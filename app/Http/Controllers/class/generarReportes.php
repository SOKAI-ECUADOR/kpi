<?php

include_once 'lib/fpdf/fpdf.php';
include_once 'lib/fpdf/fhtml.php';
// include_once 'PDFPapeleta.php';
include_once 'myPDF.php';
include_once 'NumeroLetra.php';
// include 'lib/barcode-php1/class/BCGcode128.barcode.php';
// //include 'lib/barcode-php1/class/BCGColor.php';
// include 'lib/barcode-php1/class/BCGDrawing.php';
include_once getenv("FILE_CONFIG_PHP");
class generarReportes
{
    public function factura_reporte($datos, $modo,$valores_ice, $fec_ini, $fec_fin,$nombre_producto,$retenciones)
    {
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);
        $logo = constant("DATA_EMPRESA") . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->RoundedRect(10, 10, 279, 25, 2, '1234', 'D');
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(70, 11);
        //$pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->MultiCell(155, 4, utf8_decode($datos[0]->nombre_empresa), 0, 'C');
        $cab_emp=$pdf->GetY();
        $pdf->SetXY(70, $cab_emp+1);
        $pdf->SetFont('Arial', 'B', 12);
        $modo == 1
        ? $pdf->Cell(155, 8, utf8_decode('Reporte de Ventas'), 0, 2, 'C', 0)
        : $pdf->Cell(155, 8, utf8_decode('Reporte de proformas'), 0, 2, 'C', 0);
        $pdf->SetX(70);
        if($nombre_producto!="" || $nombre_producto!=null){
            $pdf->MultiCell(155, 4, 'Producto: '.utf8_decode($nombre_producto), 0, 'C');
        }else{
            $pdf->MultiCell(155, 4, utf8_decode($nombre_producto), 0, 'C');
        }
        
        //prueba
        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null && $fec_fin == null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $exist_tbasec = 0;
        $exist_tbased = 0;
        $exist_tivad = 0;
        $exist_tdesc = 0;
        $exist_tivaret = 0;
        $exist_tirf = 0;
        $exist_ttra = 0;
        $exist_total = 0;
        $exist_total_descuento=0;
        $exist_total_ice=0;
        $exist_total_subt=0;
        $exist_totalf = 0;
        $exis_totdesc = 0;
        $exis_totalf=0;
        $datos_filtrado2 = [];
        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->id_factura, $datos_filtrado2)) {
                $datos_filtrado2[$datos[$key]->id_factura] = $datos[$key];
            }
        }
        $id_planes=0;
        $array_ice=[];
        $suma_ice=0;
        foreach ($datos_filtrado2 as $detail) {
           $id_planes=$detail->id_factura;
           
           foreach($valores_ice as $detail){
                if( $id_planes==$detail->id_factura){
                    //array_push($array_ice,$detail->total_ice);
                    $suma_ice+=$detail->total_ice;
                }
           }
           array_push($array_ice,$suma_ice);
           $suma_ice=0;
        }
        //dd($array_ice);
        $cuentas=-1;
        foreach ($datos_filtrado2 as $detail) {
            $cuentas++;

            $exist_total_ice+=$array_ice[$cuentas];
            $exist_total_subt+=$detail->subtotal_sin_impuesto;
            // $exist_tbasec = $detail->subtotal_sin_impuesto + $exist_tbasec;
            // $exist_tbasec = $detail->subtotal_0 + $exist_tbasec;
            // $exist_tbasec = $detail->subtotal_0 + $exist_tbasec;
            $exis_totdesc += $detail->descuento + $detail->cantidadiva + $detail->cantidadrenta;
            $exis_totalf += $detail->valor_total - $exis_totdesc;
            $exist_tbasec += $detail->subtotal_0;
            $exist_tbased += $detail->subtotal_12;
            $exist_tivad += $detail->iva_12;
            $exist_tdesc += $detail->descuento;
            $exist_tivaret += $detail->cantidadiva;
            $exist_tirf += $detail->cantidadrenta;
            $exist_total += $detail->valor_total;
        }
        $aumento=0;
        if($exist_total_ice<=0){
            $aumento+=7.5;
        }
        if($exist_tbasec<=0){
            $aumento+=7.5;
        }
        if($exist_tbased<=0){
            $aumento+=7.5;
        }
        if($exist_tivad<=0){
            $aumento+=7.5;
        }
        if($exist_tdesc<=0){
            $aumento+=7.5;
        }
        if($exist_tivaret<=0){
            $aumento+=7.5;
        }
        if($exist_tirf<=0){
            $aumento+=7.5;
        } 
        $pdf->SetY(40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(6, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'Fecha', 1, 0, 'C', 1);
        $pdf->Cell(10, 6, 'Tipo', 1, 0, 'C', 1);
        
        if($modo != 1){
            $pdf->Cell(14, 6, 'Facturado', 1, 0, 'C', 1);
        }
        
        $modo == 1
        ? $pdf->Cell(20, 6, 'No. Fac', 1, 0, 'C', 1)
        : $pdf->Cell(20, 6, 'No. Prof', 1, 0, 'C', 1);
        //$pdf->Cell(15, 6, 'Serie', 1, 0, 'C', 1);
        $pdf->Cell(23, 6, 'RUC/Cedula', 1, 0, 'C', 1);
        $pdf->Cell(50+$aumento, 6, 'NOMBRE', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'SUBTOTAL', 1, 0, 'C', 1);
        if($exist_total_ice>0){
            $pdf->Cell(15, 6, 'ICE', 1, 0, 'C', 1);
        }
        if($exist_tbasec>0){
            $pdf->Cell(15, 6, 'BASE 0%', 1, 0, 'C', 1);
        }
        if($exist_tbased>0){
            $pdf->Cell(15, 6, 'BASE 12%', 1, 0, 'C', 1);
        }
        if($exist_tivad>0){
            $pdf->Cell(15, 6, 'I.V.A. 12%', 1, 0, 'C', 1);
        }
        if($exist_tdesc>0){
            $pdf->Cell(15, 6, 'Dsctos.', 1, 0, 'C', 1);
        }
        if($exist_tivaret>0){
            $pdf->Cell(15, 6, 'IVA Ret', 1, 0, 'C', 1);
        }
        if($exist_tirf>0){
            $pdf->Cell(15, 6, 'I.R.F.', 1, 0, 'C', 1);
        } 
        
        $pdf->Cell(15, 6, 'TOTAL', 1, 0, 'C', 1);
        $pdf->Cell(20+$aumento, 6, 'VEND.', 1, 0, 'C', 1);
        $pdf->ln();

        $totalf = 0;
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        $contador = 1;
        $tbasec = 0;
        $tbased = 0;
        $tivad = 0;
        $tdesc = 0;
        $tivaret = 0;
        $tirf = 0;
        $ttra = 0;
        $total = 0;
        $total_descuento=0;
        $total_ice=0;
        $total_subt=0;
        
        $datos_filtrado = [];

        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->id_factura, $datos_filtrado)) {
                $datos_filtrado[$datos[$key]->id_factura] = $datos[$key];
            }
        }
        
        //dd($datos);
        $cuenta_2=-1;
        foreach ($datos_filtrado as $detail) {
            $cuenta_2++;
            $pdf->Cell(6, 6, $contador, 1, 0, 'C', 1);
            $pdf->Cell(15, 6, $detail->fecha_emision, 1, 0, 'C', 1);
            $modo == 1 ? $pdf->Cell(10, 6, 'FAC', 1, 0, 'C', 1) : $pdf->Cell(10, 6, 'PROF', 1, 0, 'C', 1);
            
            if($modo != 1){
                if($detail->estatus){
                    $pdf->Cell(14, 6, 'SI', 1, 0, 'C', 1);
                }
                else{
                    $pdf->Cell(14, 6, 'NO', 1, 0, 'C', 1);
                }
            }
            
            $serie1=substr($detail->clave_acceso,24,3);
            $serie2=substr($detail->clave_acceso,27,3);
            if($modo==1){
                $documento=substr($detail->clave_acceso,30,9);
            }else{
                $documento=$detail->codigo;
            }
            //$documento=substr($detail->clave_acceso,30,9);
            //$pdf->Cell(15, 6, $detail->id_factura, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $documento, 1, 0, 'C', 1);
            //$pdf->Cell(15, 6, '00' . $detail->id_punto_emision . '00' . $detail->id_establecimiento, 1, 0, 'C', 1);
            //$pdf->Cell(15, 6, $serie1.'-'.$serie2, 1, 0, 'C', 1);
            $pdf->Cell(23, 6, $detail->identificacion, 1, 0, 'C', 1);
            if($modo == 1){
                if($detail->estado>0){
                    $pdf->Cell(50+$aumento, 6, utf8_decode($detail->nombre), 1, 0, 'L', 1);
                }else{
                    $pdf->Cell(50+$aumento, 6, utf8_decode("ANULADO"), 1, 0, 'L', 1);
                }
            }else{
                $pdf->Cell(50+$aumento, 6, utf8_decode($detail->nombre), 1, 0, 'L', 1);
            }
            
            //$pdf->Cell(50+$aumento, 6, utf8_decode($detail->nombre), 1, 0, 'L', 1);
            if($modo == 1){
                if($detail->estado>0){
                    $pdf->Cell(15, 6, number_format($detail->subtotal_sin_impuesto,2,".",","), 1, 0, 'R', 1);
                }else{
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }
            }else{
                $pdf->Cell(15, 6, number_format($detail->subtotal_sin_impuesto,2,".",","), 1, 0, 'R', 1);
            }
            
            if($exist_total_ice>0){
                if($modo == 1){
                    if($detail->estado>0){
                        $pdf->Cell(15, 6, number_format($array_ice[$cuenta_2],2,".",","), 1, 0, 'R', 1);
                    }else{
                        $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                    }
                }else{
                    $pdf->Cell(15, 6, number_format($array_ice[$cuenta_2],2,".",","), 1, 0, 'R', 1);
                }
            }
            if($exist_tbasec>0){
                if($modo == 1){
                    if($detail->estado>0){
                        $pdf->Cell(15, 6, number_format($detail->subtotal_0,2,".",","), 1, 0, 'R', 1);
                    }else{
                        $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                    }
                }else{
                    $pdf->Cell(15, 6, number_format($detail->subtotal_0,2,".",","), 1, 0, 'R', 1);
                }
            }
            if($exist_tbased>0){
                if($modo == 1){
                    if($detail->estado>0){
                        $pdf->Cell(15, 6, number_format($detail->subtotal_12,2,".",","), 1, 0, 'R', 1);
                    }else{
                        $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                    }
                }else{
                    $pdf->Cell(15, 6, number_format($detail->subtotal_12,2,".",","), 1, 0, 'R', 1);
                }
            }
            if($exist_tivad>0){
                if($modo == 1){
                    if($detail->estado>0){
                        $pdf->Cell(15, 6, number_format($detail->iva_12,2,".",","), 1, 0, 'R', 1);
                    }else{
                        $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                    }
                }else{
                    $pdf->Cell(15, 6, number_format($detail->iva_12,2,".",","), 1, 0, 'R', 1);
                }
            }
            if($exist_tdesc>0){
                if($modo == 1){
                    if($detail->estado>0){
                        $pdf->Cell(15, 6, number_format($detail->descuento,2,".",","), 1, 0, 'R', 1);
                    }else{
                        $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                    }
                }else{
                    $pdf->Cell(15, 6, number_format($detail->descuento,2,".",","), 1, 0, 'R', 1);
                }
            }
            
            // if ($detail->cantidadiva != 0 && $detail->cantidadrenta != 0) {
            //     $cantiva = $detail->cantidadiva;
            //     $cantrent = $detail->cantidadrenta;
            //     $pdf->Cell(15, 6, number_format($cantiva,2,".",","), 1, 0, 'R', 1);
            //     $pdf->Cell(15, 6, number_format($cantrent,2,".",","), 1, 0, 'R', 1);
            // } else {
            //     $cantiva = 0.00;
            //     $cantrent = 0.00;
            // $exist_tivaret += $detail->cantidadiva;
            // $exist_tirf += $detail->cantidadrenta;
            if($exist_tivaret>0){
                if($modo == 1){
                    if($detail->estado>0){
                        foreach($retenciones as $detail_2){
                            if($detail->id_factura==$detail_2->id_factura){
                                $tivaret = $tivaret + $detail_2->cantidad_iva;
                                $pdf->Cell(15, 6, number_format($detail_2->cantidad_iva,2,".",","), 1, 0, 'R', 1);
                            }
                        }  
                    }else{
                        $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                    }
                }else{
                    foreach($retenciones as $detail_2){
                        if($detail->id_factura==$detail_2->id_factura){
                            $tivaret = $tivaret + $detail_2->cantidad_iva;
                            $pdf->Cell(15, 6, number_format($detail_2->cantidad_iva,2,".",","), 1, 0, 'R', 1);
                        }
                    }  
                }
            }
            if($exist_tirf>0){
                if($modo == 1){
                    if($detail->estado>0){
                        //$pdf->Cell(15, 6, number_format($detail->cantidadrenta,2,".",","), 1, 0, 'R', 1);
                        foreach($retenciones as $detail_2){
                            if($detail->id_factura==$detail_2->id_factura){
                                $tirf = $tirf + $detail_2->cantidad_irf;
                                $pdf->Cell(15, 6, number_format($detail_2->cantidad_irf,2,".",","), 1, 0, 'R', 1);
                            }
                        }  
                    }else{
                        $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                    }
                }else{
                    foreach($retenciones as $detail_2){
                        if($detail->id_factura==$detail_2->id_factura){
                            $tirf = $tirf + $detail_2->cantidad_irf;
                            $pdf->Cell(15, 6, number_format($detail_2->cantidad_irf,2,".",","), 1, 0, 'R', 1);
                        }
                    } 
                }
            }
            
            //}
            if($modo == 1){
                if($detail->estado>0){
                    $totdesc = $detail->descuento + $detail->cantidadiva + $detail->cantidadrenta;
                }
            }else{
                $totdesc = $detail->descuento + $detail->cantidadiva + $detail->cantidadrenta;
            }
            
            //$totalf = $detail->valor_total - $totdesc;
            $detail->valor_total = $detail->valor_total - $totdesc;
            if($modo == 1){
                if($detail->estado>0){
                    $totalf = $detail->valor_total;
                }
            }else{
                $totalf = $detail->valor_total;
            }
            if($modo == 1){
                if($detail->estado>0){
                    $pdf->Cell(15, 6, number_format($detail->valor_total,2,".",","), 1, 0, 'R', 1);
                }else{
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }  
            }else{
                $pdf->Cell(15, 6, number_format($detail->valor_total,2,".",","), 1, 0, 'R', 1);
            }
            
            $pdf->Cell(20+$aumento, 6, utf8_decode($detail->vendedor), 1, 0, 'L', 1);
            $pdf->Ln();
            if($modo == 1){
                if($detail->estado>0){
                    $total_ice+=$array_ice[$cuenta_2];
                }
                if($detail->estado>0){
                    $total_subt+=$detail->subtotal_sin_impuesto;
                }
                if($detail->estado>0){
                    $tbasec += $detail->subtotal_0;
                }
                if($detail->estado>0){
                    $tbased = $tbased + $detail->subtotal_12;
                }
                if($detail->estado>0){
                    $tivad = $tivad + $detail->iva_12;
                }
                if($detail->estado>0){
                    $tdesc += $detail->descuento;
                }
                if($detail->estado>0){
                    $total = $total + $totalf;
                }
            }else{
                $total_ice+=$array_ice[$cuenta_2];
                $total_subt+=$detail->subtotal_sin_impuesto;
                $tbasec += $detail->subtotal_0;
                $tbased = $tbased + $detail->subtotal_12;
                $tivad = $tivad + $detail->iva_12;
                $tdesc += $detail->descuento;
                $total = $total + $totalf;
            }
            
            $contador++;
            //$total += $detail->unit_price * $detail->quantity;
        }
        $pdf->SetFillColor(108, 154, 216);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(124+$aumento, 6, 'TOTAL:', 1, 0, 'R', 0);
        $pdf->Cell(15, 6, number_format($total_subt,2,".",","), 1, 0, 'R', 0);
        if($exist_total_ice>0){
            $pdf->Cell(15, 6, number_format($total_ice,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tbasec>0){
            $pdf->Cell(15, 6, number_format($tbasec,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tbased>0){
            $pdf->Cell(15, 6, number_format($tbased,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tivad>0){
            $pdf->Cell(15, 6, number_format($tivad,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tdesc>0){
            $pdf->Cell(15, 6, number_format($tdesc,2,".",","), 1, 0, 'R', 0);
        }
        
        if($exist_tivaret>0){
            $pdf->Cell(15, 6, number_format($tivaret,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tirf>0){
            $pdf->Cell(15, 6, number_format($tirf,2,".",","), 1, 0, 'R', 0);
        }
        
        
        //$pdf->Cell(15, 6, number_format($ttra,2,".",","), 1, 0, 'R', 0);
        
        
        
        $pdf->Cell(14.9, 6, number_format($total,2,".",","), 1, 0, 'R', 0);

        return $modo == 1 ? $pdf->Output('reporte-facturas-ventas.pdf', 'D') : $pdf->Output('reporte-proformas.pdf', 'D');
    }
    public function producto_vs_costos_reporte($datos, $fec_ini, $fec_fin)
    {
        $fecha_actual = date("d/m/Y");
        $total_cantidad = 0;
        $total_ventas = 0;
        $total_costos = 0;
        $total_utilidad = 0;
        $total_utilidad_porcent = "0%";
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);
        $logo = constant("DATA_EMPRESA") . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->RoundedRect(10, 10, 279, 25, 2, '1234', 'D');
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(70, 11);
        //$pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->MultiCell(155, 4, utf8_decode($datos[0]->nombre_empresa), 0, 'C');
        $cab_emp=$pdf->GetY();
        $pdf->SetXY(70, $cab_emp+1);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de Producto'), 0, 2, 'C', 0);
        $pdf->SetXY(70, $cab_emp+7);
        $pdf->Cell(155, 8, utf8_decode('Ventas VS Costos'), 0, 2, 'C', 0);
        
        //prueba
        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null && $fec_fin == null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        
        $pdf->SetY(40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(10, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, utf8_decode('CÃ³digo'), 1, 0, 'C', 1);
        $pdf->Cell(120, 6, 'Producto', 1, 0, 'C', 1);
        
        
        $pdf->Cell(25, 6, 'Cantidad', 1, 0, 'C', 1);
        $pdf->Cell(25, 6, 'Ventas', 1, 0, 'C', 1);
        $pdf->Cell(25, 6, 'Costo', 1, 0, 'C', 1);
        $pdf->Cell(30, 6, 'Utilidad', 1, 0, 'C', 1);
        
        $pdf->Cell(30, 6, '% Utilidad', 1, 0, 'C', 1);
        $pdf->ln();
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        for($i=0; $i<count($datos); $i++){
            $pdf->Cell(10, 6, $i+1, 1, 0, 'R', 1);
            $pdf->Cell(15, 6, $datos[$i]->codigo, 1, 0, 'C', 1);
            $pdf->Cell(120, 6, utf8_decode($datos[$i]->nombre), 1, 0, 'L', 1);
            
            
            $pdf->Cell(25, 6, number_format($datos[$i]->cantidad, 2, ".", ","), 1, 0, 'R', 1);
            $pdf->Cell(25, 6, number_format($datos[$i]->venta, 2, ".", ","), 1, 0, 'R', 1);
            $pdf->Cell(25, 6, number_format($datos[$i]->costo, 2, ".", ","), 1, 0, 'R', 1);
            $pdf->Cell(30, 6, number_format($datos[$i]->utilidad, 2, ".", ","), 1, 0, 'R', 1);
            
            $pdf->Cell(30, 6, number_format($datos[$i]->utilidad_porcent, 2, ".", ",")."%", 1, 0, 'R', 1);
            $pdf->ln();

            $total_cantidad = $total_cantidad + $datos[$i]->cantidad;
            $total_ventas = $total_ventas + $datos[$i]->venta;
            $total_costos = $total_costos + $datos[$i]->costo;
        }

        $total_utilidad = $total_ventas - $total_costos;
        $total_utilidad_porcent = round(($total_utilidad/$total_costos)*100, 2);

        $pdf->SetFont('Arial', 'B', 7);

        $pdf->Cell(145, 6, 'Total:', 1, 0, 'R', 1);
            
        $pdf->Cell(25, 6, number_format($total_cantidad, 2, ".", ","), 1, 0, 'R', 1);
        $pdf->Cell(25, 6, number_format($total_ventas, 2, ".", ","), 1, 0, 'R', 1);
        $pdf->Cell(25, 6, number_format($total_costos, 2, ".", ","), 1, 0, 'R', 1);
        $pdf->Cell(30, 6, number_format($total_utilidad, 2, ".", ","), 1, 0, 'R', 1);
            
        $pdf->Cell(30, 6, number_format($total_utilidad_porcent, 2, ".", ",")."%", 1, 0, 'R', 1);

        return $pdf->Output('reporte-producto-ventas-vs-costos.pdf', 'D');
    }
    public function factura_vs_costos_reporte($datos, $fec_ini, $fec_fin)
    {
        $fecha_actual = date("d/m/Y");
        $total_valor = 0;
        $total_costos = 0;
        $total_utilidad = 0;
        $total_utilidad_porcent = "0%";
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);
        $logo = constant("DATA_EMPRESA") . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->RoundedRect(10, 10, 279, 25, 2, '1234', 'D');
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(70, 11);
        //$pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->MultiCell(155, 4, utf8_decode($datos[0]->nombre_empresa), 0, 'C');
        $cab_emp=$pdf->GetY();
        $pdf->SetXY(70, $cab_emp+1);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de Factura'), 0, 2, 'C', 0);
        $pdf->SetXY(70, $cab_emp+7);
        $pdf->Cell(155, 8, utf8_decode('Ventas VS Costos'), 0, 2, 'C', 0);
        
        //prueba
        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null && $fec_fin == null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        
        $pdf->SetY(40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(10, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(25, 6, utf8_decode('Factura'), 1, 0, 'C', 1);
        $pdf->Cell(30, 6, 'Fecha', 1, 0, 'C', 1);
        
        
        $pdf->Cell(85, 6, 'Cliente', 1, 0, 'C', 1);
        $pdf->Cell(30, 6, 'Valor', 1, 0, 'C', 1);
        $pdf->Cell(30, 6, 'Costo', 1, 0, 'C', 1);
        $pdf->Cell(35, 6, 'Utilidad', 1, 0, 'C', 1);
        
        $pdf->Cell(35, 6, '% Utilidad', 1, 0, 'C', 1);
        $pdf->ln();
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        for($i=0; $i<count($datos); $i++){
            $pdf->Cell(10, 6, $i+1, 1, 0, 'R', 1);
            $pdf->Cell(25, 6, $datos[$i]->factura, 1, 0, 'R', 1);
            $pdf->Cell(30, 6, $datos[$i]->fecha, 1, 0, 'C', 1);
            
            
            $pdf->Cell(85, 6, $datos[$i]->cliente, 1, 0, 'L', 1);
            $pdf->Cell(30, 6, number_format($datos[$i]->valor, 2), 1, 0, 'R', 1);
            $pdf->Cell(30, 6, number_format($datos[$i]->costo, 2), 1, 0, 'R', 1);
            $pdf->Cell(35, 6, number_format($datos[$i]->utilidad, 2), 1, 0, 'R', 1);
            
            $pdf->Cell(35, 6, number_format($datos[$i]->utilidad_porcent, 2, ".", ",")."%", 1, 0, 'R', 1);
            $pdf->ln();

            $total_valor = $total_valor + $datos[$i]->valor;
            $total_costos = $total_costos + $datos[$i]->costo;
        }

        $total_utilidad = $total_valor - $total_costos;
        $total_utilidad_porcent = round(($total_utilidad/$total_costos)*100, 2) . "%";

        $pdf->SetFont('Arial', 'B', 7);

        $pdf->Cell(150, 6, 'Total:', 1, 0, 'R', 1);
            
        $pdf->Cell(30, 6, number_format($total_valor, 2), 1, 0, 'R', 1);
        $pdf->Cell(30, 6, number_format($total_costos, 2), 1, 0, 'R', 1);
        $pdf->Cell(35, 6, number_format($total_utilidad, 2), 1, 0, 'R', 1);
            
        $pdf->Cell(35, 6, $total_utilidad_porcent, 1, 0, 'R', 1);

        return $pdf->Output('reporte-factura-ventas-vs-costos.pdf', 'D');
    }
    public function vendedor_reporte($datos, $fec_ini, $fec_fin)
    {
        $fecha_actual = date("d/m/Y");
        $total_subtotal = 0;
        $total_iva = 0;
        $total_valor = 0;
        $total_cobrado = 0;
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);
        $logo = constant("DATA_EMPRESA") . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->RoundedRect(10, 10, 279, 25, 2, '1234', 'D');
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(70, 11);
        //$pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->MultiCell(155, 4, utf8_decode($datos[0]->nombre_empresa), 0, 'C');
        $cab_emp=$pdf->GetY();
        $pdf->SetXY(70, $cab_emp+1);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de Vendedor'), 0, 2, 'C', 0);
        $pdf->SetXY(70, $cab_emp+7);
        $pdf->Cell(155, 8, utf8_decode($datos[0]->vendedor), 0, 2, 'C', 0);
        
        //prueba
        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null && $fec_fin == null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        
        $pdf->SetY(40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(10, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(30, 6, utf8_decode('Factura'), 1, 0, 'C', 1);
        $pdf->Cell(20, 6, utf8_decode('Tipo'), 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'Fecha', 1, 0, 'C', 1);
        $pdf->Cell(50, 6, 'Cliente', 1, 0, 'C', 1);
        
        
        $pdf->Cell(30, 6, 'Subtotal', 1, 0, 'C', 1);
        $pdf->Cell(30, 6, 'Iva', 1, 0, 'C', 1);
        $pdf->Cell(30, 6, 'Total', 1, 0, 'C', 1);
        $pdf->Cell(30, 6, 'Cobrado', 1, 0, 'C', 1);
        $pdf->Cell(30, 6, 'Saldo', 1, 0, 'C', 1);
        $pdf->ln();
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        
        for($i=0; $i<count($datos); $i++){
            $pdf->Cell(10, 6, $i+1, 1, 0, 'R', 1);
            $pdf->Cell(30, 6, $datos[$i]->factura, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $datos[$i]->tipo, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $datos[$i]->fecha, 1, 0, 'C', 1);
            $pdf->Cell(50, 6, utf8_decode($datos[$i]->cliente), 1, 0, 'L', 1);

            $saldo = $datos[$i]->valor - $datos[$i]->cobrado;
            
            $pdf->Cell(30, 6, number_format($datos[$i]->subtotal, 2), 1, 0, 'R', 1);
            $pdf->Cell(30, 6, number_format($datos[$i]->iva, 2), 1, 0, 'R', 1);
            $pdf->Cell(30, 6, number_format($datos[$i]->valor, 2), 1, 0, 'R', 1);
            $pdf->Cell(30, 6, number_format($datos[$i]->cobrado, 2), 1, 0, 'R', 1);
            $pdf->Cell(30, 6, number_format($saldo, 2), 1, 0, 'R', 1);

            $total_subtotal = $total_subtotal + $datos[$i]->subtotal;
            $total_iva = $total_iva + $datos[$i]->iva;
            $total_valor = $total_valor + $datos[$i]->valor;
            $total_cobrado = $total_cobrado + $datos[$i]->cobrado;
            
            $pdf->ln();
        }

        $total_saldo = $total_valor - $total_cobrado;

        $pdf->SetFont('Arial', 'B', 7);

        $pdf->Cell(130, 6, 'Total:', 1, 0, 'R', 1);
            
        $pdf->Cell(30, 6, number_format($total_subtotal, 2), 1, 0, 'R', 1);
        $pdf->Cell(30, 6, number_format($total_iva, 2), 1, 0, 'R', 1);
        $pdf->Cell(30, 6, number_format($total_valor, 2), 1, 0, 'R', 1);
        $pdf->Cell(30, 6, number_format($total_cobrado, 2), 1, 0, 'R', 1);
        $pdf->Cell(30, 6, number_format($total_saldo, 2), 1, 0, 'R', 1);

        return $pdf->Output('reporte-vendedores.pdf', 'D');
    }
    public function factura_compra_por_producto_reporte($datos, $fec_ini, $fec_fin)
    {
        $fecha_actual = date("d/m/Y");
        $total_cantidad = 0;
        $total_costo = 0;
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);
        $logo = constant("DATA_EMPRESA") . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->RoundedRect(10, 10, 279, 25, 2, '1234', 'D');
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(70, 11);
        //$pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->MultiCell(155, 4, utf8_decode($datos[0]->nombre_empresa), 0, 'C');
        $cab_emp=$pdf->GetY();
        $pdf->SetXY(70, $cab_emp+1);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de Compras por Producto'), 0, 2, 'C', 0);
        
        //prueba
        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null && $fec_fin == null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        
        $pdf->SetY(40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(10, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(30, 6, 'Fecha', 1, 0, 'C', 1);
        $pdf->Cell(40, 6, utf8_decode('Factura'), 1, 0, 'C', 1);
        
        
        $pdf->Cell(30, 6, utf8_decode('CÃ³digo'), 1, 0, 'C', 1);
        $pdf->Cell(100, 6, 'Producto', 1, 0, 'C', 1);
        $pdf->Cell(35, 6, 'Cantidad', 1, 0, 'C', 1);
        $pdf->Cell(35, 6, 'Costo', 1, 0, 'C', 1);
        
        $pdf->ln();
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        for($i=0; $i<count($datos); $i++){
            $pdf->Cell(10, 6, $i+1, 1, 0, 'R', 1);
            $pdf->Cell(30, 6, $datos[$i]->fecha, 1, 0, 'C', 1);
            $pdf->Cell(40, 6, $datos[$i]->factura, 1, 0, 'R', 1);
            
            
            $pdf->Cell(30, 6, $datos[$i]->codigo, 1, 0, 'R', 1);
            $pdf->Cell(100, 6, $datos[$i]->producto, 1, 0, 'L', 1);
            $pdf->Cell(35, 6, $datos[$i]->cantidad, 1, 0, 'R', 1);
            $pdf->Cell(35, 6, round($datos[$i]->costo, 2), 1, 0, 'R', 1);

            $total_cantidad = $total_cantidad + $datos[$i]->cantidad;
            $total_costo = $total_costo + $datos[$i]->costo;
            
            $pdf->ln();

        }

        
        $pdf->SetFont('Arial', 'B', 7);

        $pdf->Cell(210, 6, 'Total:', 1, 0, 'R', 1);
            
        $pdf->Cell(35, 6, $total_cantidad, 1, 0, 'R', 1);
        $pdf->Cell(35, 6, round($total_costo, 2), 1, 0, 'R', 1);

        return $pdf->Output('reporte-factura-compras-por-producto.pdf', 'D');
    }
    public function nota_venta_reporte($datos, $modo,$valores_ice, $fec_ini, $fec_fin,$nombre_producto)
    {
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);
        $logo = constant("DATA_EMPRESA") . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(70, 11);
        //$pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->MultiCell(155, 4, utf8_decode($datos[0]->nombre_empresa), 0, 'C');
        $cab_emp=$pdf->GetY();
        $pdf->SetXY(70, $cab_emp+1);
        $pdf->SetFont('Arial', 'B', 12);
        $modo == 1
        ? $pdf->Cell(155, 8, utf8_decode('Reporte de Nota Venta'), 0, 2, 'C', 0)
        : $pdf->Cell(155, 8, utf8_decode('Reporte de proformas'), 0, 2, 'C', 0);
        $pdf->SetX(70);
        if($nombre_producto!="" || $nombre_producto!=null){
            $pdf->MultiCell(155, 4, 'Producto: '.utf8_decode($nombre_producto), 0, 'C');
        }else{
            $pdf->MultiCell(155, 4, utf8_decode($nombre_producto), 0, 'C');
        }
        
        //prueba
        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null && $fec_fin == null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $exist_tbasec = 0;
        $exist_tbased = 0;
        $exist_tivad = 0;
        $exist_tdesc = 0;
        $exist_tivaret = 0;
        $exist_tirf = 0;
        $exist_ttra = 0;
        $exist_total = 0;
        $exist_total_descuento=0;
        $exist_total_ice=0;
        $exist_total_subt=0;
        $exist_totalf = 0;
        $exis_totdesc = 0;
        $exis_totalf=0;
        $datos_filtrado2 = [];
        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->id_factura, $datos_filtrado2)) {
                $datos_filtrado2[$datos[$key]->id_factura] = $datos[$key];
            }
        }
        $id_planes=0;
        $array_ice=[];
        $suma_ice=0;
        foreach ($datos_filtrado2 as $detail) {
           $id_planes=$detail->id_factura;
           
           foreach($valores_ice as $detail){
                if( $id_planes==$detail->id_factura){
                    //array_push($array_ice,$detail->total_ice);
                    $suma_ice+=$detail->total_ice;
                }
           }
           array_push($array_ice,$suma_ice);
           $suma_ice=0;
        }
        //dd($array_ice);
        $cuentas=-1;
        foreach ($datos_filtrado2 as $detail) {
            $cuentas++;

            $exist_total_ice+=$array_ice[$cuentas];
            $exist_total_subt+=$detail->subtotal_sin_impuesto;
            // $exist_tbasec = $detail->subtotal_sin_impuesto + $exist_tbasec;
            // $exist_tbasec = $detail->subtotal_0 + $exist_tbasec;
            // $exist_tbasec = $detail->subtotal_0 + $exist_tbasec;
            $exis_totdesc += $detail->descuento + $detail->cantidadiva + $detail->cantidadrenta;
            $exis_totalf += $detail->valor_total - $exis_totdesc;
            $exist_tbasec += $detail->subtotal_0;
            $exist_tbased += $detail->subtotal_12;
            $exist_tivad += $detail->iva_12;
            $exist_tdesc += $detail->descuento;
            $exist_tivaret += $detail->cantidadiva;
            $exist_tirf += $detail->cantidadrenta;
            $exist_total += $detail->valor_total;
        }
        $aumento=0;
        if($exist_total_ice<=0){
            $aumento+=7.5;
        }
        if($exist_tbasec<=0){
            $aumento+=7.5;
        }
        if($exist_tbased<=0){
            $aumento+=7.5;
        }
        if($exist_tivad<=0){
            $aumento+=7.5;
        }
        if($exist_tdesc<=0){
            $aumento+=7.5;
        }
        if($exist_tivaret<=0){
            $aumento+=7.5;
        }
        if($exist_tirf<=0){
            $aumento+=7.5;;
        } 
        $pdf->SetY(40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(6, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'Fecha', 1, 0, 'C', 1);
        $pdf->Cell(10, 6, 'Tipo', 1, 0, 'C', 1);
        $modo == 1
        ? $pdf->Cell(15, 6, 'No. NV', 1, 0, 'C', 1)
        : $pdf->Cell(15, 6, 'No. Prof', 1, 0, 'C', 1);
        //$pdf->Cell(15, 6, 'Serie', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'RUC/Cedula', 1, 0, 'C', 1);
        $pdf->Cell(50+$aumento, 6, 'NOMBRE', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'SUBTOTAL', 1, 0, 'C', 1);
        if($exist_total_ice>0){
            $pdf->Cell(15, 6, 'ICE', 1, 0, 'C', 1);
        }
        if($exist_tbasec>0){
            $pdf->Cell(15, 6, 'BASE 0%', 1, 0, 'C', 1);
        }
        if($exist_tbased>0){
            $pdf->Cell(15, 6, 'BASE 12%', 1, 0, 'C', 1);
        }
        if($exist_tivad>0){
            $pdf->Cell(15, 6, 'I.V.A. 12%', 1, 0, 'C', 1);
        }
        if($exist_tdesc>0){
            $pdf->Cell(15, 6, 'Dsctos.', 1, 0, 'C', 1);
        }
        if($exist_tivaret>0){
            $pdf->Cell(15, 6, 'IVA Ret', 1, 0, 'C', 1);
        }
        if($exist_tirf>0){
            $pdf->Cell(15, 6, 'I.R.F.', 1, 0, 'C', 1);
        } 
        
        $pdf->Cell(15, 6, 'TOTAL', 1, 0, 'C', 1);
        $pdf->Cell(20+$aumento, 6, 'VEND.', 1, 0, 'C', 1);
        $pdf->ln();

        $totalf = 0;
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        $contador = 1;
        $tbasec = 0;
        $tbased = 0;
        $tivad = 0;
        $tdesc = 0;
        $tivaret = 0;
        $tirf = 0;
        $ttra = 0;
        $total = 0;
        $total_descuento=0;
        $total_ice=0;
        $total_subt=0;
        
        $datos_filtrado = [];

        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->id_factura, $datos_filtrado)) {
                $datos_filtrado[$datos[$key]->id_factura] = $datos[$key];
            }
        }
        
        //dd($datos);
        $cuenta_2=-1;
        foreach ($datos_filtrado as $detail) {
            $cuenta_2++;
            $pdf->Cell(6, 6, $contador, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $detail->fecha_emision, 1, 0, 'C', 1);
            $modo == 1 ? $pdf->Cell(10, 6, 'NV', 1, 0, 'C', 1) : $pdf->Cell(10, 6, 'PROF', 1, 0, 'C', 1);
            $serie1=substr($detail->clave_acceso,24,3);
            $serie2=substr($detail->clave_acceso,27,3);
            $documento=substr($detail->clave_acceso,30,9);
            //$pdf->Cell(15, 6, $detail->id_factura, 1, 0, 'C', 1);
            $pdf->Cell(15, 6, $documento, 1, 0, 'C', 1);
            //$pdf->Cell(15, 6, '00' . $detail->id_punto_emision . '00' . $detail->id_establecimiento, 1, 0, 'C', 1);
            //$pdf->Cell(15, 6, $serie1.'-'.$serie2, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $detail->identificacion, 1, 0, 'C', 1);
            $pdf->Cell(50+$aumento, 6, utf8_decode($detail->nombre), 1, 0, 'L', 1);
            $pdf->Cell(15, 6, number_format($detail->subtotal_sin_impuesto,2,".",","), 1, 0, 'R', 1);
            if($exist_total_ice>0){
                $pdf->Cell(15, 6, number_format($array_ice[$cuenta_2],2,".",","), 1, 0, 'R', 1);
            }
            if($exist_tbasec>0){
                $pdf->Cell(15, 6, number_format($detail->subtotal_0,2,".",","), 1, 0, 'R', 1);
            }
            if($exist_tbased>0){
                $pdf->Cell(15, 6, number_format($detail->subtotal_12,2,".",","), 1, 0, 'R', 1);
            }
            if($exist_tivad>0){
                $pdf->Cell(15, 6, number_format($detail->iva_12,2,".",","), 1, 0, 'R', 1);
            }
            if($exist_tdesc>0){
                $pdf->Cell(15, 6, number_format($detail->descuento,2,".",","), 1, 0, 'R', 1);
            }
            
            // if ($detail->cantidadiva != 0 && $detail->cantidadrenta != 0) {
            //     $cantiva = $detail->cantidadiva;
            //     $cantrent = $detail->cantidadrenta;
            //     $pdf->Cell(15, 6, number_format($cantiva,2,".",","), 1, 0, 'R', 1);
            //     $pdf->Cell(15, 6, number_format($cantrent,2,".",","), 1, 0, 'R', 1);
            // } else {
            //     $cantiva = 0.00;
            //     $cantrent = 0.00;
            // $exist_tivaret += $detail->cantidadiva;
            // $exist_tirf += $detail->cantidadrenta;
            if($exist_tivaret>0){
                $pdf->Cell(15, 6, number_format($detail->cantidadiva,2,".",","), 1, 0, 'R', 1);
            }
            if($exist_tirf>0){
                $pdf->Cell(15, 6, number_format($detail->cantidadrenta,2,".",","), 1, 0, 'R', 1);
            }
            
            
            //}
            $totdesc = $detail->descuento + $detail->cantidadiva + $detail->cantidadrenta;
            //$totalf = $detail->valor_total - $totdesc;
            $totalf = $detail->valor_total;
            $pdf->Cell(15, 6, number_format($detail->valor_total,2,".",","), 1, 0, 'R', 1);
            $pdf->Cell(20+$aumento, 6, $detail->vendedor, 1, 0, 'L', 1);
            $pdf->Ln();
            $total_ice+=$array_ice[$cuenta_2];
            $total_subt+=$detail->subtotal_sin_impuesto;
            // $tbasec = $detail->subtotal_sin_impuesto + $tbasec;
            // $tbasec = $detail->subtotal_0 + $tbasec;
            // $tbasec = $detail->subtotal_0 + $tbasec;
            $tbasec += $detail->subtotal_0;
            $tbased = $tbased + $detail->subtotal_12;
            $tivad = $tivad + $detail->iva_12;
            $tdesc += $detail->descuento;
            $tivaret = $tivaret + $detail->cantidadiva;
            $tirf = $tirf + $detail->cantidadrenta;
            $total = $total + $totalf;
            $contador++;
            //$total += $detail->unit_price * $detail->quantity;
        }
        $pdf->SetFillColor(108, 154, 216);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(121+$aumento, 6, 'TOTAL:', 1, 0, 'R', 0);
        $pdf->Cell(15, 6, number_format($total_subt,2,".",","), 1, 0, 'R', 0);
        if($exist_total_ice>0){
            $pdf->Cell(15, 6, number_format($total_ice,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tbasec>0){
            $pdf->Cell(15, 6, number_format($tbasec,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tbased>0){
            $pdf->Cell(15, 6, number_format($tbased,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tivad>0){
            $pdf->Cell(15, 6, number_format($tivad,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tdesc>0){
            $pdf->Cell(15, 6, number_format($tdesc,2,".",","), 1, 0, 'R', 0);
        }
        
        if($exist_tivaret>0){
            $pdf->Cell(15, 6, number_format($tivaret,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tirf>0){
            $pdf->Cell(15, 6, number_format($tirf,2,".",","), 1, 0, 'R', 0);
        }
        
        
        //$pdf->Cell(15, 6, number_format($ttra,2,".",","), 1, 0, 'R', 0);
        
        
        
        $pdf->Cell(15, 6, number_format($total,2,".",","), 1, 0, 'R', 0);

        return $modo == 1 ? $pdf->Output('reporte-notas-ventas.pdf', 'D') : $pdf->Output('reporte-proformas.pdf', 'D');
    }
    public function guia_reporte($datos, $fec_ini, $fec_fin,$nombre_producto)
    {
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);
        $logo = constant("DATA_EMPRESA") . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(70, 11);
        //$pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->MultiCell(155, 4, utf8_decode($datos[0]->nombre_empresa), 0, 'C');
        $cab_emp=$pdf->GetY();
        $pdf->SetXY(70, $cab_emp+1);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte Guia Remision'), 0, 2, 'C', 0);
        
        $pdf->SetX(70);
        if($nombre_producto!="" || $nombre_producto!=null){
            $pdf->MultiCell(155, 4, 'Producto: '.utf8_decode($nombre_producto), 0, 'C');
        }else{
            $pdf->MultiCell(155, 4, utf8_decode($nombre_producto), 0, 'C');
        }
        
        //prueba
        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null && $fec_fin == null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $exist_tbasec = 0;
        $exist_tbased = 0;
        $exist_tivad = 0;
        $exist_tdesc = 0;
        $exist_tivaret = 0;
        $exist_tirf = 0;
        $exist_ttra = 0;
        $exist_total = 0;
        $exist_total_descuento=0;
        $exist_total_ice=0;
        $exist_total_subt=0;
        $exist_totalf = 0;
        $exis_totdesc = 0;
        $exis_totalf=0;
        $datos_filtrado2 = [];
        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->id_factura, $datos_filtrado2)) {
                $datos_filtrado2[$datos[$key]->id_factura] = $datos[$key];
            }
        }
        $id_planes=0;
        $array_ice=[];
        $suma_ice=0;
        // foreach ($datos_filtrado2 as $detail) {
        //    $id_planes=$detail->id_factura;
           
        //    foreach($valores_ice as $detail){
        //         if( $id_planes==$detail->id_factura){
        //             //array_push($array_ice,$detail->total_ice);
        //             $suma_ice+=$detail->total_ice;
        //         }
        //    }
        //    array_push($array_ice,$suma_ice);
        //    $suma_ice=0;
        // }
        //dd($array_ice);
        $cuentas=-1;
        // foreach ($datos_filtrado2 as $detail) {
        //     $cuentas++;

        //     $exist_total_ice+=$array_ice[$cuentas];
        //     $exist_total_subt+=$detail->subtotal_sin_impuesto;
        //     // $exist_tbasec = $detail->subtotal_sin_impuesto + $exist_tbasec;
        //     // $exist_tbasec = $detail->subtotal_0 + $exist_tbasec;
        //     // $exist_tbasec = $detail->subtotal_0 + $exist_tbasec;
        //     $exis_totdesc += $detail->descuento + $detail->cantidadiva + $detail->cantidadrenta;
        //     $exis_totalf += $detail->valor_total - $exis_totdesc;
        //     $exist_tbasec += $detail->subtotal_0;
        //     $exist_tbased += $detail->subtotal_12;
        //     $exist_tivad += $detail->iva_12;
        //     $exist_tdesc += $detail->descuento;
        //     $exist_tivaret += $detail->cantidadiva;
        //     $exist_tirf += $detail->cantidadrenta;
        //     $exist_total += $detail->valor_total;
        // }
        $aumento=0;
        if($exist_total_ice<=0){
            $aumento+=7.5;
        }
        if($exist_tbasec<=0){
            $aumento+=7.5;
        }
        if($exist_tbased<=0){
            $aumento+=7.5;
        }
        if($exist_tivad<=0){
            $aumento+=7.5;
        }
        if($exist_tdesc<=0){
            $aumento+=7.5;
        }
        if($exist_tivaret<=0){
            $aumento+=7.5;
        }
        if($exist_tirf<=0){
            $aumento+=7.5;;
        } 
        $pdf->SetY(40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(6, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'Fecha Inicio', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'Fecha Fin', 1, 0, 'C', 1);
         $pdf->Cell(15, 6, 'No. Guia', 1, 0, 'C', 1);
         $pdf->Cell(30, 6, 'Motivo Traslado', 1, 0, 'C', 1);
        $pdf->Cell(46, 6, 'Direccion', 1, 0, 'C', 1);
        //$pdf->Cell(15, 6, 'Serie', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'RUC/Cedula', 1, 0, 'C', 1);
        $pdf->Cell(50+$aumento, 6, 'NOMBRE', 1, 0, 'C', 1);
        
        //$pdf->Cell(15, 6, 'SUBTOTAL', 1, 0, 'C', 1);
        if($exist_total_ice>0){
            $pdf->Cell(15, 6, 'ICE', 1, 0, 'C', 1);
        }
        if($exist_tbasec>0){
            $pdf->Cell(15, 6, 'BASE 0%', 1, 0, 'C', 1);
        }
        if($exist_tbased>0){
            $pdf->Cell(15, 6, 'BASE 12%', 1, 0, 'C', 1);
        }
        if($exist_tivad>0){
            $pdf->Cell(15, 6, 'I.V.A. 12%', 1, 0, 'C', 1);
        }
        if($exist_tdesc>0){
            $pdf->Cell(15, 6, 'Dsctos.', 1, 0, 'C', 1);
        }
        if($exist_tivaret>0){
            $pdf->Cell(15, 6, 'IVA Ret', 1, 0, 'C', 1);
        }
        if($exist_tirf>0){
            $pdf->Cell(15, 6, 'I.R.F.', 1, 0, 'C', 1);
        } 
        
        $pdf->Cell(15, 6, 'TOTAL', 1, 0, 'C', 1);
        //$pdf->Cell(20+$aumento, 6, 'VEND.', 1, 0, 'C', 1);
        $pdf->ln();

        $totalf = 0;
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        $contador = 1;
        $tbasec = 0;
        $tbased = 0;
        $tivad = 0;
        $tdesc = 0;
        $tivaret = 0;
        $tirf = 0;
        $ttra = 0;
        $total = 0;
        $total_descuento=0;
        $total_ice=0;
        $total_subt=0;
        
        $datos_filtrado = [];

        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->id_guia, $datos_filtrado)) {
                $datos_filtrado[$datos[$key]->id_guia] = $datos[$key];
            }
        }
        
        //dd($datos);
        $cuenta_2=-1;
        foreach ($datos_filtrado as $detail) {
            $cuenta_2++;
            $pdf->Cell(6, 6, $contador, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $detail->fecha_inicio_tr, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $detail->fecha_fin_tr, 1, 0, 'C', 1);
            //$pdf->Cell(10, 6, 'GUIA', 1, 0, 'C', 1);
            $serie1=substr($detail->clave_acceso,24,3);
            $serie2=substr($detail->clave_acceso,27,3);
            $documento=substr($detail->clave_acceso,30,9);
            
            //$documento=substr($detail->clave_acceso,30,9);
            //$pdf->Cell(15, 6, $detail->id_factura, 1, 0, 'C', 1);
            $pdf->Cell(15, 6, $documento, 1, 0, 'C', 1);
            $pdf->Cell(30, 6, utf8_decode($detail->motivo_translado_tr), 1, 0, 'L', 1);
            if($detail->destino_tr){
                $pdf->Cell(46, 6, utf8_decode($detail->destino_tr), 1, 0, 'L', 1);
            }else{
                $pdf->Cell(46, 6, utf8_decode($detail->direccion), 1, 0, 'L', 1);
            }
            //$pdf->Cell(15, 6, '00' . $detail->id_punto_emision . '00' . $detail->id_establecimiento, 1, 0, 'C', 1);
            //$pdf->Cell(15, 6, $serie1.'-'.$serie2, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $detail->identificacion, 1, 0, 'C', 1);
            if($detail->estado>0){
                $pdf->Cell(50+$aumento, 6, utf8_decode($detail->nombre), 1, 0, 'L', 1);
            }else{
                $pdf->Cell(50+$aumento, 6, utf8_decode("ANULADO"), 1, 0, 'L', 1);
            }
            
            
            //$pdf->Cell(50+$aumento, 6, utf8_decode($detail->nombre), 1, 0, 'L', 1);
            if($detail->estado>0){
                $pdf->Cell(15, 6, $detail->cantidad, 1, 0, 'R', 1);
            }else{
                $pdf->Cell(15, 6, 0, 1, 0, 'R', 1);
            }
            
            if($exist_total_ice>0){
                if($detail->estado>0){
                    $pdf->Cell(15, 6, number_format($array_ice[$cuenta_2],2,".",","), 1, 0, 'R', 1);
                }else{
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }
                
            }
            if($exist_tbasec>0){
                if($detail->estado>0){
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }else{
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }
                
            }
            if($exist_tbased>0){
                if($detail->estado>0){
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }else{
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }
                
            }
            if($exist_tivad>0){
                if($detail->estado>0){
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }else{
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }
                
            }
            if($exist_tdesc>0){
                if($detail->estado>0){
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }else{
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }
               
            }
            
            // if ($detail->cantidadiva != 0 && $detail->cantidadrenta != 0) {
            //     $cantiva = $detail->cantidadiva;
            //     $cantrent = $detail->cantidadrenta;
            //     $pdf->Cell(15, 6, number_format($cantiva,2,".",","), 1, 0, 'R', 1);
            //     $pdf->Cell(15, 6, number_format($cantrent,2,".",","), 1, 0, 'R', 1);
            // } else {
            //     $cantiva = 0.00;
            //     $cantrent = 0.00;
            // $exist_tivaret += $detail->cantidadiva;
            // $exist_tirf += $detail->cantidadrenta;
            if($exist_tivaret>0){
                if($detail->estado>0){
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }else{
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }
                
            }
            if($exist_tirf>0){
                if($detail->estado>0){
                    //$pdf->Cell(15, 6, number_format($detail->cantidadrenta,2,".",","), 1, 0, 'R', 1);
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }else{
                    $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
                }
                
            }
            
            
            //}
            if($detail->estado>0){
                $totdesc = 0;
            }
            
            //$totalf = $detail->valor_total - $totdesc;
            if($detail->estado>0){
                $totalf = 0;
            }
            // if($detail->estado>0){
            //     $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
            // }else{
            //     $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'R', 1);
            // }   
            //$pdf->Cell(20+$aumento, 6, utf8_decode("a"), 1, 0, 'L', 1);
            $pdf->Ln();
            if($detail->estado>0){
                $total_ice+=0;
            }
            
            if($detail->estado>0){
                $total_subt+=0;
            }
            
            // $tbasec = $detail->subtotal_sin_impuesto + $tbasec;
            // $tbasec = $detail->subtotal_0 + $tbasec;
            // $tbasec = $detail->subtotal_0 + $tbasec;
            if($detail->estado>0){
                $tbasec += 0;
            }
            
            if($detail->estado>0){
                $tbased = 0;
            }
            
            if($detail->estado>0){
                $tivad = 0;
            }
            
            if($detail->estado>0){
                $tdesc += 0;
            }
            
            // if($detail->estado>0){
            //     $tivaret = $tivaret + $detail->cantidadiva;
            // }
            
            // if($detail->estado>0){
            //     $tirf = $tirf + $detail->cantidadrenta;
            // }
            
            if($detail->estado>0){
                $total += $detail->cantidad;
            }
            
            $contador++;
            //$total += $detail->unit_price * $detail->quantity;
        }
        $pdf->SetFillColor(108, 154, 216);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(259.5, 6, 'TOTAL:', 1, 0, 'R', 0);
        //$pdf->Cell(15, 6, number_format($total_subt,2,".",","), 1, 0, 'R', 0);
        if($exist_total_ice>0){
            $pdf->Cell(15, 6, number_format($total_ice,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tbasec>0){
            $pdf->Cell(15, 6, number_format($tbasec,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tbased>0){
            $pdf->Cell(15, 6, number_format($tbased,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tivad>0){
            $pdf->Cell(15, 6, number_format($tivad,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tdesc>0){
            $pdf->Cell(15, 6, number_format($tdesc,2,".",","), 1, 0, 'R', 0);
        }
        
        if($exist_tivaret>0){
            $pdf->Cell(15, 6, number_format($tivaret,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tirf>0){
            $pdf->Cell(15, 6, number_format($tirf,2,".",","), 1, 0, 'R', 0);
        }
        
        
        //$pdf->Cell(15, 6, number_format($ttra,2,".",","), 1, 0, 'R', 0);
        
        
        
        $pdf->Cell(15, 6, $total, 1, 0, 'R', 0);

        $pdf->Output('reporte-guia-remision.pdf', 'D');
    }
    public function cierre_caja_reporte($datos, $modo,$valores_ice, $fec_ini, $fec_fin,$nombre_producto,$pagos_fact,$empresa)
    {
        
        $pdf = new PDF_MC_Table('L', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(5, 10, 286, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa[0]->id_empresa . '/imagen/' . $empresa[0]->logo;
        if (strlen($empresa[0]->logo)>0 && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 7, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(70, 12);
        $pdf->Cell(155, 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Cierre Caja'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode(''), 0, 2, 'C', 0);

        $pdf->SetXY(248, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(268, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        /*if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {*/
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        /*} else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }*/
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $exist_tbasec = 0;
        $exist_tbased = 0;
        $exist_tivad = 0;
        $exist_tdesc = 0;
        $exist_tivaret = 0;
        $exist_tirf = 0;
        $exist_ttra = 0;
        $exist_total = 0;
        $exist_total_descuento=0;
        $exist_total_ice=0;
        $exist_total_subt=0;
        $exist_totalf = 0;
        $exis_totdesc = 0;
        $exis_totalf=0;
        $datos_filtrado2 = [];
        $pdf->SetX(5);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 8);
        //dd($datos);
        $margin = 5;
            $height = 40;
            $height_products = $height +2;
            $pdf->SetXY($margin, $height_products);
            $pdf->MultiCell(30, 6, 'Fecha', 1, 'C', 0);
            $pdf->SetXY(35, $height_products);
            // $pdf->MultiCell(25, 6, 'Identificacion', 1, 'C', 0);
            //$pdf->SetXY(50, $height_products);
            $pdf->MultiCell(131, 6, 'Cliente', 1, 'C', 0);
            $pdf->SetXY(166, $height_products);
            $pdf->MultiCell(37.5, 6, 'Doc.', 1, 'C', 0);
            $pdf->SetXY(203.5, $height_products);
            $pdf->MultiCell(57.5, 6, 'Forma Pago', 1, 'C', 0);
            $pdf->SetXY(261, $height_products);
            $pdf->MultiCell(30, 6, 'Valor', 1, 'C', 0);
            $y = $height_products + 8;
            $pdf->SetFont('Helvetica', '', 4);
            $pdf->SetFillColor(255, 255, 255);
            $pdf->SetFillColor(255, 255, 255);
            $pdf->SetXY($margin, $height_products+6);
            $pdf->SetWidths(array(30,131,37.5,57.5,30));
        $datos_filtrado = $datos;

        
        
        //dd($datos);
        $cuenta_2=-1;
        $suma_total_v_cuota=0;
        foreach ($datos_filtrado as $detail) {
            $cuenta_2++;
            if(isset($detail->posicion)){
                $documento=$detail->posicion;
            }else{
                $serie1=substr($detail->clave_acceso,24,3);
                $serie2=substr($detail->clave_acceso,27,3);
                $serie3=substr($detail->clave_acceso,30,9);
                $documento=substr($detail->clave_acceso,30,9);
            }
            
            $data=array(
                date("d/m/Y", strtotime($detail->fecha_emision))."Centrado",
                "Cliente".utf8_decode($detail->nombre),
                $documento."Centrado",
                $detail->forma_pago_cxc==null ? "FormaPago"."SIN FORMA PAGO" : "FormaPago".utf8_decode($detail->forma_pago_cxc),
                number_format($detail->valor_total,2,".",",")."Derecha"
            );
            
            $pdf->RowcierreCaja($data, $margin);
        }
        $pdf->Ln(3);
        $pdf->SetFont('Arial', '', 8);
        foreach ($pagos_fact as $detail) {
            //if($detail->descripcion!=="ANTICIPO"){
                $pdf->SetX(5);
                $pdf->Cell(65, 6, $detail->descripcion==null ? "SIN FORMA PAGO" : utf8_decode($detail->descripcion), 0, 0, 'L', 0);
                $pdf->Cell(20, 6, number_format($detail->valor_total,2,".",","), 0, 1, 'R', );
                $suma_total_v_cuota+=$detail->valor_total;
            //}
        }
        $pdf->SetXY(5,$pdf->GetY()+1);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(65, 6, 'TOTAL:', 0, 0, 'L', 0);
        $pdf->Cell(20, 6, number_format($suma_total_v_cuota,2,".",","), 0, 1, 'R', 0);

        $ruta=null;
        if($ruta==null){
            $pdf->Output("reporte_cierre_caja.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."cuenta_por_cobrar_Cliente.pdf", "F");
        }
    }
    public function cierre_caja_reporteSUMIPAN($datos,$reporte_valores_pagado,$valores_pago, $fec_ini, $fec_fin,$empresa,$nombre_vendedor,$ruta=null)
    {
        //dd("FEcha inicial=".$fec_ini."Fecha fin=".$fec_fin);
        //$pdf = new FPDF('P', 'mm', 'A4');
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $pdf->AddPage();
        $pdf->AliasNbPages();

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 16);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(60, 10);
        $pdf->Cell(105, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        //$pdf->Cell(105, 8, utf8_decode('CUENTAS POR COBRAR'), 0, 2, 'C', 0);
        $pdf->Cell(105, 8, utf8_decode('CIERRE CAJA'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(105, 4, utf8_decode($nombre_vendedor), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        /*if ($fec_ini != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else */
        //if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        /*} else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }*/
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $id_prov=0;
        $exist_cobro=0;
        $exist_venta=0;
        foreach ($datos as $detail0) {
            if($detail0->valor_cuota>0){
                $exist_venta++;
            }
            
        }
        foreach($valores_pago as $detail02){
                $exist_cobro++;
        }

        
        $pdf->SetX(10);
        $totales_ventas=0;
        $totales_abono=0;
        $totales_saldo=0;
        // if($exist_venta>0){
        //     $pdf->SetFillColor(240, 240, 240);
        //     $pdf->SetFont('Arial', 'B', 8);
        //     $margin = 10;
        //         $height = 40;
        //         $height_products = $height +2;
        //         $pdf->SetXY($margin, $height_products);
        //         $pdf->MultiCell(30, 6, 'IDENTIFICACION', 1, 'C', 0);
        //         $pdf->SetXY(40, $height_products);
        //         $pdf->MultiCell(130, 6, 'CLIENTE', 1, 'C', 0);
        //         $pdf->SetXY(170, $height_products);
        //         $pdf->MultiCell(30, 6, 'VENTAS', 1, 'C', 0);
        //         // $pdf->SetXY(155, $height_products);
        //         // $pdf->MultiCell(20, 6, 'ABONOS', 1, 'C', 0);
        //         // $pdf->SetXY(175, $height_products);
        //         // $pdf->MultiCell(25, 6, 'SALDO ACTUAL', 1, 'C', 0);
        //         $y = $height_products + 8;
        //         $pdf->SetFont('Helvetica', '', 4);
        //         $pdf->SetFillColor(255, 255, 255);
        //         $pdf->SetFillColor(255, 255, 255);
        //         $pdf->SetXY($margin, $height_products+6);
        //         $pdf->SetWidths(array(30,130,30));

        //     //fill cells
        //     $tsant = 0;
        //     $tdebe = 0;
        //     $thaber = 0;
        //     $tsactual = 0;
        //     $id_prov=0;
        //     $suma_total_abono=0;
        //     $total_saldo=0;
        //     //$pdf->SetY(38);
        //     foreach ($datos as $detail) {
                
        //         $id_prov=$detail->id_cliente;
        //         $valor_pago=0;
                
        //         $suma=0;
        //         $suma=$detail->valor_cuota-$valor_pago;
        //         $data = array(
        //             $detail->identificacion."Centrado",
        //             utf8_decode($detail->nombre),
        //             number_format($detail->valor_cuota,2,".",",")."Derecha",
        //         );
                
        //         //$data_general=array_merge($data,$data2);
        //         //dd($data_general);
        //         $tsant = $detail->valor_cuota + $tsant;
        //         $tdebe = $detail->valor_cuota + $tdebe;
        //         $thaber = $valor_pago + $thaber;
        //         $tsactual = $suma + $tsactual;
        //         $pdf->RowCtas($data, $margin);
        //         $suma_total_abono+=$valor_pago;
        //         $total_saldo +=$suma;
        //         $totales_abono+=$valor_pago;
        //         $totales_saldo+=$suma;
        //         $suma=0;
        //         $valor_pago=0;
        //         $totales_ventas+=$detail->valor_cuota;
        //     }
            
            

        //     //footer
        //     $pdf->SetFillColor(255, 255, 255);
        //     $pdf->SetFont('Arial', 'B', 8);
        //     $pdf->Cell(160, 6, 'TOTAL:', 'T', 0, 'C', 1);
        //     // $pdf->Cell(25, 6, $tsant, 'T', 0, 'R', 1);
        //     //$pdf->Cell(25, 6, '', 'T', 0, 'R', 1);
        //     $pdf->Cell(30, 6, number_format(floatval($tdebe),2), 'T', 0, 'R', 1);
        //     $pdf->Ln(5);
        // }
        //$pdf->Ln(5);

        

        if($exist_cobro>0){
            $pdf->SetFont('Arial', 'B', 9);
            $pdf->Cell(190, 6, '', 0, 1, 'C', 0);
            $pdf->SetFont('Arial', 'B', 8);
            $margin = 10;
                $height = $pdf->GetY();
                $height_products = $height +2;
                $pdf->SetXY($margin, $height_products);
                $pdf->MultiCell(30, 6, 'IDENTIFICACION', 1, 'C', 0);
                $pdf->SetXY(40, $height_products);
                $pdf->MultiCell(130, 6, 'CLIENTE', 1, 'C', 0);
                $pdf->SetXY(170, $height_products);
                // $pdf->MultiCell(20, 6, 'VENTAS', 1, 'C', 0);
                // $pdf->SetXY(155, $height_products);
                $pdf->MultiCell(30, 6, 'ABONOS', 1, 'C', 0);
                // $pdf->SetXY(175, $height_products);
                // $pdf->MultiCell(25, 6, 'SALDO ACTUAL', 1, 'C', 0);
                $y = $height_products + 8;
                $pdf->SetFont('Helvetica', '', 4);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetXY($margin, $height_products+6);
                $pdf->SetWidths(array(30,130,30));
            $tsant = 0;
            $tdebe = 0;
            $thaber = 0;
            $tsactual = 0;
            $id_prov=0;
            $suma_total_abono=0;
            $total_saldo=0;
            foreach($valores_pago as $detail3){
                $id_prov=$detail3->id_cliente;
                
                        $suma=0;
                        $suma=0;
                        $data = array(
                            $detail3->identificacion."Centrado",
                            utf8_decode($detail3->nombre),
                            number_format($detail3->valor_pagado,2,".",",")."Derecha",
                        );
                        
                        //$data_general=array_merge($data,$data2);
                        //dd($data_general);
                        
                        $tdebe =0;
                        $thaber += $detail3->valor_pagado;
                        $tsactual = $suma + $tsactual;
                        $pdf->RowCtas($data, $margin);
                        $totales_ventas+=0;
                        $totales_abono+=$detail3->valor_pagado;
                        $totales_saldo+=$detail3->valor_pagado;
                        
                        
                    
            }
            $pdf->SetFillColor(255, 255, 255);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(160, 6, 'TOTAL:', 'T', 0, 'C', 1);
            // $pdf->Cell(25, 6, $tsant, 'T', 0, 'R', 1);
            //$pdf->Cell(25, 6, '', 'T', 0, 'R', 1);
            $pdf->Cell(30, 6, number_format(floatval($thaber),2), 'T', 0, 'R', 1);
            $pdf->Ln(5);
        }
            
        
        

        //$pdf->Output("cuentas-por-cobrar.pdf", "D");
        if($ruta==null){
            $pdf->Output("reporte_cierre_caja.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."cuenta_por_cobrar_Cliente.pdf", "F");
        }
    }
    public function imprimirFactura($factura,$detalle,$empresa,$user,$cliente,$pagos,$nombre,$fecha,$hora,$ruta){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(155, 8, utf8_decode('Reporte de Nota Credito'), 0, 2, 'C', 0);
        $location = $ruta . "/" . $factura->clave_acceso.".pdf";
        $pdf->Output("F", $location);
                return json_encode(
                    array(
                        "location" => $location,
                        "name" => $name)
                );
        //$pdf->Output();
    }
    public function factura_fisica_pdf($factura,$detalle,$factura_pagos,$empresa){
        //pdf de factura fisica
        $fecha_actual = date("d/m/Y");
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', '', 10);
         //$imagen=$_SERVER['DOCUMENT_ROOT'] . '/images/formato_factura_fisica.PNG';
        // $info = getimagesize($imagen);
        $ancho=$pdf->GetPageWidth();
        $alto=175;
        //$pdf->Image($imagen, 0, 0, $ancho, $alto);
        $pdf->SetXY(17,45);
        if($pdf->GetStringWidth(utf8_decode($factura[0]->nombre))>90){
            $pdf->MultiCell(90, 3,utf8_decode($factura[0]->nombre), 1,'L', 0);
        }else{
            $pdf->SetXY(17,46.5);
            $pdf->Cell(90, 6,utf8_decode($factura[0]->nombre), 0, 2, 'L', 0);
        }
        $pdf->SetXY(144,46.5);
        $pdf->Cell(30, 6,date("d/m/Y", strtotime($factura[0]->fecha_emision)), 0, 2, 'L', 0);
        $pdf->SetXY(20,51);
        if($pdf->GetStringWidth(utf8_decode($factura[0]->direccion))>90){
            $pdf->MultiCell(90, 3,utf8_decode($factura[0]->direccion), 0,'L', 0);
        }else{
            $pdf->SetXY(20,53);
            $pdf->Cell(90, 6,utf8_decode($factura[0]->direccion), 0, 2, 'L', 0);
        }
        $pdf->SetXY(135,53);
        $pdf->Cell(30, 6,utf8_decode($factura[0]->identificacion), 0, 2, 'L', 0);
        $pdf->SetXY(175,53);
        $pdf->Cell(30, 6,utf8_decode($factura[0]->telefono), 0, 2, 'L', 0);
        $margin = 6;
        $height = $pdf->GetY();
        $height_products = $height +6;
        $y = $height_products + 8;
        $pdf->SetFont('Arial', '', 10);
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetXY($margin, $height_products+6);
        $pdf->SetWidths(array(14.5,127.5,21,31));
        foreach($detalle as $detail){
            $data = array(
                $detail->cantidad."Centrado",
                utf8_decode($detail->nombre),
                "$ ".$detail->precio."Derecha",
                "$ ".number_format($detail->total,2,".",",")."Derecha"
            );
            $pdf->RowFactura_Fisica($data, $margin);
        }
        $pdf->SetXY(36,127);
        $pago=[];
        $total_pago=0;
        foreach($factura_pagos as $detail){
            if($detail->estado==2){
                array_push($pago,"Credito");
            }else{
                array_push($pago,utf8_decode($detail->descripcion));
            }   
            $total_pago+=$detail->total;
        }
        $pago=implode(" , ",$pago);
        if($pdf->GetStringWidth($pago)>100){
            $pdf->MultiCell(100, 3,$pago, 0,  'L', 0);
        }else{
            $pdf->SetXY(36,128);
            $pdf->Cell(100, 6,$pago, 0, 2, 'L', 0);
        }
        $nro_letra=new Numero_Letra();
        $valor_pago=$nro_letra->convertir($total_pago);
        $pdf->SetXY(17,134);
        if($pdf->GetStringWidth(utf8_decode($valor_pago))>120){
            $pdf->MultiCell(120, 3,utf8_decode($valor_pago), 0,  'L', 0);
        }else{
            $pdf->SetXY(17,135);
            $pdf->Cell(120, 6,utf8_decode($valor_pago), 0, 2, 'L', 0);
        }
        $pdf->SetXY(170,128);
        $pdf->Cell(32, 7,number_format($factura[0]->subtotal_sin_impuesto,2,".",","), 0, 2, 'R', 0);
        if($factura[0]->subtotal_0>0){
            $pdf->SetXY(170,137);
            $pdf->Cell(32, 7,number_format($factura[0]->subtotal_0,2,".",","), 0, 2, 'R', 0);
        }
        if($factura[0]->iva_12>0){
            $pdf->SetXY(170,144);
            $pdf->Cell(32, 7,number_format($factura[0]->iva_12,2,".",","), 0, 2, 'R', 0);
        }
        $pdf->SetXY(170,151);
        $pdf->Cell(32, 6,number_format($factura[0]->valor_total,2,".",","), 0, 2, 'R', 0);
        
        return $pdf->Output("factura fisica.pdf", "D");
    }
    public function nota_credito_reporte($datos, $fec_ini, $fec_fin,$nombre_producto)
    {
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);
        $logo = constant("DATA_EMPRESA") . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(70, 11);
        //$pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->MultiCell(155, 4, utf8_decode($datos[0]->nombre_empresa), 0, 'C');
        $cab_emp=$pdf->GetY();
        $pdf->SetXY(70, $cab_emp+1);
        $pdf->SetFont('Arial', 'B', 12);
        //$modo == 1
        //? $pdf->Cell(155, 8, utf8_decode('Reporte de Ventas'), 0, 2, 'C', 0)
        $pdf->Cell(155, 8, utf8_decode('Reporte de Nota Credito'), 0, 2, 'C', 0);
        $pdf->SetX(70);
        if($nombre_producto!="" || $nombre_producto!=null){
            $pdf->MultiCell(155, 4, 'Producto: '.utf8_decode($nombre_producto), 0, 'C');
        }else{
            $pdf->MultiCell(155, 4, utf8_decode($nombre_producto), 0, 'C');
        }
        
        //prueba
        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null && $fec_fin == null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $exist_tbasec = 0;
        $exist_tbased = 0;
        $exist_tivad = 0;
        $exist_tdesc = 0;
        $exist_tivaret = 0;
        $exist_tirf = 0;
        $exist_ttra = 0;
        $exist_total = 0;
        $exist_total_descuento=0;
        $exist_total_ice=0;
        $exist_total_subt=0;
        $exist_totalf = 0;
        $exis_totdesc = 0;
        $exis_totalf=0;
        $datos_filtrado2 = [];
        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->id_nota_credito, $datos_filtrado2)) {
                $datos_filtrado2[$datos[$key]->id_nota_credito] = $datos[$key];
            }
        }
        $id_planes=0;
        $array_ice=[];
        $suma_ice=0;
        // foreach ($datos_filtrado2 as $detail) {
        //    $id_planes=$detail->id_factura;
           
        //    foreach($valores_ice as $detail){
        //         if( $id_planes==$detail->id_factura){
        //             //array_push($array_ice,$detail->total_ice);
        //             $suma_ice+=$detail->total_ice;
        //         }
        //    }
        //    array_push($array_ice,$suma_ice);
        //    $suma_ice=0;
        // }
        //dd($array_ice);
        $cuentas=-1;
        foreach ($datos_filtrado2 as $detail) {
            $cuentas++;

            //$exist_total_ice+=$array_ice[$cuentas];
            $exist_total_subt+=$detail->subtotal_sin_impuesto;
            // $exist_tbasec = $detail->subtotal_sin_impuesto + $exist_tbasec;
            // $exist_tbasec = $detail->subtotal_0 + $exist_tbasec;
            // $exist_tbasec = $detail->subtotal_0 + $exist_tbasec;
            $exis_totdesc += $detail->descuento;
            $exis_totalf += $detail->valor_total - $exis_totdesc;
            $exist_tbasec += $detail->subtotal_0;
            $exist_tbased += $detail->subtotal_12;
            $exist_tivad += $detail->iva_12;
            $exist_tdesc += $detail->descuento;
            //$exist_tivaret += $detail->cantidadiva;
            //$exist_tirf += $detail->cantidadrenta;
            $exist_total += $detail->valor_total;
        }
        $aumento=0;
        if($exist_total_ice<=0){
            $aumento+=7.5;
        }
        if($exist_tbasec<=0){
            $aumento+=7.5;
        }
        if($exist_tbased<=0){
            $aumento+=7.5;
        }
        if($exist_tivad<=0){
            $aumento+=7.5;
        }
        if($exist_tdesc<=0){
            $aumento+=7.5;
        }
        if($exist_tivaret<=0){
            $aumento+=7.5;
        }
        if($exist_tirf<=0){
            $aumento+=7.5;;
        } 
        $pdf->SetY(40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(6, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'Fecha', 1, 0, 'C', 1);
        $pdf->Cell(10, 6, 'Tipo', 1, 0, 'C', 1);
        //$modo == 1
        //$pdf->Cell(15, 6, 'No. Fac', 1, 0, 'C', 1)
        $pdf->Cell(15, 6, 'No. NTC', 1, 0, 'C', 1);
        //$pdf->Cell(15, 6, 'Serie', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'RUC/Cedula', 1, 0, 'C', 1);
        $pdf->Cell(70+($aumento*2), 6, 'NOMBRE', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'SUBTOTAL', 1, 0, 'C', 1);
        if($exist_total_ice>0){
            $pdf->Cell(15, 6, 'ICE', 1, 0, 'C', 1);
        }
        if($exist_tbasec>0){
            $pdf->Cell(15, 6, 'BASE 0%', 1, 0, 'C', 1);
        }
        if($exist_tbased>0){
            $pdf->Cell(15, 6, 'BASE 12%', 1, 0, 'C', 1);
        }
        if($exist_tivad>0){
            $pdf->Cell(15, 6, 'I.V.A. 12%', 1, 0, 'C', 1);
        }
        if($exist_tdesc>0){
            $pdf->Cell(15, 6, 'Dsctos.', 1, 0, 'C', 1);
        }
        if($exist_tivaret>0){
            $pdf->Cell(15, 6, 'IVA Ret', 1, 0, 'C', 1);
        }
        if($exist_tirf>0){
            $pdf->Cell(15, 6, 'I.R.F.', 1, 0, 'C', 1);
        } 
        
        $pdf->Cell(15, 6, 'TOTAL', 1, 0, 'C', 1);
        //$pdf->Cell(20+$aumento, 6, 'VEND.', 1, 0, 'C', 1);
        $pdf->ln();

        $totalf = 0;
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        $contador = 1;
        $tbasec = 0;
        $tbased = 0;
        $tivad = 0;
        $tdesc = 0;
        $tivaret = 0;
        $tirf = 0;
        $ttra = 0;
        $total = 0;
        $total_descuento=0;
        $total_ice=0;
        $total_subt=0;
        
        $datos_filtrado = [];

        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->id_nota_credito, $datos_filtrado)) {
                $datos_filtrado[$datos[$key]->id_nota_credito] = $datos[$key];
            }
        }
        
        //dd($datos);
        $cuenta_2=-1;
        foreach ($datos_filtrado as $detail) {
            $cuenta_2++;
            $pdf->Cell(6, 6, $contador, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $detail->fecha_emision, 1, 0, 'C', 1);
             $pdf->Cell(10, 6, 'NTC', 1, 0, 'C', 1);
            $serie1=substr($detail->clave_acceso,24,3);
            $serie2=substr($detail->clave_acceso,27,3);
            $documento=substr($detail->clave_acceso,30,9);
            //$pdf->Cell(15, 6, $detail->id_factura, 1, 0, 'C', 1);
            $pdf->Cell(15, 6, $documento, 1, 0, 'C', 1);
            //$pdf->Cell(15, 6, '00' . $detail->id_punto_emision . '00' . $detail->id_establecimiento, 1, 0, 'C', 1);
            //$pdf->Cell(15, 6, $serie1.'-'.$serie2, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $detail->identificacion, 1, 0, 'C', 1);
            $pdf->Cell(70+($aumento*2), 6, utf8_decode($detail->nombre), 1, 0, 'L', 1);
            $pdf->Cell(15, 6, number_format($detail->subtotal_sin_impuesto,2,".",","), 1, 0, 'R', 1);
            if($exist_total_ice>0){
                $pdf->Cell(15, 6, number_format($array_ice[$cuenta_2],2,".",","), 1, 0, 'R', 1);
            }
            if($exist_tbasec>0){
                $pdf->Cell(15, 6, number_format($detail->subtotal_0,2,".",","), 1, 0, 'R', 1);
            }
            if($exist_tbased>0){
                $pdf->Cell(15, 6, number_format($detail->subtotal_12,2,".",","), 1, 0, 'R', 1);
            }
            if($exist_tivad>0){
                $pdf->Cell(15, 6, number_format($detail->iva_12,2,".",","), 1, 0, 'R', 1);
            }
            if($exist_tdesc>0){
                $pdf->Cell(15, 6, number_format($detail->descuento,2,".",","), 1, 0, 'R', 1);
            }
            
            // if ($detail->cantidadiva != 0 && $detail->cantidadrenta != 0) {
            //     $cantiva = $detail->cantidadiva;
            //     $cantrent = $detail->cantidadrenta;
            //     $pdf->Cell(15, 6, number_format($cantiva,2,".",","), 1, 0, 'R', 1);
            //     $pdf->Cell(15, 6, number_format($cantrent,2,".",","), 1, 0, 'R', 1);
            // } else {
            //     $cantiva = 0.00;
            //     $cantrent = 0.00;
            // $exist_tivaret += $detail->cantidadiva;
            // $exist_tirf += $detail->cantidadrenta;
            if($exist_tivaret>0){
                $pdf->Cell(15, 6, number_format($detail->cantidadiva,2,".",","), 1, 0, 'R', 1);
            }
            if($exist_tirf>0){
                $pdf->Cell(15, 6, number_format($detail->cantidadrenta,2,".",","), 1, 0, 'R', 1);
            }
            
            
            //}
            $totdesc = $detail->descuento ;
            //$totalf = $detail->valor_total - $totdesc;
            $totalf = $detail->valor_total;
            $pdf->Cell(15, 6, number_format($detail->valor_total,2,".",","), 1, 0, 'R', 1);
            //$pdf->Cell(20+$aumento, 6, $detail->vendedor, 1, 0, 'L', 1);
            $pdf->Ln();
            //$total_ice+=$array_ice[$cuenta_2];
            $total_subt+=$detail->subtotal_sin_impuesto;
            // $tbasec = $detail->subtotal_sin_impuesto + $tbasec;
            // $tbasec = $detail->subtotal_0 + $tbasec;
            // $tbasec = $detail->subtotal_0 + $tbasec;
            $tbasec += $detail->subtotal_0;
            $tbased = $tbased + $detail->subtotal_12;
            $tivad = $tivad + $detail->iva_12;
            $tdesc += $detail->descuento;
            //$tivaret = $tivaret + $detail->cantidadiva;
            //$tirf = $tirf + $detail->cantidadrenta;
            $total = $total + $totalf;
            $contador++;
            //$total += $detail->unit_price * $detail->quantity;
        }
        $pdf->SetFillColor(108, 154, 216);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(141+($aumento*2), 6, 'TOTAL:', 1, 0, 'R', 0);
        $pdf->Cell(15, 6, number_format($total_subt,2,".",","), 1, 0, 'R', 0);
        if($exist_total_ice>0){
            $pdf->Cell(15, 6, number_format($total_ice,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tbasec>0){
            $pdf->Cell(15, 6, number_format($tbasec,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tbased>0){
            $pdf->Cell(15, 6, number_format($tbased,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tivad>0){
            $pdf->Cell(15, 6, number_format($tivad,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tdesc>0){
            $pdf->Cell(15, 6, number_format($tdesc,2,".",","), 1, 0, 'R', 0);
        }
        
        if($exist_tivaret>0){
            $pdf->Cell(15, 6, number_format($tivaret,2,".",","), 1, 0, 'R', 0);
        }
        if($exist_tirf>0){
            $pdf->Cell(15, 6, number_format($tirf,2,".",","), 1, 0, 'R', 0);
        }
        
        
        //$pdf->Cell(15, 6, number_format($ttra,2,".",","), 1, 0, 'R', 0);
        
        
        
        $pdf->Cell(15, 6, number_format($total,2,".",","), 1, 0, 'R', 0);

        return $pdf->Output('reporte-nota_credito-ventas.pdf', 'D') ;
    }

    public function factura_compra_reporte($datos, $fec_ini, $fec_fin,$retencion)
    {
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(255, 0, 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(75, 10);
        $pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de compras'), 0, 2, 'C', 0);

        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null && $fec_fin==null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);

        

        $total = 0;
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        $contador = 1;
        $tbasec = 0;
        $tbased = 0;
        $tivad = 0;
        $tdesc = 0;
        $tivaret = 0;
        $tirf = 0;
        $total = 0;
        $total_no_grava=0;
        $datos_filtrado = [];
        $isBaseNoGravaIva = false;
        $isSubtotal0 = false;
        $isSubtotal12 = false;
        $isDescuento = false;

        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->id_factcompra, $datos_filtrado)) {
                $datos_filtrado[$datos[$key]->id_factcompra] = $datos[$key];
            }
        }
        $id_planes=0;
        $array_retencion_iva=[];
        $array_retencion_ret=[];
        $array_exist_retencion=[];
        
        foreach ($datos_filtrado as $detail) {
           $id_planes=$detail->id_factcompra;
           
           foreach($retencion as $detail){
                if( $id_planes==$detail->id_factcompra){
                    array_push($array_retencion_iva,$detail->cantidad_iva);
                    array_push($array_retencion_ret,$detail->cantidad_irf);
                    
                }
           }
        }

        foreach ($datos_filtrado as $detail) {
            if($detail->subtotal_no_obj_iva > 0){
                $isBaseNoGravaIva = true;
            }

            if($detail->subtotal_0 > 0){
                $isSubtotal0 = true;
            }

            if($detail->subtotal_12 > 0){
                $isSubtotal12 = true;
            }

            if($detail->descuento > 0){
                $isDescuento = true;
            }
        }

        $tam_acumulado = 0;

        if(!$isBaseNoGravaIva){
            $tam_acumulado += 20;
        }
        
        if(!$isSubtotal0){
            $tam_acumulado += 15;
        }

        if(!$isSubtotal12){
            $tam_acumulado += 15;
        }

        if(!$isDescuento){
            $tam_acumulado += 15;
        }

        $pdf->SetY(40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 6);
        $pdf->Cell(6, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'FECHA', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'RUC', 1, 0, 'C', 1);
        $pdf->Cell(62+$tam_acumulado, 6, 'PROVEEDOR', 1, 0, 'C', 1);
        $pdf->Cell(12, 6, 'TIPO', 1, 0, 'C', 1);
        $pdf->Cell(17, 6, 'FAC.PROV.', 1, 0, 'C', 1);
        //$pdf->Cell(17, 6, 'BASEIMPEXE', 1, 0, 'C', 1);
        if($isBaseNoGravaIva){
            $pdf->Cell(20, 6, 'BASENOGRAVAIVA', 1, 0, 'C', 1);
        }
        if($isSubtotal0){
            $pdf->Cell(15, 6, 'BASE 0%', 1, 0, 'C', 1);
        }
        if($isSubtotal12){
            $pdf->Cell(15, 6, 'BASE 12%', 1, 0, 'C', 1);
        }
        if($isDescuento){
            $pdf->Cell(15, 6, 'DESCTO.', 1, 0, 'C', 1);
        }
        $pdf->Cell(15, 6, 'I.V.A. 12%', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'IVA Ret', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'I.R.F.', 1, 0, 'C', 1);
        $pdf->Cell(18, 6, 'RET', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'TOTAL', 1, 0, 'C', 1);
        $pdf->ln();

        //dd($cuenta);
        $cuenta=-1;
        $id_planes_2=-1;
        //dd($datos_filtrado);
        foreach ($datos_filtrado as $detail) {
            $id_planes_2=$detail->id_factcompra;
            $cuenta++; 
            $pdf->Cell(6, 6, $contador, 1, 0, 'C', 1);
            $pdf->Cell(15, 6, $detail->fech_emision, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $detail->identif_proveedor, 1, 0, 'C', 1);
            $pdf->Cell(62+$tam_acumulado, 6, utf8_decode($detail->nombre_proveedor), 1, 0, 'L', 1);
            switch ($detail->descrip_tipcomprob) {
                case "Factura":
                    $pdf->Cell(12, 6, 'Factura', 1, 0, 'C', 1);
                    break;
                case "Nota o boleta de venta":
                    $pdf->Cell(12, 6, 'NV', 1, 0, 'C', 1);
                    break;
                case "LiquidaciÃ³n de compra de Bienes o PrestaciÃ³n de servicios":
                    $pdf->Cell(12, 6, 'LC', 1, 0, 'C', 1);
                    break;
                case "Nota de crÃ©dito":
                    $pdf->Cell(12, 6, 'NC', 1, 0, 'C', 1);
                    break;
                case "Nota de dÃ©bito":
                    $pdf->Cell(12, 6, 'ND', 1, 0, 'C', 1);
                    break;
                case "Comprobante de RetenciÃ³n":
                    $pdf->Cell(12, 6, 'CR', 1, 0, 'C', 1);
                    break;
                case "Boletos o entradas a espectÃ¡culos pÃºblicos":
                    $pdf->Cell(12, 6, 'BEP', 1, 0, 'C', 1);
                    break;
                case "Tiquetes o vales emitidos por mÃ¡quinas registradoras":
                    $pdf->Cell(12, 6, 'TMR', 1, 0, 'C', 1);
                    break;
                case "Pasajes expedidos por empresas de aviaciÃ³n":
                    $pdf->Cell(12, 6, 'PEA', 1, 0, 'C', 1);
                    break;
                case "Documentos emitidos por instituciones financieras":
                    $pdf->Cell(12, 6, 'DIF', 1, 0, 'C', 1);
                    break;
                case "Comprobante de venta emitido en el Exterior":
                    $pdf->Cell(12, 6, 'CVE', 1, 0, 'C', 1);
                    break;
                case "Formulario Ãnico de ExportaciÃ³n (FUE) o DeclaraciÃ³n Aduanera Ãnica (DAU) o DeclaraciÃ³n Andina de Valor (DAV)":
                    $pdf->Cell(12, 6, 'FUE', 1, 0, 'C', 1);
                    break;
                case "Documentos autorizados utilizados en ventas excepto N/C N/D":
                    $pdf->Cell(12, 6, 'DAV', 1, 0, 'C', 1);
                    break;
                case "Comprobantes de Pago de Cuotas o Aportes":
                    $pdf->Cell(12, 6, 'CPC', 1, 0, 'C', 1);
                    break;
                case "Documentos por Servicios Administrativos emitidos por Inst. del Estado":
                    $pdf->Cell(12, 6, 'DSA', 1, 0, 'C', 1);
                    break;
                case "Carta de Porte AÃ©reo":
                    $pdf->Cell(12, 6, 'CPA', 1, 0, 'C', 1);
                    break;
                case "RECAP":
                    $pdf->Cell(12, 6, 'RECAP', 1, 0, 'C', 1);
                    break;
                case "Nota de CrÃ©dito TC":
                    $pdf->Cell(12, 6, 'NCTC', 1, 0, 'C', 1);
                    break;
                case "Nota de DÃ©bito TC":
                    $pdf->Cell(12, 6, 'NDTC', 1, 0, 'C', 1);
                    break;
                case "Comprobante de venta emitido por reembolso":
                    $pdf->Cell(12, 6, 'CVR', 1, 0, 'C', 1);
                    break;
                case "Documento agente de retenciÃ³n Combustibles":
                    $pdf->Cell(12, 6, 'DRC', 1, 0, 'C', 1);
                    break;
                case "Liquidacion para Explotacion y Exploracion de Hidrocarburos":
                    $pdf->Cell(12, 6, 'LEH', 1, 0, 'C', 1);
                    break;
                case "Comprobante de Contribuciones y Aportes":
                    $pdf->Cell(12, 6, 'CCA', 1, 0, 'C', 1);
                    break;
                case "LiquidaciÃ³n por reclamos de aseguradoras":
                    $pdf->Cell(12, 6, 'LRA', 1, 0, 'C', 1);
                    break;
                case "Nota de CrÃ©dito por Reembolso Emitida por Intermediario":
                    $pdf->Cell(12, 6, 'NCRI', 1, 0, 'C', 1);
                    break;
                case "Nota de DÃ©bito por Reembolso Emitida por Intermediario":
                    $pdf->Cell(12, 6, 'NDRI', 1, 0, 'C', 1);
                    break;
                case "Proveedor Directo de Exportador Bajo RÃ©gimen Especial":
                    $pdf->Cell(12, 6, 'PERE', 1, 0, 'C', 1);
                    break;
                case "A Inst. Estado y Empr. PÃºblicas que percibe ingreso exento de Imp. Renta":
                    $pdf->Cell(12, 6, 'EPIR', 1, 0, 'C', 1);
                    break;
                case "N/C A Inst. Estado y Empr. PÃºblicas que percibe ingreso exento de Imp. Renta":
                    $pdf->Cell(12, 6, 'N/C EPIR', 1, 0, 'C', 1);
                    break;
                case "N/D A Inst. Estado y Empr. PÃºblicas que percibe ingreso exento de Imp. Renta":
                    $pdf->Cell(12, 6, 'N/D EPIR', 1, 0, 'C', 1);
                    break;
                default:
                    $pdf->Cell(12, 6, 'N/E Tipo', 1, 0, 'C', 1);
                    break;
            }
            
            $serie1=substr($detail->descripcion,0,3);
            $serie2=substr($detail->descripcion,3,6);
            if(strlen($detail->descripcion)>=15){
                $documento=substr($detail->descripcion,6,15);
            }else{
                $documento=$detail->descripcion;
            }
            $pdf->Cell(17, 6, $documento, 1, 0, 'C', 1);
            //$pdf->Cell(17, 6, '0.00', 1, 0, 'C', 1);
            
            if($isBaseNoGravaIva){
                $pdf->Cell(20, 6, number_format($detail->subtotal_no_obj_iva,2,".",","), 1, 0, 'C', 1);
            }
            if($isSubtotal0){
                $pdf->Cell(15, 6, number_format($detail->subtotal_0,2,".",","), 1, 0, 'C', 1);
            }
            if($isSubtotal12){
                $pdf->Cell(15, 6, number_format($detail->subtotal_12,2,".",","), 1, 0, 'C', 1);
            }
            if($isDescuento){
                $pdf->Cell(15, 6, number_format($detail->descuento,2,".",","), 1, 0, 'C', 1);
            }
            $pdf->Cell(15, 6, number_format($detail->iva_12,2,".",","), 1, 0, 'C', 1);
            if ($detail->retencion=='si') {
                foreach($retencion as $detail2){
                    if( $id_planes_2==$detail2->id_factcompra){
                        $pdf->Cell(15, 6, number_format($detail2->cantidad_iva,2,".",","), 1, 0, 'C', 1);
                        $pdf->Cell(15, 6, number_format($detail2->cantidad_irf,2,".",","), 1, 0, 'C', 1);
                        $detail->total_factura = $detail->total_factura - $detail2->cantidad_iva;
                        $detail->total_factura = $detail->total_factura - $detail2->cantidad_irf;
                    }
                }
            }else{
                $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'C', 1);
                $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'C', 1);
            }
                
                        
                  
                
            /*} else {
                $cantiva = 0.00;
                $cantrent = 0.00;
                $pdf->Cell(15, 6, number_format($cantiva,2,".",","), 1, 0, 'C', 1);
                $pdf->Cell(15, 6, number_format($cantrent,2,".",","), 1, 0, 'C', 1);
            }*/
            
            if($detail->respuesta!==null){
                $doc_ret=substr($detail->observacion,30,9);
                $pdf->Cell(18, 6, $doc_ret, 1, 0, 'C', 1);
            }else{
                $pdf->Cell(18, 6, 'Sin RET', 1, 0, 'C', 1);
            }
            //$pdf->Cell(18, 6, '0.00', 1, 0, 'C', 1);
            $pdf->Cell(15, 6, number_format($detail->total_factura,2,".",","), 1, 0, 'C', 1);
            $pdf->Ln();
            $tbasec = $tbasec + $detail->subtotal_0;
            $tbased = $tbased + $detail->subtotal_12;
            $tdesc = $tdesc + $detail->descuento;
            $tivad = $tivad + $detail->iva_12;
            if ($detail->retencion=='si') {
                foreach($retencion as $detail2){
                    if( $id_planes_2==$detail2->id_factcompra){
                        $tivaret = $tivaret + $detail2->cantidad_iva;
                        $tirf = $tirf + $detail2->cantidad_irf;
                    }
                }
            }else{
                $tivaret = $tivaret + 0;
                $tirf = $tirf + 0;
            }
            
            $total = $total + $detail->total_factura;
            $total_no_grava+=$detail->subtotal_no_obj_iva;
            $contador++;
            //$total += $detail->unit_price * $detail->quantity;
        }
        //footer table
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(132+$tam_acumulado, 6, 'TOTAL:', 1, 0, 'R', 1);
        //$pdf->Cell(17, 6, '0.00', 1, 0, 'C', 1);
        if($isBaseNoGravaIva){
            $pdf->Cell(20, 6, number_format($total_no_grava,2,".",","), 1, 0, 'C', 1);
        }
        if($isSubtotal0){
            $pdf->Cell(15, 6, number_format($tbasec,2,".",","), 1, 0, 'C', 1);
        }
        if($isSubtotal12){
            $pdf->Cell(15, 6, number_format($tbased,2,".",","), 1, 0, 'C', 1);
        }
        if($isDescuento){
            $pdf->Cell(15, 6, number_format($tdesc,2,".",","), 1, 0, 'C', 1);
        }
        $pdf->Cell(15, 6, number_format($tivad,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($tivaret,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($tirf,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(18, 6, '', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($total,2,".",","), 1, 0, 'C', 1);

        $pdf->Output("facturacompras.pdf", "D");
        
    }
    public function liquidacion_compra_reporte($datos, $fec_ini, $fec_fin,$retencion)
    {
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(255, 0, 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(75, 10);
        $pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de Liquidacion Compras'), 0, 2, 'C', 0);

        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null && $fec_fin==null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);

        $pdf->SetY(40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 6);
        $pdf->Cell(6, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'FECHA', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'RUC', 1, 0, 'C', 1);
        $pdf->Cell(45, 6, 'PROVEEDOR', 1, 0, 'C', 1);
        $pdf->Cell(12, 6, 'TIPO', 1, 0, 'C', 1);
        $pdf->Cell(17, 6, 'FAC.PROV.', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'BASE 0%', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'BASE 12%', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'DESCTO.', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'I.V.A. 12%', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'IVA Ret', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'I.R.F.', 1, 0, 'C', 1);
        $pdf->Cell(17, 6, 'BASEIMPEXE', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'BASENOGRAVAIVA', 1, 0, 'C', 1);
        $pdf->Cell(18, 6, 'RET', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'TOTAL', 1, 0, 'C', 1);
        $pdf->ln();

        $total = 0;
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        $contador = 1;
        $tbasec = 0;
        $tbased = 0;
        $tivad = 0;
        $tdesc = 0;
        $tivaret = 0;
        $tirf = 0;
        $total = 0;
        $total_no_grava=0;
        $datos_filtrado = [];

        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->id_factcompra, $datos_filtrado)) {
                $datos_filtrado[$datos[$key]->id_factcompra] = $datos[$key];
            }
        }
        $id_planes=0;
        $array_retencion_iva=[];
        $array_retencion_ret=[];
        
        foreach ($datos_filtrado as $detail) {
           $id_planes=$detail->id_factcompra;
           
           foreach($retencion as $detail){
                if( $id_planes==$detail->id_factcompra){
                    array_push($array_retencion_iva,$detail->cantidad_iva);
                    array_push($array_retencion_ret,$detail->cantidad_irf);
                }
           }
        }
        //dd($cuenta);
        $cuenta=-1;
        $id_planes_2=-1;
        foreach ($datos_filtrado as $detail) {
            $id_planes_2=$detail->id_factcompra;
            $cuenta++; 
            $pdf->Cell(6, 6, $contador, 1, 0, 'C', 1);
            $pdf->Cell(15, 6, date("d/m/Y", strtotime($detail->fech_emision)), 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $detail->identif_proveedor, 1, 0, 'C', 1);
            if($detail->estado>0){
                $pdf->Cell(45, 6, utf8_decode($detail->nombre_proveedor), 1, 0, 'L', 1);
            }else{
                $pdf->Cell(45, 6, utf8_decode("ANULADO"), 1, 0, 'L', 1);
            }
            switch ($detail->descrip_tipcomprob) {
                case "Factura":
                    $pdf->Cell(12, 6, 'Factura', 1, 0, 'C', 1);
                    break;
                case "Nota o boleta de venta":
                    $pdf->Cell(12, 6, 'NV', 1, 0, 'C', 1);
                    break;
                case "LiquidaciÃ³n de compra de Bienes o PrestaciÃ³n de servicios":
                    $pdf->Cell(12, 6, 'LC', 1, 0, 'C', 1);
                    break;
                case "Nota de crÃ©dito":
                    $pdf->Cell(12, 6, 'NC', 1, 0, 'C', 1);
                    break;
                case "Nota de dÃ©bito":
                    $pdf->Cell(12, 6, 'ND', 1, 0, 'C', 1);
                    break;
                case "Comprobante de RetenciÃ³n":
                    $pdf->Cell(12, 6, 'CR', 1, 0, 'C', 1);
                    break;
                case "Boletos o entradas a espectÃ¡culos pÃºblicos":
                    $pdf->Cell(12, 6, 'BEP', 1, 0, 'C', 1);
                    break;
                case "Tiquetes o vales emitidos por mÃ¡quinas registradoras":
                    $pdf->Cell(12, 6, 'TMR', 1, 0, 'C', 1);
                    break;
                case "Pasajes expedidos por empresas de aviaciÃ³n":
                    $pdf->Cell(12, 6, 'PEA', 1, 0, 'C', 1);
                    break;
                case "Documentos emitidos por instituciones financieras":
                    $pdf->Cell(12, 6, 'DIF', 1, 0, 'C', 1);
                    break;
                case "Comprobante de venta emitido en el Exterior":
                    $pdf->Cell(12, 6, 'CVE', 1, 0, 'C', 1);
                    break;
                case "Formulario Ãnico de ExportaciÃ³n (FUE) o DeclaraciÃ³n Aduanera Ãnica (DAU) o DeclaraciÃ³n Andina de Valor (DAV)":
                    $pdf->Cell(12, 6, 'FUE', 1, 0, 'C', 1);
                    break;
                case "Documentos autorizados utilizados en ventas excepto N/C N/D":
                    $pdf->Cell(12, 6, 'DAV', 1, 0, 'C', 1);
                    break;
                case "Comprobantes de Pago de Cuotas o Aportes":
                    $pdf->Cell(12, 6, 'CPC', 1, 0, 'C', 1);
                    break;
                case "Documentos por Servicios Administrativos emitidos por Inst. del Estado":
                    $pdf->Cell(12, 6, 'DSA', 1, 0, 'C', 1);
                    break;
                case "Carta de Porte AÃ©reo":
                    $pdf->Cell(12, 6, 'CPA', 1, 0, 'C', 1);
                    break;
                case "RECAP":
                    $pdf->Cell(12, 6, 'RECAP', 1, 0, 'C', 1);
                    break;
                case "Nota de CrÃ©dito TC":
                    $pdf->Cell(12, 6, 'NCTC', 1, 0, 'C', 1);
                    break;
                case "Nota de DÃ©bito TC":
                    $pdf->Cell(12, 6, 'NDTC', 1, 0, 'C', 1);
                    break;
                case "Comprobante de venta emitido por reembolso":
                    $pdf->Cell(12, 6, 'CVR', 1, 0, 'C', 1);
                    break;
                case "Documento agente de retenciÃ³n Combustibles":
                    $pdf->Cell(12, 6, 'DRC', 1, 0, 'C', 1);
                    break;
                case "Liquidacion para Explotacion y Exploracion de Hidrocarburos":
                    $pdf->Cell(12, 6, 'LEH', 1, 0, 'C', 1);
                    break;
                case "Comprobante de Contribuciones y Aportes":
                    $pdf->Cell(12, 6, 'CCA', 1, 0, 'C', 1);
                    break;
                case "LiquidaciÃ³n por reclamos de aseguradoras":
                    $pdf->Cell(12, 6, 'LRA', 1, 0, 'C', 1);
                    break;
                case "Nota de CrÃ©dito por Reembolso Emitida por Intermediario":
                    $pdf->Cell(12, 6, 'NCRI', 1, 0, 'C', 1);
                    break;
                case "Nota de DÃ©bito por Reembolso Emitida por Intermediario":
                    $pdf->Cell(12, 6, 'NDRI', 1, 0, 'C', 1);
                    break;
                case "Proveedor Directo de Exportador Bajo RÃ©gimen Especial":
                    $pdf->Cell(12, 6, 'PERE', 1, 0, 'C', 1);
                    break;
                case "A Inst. Estado y Empr. PÃºblicas que percibe ingreso exento de Imp. Renta":
                    $pdf->Cell(12, 6, 'EPIR', 1, 0, 'C', 1);
                    break;
                case "N/C A Inst. Estado y Empr. PÃºblicas que percibe ingreso exento de Imp. Renta":
                    $pdf->Cell(12, 6, 'N/C EPIR', 1, 0, 'C', 1);
                    break;
                case "N/D A Inst. Estado y Empr. PÃºblicas que percibe ingreso exento de Imp. Renta":
                    $pdf->Cell(12, 6, 'N/D EPIR', 1, 0, 'C', 1);
                    break;
            }
            //$pdf->Cell(12, 6, 'LC', 1, 0, 'C', 1);
            $serie1=substr($detail->descripcion,0,3);
            $serie2=substr($detail->descripcion,3,6);
            if(strlen($detail->descripcion)>=15){
                $documento=substr($detail->descripcion,6,15);
            }else{
                $documento=$detail->descripcion;
            }
            $pdf->Cell(17, 6, $documento, 1, 0, 'C', 1);
            if($detail->estado>0){
                $pdf->Cell(15, 6, number_format($detail->subtotal_0,2,".",","), 1, 0, 'C', 1);
                $pdf->Cell(15, 6, number_format($detail->subtotal_12,2,".",","), 1, 0, 'C', 1);
                $pdf->Cell(15, 6, number_format($detail->descuento,2,".",","), 1, 0, 'C', 1);
                $pdf->Cell(15, 6, number_format($detail->iva_12,2,".",","), 1, 0, 'C', 1);
            }else{
                $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'C', 1);
                $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'C', 1);
                $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'C', 1);
                $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'C', 1);
            }
            
           // if ($detail->cantidadiva != 0 && $detail->cantidadrenta != 0) {
            if($detail->estado>0){
                $cantiva = $detail->cantidadiva;
                $cantrent = $detail->cantidadrenta;
            }
            
            if ($detail->retencion=='si') {
                foreach($retencion as $detail2){
                    if( $id_planes_2==$detail2->id_factcompra){
                        $pdf->Cell(15, 6, number_format($detail2->cantidad_iva,2,".",","), 1, 0, 'C', 1);
                        $pdf->Cell(15, 6, number_format($detail2->cantidad_irf,2,".",","), 1, 0, 'C', 1);
                    }
                }
            }else{
                $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'C', 1);
                $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'C', 1);
            }
           
                  
                
            /*} else {
                $cantiva = 0.00;
                $cantrent = 0.00;
                $pdf->Cell(15, 6, number_format($cantiva,2,".",","), 1, 0, 'C', 1);
                $pdf->Cell(15, 6, number_format($cantrent,2,".",","), 1, 0, 'C', 1);
            }*/
            $pdf->Cell(17, 6, '0.00', 1, 0, 'C', 1);
            if($detail->estado>0){
                $pdf->Cell(20, 6, number_format($detail->subtotal_no_obj_iva,2,".",","), 1, 0, 'C', 1);
                
                if($detail->respuesta!==null){
                    $doc_ret=substr($detail->observacion,30,9);
                    $pdf->Cell(18, 6, $doc_ret, 1, 0, 'C', 1);
                }else{
                    $pdf->Cell(18, 6, 'Sin RET', 1, 0, 'C', 1);
                }
                $pdf->Cell(15, 6, number_format($detail->total_factura,2,".",","), 1, 0, 'C', 1);
            }else{
                $pdf->Cell(20, 6, number_format(0,2,".",","), 1, 0, 'C', 1);
                if($detail->respuesta!==null){
                    $doc_ret=substr($detail->observacion,30,9);
                    $pdf->Cell(18, 6, $doc_ret, 1, 0, 'C', 1);
                }else{
                    $pdf->Cell(18, 6, 'Sin RET', 1, 0, 'C', 1);
                }
                $pdf->Cell(15, 6, number_format(0,2,".",","), 1, 0, 'C', 1);
            }
            
            $pdf->Ln();
            if($detail->estado>0){
                $tbasec = $tbasec + $detail->subtotal_0;
                $tbased = $tbased + $detail->subtotal_12;
                $tdesc = $tdesc + $detail->descuento;
                $tivad = $tivad + $detail->iva_12;
                if ($detail->retencion=='si') {
                    foreach($retencion as $detail2){
                        if( $id_planes_2==$detail2->id_factcompra){
                            $tivaret = $tivaret + $detail2->cantidad_iva;
                            $tirf = $tirf + $detail2->cantidad_irf;
                        }
                    }
                }else{
                    $tivaret = $tivaret + 0;
                    $tirf = $tirf + 0;
                }
                $total = $total + $detail->total_factura;
                $total_no_grava+=$detail->subtotal_no_obj_iva;
            }
            
            $contador++;
            //$total += $detail->unit_price * $detail->quantity;
        }
        //footer table
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(115, 6, 'TOTAL:', 1, 0, 'R', 1);
        $pdf->Cell(15, 6, number_format($tbasec,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($tbased,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($tdesc,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($tivad,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($tivaret,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($tirf,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(17, 6, '0.00', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, number_format($total_no_grava,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(18, 6, '', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($total,2,".",","), 1, 0, 'C', 1);

        $pdf->Output("liquidacioncompras.pdf", "D");
    }
    public function nota_credito_compra_reporte($datos, $fec_ini, $fec_fin,$retencion)
    {
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetAutoPageBreak(true,2);
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(255, 0, 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(75, 10);
        $pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de compras'), 0, 2, 'C', 0);

        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null && $fec_fin==null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);

        $pdf->SetY(40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 6);
        $pdf->Cell(6, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'FECHA', 1, 0, 'C', 1);
        $pdf->Cell(12, 6, 'TIPO', 1, 0, 'C', 1);
        $pdf->Cell(17, 6, 'DOCUMENTO', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'RUC/CEDULA', 1, 0, 'C', 1);
        $pdf->Cell(115, 6, 'PROVEEDOR', 1, 0, 'C', 1);
        
        $pdf->Cell(15, 6, 'SUBTOTAL', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'BASE 0%', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'BASE 12%', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'DESCTO.', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'I.V.A. 12%', 1, 0, 'C', 1);

        $pdf->Cell(15, 6, 'TOTAL', 1, 0, 'C', 1);
        $pdf->ln();

        $total = 0;
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        $contador = 1;
        $tbasesinimp = 0;
        $tbasec = 0;
        $tbased = 0;
        $tivad = 0;
        $tdesc = 0;
        $tivaret = 0;
        $tirf = 0;
        $total = 0;
        $total_no_grava=0;
        $datos_filtrado = [];

        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->id_factcompra, $datos_filtrado)) {
                $datos_filtrado[$datos[$key]->id_factcompra] = $datos[$key];
            }
        }
        $id_planes=0;
        $array_retencion_iva=[];
        $array_retencion_ret=[];
        $array_exist_retencion=[];
        
        foreach ($datos_filtrado as $detail) {
           $id_planes=$detail->id_factcompra;
           
           foreach($retencion as $detail){
                if( $id_planes==$detail->id_factcompra){
                    array_push($array_retencion_iva,$detail->cantidad_iva);
                    array_push($array_retencion_ret,$detail->cantidad_irf);
                    
                }
           }
        }
        //dd($cuenta);
        $cuenta=-1;
        $id_planes_2=-1;
        //dd($datos_filtrado);
        foreach ($datos_filtrado as $detail) {
            $id_planes_2=$detail->id_factcompra;
            $cuenta++; 
            $pdf->Cell(6, 6, $contador, 1, 0, 'C', 1);
            $pdf->Cell(15, 6, $detail->fecha_emision, 1, 0, 'C', 1);
            $pdf->Cell(12, 6, 'NTC', 1, 0, 'C', 1);
            $serie1=substr($detail->descripcion,0,3);
            $serie2=substr($detail->descripcion,3,6);
            if(strlen($detail->descripcion)>=15){
                $documento=substr($detail->descripcion,6,15);
            }else{
                $documento=$detail->descripcion;
            }
            $pdf->Cell(17, 6, $documento, 1, 0, 'C', 1);
            $pdf->Cell(20, 6, $detail->identif_proveedor, 1, 0, 'C', 1);
            $pdf->Cell(115, 6, utf8_decode($detail->nombre_proveedor), 1, 0, 'L', 1);
            
            
            $pdf->Cell(15, 6, number_format($detail->subtotal_sin_impuesto,2,".",","), 1, 0, 'C', 1);
            $pdf->Cell(15, 6, number_format($detail->subtotal_0,2,".",","), 1, 0, 'C', 1);
            $pdf->Cell(15, 6, number_format($detail->subtotal_12,2,".",","), 1, 0, 'C', 1);
            $pdf->Cell(15, 6, number_format($detail->descuento,2,".",","), 1, 0, 'C', 1);
            $pdf->Cell(15, 6, number_format($detail->iva_12,2,".",","), 1, 0, 'C', 1);
           // if ($detail->cantidadiva != 0 && $detail->cantidadrenta != 0) {
                
            
                        
                  
                
            /*} else {
                $cantiva = 0.00;
                $cantrent = 0.00;
                $pdf->Cell(15, 6, number_format($cantiva,2,".",","), 1, 0, 'C', 1);
                $pdf->Cell(15, 6, number_format($cantrent,2,".",","), 1, 0, 'C', 1);
            }*/
           
            //$pdf->Cell(20, 6, number_format($detail->subtotal_no_obj_iva,2,".",","), 1, 0, 'C', 1);
            
            //$pdf->Cell(18, 6, '0.00', 1, 0, 'C', 1);
            $pdf->Cell(15, 6, number_format($detail->total_factura,2,".",","), 1, 0, 'C', 1);
            $pdf->Ln();
            $tbasesinimp+=$detail->subtotal_sin_impuesto;
            $tbasec = $tbasec + $detail->subtotal_0;
            $tbased = $tbased + $detail->subtotal_12;
            $tdesc = $tdesc + $detail->descuento;
            $tivad = $tivad + $detail->iva_12;
            $total = $total + $detail->total_factura;
            $total_no_grava+=$detail->subtotal_no_obj_iva;
            $contador++;
            //$total += $detail->unit_price * $detail->quantity;
        }
        //footer table
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(185, 6, 'TOTAL:', 1, 0, 'R', 1);
        $pdf->Cell(15, 6, number_format($tbasesinimp,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($tbasec,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($tbased,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($tdesc,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($tivad,2,".",","), 1, 0, 'C', 1);
        
        //$pdf->Cell(20, 6, number_format($total_no_grava,2,".",","), 1, 0, 'C', 1);
        $pdf->Cell(15, 6, number_format($total,2,".",","), 1, 0, 'C', 1);

        $pdf->Output("NotaCreditoCompras.pdf", "D");
    }
    
    public function diario_general($datos,$fec_ini,$fec_fin,$empresa,$ingresos,$proyecto,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa[0]->id_empresa . '/imagen/' . $empresa[0]->logo;
        if (strlen($empresa[0]->logo)>0 && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        $pdf->Cell(155, 10, utf8_decode($empresa[0]->nombre_empresa), 0, 1, 'C', 0);
        $pdf->SetXY(35, 17);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Diario General'), 0, 2, 'C', 0);
        $pdf->SetXY(35, 22);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, 'Proyecto: '.ucfirst($proyecto), 0, 1, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $fecha="";
        $debe=0;
        $haber=0;
        $sum_debe=0;
        $sum_haber=0;
        $total_debe=0;
        $total_haber=0;
        $doc="";
        $totsum_debe=0;
        $totsum_haber=0;
        $totales_debe=0;
        $totales_haber=0;
        $head=0;
        foreach($ingresos as $detail){
            $fecha=date("d/m/Y",strtotime($detail->fecha));
            $pdf->SetX(10);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            
            $pdf->Cell(195, 6, 'Comprobante: '.strtoupper($detail->tipo).' '.$detail->codigo.' '.$fecha, 0, 0, 'C', 0);
            // $pdf->Cell(25, 6, strtoupper($detail->tipo), 0, 0, 'C', 0);
            // $pdf->Cell(25, 6, $detail->codigo, 0, 0, 'C', 0);
            // $pdf->Cell(35, 6, $fecha, 0, 0, 'C', 0);
            //$pdf->Cell(30, 6, 'Proyecto:'.$detail->descripcion, 0, 0, 'C', 0);
            $id_prov=$detail->id_asientos;
            $id_proyecto=$detail->id_proyecto;
            $doc=$detail->codigo;
            $pdf->Ln(5);
                    $pdf->SetX(10);
                    $pdf->SetFillColor(240, 240, 240);
                    $pdf->SetFont('Arial', 'B', 8);
                    $pdf->Cell(20, 6, 'Cuenta', 0, 0, 'C', 0);
                    $pdf->Cell(54, 6, 'Nombre', 0, 0, 'C', 0);
                    $pdf->Cell(61, 6, 'Descripcion', 0, 0, 'C', 0);
                    $pdf->Cell(25, 6, 'Proyecto', 0, 0, 'C', 0);
                    $pdf->Cell(15, 6, 'Debe', 0, 0, 'R', 0);
                    $pdf->Cell(15, 6, 'Haber', 0, 0, 'R', 0);
                    //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
                    //$pdf->Cell(31, 6, 'Valor', 1, 0, 'C', 0);
                    //$pdf->Cell(35, 6, 'Saldos', 1, 0, 'C', 1);
                    $pdf->Ln();

            foreach($datos as $detail){
                if($detail->id_asientos==$id_prov){
                    if($detail->id_proyecto==$id_proyecto){
                        $pdf->SetX(10);
                        $debe=number_format($detail->debe,2,".",",");
                        $haber=number_format($detail->haber,2,".",",");
                        $pdf->SetFillColor(255, 255, 255);
                        $pdf->SetFont('Arial', '', 7);
                        $pdf->Cell(20, 3, $detail->codcta, 0, 0, 'C', 0);
                        $pdf->Cell(54, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 1);
                        //$pdf->Cell(13, 6, 'Factura', 0, 0, 'C', 1);
                        //$pdf->Cell(18, 6, $detail->num_cuota, 0, 0, 'C', 1);
                        $pdf->Cell(61, 3, utf8_decode($detail->concepto), 0, 0, 'L', 1);
                        $pdf->Cell(25, 3, utf8_decode($detail->descripcion), 0, 0, 'L', 1);
                        $pdf->Cell(15, 3, $debe, 0, 0, 'R', 1);
                        $pdf->Cell(15, 3, $haber, 0, 0, 'R', 1);
                        $pdf->Cell(15, 3, '', 0, 0, 'R', 1);
                        $sum_debe+=$detail->debe;
                        $sum_haber+=$detail->haber;
                        $totsum_debe+=$detail->debe;
                        $totsum_haber+=$detail->haber;
                        $pdf->Ln(); 
                    }
                }
            }
                            $total_debe=number_format($sum_debe,2,".",",");
                            $total_haber=number_format($sum_haber,2,".",",");
                            $totales_debe=number_format($totsum_debe,2,".",",");
                            $totales_haber=number_format($totsum_haber,2,".",",");
                            $pdf->SetX(15);
                            $pdf->SetFillColor(240, 240, 240);
                            $pdf->SetFont('Arial', 'B', 8);
                            $pdf->Cell(155, 6, 'TOTAL   '.$doc, 0, 0, 'C', 0);
                            //$pdf->Cell(25, 6, $no_doc, 1, 0, 'R', 0);
                            //$pdf->Cell(25, 6, '', 1, 0, 'R', 0);
                            //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
                            //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
                            $pdf->Cell(15, 6, $total_debe, 'T', 0, 'R', 0);
                            $pdf->Cell(15, 6, $total_haber, 'T', 0, 'R', 0);
                            $pdf->Ln(10);
                            $total_debe=0;
                            $total_haber=0;
                            $sum_debe=0;
                            $sum_haber=0;
                            $doc="";
                            $head=$pdf->GetY();
        }
                            $pdf->SetXY(15, $head+5);
                            $pdf->SetFillColor(240, 240, 240);
                            $pdf->SetFont('Arial', 'B',10);
                            $pdf->Cell(145, 6, 'TOTAL GENERAL', 0, 0, 'C', 0);
                            //$pdf->Cell(25, 6, $no_doc, 1, 0, 'R', 0);
                            //$pdf->Cell(25, 6, '', 1, 0, 'R', 0);
                            //$pdf->Cell(44, 6, '', 0, 0, 'R', 0);
                            //$pdf->Cell(44, 6, '', 0, 0, 'R', 0);
                            $pdf->Cell(20, 6, $totales_debe, 0, 0, 'R', 0);
                            $pdf->Cell(20, 6, $totales_haber, 0, 0, 'R', 0);
                            
        
        if($ruta==null){
            $pdf->Output("diario_general.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."diario_general.pdf", "F");
        }
    }
    public function mayor_general($datos,$fec_ini,$fec_fin,$empresa,$ingresos,$ingresos_prueba,$proyecto,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa[0]->id_empresa . '/imagen/' . $empresa[0]->logo;
        if (strlen($empresa[0]->logo)>0 && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        if($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa))>115){
            $pdf->SetXY(55, 10);
            $pdf->MultiCell(115, 5, utf8_decode($empresa[0]->nombre_empresa), 0,'C', 0);
            $head_empresa=$pdf->GetY();
        }else{
            $pdf->Cell(155, 10, utf8_decode($empresa[0]->nombre_empresa), 0, 1, 'C', 0);
        }
        if($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa))>115){
            $pdf->SetXY(35, $head_empresa-2);
        }else{
            $pdf->SetXY(35, 17);
        }
        //$pdf->Cell(155, 10, utf8_decode($empresa[0]->nombre_empresa), 0, 1, 'C', 0);
        //$pdf->SetXY(35, 17);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Mayor General'), 0, 2, 'C', 0);
        $pdf->SetXY(35, 22);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, 'Proyecto: '.ucfirst($proyecto), 0, 1, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        
        $fecha="";
        $debe=0;
        $haber=0;
        $sum_debe=0;
        $sum_haber=0;
        $total_debe=0;
        $total_haber=0;
        $doc="";
        $id_cuentas=0;
        $fecha="";
        $debe=0;
        $haber=0;
        $sum_1=0;
        $sum_2=0;
        $sum_saldo=0;
        $total_saldo=0;
        $sum_debe=0;
        $sum_haber=0;
        $total_deber=0;
        $total_haber=0;
        $totales_sum_saldo=0;
        $totales_total_saldo=0;
        $totales_sum_debe=0;
        $totales_sum_haber=0;
        $totales_total_deber=0;
        $totales_total_haber=0;
        $dias_enero=[];
        $dias_febrero=[];
        $dias_marzo=[];
        $dias_abril=[];
        $dias_mayo=[];
        $dias_junio=[];
        $dias_julio=[];
        $dias_agosto=[];
        $dias_septiembre=[];
        $dias_octubre=[];
        $dias_noviembre=[];
        $dias_diciembre=[];
        $max_enero=[];
        $max_febrero=[];
        $max_marzo=[];
        $max_abril=[];
        $max_mayo=[];
        $max_junio=[];
        $max_julio=[];
        $max_agosto=[];
        $max_septiembre=[];
        $max_octubre=[];
        $max_noviembre=[];
        $max_diciembre=[];
        $horas_enero=[];
        $horas_febrero=[];
        $horas_marzo=[];
        $horas_abril=[];
        $horas_mayo=[];
        $horas_junio=[];
        $horas_julio=[];
        $horas_agosto=[];
        $horas_septiembre=[];
        $horas_octubre=[];
        $horas_noviembre=[];
        $horas_diciembre=[];
        $max_horas_enero=[];
        $max_horas_febrero=[];
        $max_horas_marzo=[];
        $max_horas_abril=[];
        $max_horas_mayo=[];
        $max_horas_junio=[];
        $max_horas_julio=[];
        $max_horas_agosto=[];
        $max_horas_septiembre=[];
        $max_horas_octubre=[];
        $max_horas_noviembre=[];
        $max_horas_diciembre=[];
        $id_meses=0;
        $array_meses=[];
        $array_meses_total=[];
        $index_iguales_fecha_febrero=0;
        $array_iguales_fecha_febrero=[];
        $max_iguales_fecha_febrero=[];
        foreach($ingresos as $detail){
            $id_cuentas=$detail->id_plan_cuentas;
            foreach($datos as $detail){
                if($detail->id_plan_cuentas==$id_cuentas){
                    $fecha=date("d/m/Y", strtotime($detail->fecha));
                    $mes=substr($fecha,3,2);
                    $dia=substr($fecha,0,2);
                    $fecha_2=date("H:i:s", strtotime($detail->fecha));
                    if($mes=="01"){
                        array_push($dias_enero,$detail->fecha);
                        array_push($horas_enero,$fecha_2);
                        array_push($array_meses,$mes);
                    }
                    
                    if($mes=="02"){
                        $index_iguales_fecha_febrero++;
                        array_push($dias_febrero,$detail->fecha);
                        array_push($horas_febrero,$fecha_2);
                        array_push($array_meses,$mes);
                        array_push($array_iguales_fecha_febrero,$index_iguales_fecha_febrero);
                    }
                    if($mes=="03"){

                        array_push($dias_marzo,$detail->fecha);
                        array_push($horas_marzo,$fecha_2);
                        array_push($array_meses,$mes);
                        
                    }
                    
                    if($mes=="04"){
                        array_push($dias_abril,$detail->fecha);
                        array_push($horas_abril,$fecha_2);
                        array_push($array_meses,$mes);
                    }
                    if($mes=="05"){
                        array_push($dias_mayo,$detail->fecha);
                        array_push($horas_mayo,$fecha_2);
                        array_push($array_meses,$mes);
                    }
                    if($mes=="06"){
                        array_push($dias_junio,$detail->fecha);
                        array_push($horas_junio,$fecha_2);
                        array_push($array_meses,$mes);
                    }
                    
                    if($mes=="07"){
                        array_push($dias_julio,$detail->fecha);
                        array_push($horas_julio,$fecha_2);
                        array_push($array_meses,$mes);
                    }
                    if($mes=="08"){
                        array_push($dias_agosto,$detail->fecha);
                        array_push($horas_agosto,$fecha_2);
                        array_push($array_meses,$mes);
                    }
                    if($mes=="09"){
                        array_push($dias_septiembre,$detail->fecha);
                        array_push($horas_septiembre,$fecha_2);
                        array_push($array_meses,$mes);
                    }
                    if($mes=="10"){
                        array_push($dias_octubre,$detail->fecha);
                        array_push($horas_octubre,$fecha_2);
                        array_push($array_meses,$mes);
                    }
                    if($mes=="11"){
                        array_push($dias_noviembre,$detail->fecha);
                        array_push($horas_noviembre,$fecha_2);
                        array_push($array_meses,$mes);
                    }
                    if($mes=="12"){
                        array_push($dias_diciembre,$detail->fecha);
                        array_push($horas_diciembre,$fecha_2);
                        array_push($array_meses,$mes);
                    }
                    
                }
                
                 
            }   
                 
                array_push($max_enero,$dias_enero);
                $dias_enero=[];
                array_push($max_febrero,$dias_febrero);
                $dias_febrero=[];
                array_push($max_marzo,$dias_marzo);
                $dias_marzo=[];
                array_push($max_abril,$dias_abril);
                $dias_abril=[];
                array_push($max_mayo,$dias_mayo);
                $dias_mayo=[];    
                array_push($max_junio,$dias_junio);
                $dias_junio=[];
                array_push($max_julio,$dias_julio);
                $dias_julio=[];
                array_push($max_agosto,$dias_agosto);
                $dias_agosto=[];
                array_push($max_septiembre,$dias_septiembre);
                $dias_septiembre=[];
                array_push($max_octubre,$dias_octubre);
                $dias_octubre=[];
                array_push($max_noviembre,$dias_noviembre);
                $dias_noviembre=[];
                array_push($max_diciembre,$dias_diciembre);
                $dias_diciembre=[];
                array_push($max_horas_enero,$horas_enero);
                $horas_enero=[];
                array_push($max_horas_febrero,$horas_febrero);
                $horas_febrero=[];
                array_push($max_horas_marzo,$horas_marzo);
                $horas_marzo=[];
                array_push($max_horas_abril,$horas_abril);
                $horas_abril=[];
                array_push($max_horas_mayo,$horas_mayo);
                $horas_mayo=[];    
                array_push($max_horas_junio,$horas_junio);
                $horas_junio=[];
                array_push($max_horas_julio,$horas_julio);
                $horas_julio=[];
                array_push($max_horas_agosto,$horas_agosto);
                $horas_agosto=[];
                array_push($max_horas_septiembre,$horas_septiembre);
                $horas_septiembre=[];
                array_push($max_horas_octubre,$horas_octubre);
                $horas_octubre=[];
                array_push($max_horas_noviembre,$horas_noviembre);
                $horas_noviembre=[];
                array_push($max_horas_diciembre,$horas_diciembre);
                $horas_diciembre=[];
                array_push($array_meses_total,$array_meses);
                $array_meses=[];
                array_push($max_iguales_fecha_febrero,$array_iguales_fecha_febrero);
                $array_iguales_fecha_febrero=[];
                $index_iguales_fecha_febrero=0;
        }
        //dd($max_iguales_fecha_febrero);
        //$array_meses_total_2=array_unique($array_meses_total);
       // dd(max($array_meses_total[0]));
       //dd($max_febrero);
       $id_saldo_ant=0;
       $array_saldo_ant=[];
       $array_saldo_ant_2=[];
        foreach($ingresos as $detail){
            $id_plc_0=$detail->id_plan_cuentas;
            foreach($ingresos_prueba as $detail){
                if($detail->id_plan_cuentas==$id_plc_0){
                    $id_saldo_ant=$detail->saldo_ant;
                    array_push($array_saldo_ant,$detail->saldo_ant);
                }else{
                    $id_saldo_ant+=0;
                    array_push($array_saldo_ant,0);
                }
            }
           array_push($array_saldo_ant_2,$id_saldo_ant);
           $array_saldo_ant=[];
           $id_saldo_ant=0;
        }
        //dd($array_saldo_ant_2);
        $id_plc_0=-1;
        $array_unique_meses=[];
        foreach($ingresos as $detail){
            $id_plc_0++;
            $unico=array_unique($array_meses_total[$id_plc_0]);
            array_push($array_unique_meses,$unico);
        }
        $array_cuentas=[];
        foreach($ingresos as $detail){
            $id_cuentas=$detail->id_plan_cuentas;
            foreach($datos as $detail){
                
                if($detail->id_plan_cuentas==$id_cuentas){
                    array_push($array_cuentas,"si");
                }else{
                    array_push($array_cuentas,"no");  
                }
            }
        }
        //dd($array_cuentas);
        $items_plc=-1;
        $item_meses=-1;
        $horas_enero=-1;
        $horas_febrero=-1;
        $horas_marzo=-1;
        $horas_abril=-1;
        $horas_mayo=-1;
        $horas_junio=-1;
        $horas_julio=-1;
        $horas_agosto=-1;
        $horas_septiembre=-1;
        $horas_octubre=-1;
        $horas_noviembre=-1;
        $horas_diciembre=-1;
        $array_enero=[];
        $array_febrero=[];
        $array_marzo=[];
        $array_abril=[];
        $array_mayo=[];
        $array_junio=[];
        $array_julio=[];
        $array_agosto=[];
        $array_septiembre=[];
        $array_octubre=[];
        $array_noviembre=[];
        $array_diciembre=[];
        $array_tot_enero=[];
        $array_tot_febrero=[];
        $array_tot_marzo=[];
        $array_tot_abril=[];
        $array_tot_mayo=[];
        $array_tot_junio=[];
        $array_tot_julio=[];
        $array_tot_agosto=[];
        $array_tot_septiembre=[];
        $array_tot_octubre=[];
        $array_tot_noviembre=[];
        $array_tot_diciembre=[];
        $array_tot_igual_enero=[];
        $array_tot_igual_feb=[];
        $array_tot_igual_marzo=[];
        $array_tot_igual_abril=[];
        $array_tot_igual_mayo=[];
        $array_tot_igual_junio=[];
        $array_tot_igual_julio=[];
        $array_tot_igual_agosto=[];
        $array_tot_igual_septiembre=[];
        $array_tot_igual_octubre=[];
        $array_tot_igual_noviembre=[];
        $array_tot_igual_diciembre=[];
        foreach($ingresos as $detail){
            $id_cuentas=$detail->id_plan_cuentas;
            $item_meses++;
            foreach($datos as $detail){
                
                if($detail->id_plan_cuentas==$id_cuentas){
                    $fecha=date("d/m/Y", strtotime($detail->fecha));
                    $mes=substr($fecha,3,2);
                    if($mes=="01"){
                        if($detail->fecha===max($max_enero[$item_meses])){
                            $horas_enero++;
                            array_push($array_enero,max($max_enero[$item_meses]));
                            array_push($array_tot_igual_enero,$horas_enero);
                        }else{
                            array_push($array_tot_igual_enero,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_enero,null); 
                    }
                    if($mes=="02"){
                        if($detail->fecha===max($max_febrero[$item_meses])){
                            $horas_febrero++;
                            array_push($array_febrero,max($max_febrero[$item_meses]));
                            array_push($array_tot_igual_feb,$horas_febrero);
                        }else{
                            array_push($array_tot_igual_feb,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_feb,null);
                    }
                    if($mes=="03"){
                        if($detail->fecha===max($max_marzo[$item_meses])){
                            $horas_marzo++;
                            array_push($array_marzo,max($max_marzo[$item_meses]));
                            array_push($array_tot_igual_marzo,$horas_marzo);
                        }else{
                            array_push($array_tot_igual_marzo,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_marzo,null);
                    }

                    if($mes=="04"){
                        if($detail->fecha===max($max_abril[$item_meses])){
                            $horas_abril++;
                            array_push($array_abril,max($max_abril[$item_meses]));
                            array_push($array_tot_igual_abril,$horas_abril);
                        }else{
                            array_push($array_tot_igual_abril,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_abril,null);
                    }
                    if($mes=="05"){
                        if($detail->fecha===max($max_mayo[$item_meses])){
                            $horas_mayo++;
                            array_push($array_mayo,max($max_mayo[$item_meses]));
                            array_push($array_tot_igual_mayo,$horas_mayo);
                        }else{
                            array_push($array_tot_igual_mayo,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_mayo,null);
                    }
                    if($mes=="06"){
                        if($detail->fecha===max($max_junio[$item_meses])){
                            $horas_junio++;
                            array_push($array_junio,max($max_junio[$item_meses]));
                            array_push($array_tot_igual_junio,$horas_junio);
                        }else{
                            array_push($array_tot_igual_junio,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_junio,null);
                    }
                    if($mes=="07"){
                        if($detail->fecha===max($max_julio[$item_meses])){
                            $horas_julio++;
                            array_push($array_julio,max($max_julio[$item_meses]));
                            array_push($array_tot_igual_julio,$horas_julio);
                        }else{
                            array_push($array_tot_igual_julio,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_julio,null);
                    }
                    if($mes=="08"){
                        if($detail->fecha===max($max_agosto[$item_meses])){
                            $horas_agosto++;
                            array_push($array_agosto,max($max_agosto[$item_meses]));
                            array_push($array_tot_igual_agosto,$horas_agosto);
                        }else{
                            array_push($array_tot_igual_agosto,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_agosto,null);
                    }
                    if($mes=="09"){
                        if($detail->fecha===max($max_septiembre[$item_meses])){
                            $horas_septiembre++;
                            array_push($array_septiembre,max($max_septiembre[$item_meses]));
                            array_push($array_tot_igual_septiembre,$horas_septiembre);
                        }else{
                            array_push($array_tot_igual_septiembre,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_septiembre,null);
                    }
                    if($mes=="10"){
                        if($detail->fecha===max($max_octubre[$item_meses])){
                            $horas_octubre++;
                            array_push($array_octubre,max($max_octubre[$item_meses]));
                            array_push($array_tot_igual_octubre,$horas_octubre);
                        }else{
                            array_push($array_tot_igual_octubre,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_octubre,null); 
                    }
                    if($mes=="11"){
                        if($detail->fecha===max($max_noviembre[$item_meses])){
                            $horas_noviembre++;
                            array_push($array_noviembre,max($max_noviembre[$item_meses]));
                            array_push($array_tot_igual_noviembre,$horas_noviembre);
                        }else{
                            array_push($array_tot_igual_noviembre,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_noviembre,null);
                    }
                    if($mes=="12"){
                        if($detail->fecha===max($max_diciembre[$item_meses])){
                            $horas_diciembre++;
                            array_push($array_diciembre,max($max_diciembre[$item_meses]));
                            array_push($array_tot_igual_diciembre,$horas_diciembre);
                        }else{
                            array_push($array_tot_igual_diciembre,null);
                        }
                        
                    }else{
                        array_push($array_tot_igual_diciembre,null);
                    }
                    
                }
                
                //$array_febrero=[];
                
            }
            array_push($array_tot_enero,$array_enero);
            $array_enero=[];
            $horas_enero=-1;
            array_push($array_tot_febrero,$array_febrero);
            $array_febrero=[];
            $horas_febrero=-1;
            array_push($array_tot_marzo,$array_marzo);
            $array_marzo=[];
            $horas_marzo=-1;
            array_push($array_tot_abril,$array_abril);
            $array_abril=[];
            $horas_abril=-1;
            array_push($array_tot_mayo,$array_mayo);
            $array_mayo=[];
            $horas_mayo=-1;
            array_push($array_tot_junio,$array_junio);
            $array_junio=[];
            $horas_junio=-1;
            array_push($array_tot_julio,$array_julio);
            $array_julio=[];
            $horas_julio=-1;
            array_push($array_tot_agosto,$array_agosto);
            $array_agosto=[];
            $horas_agosto=-1;
            array_push($array_tot_septiembre,$array_septiembre);
            $array_septiembre=[];
            $horas_septiembre=-1;
            array_push($array_tot_octubre,$array_octubre);
            $array_octubre=[];
            $horas_octubre=-1;
            array_push($array_tot_noviembre,$array_noviembre);
            $array_noviembre=[];
            $horas_noviembre=-1;
            array_push($array_tot_diciembre,$array_diciembre);
            $array_diciembre=[];
            $horas_diciembre=-1;
        }
        //dd($array_tot);
        $item_febrero=-1;
        foreach($ingresos as $detail){
            $item_febrero++;

        }
        
        $prueba_febrero=[];
        $prueba_febrero_max=[];
        $prueba_febrero_count=[];
        $item_febrero=0;
        $item_cuenta=-1;
        /*foreach($ingresos as $detail){
            $item_cuenta++;
            $id_cuentas=$detail->id_plan_cuentas;
            foreach($datos as $detail){
                if($detail->id_plan_cuentas==$id_cuentas){
                    $fecha=date("d/m/Y", strtotime($detail->fecha));
                    $mes=substr($fecha,3,2);
                    $dia=substr($fecha,0,2);
                    $fecha_2=date("H:i:s", strtotime($detail->fecha));
                    
                    
                    if($mes=="02"){
                        $index_iguales_fecha_febrero++;
                        if($detail->fecha==key($array_febrero[$item_cuenta])){
                            $item_febrero++;
                        }
                    }
                }
            }
            array_push($prueba_febrero_max,$item_febrero);
            $item_febrero=0;
        }*/
        //dd($array_febrero);
        //dd($prueba_febrero_max);
        //dd($array_tot_igual_feb);
        $item_febrero=-1;
        $items_datos=-1;
        //dd($datos);
        foreach($ingresos as $detail){
            $items_plc++;
            $pdf->SetX(70);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(20, 6, $detail->codcta, 0, 0, 'C', 0);
            $pdf->Cell(75, 6, utf8_decode($detail->nomcta), 0, 0, 'C', 0);
            //$pdf->Cell(10, 6, 'Proyecto:', 0, 0, 'C', 0);
            //$pdf->Cell(35, 6, utf8_decode($detail->descripcion), 0, 0, 'C', 0);
            $pdf->Ln(5);
            $id_cuentas=$detail->id_plan_cuentas;
            $doc=$detail->codcta;
            $pdf->SetX(10);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 7);
            $pdf->Cell(25, 6, 'Fecha', 0, 0, 'C', 0);
            $pdf->Cell(15, 6, 'Asiento', 0, 0, 'C', 0);
            $pdf->Cell(62.5 , 6, 'Descripcion', 0, 0, 'C', 0);
            $pdf->Cell(42.5, 6, 'Razon Social', 0, 0, 'C', 0);
            $pdf->Cell(15, 6, 'Debitos', 0, 0, 'R', 0);
            $pdf->Cell(15, 6, 'Creditos', 0, 0, 'R', 0);
            $pdf->Cell(15, 6, 'Saldo', 0, 0, 'R', 0);
            $pdf->Ln();
            $pdf->Cell(175, 3, 'Saldo Anterior:', 0, 0, 'C', 0);
            $pdf->SetFillColor(255, 255, 255);
            $pdf->Cell(15, 3, number_format($array_saldo_ant_2[$items_plc],2,".",","), 0, 0, 'R', 0);
            $pdf->Ln();
            $suma_mensual_debe=0;
            $suma_mensual_haber=0;
            $suma_mensual_saldo=0;
            $mensual_debe=0;
            $mensual_haber=0;
            $total_mensual_saldo=0;
            $items_enero=-1;
            $exist_debe=0;
            $exist_haber=0;
            
           $conteo_mayor=0;
                foreach($datos as $detail){
                
                    if($detail->id_plan_cuentas==$id_cuentas){
                        $items_datos++;
                        $debe=number_format($detail->debe,2,".",",");
                        $haber=number_format($detail->haber,2,".",",");
                        if($detail->debe==null){
                            $sum_1=0-$detail->haber;
                        }else{
                            if($detail->haber==null){
                                $sum_1=$detail->debe-0;
                            }else{
                                $sum_1=$detail->debe-$detail->haber;
                            }
                        }
                        $conteo_mayor++;
                        $sum_saldo+=$sum_1;
                        $totales_sum_saldo+=$sum_1;
                        $sum_2=number_format($sum_1,2,".",",");
                        //$suma_mensual_saldo=number_format($sum_saldo,2,".",",");
                        $fecha=date("d/m/Y", strtotime($detail->fecha));
                        $mes=substr($fecha,3,2);
                        $dia=substr($fecha,0,2);
                        $fecha_2=date("H:i:s", strtotime($detail->fecha));
                        $pdf->SetFillColor(255,255,255);
                        $pdf->SetFont('Arial', '', 7);
                        $pdf->Cell(25, 3, $fecha, 0, 0, 'C', 0);
                        $pdf->Cell(15, 3, $detail->codigo, 0, 0, 'C', 0);
                        $pdf->Cell(62.5, 3, utf8_decode($detail->concepto), 0, 0, 'L', 1);
                        $pdf->Cell(42.5, 3, utf8_decode($detail->razon_social), 0, 0, 'L', 1);
                        $pdf->Cell(15, 3,   $debe, 0, 0, 'R', 1);
                        if($haber<=0){
                            $pdf->Cell(15, 3, $haber, 0, 0, 'R', 1);
                        }else{
                            $pdf->Cell(15, 3, $haber, 0, 0, 'R', 1);
                        }
                        
                        //$pdf->Cell(15, 3, $sum_2, 0, 2, 'R', 0);
                        if($mes=="01"){
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            //$suma_mensual_saldo=$suma_mensual_debe-$suma_mensual_haber;
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_enero[$items_plc])<=0){
                                $var_1=count($max_enero[$items_plc]);
                            }else{
                                $var_1=count($max_enero[$items_plc])-1;
                            }
                            if(count($array_tot_enero[$items_plc])<=0){
                                $count_1=count($array_tot_enero[$items_plc]);
                            }else{
                                $count_1=count($array_tot_enero[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_enero[$items_plc][0]){
                                if($count_1==$array_tot_igual_enero[$items_datos]){
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 2, 'R', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Enero ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1); 
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1); 
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*if($max_enero[$items_plc][$var_1]==$dia){
                                if($max_horas_enero[$items_plc][$hor_1]==$fecha_2){
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 7);
                                    $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                    $pdf->Cell(105, 3, 'Enero', 0, 0, 'C', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                    if($suma_mensual_haber!==0){
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }
                                    //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    if(count($array_unique_meses[$items_plc])<=1){
                                        $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                        $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    }
                                    
                                    $suma_mensual_debe=0;
                                    $suma_mensual_haber=0;
                                    $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                }
                                
                                
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        if($mes=="02"){
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            //$suma_mensual_saldo=$suma_mensual_debe-$suma_mensual_haber;
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_febrero[$items_plc])<=0){
                                $var_2=count($max_febrero[$items_plc]);
                            }else{
                                $var_2=count($max_febrero[$items_plc])-1;
                            }
                            if(count($max_horas_febrero[$items_plc])<=0){
                                $hor_2=count($max_horas_febrero[$items_plc]);
                            }else{
                                $hor_2=count($max_horas_febrero[$items_plc])-1;
                            }
                            if(count($array_tot_febrero[$items_plc])<=0){
                                $count_2=count($array_tot_febrero[$items_plc]);
                            }else{
                                $count_2=count($array_tot_febrero[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_febrero[$items_plc][0]){
                                if($count_2==$array_tot_igual_feb[$items_datos]){
                                    //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 1);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 2, 'R', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Febrero ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1); 
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1); 
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*if($max_febrero[$items_plc][$var_2]==$dia){
                                if($max_horas_febrero[$items_plc][$hor_2]==$fecha_2){
                                    $item_febrero++;
                                    if($item_febrero==$hor_2){
                                        $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(240, 240, 240);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Febrero ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                        $item_febrero=-1;
                                    }else{
                                        
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",",")."-s".$hor_2."-s".$item_febrero, 0, 0, 'R', 0);
                                            
                                        
                                    }
                                    
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",",")."-s".$item_febrero, 0, 0, 'R', 0); 
                                    
                                    
                                }
                                
                                
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        if($mes=="03"){
                            //$items_marzo++;
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            //$suma_mensual_saldo=$suma_mensual_debe-$suma_mensual_haber;
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_marzo[$items_plc])<=0){
                                $var_3=count($max_marzo[$items_plc]);
                            }else{
                                $var_3=count($max_marzo[$items_plc])-1;
                            }
                            if(count($max_horas_marzo[$items_plc])<=0){
                                $hor_3=count($max_horas_marzo[$items_plc]);
                            }else{
                                $hor_3=count($max_horas_marzo[$items_plc])-1;
                            }
                            if(count($array_tot_marzo[$items_plc])<=0){
                                $count_3=count($array_tot_marzo[$items_plc]);
                            }else{
                                $count_3=count($array_tot_marzo[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_marzo[$items_plc][0]){
                                if($count_3==$array_tot_igual_marzo[$items_datos]){
                                    //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 1);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 2, 'R', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Marzo ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);  
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*if($max_marzo[$items_plc][$var_3]==$dia){
                                if($max_horas_marzo[$items_plc][$hor_3]==$fecha_2){
                                    //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 7);
                                    $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                    $pdf->Cell(105, 3, 'Marzo', 0, 0, 'C', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                    if($suma_mensual_haber!==0){
                                        $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }
                                    //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    if(count($array_unique_meses[$items_plc])<=1){
                                        $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                        $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    }
                                    $suma_mensual_debe=0;
                                    $suma_mensual_haber=0;
                                    $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                }
                                
                                
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        if($mes=="04"){
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_abril[$items_plc])<=0){
                                $var_4=count($max_abril[$items_plc]);
                            }else{
                                $var_4=count($max_abril[$items_plc])-1;
                            }
                            if(count($max_horas_abril[$items_plc])<=0){
                                $hor_4=count($max_horas_abril[$items_plc]);
                            }else{
                                $hor_4=count($max_horas_abril[$items_plc])-1;
                            }
                            if(count($array_tot_abril[$items_plc])<=0){
                                $count_4=count($array_tot_abril[$items_plc]);
                            }else{
                                $count_4=count($array_tot_abril[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_abril[$items_plc][0]){
                                if($count_4==$array_tot_igual_abril[$items_datos]){
                                    //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 1);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 2, 'R', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Abril ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1); 
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1); 
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*if($max_abril[$items_plc][$var_4]==$dia){
                                if($max_horas_abril[$items_plc][$hor_4]==$fecha_2){
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 7);
                                    $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                    $pdf->Cell(105, 3, 'Abril', 0, 0, 'C', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                    if($suma_mensual_haber!==0){
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }
                                    //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    if(count($array_unique_meses[$items_plc])<=1){
                                        $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                        $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    }
                                    $suma_mensual_debe=0;
                                    $suma_mensual_haber=0;
                                    $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                }
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        if($mes=="05"){
                            
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            //$suma_mensual_saldo=$mensual_debe-$mensual_haber;
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_mayo[$items_plc])<=0){
                                $var_5=count($max_mayo[$items_plc]);
                            }else{
                                $var_5=count($max_mayo[$items_plc])-1;
                            }
                            if(count($max_horas_mayo[$items_plc])<=0){
                                $hor_5=count($max_horas_mayo[$items_plc]);
                            }else{
                                $hor_5=count($max_horas_mayo[$items_plc])-1;
                            }
                            if(count($array_tot_mayo[$items_plc])<=0){
                                $count_5=count($array_tot_mayo[$items_plc]);
                            }else{
                                $count_5=count($array_tot_mayo[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_mayo[$items_plc][0]){
                                if($count_5==$array_tot_igual_mayo[$items_datos]){
                                    //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 1);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 2, 'R', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Mayo ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1); 
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1); 
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*
                            if($max_mayo[$items_plc][$var_5]==$dia){
                                if($max_horas_mayo[$items_plc][$hor_5]==$fecha_2){
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 7);
                                    $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                    $pdf->Cell(105, 3, 'Mayo', 0, 0, 'C', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                    if($suma_mensual_haber!==0){
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }
                                    //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    if(count($array_unique_meses[$items_plc])<=1){
                                        $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                        $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    }
                                    $suma_mensual_debe=0;
                                    $suma_mensual_haber=0;
                                    $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                }
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        if($mes=="06"){
                            
                        
                            
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_junio[$items_plc])<=0){
                                $var_6=count($max_junio[$items_plc]);
                            }else{
                                $var_6=count($max_junio[$items_plc])-1;
                            }
                            if(count($max_horas_junio[$items_plc])<=0){
                                $hor_6=count($max_horas_junio[$items_plc]);
                            }else{
                                $hor_6=count($max_horas_junio[$items_plc])-1;
                            }
                            if(count($array_tot_junio[$items_plc])<=0){
                                $count_6=count($array_tot_junio[$items_plc]);
                            }else{
                                $count_6=count($array_tot_junio[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_junio[$items_plc][0]){
                                if($count_6==$array_tot_igual_junio[$items_datos]){
                                    //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 1);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 2, 'R', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Junio ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1);  
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*if($max_junio[$items_plc][$var_6]==$dia){
                                if($max_horas_junio[$items_plc][$hor_6]==$fecha_2){
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 7);
                                    $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                    $pdf->Cell(105, 3, 'Junio', 0, 0, 'C', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                    if($suma_mensual_haber!==0){
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }
                                    //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    if(count($array_unique_meses[$items_plc])<=1){
                                        $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                        $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    }
                                    $suma_mensual_debe=0;
                                    $suma_mensual_haber=0;
                                    $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                }
                                
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        if($mes=="07"){
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_julio[$items_plc])<=0){
                                $var_7=count($max_julio[$items_plc]);
                            }else{
                                $var_7=count($max_julio[$items_plc])-1;
                            }
                            if(count($max_horas_julio[$items_plc])<=0){
                                $hor_7=count($max_horas_julio[$items_plc]);
                            }else{
                                $hor_7=count($max_horas_julio[$items_plc])-1;
                            }
                            if(count($array_tot_julio[$items_plc])<=0){
                                $count_7=count($array_tot_julio[$items_plc]);
                            }else{
                                $count_7=count($array_tot_julio[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_julio[$items_plc][0]){
                                if($count_7==$array_tot_igual_julio[$items_datos]){
                                    //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 1);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 2, 'R', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Julio ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);  
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*if($max_julio[$items_plc][$var_7]==$dia){
                                if($max_horas_julio[$items_plc][$hor_7]==$fecha_2){
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 7);
                                    $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                    $pdf->Cell(105, 3, 'Julio', 0, 0, 'C', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                    if($suma_mensual_haber!==0){
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }
                                    //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    if(count($array_unique_meses[$items_plc])<=1){
                                        $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                        $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    }
                                    $suma_mensual_debe=0;
                                    $suma_mensual_haber=0;
                                    $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                }
                                
                                
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        if($mes=="08"){
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_agosto[$items_plc])<=0){
                                $var_8=count($max_agosto[$items_plc]);
                            }else{
                                $var_8=count($max_agosto[$items_plc])-1;
                            }
                            if(count($max_horas_agosto[$items_plc])<=0){
                                $hor_8=count($max_horas_agosto[$items_plc]);
                            }else{
                                $hor_8=count($max_horas_agosto[$items_plc])-1;
                            }
                            if(count($array_tot_agosto[$items_plc])<=0){
                                $count_8=count($array_tot_agosto[$items_plc]);
                            }else{
                                $count_8=count($array_tot_agosto[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_agosto[$items_plc][0]){
                                if($count_8==$array_tot_igual_agosto[$items_datos]){
                                        //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 1);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 2, 'R', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Agosto ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);  
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*if($max_agosto[$items_plc][$var_8]==$dia){
                                if($max_horas_agosto[$items_plc][$hor_8]==$fecha_2){
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 7);
                                    $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                    $pdf->Cell(105, 3, 'Agosto', 0, 0, 'C', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                    if($suma_mensual_haber!==0){
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }
                                    //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    $suma_mensual_debe=0;
                                    $suma_mensual_haber=0;
                                    $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                }
                                
    
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        if($mes=="09"){
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_septiembre[$items_plc])<=0){
                                
                                $var_9=count($max_septiembre[$items_plc]);
                            }else{
                                $var_9=count($max_septiembre[$items_plc])-1;
                            }
                            if(count($max_horas_septiembre[$items_plc])<=0){
                                $hor_9=count($max_horas_septiembre[$items_plc]);
                            }else{
                                $hor_9=count($max_horas_septiembre[$items_plc])-1;
                            }
                            if(count($array_tot_septiembre[$items_plc])<=0){
                                $count_9=count($array_tot_septiembre[$items_plc]);
                            }else{
                                $count_9=count($array_tot_septiembre[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_septiembre[$items_plc][0]){
                                if($count_9==$array_tot_igual_septiembre[$items_datos]){
                                    //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 1);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 2, 'R', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Septiembre ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);  
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*if($max_septiembre[$items_plc][$var_9]==$dia){
                                if($max_horas_septiembre[$items_plc][$hor_9]==$fecha_2){
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 7);
                                    $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                    $pdf->Cell(105, 3, 'Septiembre', 0, 0, 'C', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                    if($suma_mensual_haber!==0){
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }
                                    //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    $suma_mensual_debe=0;
                                    $suma_mensual_haber=0;
                                    $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                }
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        if($mes=="10"){
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_octubre[$items_plc])<=0){
                                $var_10=count($max_octubre[$items_plc]);
                            }else{
                                $var_10=count($max_octubre[$items_plc])-1;
                            }
                            if(count($max_horas_octubre[$items_plc])<=0){
                                $hor_10=count($max_horas_octubre[$items_plc]);
                            }else{
                                $hor_10=count($max_horas_octubre[$items_plc])-1;
                            }
                            if(count($array_tot_octubre[$items_plc])<=0){
                                $count_10=count($array_tot_octubre[$items_plc]);
                            }else{
                                $count_10=count($array_tot_octubre[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_octubre[$items_plc][0]){
                                if($count_10==$array_tot_igual_octubre[$items_datos]){
                                    //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 1);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(20, 3, "", 0, 2, 'L', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Octubre ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 1);
                                            $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                            $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);  
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*if($max_octubre[$items_plc][$var_10]==$dia){
                                if($max_horas_octubre[$items_plc][$hor_10]==$fecha_2){
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 7);
                                    $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                    $pdf->Cell(105, 3, 'Octubre', 0, 0, 'C', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                    if($suma_mensual_haber!==0){
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }
                                    //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    $suma_mensual_debe=0;
                                    $suma_mensual_haber=0;
                                    $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                }
                                
                                
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        if($mes=="11"){
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_noviembre[$items_plc])<=0){
                                $var_11=count($max_noviembre[$items_plc]);
                            }else{
                                $var_11=count($max_noviembre[$items_plc])-1;
                            }
                            if(count($max_horas_noviembre[$items_plc])<=0){
                                $hor_11=count($max_horas_noviembre[$items_plc]);
                            }else{
                                $hor_11=count($max_horas_noviembre[$items_plc])-1;
                            }
                            if(count($array_tot_noviembre[$items_plc])<=0){
                                $count_11=count($array_tot_noviembre[$items_plc]);
                            }else{
                                $count_11=count($array_tot_noviembre[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_noviembre[$items_plc][0]){
                                if($count_11==$array_tot_igual_noviembre[$items_datos]){
                                    //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 1);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 2, 'R', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(240, 240, 240);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Noviembre ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1); 
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1); 
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*if($max_noviembre[$items_plc][$var_11]==$dia){
                                if($max_horas_noviembre[$items_plc][$hor_11]==$fecha_2){
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 7);
                                    $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                    $pdf->Cell(105, 3, 'Noviembre', 0, 0, 'C', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                    if($suma_mensual_haber!==0){
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }
                                    //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    $suma_mensual_debe=0;
                                    $suma_mensual_haber=0;
                                    $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                }
                                
                                
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        if($mes=="12"){
                            $suma_mensual_debe+=$detail->debe;
                            $suma_mensual_haber+=$detail->haber;
                            if($detail->debe==null){
                                $mensual_debe+=0;
                                $mensual_haber+=$detail->haber;
                            }else{
                                if($detail->haber==null){
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=0;
                                }else{
                                    $mensual_debe+=$detail->debe;
                                    $mensual_haber+=$detail->haber;
                                }
                            }
                            $suma_mensual_saldo=$array_saldo_ant_2[$items_plc]+$mensual_debe-$mensual_haber;
                            if(count($max_diciembre[$items_plc])<=0){
                                $var_12=count($max_diciembre[$items_plc]);
                            }else{
                                $var_12=count($max_diciembre[$items_plc])-1;
                            }
                            if(count($max_horas_diciembre[$items_plc])<=0){
                                $hor_12=count($max_horas_diciembre[$items_plc]);
                            }else{
                                $hor_12=count($max_horas_diciembre[$items_plc])-1;
                            }
                            if(count($array_tot_diciembre[$items_plc])<=0){
                                $count_12=count($array_tot_diciembre[$items_plc]);
                            }else{
                                $count_12=count($array_tot_diciembre[$items_plc])-1;
                            }
                            if($detail->fecha==$array_tot_diciembre[$items_plc][0]){
                                if($count_12==$array_tot_igual_diciembre[$items_datos]){
                                    //$pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 1);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                    $pdf->Cell(15, 3, "", 0, 2, 'R', 1);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(240, 240, 240);
                                        $pdf->SetFont('Arial', 'B', 7);
                                        $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                        $pdf->Cell(105, 3, 'Diciembre ', 0, 0, 'C', 0);
                                        $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                        if($suma_mensual_haber!==0){
                                            $pdf->Cell(15, 3,number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        }
                                        //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                        if(count($array_unique_meses[$items_plc])<=1){
                                            $suma_act=$array_saldo_ant_2[$items_plc]+$suma_mensual_debe-$suma_mensual_haber;
                                            $pdf->Cell(15, 3, number_format($suma_act,2,".",","), 0, 0, 'R', 0);
                                        }else{
                                            $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                        }
                                        $suma_mensual_debe=0;
                                        $suma_mensual_haber=0;
                                        $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1); 
                                    $pdf->Cell(15, 3, "", 0, 0, 'R', 1); 
                                }
                                        
                                        
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 1);
                                $pdf->Cell(15, 3, "", 0, 0, 'R', 1);
                            }
                            /*if($max_diciembre[$items_plc][$var_12]==$dia){
                                //$suma_mensual_saldo=$suma_mensual_debe-$suma_mensual_haber;
                                if($max_horas_diciembre[$items_plc][$hor_12]==$fecha_2){
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 2, 'R', 0);
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 7);
                                    $pdf->Cell(40, 3, 'Saldo Mensual', 0, 0, 'C', 0);
                                    $pdf->Cell(105, 3, 'Diciembre', 0, 0, 'C', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_debe,2,".",","), 0, 0, 'R', 0);
                                    if($suma_mensual_haber!==0){
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }else{
                                        $pdf->Cell(15, 3, number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    }
                                    //$pdf->Cell(15, 3, "-".number_format($suma_mensual_haber,2,".",","), 0, 0, 'R', 0);
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                                    $suma_mensual_debe=0;
                                    $suma_mensual_haber=0;
                                    $suma_mensual_saldo=0;
                                }else{
                                    $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0); 
                                }
                                
                                
                            }else{
                                $pdf->Cell(15, 3, number_format($suma_mensual_saldo,2,".",","), 0, 0, 'R', 0);
                            }*/
                        }
                        $pdf->Ln();
    
                        $sum_debe+=$detail->debe;
                        $sum_haber+=$detail->haber;
                        $totales_sum_debe+=$detail->debe;
                        $totales_sum_haber+=$detail->haber;
                    }else{
                        $item_febrero=-1;
                        $horas_febrero=-1;
                    }
                }
            
                            /*$total_debe=number_format($sum_debe,2,".",",");
                            $total_haber=number_format($sum_haber,2,".",",");
                            $totales_debe=number_format($totsum_debe,2,".",",");
                            $totales_haber=number_format($totsum_haber,2,".",",");*/
                            $total_haber=number_format($sum_haber,2,".",",");
                            $total_deber=number_format($sum_debe,2,".",",");
                            $total_saldo=number_format($sum_saldo,2,".",",");
                            $totales_total_haber=number_format($totales_sum_haber,2,".",",");
                            $totales_total_deber=number_format($totales_sum_debe,2,".",",");
                            $totales_total_saldo=number_format($totales_sum_saldo,2,".",",");
                            //$pdf->SetX(15);
                            $pdf->SetFillColor(240, 240, 240);
                            $pdf->SetFont('Arial', 'B', 7);
                            //$pdf->Cell(145, 6, 'TOTAL   '.$doc, 0, 0, 'C', 0);
                            //$pdf->Cell(25, 6, $no_doc, 1, 0, 'R', 0);
                            //$pdf->Cell(25, 6, '', 1, 0, 'R', 0);
                            //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
                            //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
                            //$pdf->Cell(15, 6, $total_deber, 0, 0, 'R', 0);
                            //$pdf->Cell(15, 6, $total_haber, 0, 0, 'R', 0);
                            //$pdf->Cell(15, 6, $total_saldo, 0, 0, 'R', 0);
                            $pdf->Ln(10);
                            $total_saldo=0;
                            //$sum_1=0;
                            //$sum_2=0;
                            $sum_saldo=0;
                            $sum_debe=0;
                            $sum_haber=0;
                            $item_febrero=-1;
                            $head=$pdf->GetY();
        }

        if(isset($head)){
            // $pdf->SetY($head+5);
            // $pdf->SetFillColor(240, 240, 240);
            // $pdf->SetFont('Arial', 'B', 9);
            // $pdf->Cell(145, 6, 'TOTAL  GENERAL', 0, 0, 'C', 0);
            // //$pdf->Cell(25, 6, $no_doc, 1, 0, 'R', 0);
            // //$pdf->Cell(25, 6, '', 1, 0, 'R', 0);
            // //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
            // //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
            // $pdf->Cell(15, 6, $totales_total_deber, 0, 0, 'R', 0);
            // $pdf->Cell(15, 6, $totales_total_haber, 0, 0, 'R', 0);
            // $pdf->Cell(15, 6, $totales_total_saldo, 0, 0, 'R', 0);
        }else{
            $items_plc_not=-1;
                foreach($ingresos_prueba as $detail){
                    $items_plc_not++; 
                    $pdf->SetX(70);
                    $pdf->SetFillColor(240, 240, 240);
                    $pdf->SetFont('Arial', 'B', 8);
                    $pdf->Cell(20, 6, $detail->codcta, 0, 0, 'C', 0);
                    $pdf->Cell(75, 6, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                    //$pdf->Cell(10, 6, 'Proyecto:', 0, 0, 'C', 0);
                    //$pdf->Cell(35, 6, utf8_decode($detail->descripcion), 0, 0, 'C', 0);
                    $pdf->Ln(5);
                    $pdf->SetFillColor(240, 240, 240);
                    $pdf->SetFont('Arial', '', 8);
                    $pdf->Cell(190, 6, "Saldo Anterior:  ".number_format($detail->saldo_ant,2,".",","), 0, 0, 'C', 0);
                    $pdf->Ln(5);
                    $pdf->Cell(190, 6, "No se encontraron movimientos de esta cuenta", 0, 0, 'C', 0);
                    $pdf->Ln(10);
                }
            
        }
                            
        /*$pdf->SetXY(10,40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, 'Codigo', 1, 0, 'C', 0);
        $pdf->Cell(105, 6, 'Descripcion', 1, 0, 'C', 0);
        //$pdf->Cell(25, 6, 'Fecha Vencimiento', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, 'Debitos', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, 'Creditos', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, 'Saldo', 1, 0, 'C', 0);
        $pdf->Ln();
        $suma_inici=0;
        $debito=0;
        $credito=0;
        foreach($datos as $detail){
            $fecha=date("d/m/Y",strtotime($detail->fecha));
            $suma_inici=number_format($detail->suma,2,".",",");
            //$pdf->SetX(10);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', '', 7);
            $pdf->Cell(25, 6, $fecha, 1, 0, 'C', 0);
            $pdf->Cell(15, 6, $detail->codigo, 1, 0, 'C', 0);
            $pdf->Cell(105, 6, utf8_decode($detail->concepto), 1, 0, 'C', 0);
            //$pdf->Cell(25, 6, 'Fecha Vencimiento', 1, 0, 'C', 0);
            if($detail->id_asientos_comprobante==1){
                $pdf->Cell(15, 6, $suma_inici, 1, 0, 'C', 0);
                $debito+=$detail->suma;
                $credito+=0;
            }else{
                $pdf->Cell(15, 6, '', 1, 0, 'C', 0);
                
            }
            if($detail->id_asientos_comprobante==2){
                $pdf->Cell(15, 6, "-".$suma_inici, 1, 0, 'C', 0);
                $debito+=0;
                $credito+=$detail->suma;
            }else{
                $pdf->Cell(15, 6, '', 1, 0, 'C', 0);
            }
            $pdf->Cell(15, 6, $debito-$credito, 1, 0, 'C', 0);
            $pdf->Ln();
            
                            /*$total_debe=number_format($sum_debe,2,".",",");
                            $total_haber=number_format($sum_haber,2,".",",");
                            $pdf->SetX(15);
                            $pdf->SetFillColor(240, 240, 240);
                            $pdf->SetFont('Arial', 'B', 8);
                            $pdf->Cell(155, 6, 'TOTAL   '.$doc, 'T', 0, 'C', 0);
                            //$pdf->Cell(25, 6, $no_doc, 1, 0, 'R', 0);
                            //$pdf->Cell(25, 6, '', 1, 0, 'R', 0);
                            //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
                            //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
                            $pdf->Cell(15, 6, $total_debe, 'T', 0, 'C', 0);
                            $pdf->Cell(15, 6, $total_haber, 'T', 0, 'C', 0);
                            $pdf->Ln(11);
                            $total_debe=0;
                            $total_haber=0;
                            $sum_debe=0;
                            $sum_haber=0;
                            $doc="";
        }*/
        if($ruta==null){
            $pdf->Output("mayor_general.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."mayor_general.pdf", "F");
        }
        
    }
    public function balance_comprobacion($fec_ini,$fec_fin,$empresa,$ingresos,$plan_cuentas,$ingresos_prueba,$proyecto,$debe_haber,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa[0]->id_empresa . '/imagen/' . $empresa[0]->logo;
        if (strlen($empresa[0]->logo)>0 && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        $pdf->Cell(155, 10, utf8_decode($empresa[0]->nombre_empresa), 0, 1, 'C', 0);
        $pdf->SetXY(35, 17);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Balance Comprobacion'), 0, 1, 'C', 0);
        $pdf->SetXY(35, 22);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, 'Proyecto: '.ucfirst($proyecto), 0, 1, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $array_debe=[];
        $array_haber=[];
        $array_saldo_ant=[];
        $id_cuenta="";
        $suma_debe=0;
        $suma_haber=0;
        $suma_saldo_anterior=0;
        foreach(array_reverse($plan_cuentas) as $detail){
            $id_cuenta=$detail->id_plan_cuentas;
            foreach(array_reverse($debe_haber) as $detail){
                if($detail->id_plan_cuentas==$id_cuenta){
                    $suma_debe=$detail->debe;
                    $suma_haber=$detail->haber;
                }
            }
            foreach(array_reverse($ingresos_prueba) as $detail){
                if($detail->id_plan_cuentas==$id_cuenta){
                    $suma_saldo_anterior=$detail->saldo_ant;
                }   
            }
            array_push($array_debe,$suma_debe);
            array_push($array_haber,$suma_haber);
            array_push($array_saldo_ant,$suma_saldo_anterior);
            $suma_debe=0;
            $suma_haber=0;
            $suma_saldo_anterior=0;
        }
        //dd($array_debe);
        $id_planes=-1;
        $saldo_ant_array=[];
        $saldo_debe_array=[];
        $saldo_haber_array=[];
        $saldo_anterior=0;
        $saldo_anterior=0;
        $saldo_anterior_2=0;
        $saldo_anterior_3=0;
        $saldo_anterior_4=0;
        $suma_saldo_ant_total=0;
        $suma_total_ant=0;
        $suma_debe=0;
        $suma_debe_2=0;
        $suma_debe_3=0;
        $suma_debe_4=0;
        $suma_haber=0;
        $suma_haber_2=0;
        $suma_haber_3=0;
        $suma_haber_4=0;
        $suma_saldo_act=0;
        $suma_saldo_act_2=0;
        $suma_saldo_act_3=0;
        $suma_saldo_act_4=0;
        $index_ant=-1;
        $array_id_placts=[];
        foreach(array_reverse($plan_cuentas) as $detail){
            //$id=$detail->id_plan_cuentas;
            $cuenta=0;
            $meses="";
            $id_planes++; 
            
            $pdf->SetXY(10,30);
            /*$pdf->SetTextColor(0, 0, 0);
            $pdf->SetFont('Arial', '', 7);
            $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
            $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);*/
            //array_push($otro_array_1,$suma_debito[$prueba[intval($id_planes)]]);
            //array_push($otro_array_2,$suma_credito[$prueba[intval($id_planes)]]);
            if($detail->saldo!==null){
                $index_ant++;
                
                //if(isset($array_saldo_ant[$index_ant])){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);
                    $pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);*/
                    // if(count($array_saldo_ant[$index_ant])<=0){
                    //     $var_1=count($array_saldo_ant[$index_ant]);
                    // }else{
                    //     $var_1=count($array_saldo_ant[$index_ant])-1;
                    // }
                    
                    //$pdf->Cell(15, 3, number_format($array_saldo_ant[$index_ant][$var_1],2,".",","), 0, 0, 'R', 0);
                   
                    //array_push($saldo_ant_array,array_sum($array_saldo_ant[$index_ant]));
                    array_push($saldo_ant_array,$array_saldo_ant[$id_planes]);
                    array_push($array_id_placts,$detail->id_plan_cuentas);
                    $saldo_anterior+=$array_saldo_ant[$id_planes];
        
                //}
                //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
                //$saldo_anterior+=0;
            }else{
                if($detail->longt>10){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);
                    $pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);*/
                    array_push($saldo_ant_array,0);
                    //$saldo_anterior=0;
                }
            }
            if($detail->longt==9){
                $saldo_anterior_2+=$saldo_anterior;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, $saldo_anterior, 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior);
                $saldo_anterior=0;
            }
            
            if($detail->longt==6){
                $saldo_anterior_3+=$saldo_anterior_2;
                /*$pdf->SetTextColor(0, 0, 100);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($saldo_anterior_2,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior_2);
                $saldo_anterior_2=0;
            }
            if($detail->longt==4){
                $saldo_anterior_4+=$saldo_anterior_3;
                /*$pdf->SetTextColor(0, 100, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($saldo_anterior_3,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior_3);
                $saldo_anterior_3=0;
            }
            if($detail->longt==2){
                /*$pdf->SetTextColor(100, 50, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($saldo_anterior_4,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior_4);
                $saldo_anterior_4=0;
            }
            if($detail->saldo!==null){
                //$index_ant++;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', '', 7);*/
                //if(count($array_debe[$index_ant])>0){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);*/
                    //$var_2=count($array_debe[$index_ant])-1;
                    //$pdf->Cell(15, 3, number_format($array_debe[$index_ant][$var_2],2,".",","), 0, 0, 'R', 0);
                    array_push($saldo_debe_array,$array_debe[$id_planes]);
                    $suma_debe+=$array_debe[$id_planes];
                //}
                //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
                //$saldo_anterior+=0;
            }else{
                if($detail->longt>10){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);
                    $pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);*/
                    array_push($saldo_debe_array,0);
                }
            }
            if($detail->longt==9){
                $suma_debe_2+=$suma_debe;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, $suma_debe, 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe);
                $suma_debe=0;
            }
            
            if($detail->longt==6){
                $suma_debe_3+=$suma_debe_2;
                /*$pdf->SetTextColor(0, 0, 100);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_debe_2,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe_2);
                $suma_debe_2=0;
            }
            if($detail->longt==4){
                $suma_debe_4+=$suma_debe_3;
                /*$pdf->SetTextColor(0, 100, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_debe_3,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe_3);
                $suma_debe_3=0;
            }
            if($detail->longt==2){
                /*$pdf->SetTextColor(100, 50, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_debe_4,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe_4);
                $suma_debe_4=0;
            }
            if($detail->saldo!==null){
                //$index_ant++;
                // if(count($array_haber[$index_ant])>0){
                //     $var_3=count($array_haber[$index_ant])-1;
                    //$pdf->Cell(15, 3, number_format($array_haber[$index_ant][$var_3],2,".",","), 0, 0, 'R', 0);
                    array_push($saldo_haber_array,$array_haber[$id_planes]);
                    $suma_haber+=$array_haber[$id_planes];
                //}
                //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
                //$saldo_anterior+=0;
            }else{
                if($detail->longt>10){
                    array_push($saldo_haber_array,0);
                }
            }
            if($detail->longt==9){
                $suma_haber_2+=$suma_haber;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, $suma_haber, 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber);
                $suma_haber=0;
            }
            
            if($detail->longt==6){
                $suma_haber_3+=$suma_haber_2;
                /*$pdf->SetTextColor(0, 0, 100);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_haber_2,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber_2);
                $suma_haber_2=0;
            }
            if($detail->longt==4){
                $suma_haber_4+=$suma_haber_3;
                /*$pdf->SetTextColor(0, 100, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_haber_3,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber_3);
                $suma_haber_3=0;
            }
            if($detail->longt==2){
                /*$pdf->SetTextColor(100, 50, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_haber_4,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber_4);
                $suma_haber_4=0;
            }
            // if($detail->saldo!==null){
            //     //$index_ant++;
                
            //         //$var_3=count($max_haber[$index_ant])-1;
            //         //$pdf->Cell(15, 3, number_format($detail->saldo,2,".",","), 0, 0, 'R', 0);
            //         array_push($saldo_act_array,$detail->saldo);
            //         $suma_saldo_act+=$detail->saldo;
               
            //     //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
            //     //$saldo_anterior+=0;
            //     }else{
            //         if($detail->longt==12 || $detail->longt==11){
            //             //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
            //             array_push($saldo_act_array,0);
            //         }
            // }
            // if($detail->longt==9){
            //     $suma_saldo_act_2+=$suma_saldo_act;
            //     /*$pdf->SetTextColor(0, 0, 0);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, $suma_saldo_act, 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act);
            //     $suma_saldo_act=0;
            // }
            
            // if($detail->longt==6){
            //     $suma_saldo_act_3+=$suma_saldo_act_2;
            //     /*$pdf->SetTextColor(0, 0, 100);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, number_format($suma_saldo_act_2,2,".",","), 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act_2);
            //     $suma_saldo_act_2=0;
            // }
            // if($detail->longt==4){
            //     $suma_saldo_act_4+=$suma_saldo_act_3;
            //     /*$pdf->SetTextColor(0, 100, 50);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, number_format($suma_saldo_act_3,2,".",","), 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act_3);
            //     $suma_saldo_act_3=0;
            // }
            // if($detail->longt==2){
            //     /*$pdf->SetTextColor(100, 50, 50);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, number_format($suma_saldo_act_4,2,".",","), 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act_4);
            //     $suma_saldo_act_4=0;
            // }
            // array_push($array_index,$index_ant);
            // $index_ant=-1;
            $pdf->Ln();
            
            $head=$pdf->GetY();
        }
        $reverse_saldo_ant=array_reverse($saldo_ant_array);
        $reverse_saldo_debe=array_reverse($saldo_debe_array);
        $reverse_saldo_haber=array_reverse($saldo_haber_array);
        //dd($reverse_saldo_debe);
        $index_plc_2=-1;
        $suma_total_niv_ant=0;
        $suma_total_niv_debe=0;
        $suma_total_niv_haber=0;
        $suma_total_niv_act=0;
        $total_saldo_act=0;
        $suma_solo_saldo_ant=0;
        $suma_solo_debe=0;
        $suma_solo_haber=0;
        $suma_solo_act=0;
        //dd($reverse_saldo_ant);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(130, 3, utf8_decode("Cuenta Contable"), 0, 0, 'C', 0);
            $pdf->Cell(15, 3, utf8_decode("Saldo Anterior"), 0, 0, 'L', 0);
            $pdf->Cell(15, 3, utf8_decode("Debe"), 0, 0, 'R', 0);
            $pdf->Cell(15, 3, utf8_decode("Haber"), 0, 0, 'R', 0);
            $pdf->Cell(15, 3, utf8_decode("Saldo"), 0, 1, 'R', 0);
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            
            if($reverse_saldo_ant[$index_plc_2]!='0' || $reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                $pdf->SetX(10);
                if($detail->longt>10){
                    $pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);
                }else{
                    if($detail->longt==9){
                        $pdf->SetTextColor(100,100,100);
                        $pdf->SetFont('Arial', 'B', 7);
                    }else{
                        if($detail->longt==6){
                            $pdf->SetTextColor(70,70,70 );
                            $pdf->SetFont('Arial', 'B', 7);
                        }else{
                            if($detail->longt==4){
                                $pdf->SetTextColor(30,30,30);
                                $pdf->SetFont('Arial', 'B', 7);
                            }else{
                                $pdf->SetTextColor(0, 0, 0);
                                $pdf->SetFont('Arial', 'B', 7);
                            }
                        }
                    }
                }
                $suma_total_niv_ant+=$reverse_saldo_ant[$index_plc_2];
                $suma_total_niv_debe+=$reverse_saldo_debe[$index_plc_2];
                $suma_total_niv_haber+=$reverse_saldo_haber[$index_plc_2];
                $suma_total_niv_act=$suma_total_niv_ant+$suma_total_niv_debe-$suma_total_niv_haber;
                $total_saldo_act+=$suma_total_niv_ant+$suma_total_niv_debe-$suma_total_niv_haber;
                $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                $pdf->Cell(15, 3, number_format($reverse_saldo_ant[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                $pdf->Cell(15, 3, number_format($reverse_saldo_debe[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                $pdf->Cell(15, 3, number_format($reverse_saldo_haber[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                $pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);
                $pdf->Ln();
                if($detail->longt>10){
                    $suma_solo_saldo_ant+=$reverse_saldo_ant[$index_plc_2];
                    $suma_solo_debe+=$reverse_saldo_debe[$index_plc_2];
                    $suma_solo_haber+=$reverse_saldo_haber[$index_plc_2];
                    $suma_solo_act+=$suma_total_niv_act;
                }
                $suma_total_niv_ant=0;
                $suma_total_niv_debe=0;
                $suma_total_niv_haber=0;
                $suma_total_niv_act=0;
            }

            
            
            $head_2=$pdf->GetY();
        }
            $pdf->SetXY(10,$head_2);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'TOTAL GENERAL', 0, 0, 'C', 0);
            //$pdf->Cell(105, 6, '', 0, 0, 'C', 0);
            //$pdf->Cell(15, 6, 'S.Anterior', 0, 0, 'R', 0);
            //$pdf->Cell(25, 6, 'Fecha Vencimiento', 'T', 0, 'C', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_ant),2,".",","), 'T', 0, 'R', 0);
            $pdf->Cell(15, 6, number_format($suma_solo_saldo_ant,2,".",","), 'T', 0, 'R', 0);
            $pdf->Cell(15, 6, number_format($suma_solo_debe,2,".",","), 'T', 0, 'R', 0);
            $pdf->Cell(15, 6, number_format($suma_solo_haber,2,".",","), 'T', 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format($suma_solo_saldo_act,2,".",","), 'T', 0, 'R', 0);
           // $pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_debe),2,".",","), 'T', 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_haber),2,".",","), 'T', 0, 'R', 0);
            $suma_solo_saldo_act=0;
            $suma_solo_saldo_act=$suma_solo_saldo_ant+$suma_solo_debe-$suma_solo_haber;
            $pdf->Cell(15, 6, number_format($suma_solo_act,2,".",","), 'T', 0, 'R', 0);
        if($ruta==null){
            $pdf->Output("balance_comprobacion.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."balance_comprobacion.pdf", "F");
            //$pdf->Output("balance_comprobacion.pdf", "D");
        }
        
    }
    public function estado_situacion_financiera($fec_ini,$fec_fin,$empresa,$ingresos,$plan_cuentas,$ingresos_prueba,$proyecto,$debe_haber,$activo,$pasivo,$patrimonio,$ingreso,$costo,$gasto,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        //$pdf->SetAutoPageBreak(true,2);
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa[0]->id_empresa . '/imagen/' . $empresa[0]->logo;
        if (strlen($empresa[0]->logo)>0 && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            if($empresa[0]->id_empresa!==48){
                $pdf->Image($logo, 12, 11, 45, 18);
            }else{
                $pdf->Image($logo, 12, 10, 40, 17);
            }
            
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        if($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa))>115){
            $pdf->SetXY(55, 10);
            $pdf->MultiCell(115, 5, utf8_decode($empresa[0]->nombre_empresa), 0,'C', 0);
            $head_empresa=$pdf->GetY();
        }else{
            $pdf->Cell(155, 10, utf8_decode($empresa[0]->nombre_empresa), 0, 1, 'C', 0);
        }
        if($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa))>115){
            $pdf->SetXY(35, $head_empresa-1);
        }else{
            $pdf->SetXY(35, 17);
        }
        
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Estado Situacion Financiera'), 0, 2, 'C', 0);
        $pdf->SetXY(35, 23);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, 'Proyecto: '.ucfirst($proyecto), 0, 1, 'C', 0);
        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        
        
        $array_debe=[];
        $array_haber=[];
        $array_saldo_ant=[];
        $id_cuenta="";
        $suma_debe=0;
        $suma_haber=0;
        $suma_saldo_anterior=0;
        foreach(array_reverse($plan_cuentas) as $detail){
            $id_cuenta=$detail->id_plan_cuentas;
            foreach(array_reverse($debe_haber) as $detail){
                if($detail->id_plan_cuentas==$id_cuenta){
                    $suma_debe=$detail->debe;
                    $suma_haber=$detail->haber;
                }
            }
            foreach(array_reverse($ingresos_prueba) as $detail){
                if($detail->id_plan_cuentas==$id_cuenta){
                    $suma_saldo_anterior=$detail->saldo_ant;
                }   
            }
            array_push($array_debe,$suma_debe);
            array_push($array_haber,$suma_haber);
            array_push($array_saldo_ant,$suma_saldo_anterior);
            $suma_debe=0;
            $suma_haber=0;
            $suma_saldo_anterior=0;
        }
        $id_planes=-1;
        $saldo_ant_array=[];
        $saldo_debe_array=[];
        $saldo_haber_array=[];
        $saldo_anterior=0;
        $saldo_anterior=0;
        $saldo_anterior_2=0;
        $saldo_anterior_3=0;
        $saldo_anterior_4=0;
        $suma_saldo_ant_total=0;
        $suma_total_ant=0;
        $suma_debe=0;
        $suma_debe_2=0;
        $suma_debe_3=0;
        $suma_debe_4=0;
        $suma_haber=0;
        $suma_haber_2=0;
        $suma_haber_3=0;
        $suma_haber_4=0;
        $suma_saldo_act=0;
        $suma_saldo_act_2=0;
        $suma_saldo_act_3=0;
        $suma_saldo_act_4=0;
        $index_ant=-1;
        foreach(array_reverse($plan_cuentas) as $detail){
            //$id=$detail->id_plan_cuentas;
            $cuenta=0;
            $meses="";
            $id_planes++; 
            
            $pdf->SetXY(10,30);
            /*$pdf->SetTextColor(0, 0, 0);
            $pdf->SetFont('Arial', '', 7);
            $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
            $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);*/
            //array_push($otro_array_1,$suma_debito[$prueba[intval($id_planes)]]);
            //array_push($otro_array_2,$suma_credito[$prueba[intval($id_planes)]]);
            if($detail->saldo!==null){
                $index_ant++;
                
                //if(isset($array_saldo_ant[$index_ant])){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);
                    $pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);*/
                    // if(count($array_saldo_ant[$index_ant])<=0){
                    //     $var_1=count($array_saldo_ant[$index_ant]);
                    // }else{
                    //     $var_1=count($array_saldo_ant[$index_ant])-1;
                    // }
                    
                    //$pdf->Cell(15, 3, number_format($array_saldo_ant[$index_ant][$var_1],2,".",","), 0, 0, 'R', 0);
                   
                    //array_push($saldo_ant_array,array_sum($array_saldo_ant[$index_ant]));
                    array_push($saldo_ant_array,$array_saldo_ant[$id_planes]);
                    $saldo_anterior+=$array_saldo_ant[$id_planes];
        
                //}
                //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
                //$saldo_anterior+=0;
            }else{
                if($detail->longt>10){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);
                    $pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);*/
                    array_push($saldo_ant_array,0);
                }
            }
            if($detail->longt==9){
                $saldo_anterior_2+=$saldo_anterior;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, $saldo_anterior, 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior);
                $saldo_anterior=0;
            }
            
            if($detail->longt==6){
                $saldo_anterior_3+=$saldo_anterior_2;
                /*$pdf->SetTextColor(0, 0, 100);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($saldo_anterior_2,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior_2);
                $saldo_anterior_2=0;
            }
            if($detail->longt==4){
                $saldo_anterior_4+=$saldo_anterior_3;
                /*$pdf->SetTextColor(0, 100, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($saldo_anterior_3,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior_3);
                $saldo_anterior_3=0;
            }
            if($detail->longt==2){
                /*$pdf->SetTextColor(100, 50, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($saldo_anterior_4,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior_4);
                $saldo_anterior_4=0;
            }
            if($detail->saldo!==null){
                //$index_ant++;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', '', 7);*/
                //if(count($array_debe[$index_ant])>0){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);*/
                    //$var_2=count($array_debe[$index_ant])-1;
                    //$pdf->Cell(15, 3, number_format($array_debe[$index_ant][$var_2],2,".",","), 0, 0, 'R', 0);
                    array_push($saldo_debe_array,$array_debe[$id_planes]);
                    $suma_debe+=$array_debe[$id_planes];
                //}
                //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
                //$saldo_anterior+=0;
            }else{
                if($detail->longt>10){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);
                    $pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);*/
                    array_push($saldo_debe_array,0);
                }
            }
            if($detail->longt==9){
                $suma_debe_2+=$suma_debe;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, $suma_debe, 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe);
                $suma_debe=0;
            }
            
            if($detail->longt==6){
                $suma_debe_3+=$suma_debe_2;
                /*$pdf->SetTextColor(0, 0, 100);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_debe_2,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe_2);
                $suma_debe_2=0;
            }
            if($detail->longt==4){
                $suma_debe_4+=$suma_debe_3;
                /*$pdf->SetTextColor(0, 100, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_debe_3,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe_3);
                $suma_debe_3=0;
            }
            if($detail->longt==2){
                /*$pdf->SetTextColor(100, 50, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_debe_4,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe_4);
                $suma_debe_4=0;
            }
            if($detail->saldo!==null){
                //$index_ant++;
                // if(count($array_haber[$index_ant])>0){
                //     $var_3=count($array_haber[$index_ant])-1;
                    //$pdf->Cell(15, 3, number_format($array_haber[$index_ant][$var_3],2,".",","), 0, 0, 'R', 0);
                    array_push($saldo_haber_array,$array_haber[$id_planes]);
                    $suma_haber+=$array_haber[$id_planes];
                //}
                //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
                //$saldo_anterior+=0;
            }else{
                if($detail->longt>10){
                    array_push($saldo_haber_array,0);
                }
            }
            if($detail->longt==9){
                $suma_haber_2+=$suma_haber;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, $suma_haber, 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber);
                $suma_haber=0;
            }
            
            if($detail->longt==6){
                $suma_haber_3+=$suma_haber_2;
                /*$pdf->SetTextColor(0, 0, 100);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_haber_2,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber_2);
                $suma_haber_2=0;
            }
            if($detail->longt==4){
                $suma_haber_4+=$suma_haber_3;
                /*$pdf->SetTextColor(0, 100, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_haber_3,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber_3);
                $suma_haber_3=0;
            }
            if($detail->longt==2){
                /*$pdf->SetTextColor(100, 50, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_haber_4,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber_4);
                $suma_haber_4=0;
            }
            // if($detail->saldo!==null){
            //     //$index_ant++;
                
            //         //$var_3=count($max_haber[$index_ant])-1;
            //         //$pdf->Cell(15, 3, number_format($detail->saldo,2,".",","), 0, 0, 'R', 0);
            //         array_push($saldo_act_array,$detail->saldo);
            //         $suma_saldo_act+=$detail->saldo;
               
            //     //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
            //     //$saldo_anterior+=0;
            //     }else{
            //         if($detail->longt==12 || $detail->longt==11){
            //             //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
            //             array_push($saldo_act_array,0);
            //         }
            // }
            // if($detail->longt==9){
            //     $suma_saldo_act_2+=$suma_saldo_act;
            //     /*$pdf->SetTextColor(0, 0, 0);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, $suma_saldo_act, 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act);
            //     $suma_saldo_act=0;
            // }
            
            // if($detail->longt==6){
            //     $suma_saldo_act_3+=$suma_saldo_act_2;
            //     /*$pdf->SetTextColor(0, 0, 100);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, number_format($suma_saldo_act_2,2,".",","), 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act_2);
            //     $suma_saldo_act_2=0;
            // }
            // if($detail->longt==4){
            //     $suma_saldo_act_4+=$suma_saldo_act_3;
            //     /*$pdf->SetTextColor(0, 100, 50);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, number_format($suma_saldo_act_3,2,".",","), 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act_3);
            //     $suma_saldo_act_3=0;
            // }
            // if($detail->longt==2){
            //     /*$pdf->SetTextColor(100, 50, 50);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, number_format($suma_saldo_act_4,2,".",","), 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act_4);
            //     $suma_saldo_act_4=0;
            // }
            // array_push($array_index,$index_ant);
            // $index_ant=-1;
            $pdf->Ln();
            
            $head=$pdf->GetY();
        }
        $reverse_saldo_ant=array_reverse($saldo_ant_array);
        $reverse_saldo_debe=array_reverse($saldo_debe_array);
        $reverse_saldo_haber=array_reverse($saldo_haber_array);
        //dd($reverse_saldo_debe);
        //ACTIVOS
        $index_plc_2=-1;
        $existe_activos=0;
        $head_cabecera=35;
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($activo==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                if($reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                    $existe_activos++;
                }
                
            }
            
        }
        //dd($plan_cuentas);
        if($existe_activos>0){
            $pdf->SetXY(45,$head_cabecera);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'ACTIVO', 0, 0, 'C', 0);
            $pdf->Ln();
        }
        $index_plc_2=-1;
        $suma_total_niv_ant=0;
        $suma_total_niv_debe=0;
        $suma_total_niv_haber=0;
        $suma_total_niv_act=0;
        $total_saldo_act=0;
        $suma_solo_saldo_ant=0;
        $suma_solo_debe=0;
        $suma_solo_haber=0;
        $array_saldo_anterior=[];
        $array_saldo_tot_anterior=[];
        $n1="";
        $n2="";
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($activo==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                //if($reverse_saldo_ant[$index_plc_2]!='0' || $reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                //if($reverse_saldo_ant[$index_plc_2]+$reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                if($reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                    $pdf->SetX(10);
                    if($detail->longt>10){
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Arial', '', 7);
                    }else{
                        if($detail->longt==9){
                            $pdf->SetTextColor(100,100,100);
                            $pdf->SetFont('Arial', 'B', 7);
                        }else{
                            if($detail->longt==6){
                                $pdf->SetTextColor(70,70,70 );
                                $pdf->SetFont('Arial', 'B', 7);
                            }else{
                                if($detail->longt==4){
                                    $pdf->SetTextColor(30,30,30);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }else{
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }
                            }
                        }
                    }
                    $suma_total_niv_ant+=$reverse_saldo_ant[$index_plc_2];
                    $suma_total_niv_debe+=$reverse_saldo_debe[$index_plc_2];
                    $suma_total_niv_haber+=$reverse_saldo_haber[$index_plc_2];
                    $suma_total_niv_act=$suma_total_niv_debe-$suma_total_niv_haber;
                    $total_saldo_act+=$suma_total_niv_debe-$suma_total_niv_haber;
                    if($suma_total_niv_act!==0){
                        //array_push($array_saldo_anterior,$suma_total_niv_act);
                        //$pdf->Ln();
                        $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                            $pdf->Cell(65, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                            if($detail->longt>10){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==9){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==6){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==4){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";  
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==2){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $ultimo_nivel=$suma_total_niv_act;
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2=""; 
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            if($detail->longt==12 || $detail->longt==11){
                                $suma_solo_saldo_ant+=$reverse_saldo_ant[$index_plc_2];
                                $suma_solo_debe+=$reverse_saldo_debe[$index_plc_2];
                                $suma_solo_haber+=$reverse_saldo_haber[$index_plc_2];
                            }
                            $suma_total_niv_ant=0;
                            $suma_total_niv_debe=0;
                            $suma_total_niv_haber=0;
                            $suma_total_niv_act=0;
                            //$pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);
                            //array_push($array_total_saldo_actual,$suma_total_niv_act);
                            $pdf->Ln();
                        }
                    
    
                        $head_2=$pdf->GetY();
                    /*$pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                    $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                    /*$pdf->Cell(15, 3, number_format($reverse_saldo_ant[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_debe[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_haber[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);*/
                    
                }
                //array_push($array_saldo_tot_anterior,$array_saldo_anterior);
                //$array_saldo_anterior=[];
                
                $head_2=$pdf->GetY();
            }
            
        }
        //dd($array_saldo_anterior);
        $head_total_activo=0;
        if($existe_activos>0){
            $pdf->SetXY(10,$head_2);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'TOTAL ACTIVO', 0, 0, 'C', 0);
            //$pdf->Cell(105, 6, '', 0, 0, 'C', 0);
            //$pdf->Cell(15, 6, 'S.Anterior', 0, 0, 'R', 0);
            //$pdf->Cell(25, 6, 'Fecha Vencimiento', 'T', 0, 'C', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_ant),2,".",","), 'T', 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format($suma_solo_saldo_act,2,".",","), 'T', 0, 'R', 0);
           // $pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_debe),2,".",","), 'T', 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_haber),2,".",","), 'T', 0, 'R', 0);
            $suma_solo_saldo_act=0;
            $suma_solo_saldo_act=$suma_solo_debe-$suma_solo_haber;
            $a="";
            $b="";
            if($suma_solo_saldo_act<0){
                $suma_solo_saldo_act=$suma_solo_saldo_act*-1;
                $a="(";
                $b=")";
            }
            $pdf->Cell(15, 6, $a.number_format($suma_solo_saldo_act,2,".",",").$b, 0, 0, 'R', 0);
            $head_total_activo=$pdf->GetY();
            $pdf->Ln(10);
            $head_cabecera=$pdf->GetY();
        }
        //dd($head_total_activo."total actibo");
        if($head_total_activo>190){
            $otro_valor=$pdf->GetPageHeight()-$head_total_activo+5;
            $pdf->SetAutoPageBreak(true,$otro_valor);
        }else{
            $pdf->SetAutoPageBreak(false);
        }
        //PASIVOS
        $index_plc_2=-1;
        $existe_pasivos=0;
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($pasivo==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                if($reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                    $existe_pasivos++;
                }
            }
        }
        if($existe_pasivos>0){
            $pdf->SetXY(45,$head_cabecera);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'PASIVO', 0, 0, 'C', 0);
            $head_pasivo=$pdf->GetY();
            $pdf->Ln();
        }
        $index_plc_2=-1;
        $suma_total_niv_ant=0;
        $suma_total_niv_debe=0;
        $suma_total_niv_haber=0;
        $suma_total_niv_act=0;
        $total_saldo_act=0;
        $suma_solo_saldo_ant=0;
        $suma_solo_debe=0;
        $suma_solo_haber=0;
        $array_saldo_anterior=[];
        $array_saldo_tot_anterior=[];
        $n1="";
        $n2="";
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($pasivo==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                //if($reverse_saldo_ant[$index_plc_2]!='0' || $reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                //if($reverse_saldo_ant[$index_plc_2]+$reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                if($reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                    $pdf->SetX(10);
                    if($detail->longt>10){
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Arial', '', 7);
                    }else{
                        if($detail->longt==9){
                            $pdf->SetTextColor(100,100,100);
                            $pdf->SetFont('Arial', 'B', 7);
                        }else{
                            if($detail->longt==6){
                                $pdf->SetTextColor(70,70,70 );
                                $pdf->SetFont('Arial', 'B', 7);
                            }else{
                                if($detail->longt==4){
                                    $pdf->SetTextColor(30,30,30);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }else{
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }
                            }
                        }
                    }
                    $suma_total_niv_ant+=$reverse_saldo_ant[$index_plc_2];
                    $suma_total_niv_debe+=$reverse_saldo_debe[$index_plc_2];
                    $suma_total_niv_haber+=$reverse_saldo_haber[$index_plc_2];
                    $suma_total_niv_act=$suma_total_niv_debe-$suma_total_niv_haber;
                    $total_saldo_act+=$suma_total_niv_debe-$suma_total_niv_haber;
                    if($suma_total_niv_act!==0){
                        //array_push($array_saldo_anterior,$suma_total_niv_act);
                        //$pdf->Ln();
                        $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                            $pdf->Cell(65, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                            if($detail->longt>10){
                                if($suma_total_niv_act>0){
                                    $suma_total_niv_act=$suma_total_niv_act*1;
                                    $n1="(";
                                    $n2=")";
                                }else{
                                    if($suma_total_niv_act<0){
                                        $suma_total_niv_act=$suma_total_niv_act*-1;
                                    }
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==9){
                                if($suma_total_niv_act>0){
                                    $suma_total_niv_act=$suma_total_niv_act*1;
                                    $n1="(";
                                    $n2=")";
                                }else{
                                    if($suma_total_niv_act<0){
                                        $suma_total_niv_act=$suma_total_niv_act*-1;
                                    }
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==6){
                                if($suma_total_niv_act>0){
                                    $suma_total_niv_act=$suma_total_niv_act*1;
                                    $n1="(";
                                    $n2=")";
                                }else{
                                    if($suma_total_niv_act<0){
                                        $suma_total_niv_act=$suma_total_niv_act*-1;
                                    }
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==4){
                                if($suma_total_niv_act>0){
                                    $suma_total_niv_act=$suma_total_niv_act*1;
                                    $n1="(";
                                    $n2=")";
                                }else{
                                    if($suma_total_niv_act<0){
                                        $suma_total_niv_act=$suma_total_niv_act*-1;
                                    }
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";  
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==2){
                                if($suma_total_niv_act>0){
                                    $suma_total_niv_act=$suma_total_niv_act*1;
                                    $n1="(";
                                    $n2=")";
                                }else{
                                    if($suma_total_niv_act<0){
                                        $suma_total_niv_act=$suma_total_niv_act*-1;
                                    }
                                }
                                $ultimo_nivel=$suma_total_niv_act;
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            if($detail->longt==12 || $detail->longt==11){
                                $suma_solo_saldo_ant+=$reverse_saldo_ant[$index_plc_2];
                                $suma_solo_debe+=$reverse_saldo_debe[$index_plc_2];
                                $suma_solo_haber+=$reverse_saldo_haber[$index_plc_2];
                            }
                            $suma_total_niv_ant=0;
                            $suma_total_niv_debe=0;
                            $suma_total_niv_haber=0;
                            $suma_total_niv_act=0;
                            //$pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);
                            //array_push($array_total_saldo_actual,$suma_total_niv_act);
                            $pdf->Ln();
                    }
                    
    
                        $head_3=$pdf->GetY();
                    /*$pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                    $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                    /*$pdf->Cell(15, 3, number_format($reverse_saldo_ant[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_debe[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_haber[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);*/
                    
                }
                //array_push($array_saldo_tot_anterior,$array_saldo_anterior);
                //$array_saldo_anterior=[];
                
                $head_3=$pdf->GetY();
            }
            
        }
        $suma_solo_saldo_pasivo=0;
        $head_total_pasivo=0;
        $positivo_pasivo=0;
        if($existe_pasivos>0){
            $pdf->SetXY(10,$head_3);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'TOTAL PASIVOS', 0, 0, 'C', 0);
            //$pdf->Cell(105, 6, '', 0, 0, 'C', 0);
            //$pdf->Cell(15, 6, 'S.Anterior', 0, 0, 'R', 0);
            //$pdf->Cell(25, 6, 'Fecha Vencimiento', 'T', 0, 'C', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_ant),2,".",","), 'T', 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format($suma_solo_saldo_act,2,".",","), 'T', 0, 'R', 0);
           // $pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_debe),2,".",","), 'T', 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_haber),2,".",","), 'T', 0, 'R', 0);
            $a="";
            $b="";
            $suma_solo_saldo_pasivo=$suma_solo_debe-$suma_solo_haber;
            if($suma_solo_saldo_pasivo>0){
                $positivo_pasivo=1;
                $suma_solo_saldo_pasivo=$suma_solo_saldo_pasivo*1;
                $a="(";
                $b=")";
            }else{
                if($suma_solo_saldo_pasivo<0){
                    $suma_solo_saldo_pasivo=$suma_solo_saldo_pasivo*-1;
                }
            }
            
            $pdf->Cell(15, 6, $a.number_format($suma_solo_saldo_pasivo,2,".",",").$b, 0, 0, 'R', 0);
            
            
            $head_total_pasivo=$pdf->GetY();
            $pdf->Ln(10);
            $head_cabecera=$pdf->GetY();
        }
        
        //PATRIMONIO
        $index_plc_2=-1;
        $existe_patrimonio=0;
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($patrimonio==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                if($reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                    $existe_patrimonio++;
                }
            }
        }
        $index_plc_3=-1;
        $tamanio_patrimonio=0;
        foreach($plan_cuentas as $detail){
            $index_plc_3++;
            $codigo=str_split($detail->codcta,2);
            if($patrimonio==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                //if($reverse_saldo_ant[$index_plc_2]!='0' || $reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                if($reverse_saldo_ant[$index_plc_3]+$reverse_saldo_debe[$index_plc_3]-$reverse_saldo_haber[$index_plc_3]!='0'){
                    $pdf->SetX(10);
                    if($detail->longt>10){
                        $tamanio_patrimonio+=3;
                    }else{
                        if($detail->longt==9){
                            $tamanio_patrimonio+=3;
                        }else{
                            if($detail->longt==6){
                                $tamanio_patrimonio+=3;
                            }else{
                                if($detail->longt==4){
                                    $tamanio_patrimonio+=3;
                                }else{
                                    $tamanio_patrimonio+=3;
                                }
                            }
                        }
                    }
                    
                    
    
                        
                    /*$pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                    $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                    /*$pdf->Cell(15, 3, number_format($reverse_saldo_ant[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_debe[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_haber[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);*/
                    
                }
                //array_push($array_saldo_tot_anterior,$array_saldo_anterior);
                //$array_saldo_anterior=[];
                
                
            }
            
        }
        //dd($pdf->GetPageHeight());
        if($head_total_pasivo>180){
            $otro_valor=$pdf->GetPageHeight()-$head_total_pasivo+5;
            $pdf->SetAutoPageBreak(true,$otro_valor);
        }else{
            $pdf->SetAutoPageBreak(false);
        }
        //dd($tamanio_patrimonio);
        if($existe_patrimonio>0){
            $pdf->SetXY(45,$head_cabecera);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $head_patrimonio=$pdf->GetY();
            $pdf->Cell(130, 6, 'PATRIMONIO', 0, 0, 'C', 0);
            
            $pdf->Ln();
        }
        //dd($head_patrimonio.":patrimo");
        $index_plc_2=-1;
        $suma_total_niv_ant=0;
        $suma_total_niv_debe=0;
        $suma_total_niv_haber=0;
        $suma_total_niv_act=0;
        $total_saldo_act=0;
        $suma_solo_saldo_ant=0;
        $suma_solo_debe=0;
        $suma_solo_haber=0;
        $array_saldo_anterior=[];
        $array_saldo_tot_anterior=[];
        $n1="";
        $n2="";
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($patrimonio==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                //if($reverse_saldo_ant[$index_plc_2]!='0' || $reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                //if($reverse_saldo_ant[$index_plc_2]+$reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                if($reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                    $pdf->SetX(10);
                    if($detail->longt>10){
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Arial', '', 7);
                    }else{
                        if($detail->longt==9){
                            $pdf->SetTextColor(100,100,100);
                            $pdf->SetFont('Arial', 'B', 7);
                        }else{
                            if($detail->longt==6){
                                $pdf->SetTextColor(70,70,70 );
                                $pdf->SetFont('Arial', 'B', 7);
                            }else{
                                if($detail->longt==4){
                                    $pdf->SetTextColor(30,30,30);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }else{
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }
                            }
                        }
                    }
                    $suma_total_niv_ant+=$reverse_saldo_ant[$index_plc_2];
                    $suma_total_niv_debe+=$reverse_saldo_debe[$index_plc_2];
                    $suma_total_niv_haber+=$reverse_saldo_haber[$index_plc_2];
                    $suma_total_niv_act=$suma_total_niv_debe-$suma_total_niv_haber;
                    $total_saldo_act+=$suma_total_niv_debe-$suma_total_niv_haber;
                    if($suma_total_niv_act!==0){
                        //array_push($array_saldo_anterior,$suma_total_niv_act);
                        //$pdf->Ln();
                        $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                            $pdf->Cell(65, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                            if($detail->longt>10){
                                if($suma_total_niv_act>0){
                                    $suma_total_niv_act=$suma_total_niv_act*1;
                                    $n1="(";
                                    $n2=")";
                                }else{
                                    if($suma_total_niv_act<0){
                                        $suma_total_niv_act=$suma_total_niv_act*-1;
                                    }
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==9){
                                if($suma_total_niv_act>0){
                                    $suma_total_niv_act=$suma_total_niv_act*1;
                                    $n1="(";
                                    $n2=")";
                                }else{
                                    if($suma_total_niv_act<0){
                                        $suma_total_niv_act=$suma_total_niv_act*-1;
                                    }
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==6){
                                if($suma_total_niv_act>0){
                                    $suma_total_niv_act=$suma_total_niv_act*1;
                                    $n1="(";
                                    $n2=")";
                                }else{
                                    if($suma_total_niv_act<0){
                                        $suma_total_niv_act=$suma_total_niv_act*-1;
                                    }
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==4){
                                if($suma_total_niv_act>0){
                                    $suma_total_niv_act=$suma_total_niv_act*1;
                                    $n1="(";
                                    $n2=")";
                                }else{
                                    if($suma_total_niv_act<0){
                                        $suma_total_niv_act=$suma_total_niv_act*-1;
                                    }
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";  
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==2){
                                if($suma_total_niv_act>0){
                                    $suma_total_niv_act=$suma_total_niv_act*1;
                                    $n1="(";
                                    $n2=")";
                                }else{
                                    if($suma_total_niv_act<0){
                                        $suma_total_niv_act=$suma_total_niv_act*-1;
                                    }
                                }
                                $ultimo_nivel=$suma_total_niv_act;
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            if($detail->longt>10){
                                $suma_solo_saldo_ant+=$reverse_saldo_ant[$index_plc_2];
                                $suma_solo_debe+=$reverse_saldo_debe[$index_plc_2];
                                $suma_solo_haber+=$reverse_saldo_haber[$index_plc_2];
                            }
                            $suma_total_niv_ant=0;
                            $suma_total_niv_debe=0;
                            $suma_total_niv_haber=0;
                            $suma_total_niv_act=0;
                            //$pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);
                            //array_push($array_total_saldo_actual,$suma_total_niv_act);
                            $pdf->Ln();
                        }
                    
    
                        $head_3=$pdf->GetY();
                    /*$pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                    $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                    /*$pdf->Cell(15, 3, number_format($reverse_saldo_ant[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_debe[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_haber[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);*/
                    
                }
                //array_push($array_saldo_tot_anterior,$array_saldo_anterior);
                //$array_saldo_anterior=[];
                
                $head_3=$pdf->GetY();
            }
            
        }
        $suma_solo_saldo_patrimonio=0;
        $positivo_patrimonio=0;
        if($existe_patrimonio>0){
            $pdf->SetXY(10,$head_3);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'TOTAL PATRIMONIO', 0, 0, 'C', 0);
            //$pdf->Cell(105, 6, '', 0, 0, 'C', 0);
            //$pdf->Cell(15, 6, 'S.Anterior', 0, 0, 'R', 0);
            //$pdf->Cell(25, 6, 'Fecha Vencimiento', 'T', 0, 'C', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_ant),2,".",","), 'T', 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format($suma_solo_saldo_act,2,".",","), 'T', 0, 'R', 0);
           // $pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_debe),2,".",","), 'T', 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_haber),2,".",","), 'T', 0, 'R', 0);
            $a="";
            $b="";
            
            $suma_solo_saldo_patrimonio=$suma_solo_debe-$suma_solo_haber;
            if($suma_solo_saldo_patrimonio>0){
                $positivo_patrimonio=1;
                $suma_solo_saldo_patrimonio=$suma_solo_saldo_patrimonio*1;
                $a="(";
                $b=")";
            }else{
                if($suma_solo_saldo_patrimonio<0){
                    $suma_solo_saldo_patrimonio=$suma_solo_saldo_patrimonio*-1;
                }
            }
            
            $pdf->Cell(15, 6, $a.number_format($suma_solo_saldo_patrimonio,2,".",",").$b, 0, 0, 'R', 0);
            
            
            $pdf->Ln(10);
            $head_cabecera=$pdf->GetY();
        }
        //Estado resultaod
        $index_plc_2=-1;
        $suma_total_niv_ant=0;
        $suma_total_niv_debe=0;
        $suma_total_niv_haber=0;
        $suma_total_niv_act=0;
        $total_saldo_act=0;
        $ultimo_nivel_ingreso=0;
        $ultimo_nivel_costo=0;
        $ultimo_nivel_gasto=0;
        $suma_estado_resultado=0;
        // foreach($plan_cuentas as $detail){
        //     $index_plc_2++;
        // }
        // dd($index_plc_2);
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($ingreso==$codigo[0]){
                if($reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                    //$pdf->SetX(10);
                    /*if($detail->longt==12 || $detail->longt==11){
                        //$pdf->SetTextColor(0, 0, 0);
                        //$pdf->SetFont('Arial', '', 7);
                    }else{
                        if($detail->longt==9){
                            //$pdf->SetTextColor(0, 0, 0);
                            //$pdf->SetFont('Arial', '', 7);
                        }else{
                            if($detail->longt==6){
                                //$pdf->SetTextColor(0, 0, 0);
                                //$pdf->SetFont('Arial', '', 7);
                            }else{
                                if($detail->longt==4){
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', '', 7);
                                }else{
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }
                            }
                        }
                    }*/
    
                    /*$pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                    $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_ant[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_debe[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_haber[$index_plc_2],2,".",","), 0, 0, 'R', 0);*/
                    $suma_total_niv_ant+=$reverse_saldo_ant[$index_plc_2];
                    $suma_total_niv_debe+=$reverse_saldo_debe[$index_plc_2];
                    $suma_total_niv_haber+=$reverse_saldo_haber[$index_plc_2];
                    $suma_total_niv_act=$suma_total_niv_debe-$suma_total_niv_haber;
                    $total_saldo_act+=$suma_total_niv_debe-$suma_total_niv_haber;
                    //$pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);
                    if($detail->longt==2){
                        $ultimo_nivel_ingreso=$suma_total_niv_act;
                    }
                    //$pdf->Ln();
                    $suma_total_niv_ant=0;
                    $suma_total_niv_debe=0;
                    $suma_total_niv_haber=0;
                    $suma_total_niv_act=0;
                }
            }
            if($costo==$codigo[0]){
                if($reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                    /*$pdf->SetX(10);
                    if($detail->longt==12 || $detail->longt==11){
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Arial', '', 7);
                    }else{
                        if($detail->longt==9){
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 7);
                        }else{
                            if($detail->longt==6){
                                $pdf->SetTextColor(0, 0, 0);
                                $pdf->SetFont('Arial', '', 7);
                            }else{
                                if($detail->longt==4){
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', '', 7);
                                }else{
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }
                            }
                        }
                    }
    
                    $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                    $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_ant[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_debe[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_haber[$index_plc_2],2,".",","), 0, 0, 'R', 0);*/
                    $suma_total_niv_ant+=$reverse_saldo_ant[$index_plc_2];
                    $suma_total_niv_debe+=$reverse_saldo_debe[$index_plc_2];
                    $suma_total_niv_haber+=$reverse_saldo_haber[$index_plc_2];
                    $suma_total_niv_act=$suma_total_niv_debe-$suma_total_niv_haber;
                    $total_saldo_act+=$suma_total_niv_debe-$suma_total_niv_haber;
                    //$pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);
                    if($detail->longt==2){
                        $ultimo_nivel_costo=$suma_total_niv_act;
                    }
                    //$pdf->Ln();
                    $suma_total_niv_ant=0;
                    $suma_total_niv_debe=0;
                    $suma_total_niv_haber=0;
                    $suma_total_niv_act=0;
                }
            }
            if($gasto==$codigo[0]){
                if($reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                    /*$pdf->SetX(10);
                    if($detail->longt==12 || $detail->longt==11){
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Arial', '', 7);
                    }else{
                        if($detail->longt==9){
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 7);
                        }else{
                            if($detail->longt==6){
                                $pdf->SetTextColor(0, 0, 0);
                                $pdf->SetFont('Arial', '', 7);
                            }else{
                                if($detail->longt==4){
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', '', 7);
                                }else{
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }
                            }
                        }
                    }
    
                    $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                    $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_ant[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_debe[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_haber[$index_plc_2],2,".",","), 0, 0, 'R', 0);*/
                    $suma_total_niv_ant+=$reverse_saldo_ant[$index_plc_2];
                    $suma_total_niv_debe+=$reverse_saldo_debe[$index_plc_2];
                    $suma_total_niv_haber+=$reverse_saldo_haber[$index_plc_2];
                    $suma_total_niv_act=$suma_total_niv_debe-$suma_total_niv_haber;
                    $total_saldo_act+=$suma_total_niv_debe-$suma_total_niv_haber;
                    //$pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);
                    if($detail->longt==2){
                        $ultimo_nivel_gasto=$suma_total_niv_act;
                    }
                    //$pdf->Ln();
                    $suma_total_niv_ant=0;
                    $suma_total_niv_debe=0;
                    $suma_total_niv_haber=0;
                    $suma_total_niv_act=0;
                }
            }
        }
        $pdf->SetXY(10,$head_cabecera+5);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 8);
        $a="";
        $b="";
        $c="";
        $d="";
        $e="";
        $f="";
        if($ultimo_nivel_costo<0){
            $ultimo_nivel_costo=$ultimo_nivel_costo*-1;
            
        }
        if($ultimo_nivel_gasto<0){
            $ultimo_nivel_gasto=$ultimo_nivel_gasto*-1;
            $c="(";
            $d=")";
        }
        if($ultimo_nivel_ingreso<0){
            $ultimo_nivel_ingreso=$ultimo_nivel_ingreso*-1;
            $e="(";
            $f=")";
        }
        $suma_estado_resultado=$ultimo_nivel_costo+$ultimo_nivel_gasto-$ultimo_nivel_ingreso;
        if($suma_estado_resultado<0){
            $pdf->Cell(90, 6, 'UTILIDAD DEL EJERCICIO', 0, 0, 'C', 0);
            $pdf->Cell(100, 6, number_format($suma_estado_resultado*-1,2,".",","), 0, 0, 'R', 0);
        }else{
            if($suma_estado_resultado>0){
                $pdf->Cell(90, 6, 'PERDIDA DEL EJERCICIO', 0, 0, 'C', 0);
                $pdf->Cell(100, 6, number_format($suma_estado_resultado,2,".",","), 0, 0, 'R', 0);
            }else{
                if($suma_estado_resultado==0){
                    $pdf->Cell(90, 6, 'RESULTADO DEL EJERCICIO', 0, 0, 'C', 0);
                    $pdf->Cell(100, 6, number_format($suma_estado_resultado,2,".",","), 0, 0, 'R', 0);
                }
            }
        }
        $pdf->Ln(5);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 8);
        $valor_estdo_resultado=0;
        if($suma_estado_resultado<0){
            $valor_estdo_resultado=-1*$suma_estado_resultado;
        }else{
            if($suma_estado_resultado>0){
                $valor_estdo_resultado=-1*$suma_estado_resultado;
            }else{
                if($suma_estado_resultado==0){
                    $valor_estdo_resultado=$suma_estado_resultado;
                }
            }
        }
        $a="";
        $b="";
        $saldo_solo_patrimonio=0;
        if($positivo_patrimonio>0){
            $saldo_solo_patrimonio=$suma_solo_saldo_patrimonio*-1;
        }else{
            $saldo_solo_patrimonio=$suma_solo_saldo_patrimonio;
        }
        $saldo_solo_pasivo=0;
        if($positivo_pasivo>0){
            $saldo_solo_pasivo=$suma_solo_saldo_pasivo*-1;
        }else{
            $saldo_solo_pasivo=$suma_solo_saldo_pasivo;
        }
        $suma_pasv_patri=$saldo_solo_patrimonio+$saldo_solo_pasivo+$valor_estdo_resultado;
        if($suma_pasv_patri<0){
            $a="(";
            $b=")";
            $suma_pasv_patri=$suma_pasv_patri*-1;
        }
        $pdf->Cell(90, 6, 'TOTAL PASIVO Y PATRIMONIO', 0, 0, 'C', 0);
        
        $pdf->Cell(100, 6, $a.number_format($suma_pasv_patri,2,".",",").$b, 0, 0, 'R', 0);
        $head_total_pasivo_y_patrimonio=$pdf->GetY();
        //dd($head_total_pasivo_y_patrimonio."cantidad");
        $pdf->Ln(23);
        if($head_total_pasivo_y_patrimonio>($pdf->GetPageHeight()-30)){
            $otro_valor=$pdf->GetPageHeight()-$head_total_pasivo_y_patrimonio;
            $pdf->SetAutoPageBreak(true,$otro_valor);
        }else{
            $pdf->SetAutoPageBreak(false);
        }
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 8);
        $head_cont_x=$pdf->GetX();
        $head_cont_y=$pdf->GetY();
        $pdf->Cell(30, 6, '', 0, 0, 'C', 0);
        $pdf->Cell(50, 6, 'CONTADOR', 'T', 0, 'C', 0);
        $pdf->Cell(30, 6, '', 0, 0, 'C', 0);
        $pdf->Cell(50, 6, 'GERENTE GENERAL', 'T', 1, 'C', 0);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(30, 6, '', 0, 0, 'C', 0);
        $pdf->Cell(50, 6, utf8_decode($empresa[0]->nombre_contador), 0, 0, 'C', 0);
        $pdf->Cell(30, 6, '', 0, 0, 'C', 0);
        $pdf->Cell(50, 6, utf8_decode($empresa[0]->nomb_representante), 0, 0, 'C', 0);
        $pdf->Ln();  
        //dd($head_cont_x);
        
            
        if($ruta==null){
            $pdf->Output("estado_situacion_financiera.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."estado_situacion_financiera.pdf", "F");
        }
        
    }

    public function estado_resultado_integral($fec_ini,$fec_fin,$empresa,$ingresos,$plan_cuentas,$ingresos_prueba,$proyecto,$debe_haber,$activo,$pasivo,$patrimonio,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        //$pdf->SetAutoPageBreak(true,2);
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA") . $empresa[0]->id_empresa . '/imagen/' . $empresa[0]->logo;
        if (strlen($empresa[0]->logo)>0 && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            if($empresa[0]->id_empresa!==48){
                $pdf->Image($logo, 12, 11, 45, 18);
            }else{
                $pdf->Image($logo, 12, 10, 40, 17);
            }
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        if($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa))>115){
            $pdf->SetXY(55, 10);
            $pdf->MultiCell(115, 5, utf8_decode($empresa[0]->nombre_empresa), 0,'C', 0);
            $head_empresa=$pdf->GetY();
        }else{
            $pdf->Cell(155, 10, utf8_decode($empresa[0]->nombre_empresa), 0, 1, 'C', 0);
        }
        if($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa))>115){
            $pdf->SetXY(35, $head_empresa-1);
        }else{
            $pdf->SetXY(35, 17);
        }
        //$pdf->Cell(155, 10, utf8_decode($empresa[0]->nombre_empresa), 0, 1, 'C', 0);
        //$pdf->SetXY(35, 17);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Estado Resultado Integral'), 0, 2, 'C', 0);
        $pdf->SetXY(35, 23);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, 'Proyecto: '.ucfirst($proyecto), 0, 1, 'C', 0);
        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        
        $array_debe=[];
        $array_haber=[];
        $array_saldo_ant=[];
        $id_cuenta="";
        $suma_debe=0;
        $suma_haber=0;
        $suma_saldo_anterior=0;
        foreach(array_reverse($plan_cuentas) as $detail){
            $id_cuenta=$detail->id_plan_cuentas;
            foreach(array_reverse($debe_haber) as $detail){
                if($detail->id_plan_cuentas==$id_cuenta){
                    $suma_debe=$detail->debe;
                    $suma_haber=$detail->haber;
                }
            }
            foreach(array_reverse($ingresos_prueba) as $detail){
                if($detail->id_plan_cuentas==$id_cuenta){
                    $suma_saldo_anterior=$detail->saldo_ant;
                }   
            }
            array_push($array_debe,$suma_debe);
            array_push($array_haber,$suma_haber);
            array_push($array_saldo_ant,$suma_saldo_anterior);
            $suma_debe=0;
            $suma_haber=0;
            $suma_saldo_anterior=0;
        }
        $id_planes=-1;
        $saldo_ant_array=[];
        $saldo_debe_array=[];
        $saldo_haber_array=[];
        $saldo_anterior=0;
        $saldo_anterior=0;
        $saldo_anterior_2=0;
        $saldo_anterior_3=0;
        $saldo_anterior_4=0;
        $suma_saldo_ant_total=0;
        $suma_total_ant=0;
        $suma_debe=0;
        $suma_debe_2=0;
        $suma_debe_3=0;
        $suma_debe_4=0;
        $suma_haber=0;
        $suma_haber_2=0;
        $suma_haber_3=0;
        $suma_haber_4=0;
        $suma_saldo_act=0;
        $suma_saldo_act_2=0;
        $suma_saldo_act_3=0;
        $suma_saldo_act_4=0;
        $index_ant=-1;
        foreach(array_reverse($plan_cuentas) as $detail){
            //$id=$detail->id_plan_cuentas;
            $cuenta=0;
            $meses="";
            $id_planes++; 
            
            $pdf->SetXY(10,30);
            /*$pdf->SetTextColor(0, 0, 0);
            $pdf->SetFont('Arial', '', 7);
            $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
            $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);*/
            //array_push($otro_array_1,$suma_debito[$prueba[intval($id_planes)]]);
            //array_push($otro_array_2,$suma_credito[$prueba[intval($id_planes)]]);
            if($detail->saldo!==null){
                $index_ant++;
                
                //if(isset($array_saldo_ant[$index_ant])){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);
                    $pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);*/
                    // if(count($array_saldo_ant[$index_ant])<=0){
                    //     $var_1=count($array_saldo_ant[$index_ant]);
                    // }else{
                    //     $var_1=count($array_saldo_ant[$index_ant])-1;
                    // }
                    
                    //$pdf->Cell(15, 3, number_format($array_saldo_ant[$index_ant][$var_1],2,".",","), 0, 0, 'R', 0);
                   
                    //array_push($saldo_ant_array,array_sum($array_saldo_ant[$index_ant]));
                    array_push($saldo_ant_array,$array_saldo_ant[$id_planes]);
                    $saldo_anterior+=$array_saldo_ant[$id_planes];
        
                //}
                //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
                //$saldo_anterior+=0;
            }else{
                if($detail->longt>10){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);
                    $pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);*/
                    array_push($saldo_ant_array,0);
                }
            }
            if($detail->longt==9){
                $saldo_anterior_2+=$saldo_anterior;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, $saldo_anterior, 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior);
                $saldo_anterior=0;
            }
            
            if($detail->longt==6){
                $saldo_anterior_3+=$saldo_anterior_2;
                /*$pdf->SetTextColor(0, 0, 100);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($saldo_anterior_2,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior_2);
                $saldo_anterior_2=0;
            }
            if($detail->longt==4){
                $saldo_anterior_4+=$saldo_anterior_3;
                /*$pdf->SetTextColor(0, 100, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($saldo_anterior_3,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior_3);
                $saldo_anterior_3=0;
            }
            if($detail->longt==2){
                /*$pdf->SetTextColor(100, 50, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($saldo_anterior_4,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_ant_array,$saldo_anterior_4);
                $saldo_anterior_4=0;
            }
            if($detail->saldo!==null){
                //$index_ant++;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', '', 7);*/
                //if(count($array_debe[$index_ant])>0){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);*/
                    //$var_2=count($array_debe[$index_ant])-1;
                    //$pdf->Cell(15, 3, number_format($array_debe[$index_ant][$var_2],2,".",","), 0, 0, 'R', 0);
                    array_push($saldo_debe_array,$array_debe[$id_planes]);
                    $suma_debe+=$array_debe[$id_planes];
                //}
                //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
                //$saldo_anterior+=0;
            }else{
                if($detail->longt>10){
                    /*$pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', '', 7);
                    $pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);*/
                    array_push($saldo_debe_array,0);
                }
            }
            if($detail->longt==9){
                $suma_debe_2+=$suma_debe;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, $suma_debe, 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe);
                $suma_debe=0;
            }
            
            if($detail->longt==6){
                $suma_debe_3+=$suma_debe_2;
                /*$pdf->SetTextColor(0, 0, 100);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_debe_2,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe_2);
                $suma_debe_2=0;
            }
            if($detail->longt==4){
                $suma_debe_4+=$suma_debe_3;
                /*$pdf->SetTextColor(0, 100, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_debe_3,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe_3);
                $suma_debe_3=0;
            }
            if($detail->longt==2){
                /*$pdf->SetTextColor(100, 50, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_debe_4,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_debe_array,$suma_debe_4);
                $suma_debe_4=0;
            }
            if($detail->saldo!==null){
                //$index_ant++;
                // if(count($array_haber[$index_ant])>0){
                //     $var_3=count($array_haber[$index_ant])-1;
                    //$pdf->Cell(15, 3, number_format($array_haber[$index_ant][$var_3],2,".",","), 0, 0, 'R', 0);
                    array_push($saldo_haber_array,$array_haber[$id_planes]);
                    $suma_haber+=$array_haber[$id_planes];
                //}
                //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
                //$saldo_anterior+=0;
            }else{
                if($detail->longt>10){
                    array_push($saldo_haber_array,0);
                }
            }
            if($detail->longt==9){
                $suma_haber_2+=$suma_haber;
                /*$pdf->SetTextColor(0, 0, 0);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, $suma_haber, 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber);
                $suma_haber=0;
            }
            
            if($detail->longt==6){
                $suma_haber_3+=$suma_haber_2;
                /*$pdf->SetTextColor(0, 0, 100);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_haber_2,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber_2);
                $suma_haber_2=0;
            }
            if($detail->longt==4){
                $suma_haber_4+=$suma_haber_3;
                /*$pdf->SetTextColor(0, 100, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_haber_3,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber_3);
                $suma_haber_3=0;
            }
            if($detail->longt==2){
                /*$pdf->SetTextColor(100, 50, 50);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(15, 3, number_format($suma_haber_4,2,".",","), 0, 0, 'R', 0);*/
                array_push($saldo_haber_array,$suma_haber_4);
                $suma_haber_4=0;
            }
            // if($detail->saldo!==null){
            //     //$index_ant++;
                
            //         //$var_3=count($max_haber[$index_ant])-1;
            //         //$pdf->Cell(15, 3, number_format($detail->saldo,2,".",","), 0, 0, 'R', 0);
            //         array_push($saldo_act_array,$detail->saldo);
            //         $suma_saldo_act+=$detail->saldo;
               
            //     //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
            //     //$saldo_anterior+=0;
            //     }else{
            //         if($detail->longt==12 || $detail->longt==11){
            //             //$pdf->Cell(15, 3, '0,00', 0, 0, 'R', 0);
            //             array_push($saldo_act_array,0);
            //         }
            // }
            // if($detail->longt==9){
            //     $suma_saldo_act_2+=$suma_saldo_act;
            //     /*$pdf->SetTextColor(0, 0, 0);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, $suma_saldo_act, 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act);
            //     $suma_saldo_act=0;
            // }
            
            // if($detail->longt==6){
            //     $suma_saldo_act_3+=$suma_saldo_act_2;
            //     /*$pdf->SetTextColor(0, 0, 100);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, number_format($suma_saldo_act_2,2,".",","), 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act_2);
            //     $suma_saldo_act_2=0;
            // }
            // if($detail->longt==4){
            //     $suma_saldo_act_4+=$suma_saldo_act_3;
            //     /*$pdf->SetTextColor(0, 100, 50);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, number_format($suma_saldo_act_3,2,".",","), 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act_3);
            //     $suma_saldo_act_3=0;
            // }
            // if($detail->longt==2){
            //     /*$pdf->SetTextColor(100, 50, 50);
            //     $pdf->SetFont('Arial', 'B', 7);
            //     $pdf->Cell(15, 3, number_format($suma_saldo_act_4,2,".",","), 0, 0, 'R', 0);*/
            //     array_push($saldo_act_array,$suma_saldo_act_4);
            //     $suma_saldo_act_4=0;
            // }
            // array_push($array_index,$index_ant);
            // $index_ant=-1;
            $pdf->Ln();
            
            $head=$pdf->GetY();
        }
        $reverse_saldo_ant=array_reverse($saldo_ant_array);
        $reverse_saldo_debe=array_reverse($saldo_debe_array);
        $reverse_saldo_haber=array_reverse($saldo_haber_array);
        //dd($reverse_saldo_debe);
        //ACTIVOS
        $index_plc_2=-1;
        $existe_activos=0;
        $head_cabecera=35;
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($activo==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                if($reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                    $existe_activos++;
                }
                
            }
            
        }
        if($existe_activos>0){
            $pdf->SetXY(45,$head_cabecera);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'INGRESOS', 0, 0, 'C', 0);
            $pdf->Ln();
        }
        $index_plc_2=-1;
        $suma_total_niv_ant=0;
        $suma_total_niv_debe=0;
        $suma_total_niv_haber=0;
        $suma_total_niv_act=0;
        $total_saldo_act=0;
        $suma_solo_saldo_ant=0;
        $suma_solo_debe=0;
        $suma_solo_haber=0;
        $array_saldo_anterior=[];
        $array_saldo_tot_anterior=[];
        $n1="";
        $n2="";
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($activo==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                //if($reverse_saldo_ant[$index_plc_2]!='0' || $reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                //if($reverse_saldo_ant[$index_plc_2]+$reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                if($reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                    $pdf->SetX(10);
                    if($detail->longt>10){
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Arial', '', 7);
                    }else{
                        if($detail->longt==9){
                            $pdf->SetTextColor(100,100,100);
                            $pdf->SetFont('Arial', 'B', 7);
                        }else{
                            if($detail->longt==6){
                                $pdf->SetTextColor(70,70,70 );
                                $pdf->SetFont('Arial', 'B', 7);
                            }else{
                                if($detail->longt==4){
                                    $pdf->SetTextColor(30,30,30);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }else{
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }
                            }
                        }
                    }
                    $suma_total_niv_ant+=$reverse_saldo_ant[$index_plc_2];
                    $suma_total_niv_debe+=$reverse_saldo_debe[$index_plc_2];
                    $suma_total_niv_haber+=$reverse_saldo_haber[$index_plc_2];
                    $suma_total_niv_act=$suma_total_niv_debe-$suma_total_niv_haber;
                    $total_saldo_act+=$suma_total_niv_debe-$suma_total_niv_haber;
                    if($suma_total_niv_act!==0){
                        //array_push($array_saldo_anterior,$suma_total_niv_act);
                        //$pdf->Ln();
                        $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                            $pdf->Cell(65, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                            if($detail->longt>10){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==9){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==6){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==4){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;  
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==2){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $ultimo_nivel=$suma_total_niv_act;
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            if($detail->longt>10){
                                $suma_solo_saldo_ant+=$reverse_saldo_ant[$index_plc_2];
                                $suma_solo_debe+=$reverse_saldo_debe[$index_plc_2];
                                $suma_solo_haber+=$reverse_saldo_haber[$index_plc_2];
                            }
                            $suma_total_niv_ant=0;
                            $suma_total_niv_debe=0;
                            $suma_total_niv_haber=0;
                            $suma_total_niv_act=0;
                            //$pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);
                            //array_push($array_total_saldo_actual,$suma_total_niv_act);
                            $pdf->Ln();
                        }
                    
    
                        $head_2=$pdf->GetY();
                    /*$pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                    $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                    /*$pdf->Cell(15, 3, number_format($reverse_saldo_ant[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_debe[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_haber[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);*/
                    
                }
                //array_push($array_saldo_tot_anterior,$array_saldo_anterior);
                //$array_saldo_anterior=[];
                
                $head_2=$pdf->GetY();
            }
            
        }
        //dd($array_saldo_anterior);
        $suma_solo_saldo_act=0;
        $head_totales_ingresos=0;
        if($existe_activos>0){
            $pdf->SetXY(10,$head_2);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'TOTAL INGRESOS', 0, 0, 'C', 0);
            //$pdf->Cell(105, 6, '', 0, 0, 'C', 0);
            //$pdf->Cell(15, 6, 'S.Anterior', 0, 0, 'R', 0);
            //$pdf->Cell(25, 6, 'Fecha Vencimiento', 'T', 0, 'C', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_ant),2,".",","), 'T', 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format($suma_solo_saldo_act,2,".",","), 'T', 0, 'R', 0);
           // $pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_debe),2,".",","), 'T', 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_haber),2,".",","), 'T', 0, 'R', 0);
            $a="";
            $b="";
            $suma_solo_saldo_act=$suma_solo_debe-$suma_solo_haber;
            if($suma_solo_saldo_act<0){
                $suma_solo_saldo_act=$suma_solo_saldo_act*-1;
                $a="(";
                $b=")";
            }
            $pdf->Cell(15, 6, $a.number_format($suma_solo_saldo_act,2,".",",").$b, 0, 0, 'R', 0);
            $head_totales_ingresos=$pdf->GetY();
            $pdf->Ln(10);
            $head_cabecera=$pdf->GetY();
        }
        // if($head_totales_ingresos>190){
        //     $otro_valor=$pdf->GetPageHeight()-$head_totales_ingresos+5;
        //     $pdf->SetAutoPageBreak(true,$otro_valor);
        // }else{
        //     $pdf->SetAutoPageBreak(false);
        // }
        //PASIVOS
        $index_plc_2=-1;
        $existe_pasivos=0;
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($pasivo==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                if($reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                    $existe_pasivos++;
                }
            }
        }
        if($existe_pasivos>0){
            $pdf->SetXY(45,$head_cabecera);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'EGRESO COSTO', 0, 0, 'C', 0);
            $pdf->Ln();
        }
        $index_plc_2=-1;
        $suma_total_niv_ant=0;
        $suma_total_niv_debe=0;
        $suma_total_niv_haber=0;
        $suma_total_niv_act=0;
        $total_saldo_act=0;
        $suma_solo_saldo_ant=0;
        $suma_solo_debe=0;
        $suma_solo_haber=0;
        $array_saldo_anterior=[];
        $array_saldo_tot_anterior=[];
        $n1="";
        $n2="";
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($pasivo==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                //if($reverse_saldo_ant[$index_plc_2]!='0' || $reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                //if($reverse_saldo_ant[$index_plc_2]+$reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                if($reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                    $pdf->SetX(10);
                    if($detail->longt>10){
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Arial', '', 7);
                    }else{
                        if($detail->longt==9){
                            $pdf->SetTextColor(100,100,100);
                            $pdf->SetFont('Arial', 'B', 7);
                        }else{
                            if($detail->longt==6){
                                $pdf->SetTextColor(70,70,70 );
                                $pdf->SetFont('Arial', 'B', 7);
                            }else{
                                if($detail->longt==4){
                                    $pdf->SetTextColor(30,30,30);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }else{
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }
                            }
                        }
                    }
                    $suma_total_niv_ant+=$reverse_saldo_ant[$index_plc_2];
                    $suma_total_niv_debe+=$reverse_saldo_debe[$index_plc_2];
                    $suma_total_niv_haber+=$reverse_saldo_haber[$index_plc_2];
                    $suma_total_niv_act=$suma_total_niv_debe-$suma_total_niv_haber;
                    $total_saldo_act+=$suma_total_niv_debe-$suma_total_niv_haber;
                    if($suma_total_niv_act!==0){
                        //array_push($array_saldo_anterior,$suma_total_niv_act);
                        //$pdf->Ln();
                        $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                            $pdf->Cell(65, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                            if($detail->longt>10){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==9){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==6){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==4){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;  
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==2){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $ultimo_nivel=$suma_total_niv_act;
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            if($detail->longt>10){
                                $suma_solo_saldo_ant+=$reverse_saldo_ant[$index_plc_2];
                                $suma_solo_debe+=$reverse_saldo_debe[$index_plc_2];
                                $suma_solo_haber+=$reverse_saldo_haber[$index_plc_2];
                            }
                            $suma_total_niv_ant=0;
                            $suma_total_niv_debe=0;
                            $suma_total_niv_haber=0;
                            $suma_total_niv_act=0;
                            //$pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);
                            //array_push($array_total_saldo_actual,$suma_total_niv_act);
                            $pdf->Ln();
                        }
                    
    
                        $head_3=$pdf->GetY();
                    /*$pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                    $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                    /*$pdf->Cell(15, 3, number_format($reverse_saldo_ant[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_debe[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_haber[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);*/
                    
                }
                //array_push($array_saldo_tot_anterior,$array_saldo_anterior);
                //$array_saldo_anterior=[];
                
                $head_3=$pdf->GetY();
            }
            
        }
        $suma_solo_saldo_pasivo=0;
        $head_total_egreso_costo=0;
        if($existe_pasivos>0){
            $pdf->SetXY(10,$head_3);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'TOTAL EGRESO COSTOS', 0, 0, 'C', 0);
            //$pdf->Cell(105, 6, '', 0, 0, 'C', 0);
            //$pdf->Cell(15, 6, 'S.Anterior', 0, 0, 'R', 0);
            //$pdf->Cell(25, 6, 'Fecha Vencimiento', 'T', 0, 'C', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_ant),2,".",","), 'T', 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format($suma_solo_saldo_act,2,".",","), 'T', 0, 'R', 0);
           // $pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_debe),2,".",","), 'T', 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_haber),2,".",","), 'T', 0, 'R', 0);
            $a="";
            $b="";
            $suma_solo_saldo_pasivo=$suma_solo_debe-$suma_solo_haber;
            if($suma_solo_saldo_pasivo<0){
                $suma_solo_saldo_pasivo=$suma_solo_saldo_pasivo*-1;
                $a="(";
                $b=")";
            }
            $pdf->Cell(15, 6, $a.number_format($suma_solo_saldo_pasivo,2,".",",").$b, 0, 0, 'R', 0);
            $head_total_egreso_costo=$pdf->GetY();
            $pdf->Ln(10);
            $head_cabecera=$pdf->GetY();
        }
        // if($head_total_egreso_costo>180){
        //     $otro_valor=$pdf->GetPageHeight()-$head_total_egreso_costo+5;
        //     $pdf->SetAutoPageBreak(true,$otro_valor);
        // }else{
        //     $pdf->SetAutoPageBreak(false);
        // }
        //PATRIMONIO
        $index_plc_2=-1;
        $existe_patrimonio=0;
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($patrimonio==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                if($reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                    $existe_patrimonio++;
                }
            }
        }
        if($existe_patrimonio>0){
            $pdf->SetXY(45,$head_cabecera);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'EGRESO GASTOS OPERACION', 0, 0, 'C', 0);
            $pdf->Ln();
        }
        $index_plc_2=-1;
        $suma_total_niv_ant=0;
        $suma_total_niv_debe=0;
        $suma_total_niv_haber=0;
        $suma_total_niv_act=0;
        $total_saldo_act=0;
        $suma_solo_saldo_ant=0;
        $suma_solo_debe=0;
        $suma_solo_haber=0;
        $array_saldo_anterior=[];
        $array_saldo_tot_anterior=[];
        $n1="";
        $n2="";
        foreach($plan_cuentas as $detail){
            $index_plc_2++;
            $codigo=str_split($detail->codcta,2);
            if($patrimonio==$codigo[0]){
                //array_push($array_saldo_anterior,$activo);
                //if($reverse_saldo_ant[$index_plc_2]!='0' || $reverse_saldo_debe[$index_plc_2]!='0' || $reverse_saldo_haber[$index_plc_2]!='0'){
                //if($reverse_saldo_ant[$index_plc_2]+$reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                if($reverse_saldo_debe[$index_plc_2]-$reverse_saldo_haber[$index_plc_2]!='0'){
                    $pdf->SetX(10);
                    if($detail->longt>10){
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Arial', '', 7);
                    }else{
                        if($detail->longt==9){
                            $pdf->SetTextColor(100,100,100);
                            $pdf->SetFont('Arial', 'B', 7);
                        }else{
                            if($detail->longt==6){
                                $pdf->SetTextColor(70,70,70 );
                                $pdf->SetFont('Arial', 'B', 7);
                            }else{
                                if($detail->longt==4){
                                    $pdf->SetTextColor(30,30,30);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }else{
                                    $pdf->SetTextColor(0, 0, 0);
                                    $pdf->SetFont('Arial', 'B', 7);
                                }
                            }
                        }
                    }
                    $suma_total_niv_ant+=$reverse_saldo_ant[$index_plc_2];
                    $suma_total_niv_debe+=$reverse_saldo_debe[$index_plc_2];
                    $suma_total_niv_haber+=$reverse_saldo_haber[$index_plc_2];
                    $suma_total_niv_act=$suma_total_niv_debe-$suma_total_niv_haber;
                    $total_saldo_act+=$suma_total_niv_debe-$suma_total_niv_haber;
                    if($suma_total_niv_act!==0){
                        //array_push($array_saldo_anterior,$suma_total_niv_act);
                        //$pdf->Ln();
                        $pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                            $pdf->Cell(65, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                            if($detail->longt>10){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==9){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==6){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2="";
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==4){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0; 
                                $n1="";
                                $n2=""; 
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            if($detail->longt==2){
                                if($suma_total_niv_act<0){
                                    $suma_total_niv_act=$suma_total_niv_act*-1;
                                    $n1="(";
                                    $n2=")";
                                }
                                $ultimo_nivel=$suma_total_niv_act;
                                $pdf->Cell(20, 3, $n1.number_format($suma_total_niv_act,2,".",",").$n2, 0, 0, 'R', 0);
                                $suma_total_niv_ant=0;
                                $suma_total_niv_debe=0;
                                $suma_total_niv_haber=0;
                                $suma_total_niv_act=0;
                                $n1="";
                                $n2=""; 
                            }else{
                                $pdf->Cell(20, 3, '', 0, 0, 'R', 0);
                            }
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            $pdf->Cell(15, 3, "", 0, 0, 'R', 0);
                            if($detail->longt>10){
                                $suma_solo_saldo_ant+=$reverse_saldo_ant[$index_plc_2];
                                $suma_solo_debe+=$reverse_saldo_debe[$index_plc_2];
                                $suma_solo_haber+=$reverse_saldo_haber[$index_plc_2];
                            }
                            $suma_total_niv_ant=0;
                            $suma_total_niv_debe=0;
                            $suma_total_niv_haber=0;
                            $suma_total_niv_act=0;
                            //$pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);
                            //array_push($array_total_saldo_actual,$suma_total_niv_act);
                            $pdf->Ln();
                        }
                    
    
                        $head_3=$pdf->GetY();
                    /*$pdf->Cell(25, 3, $detail->codcta, 0, 0, 'L', 0);
                    $pdf->Cell(105, 3, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                    /*$pdf->Cell(15, 3, number_format($reverse_saldo_ant[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_debe[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($reverse_saldo_haber[$index_plc_2],2,".",","), 0, 0, 'R', 0);
                    $pdf->Cell(15, 3, number_format($suma_total_niv_act,2,".",","), 0, 0, 'R', 0);*/
                    
                }
                //array_push($array_saldo_tot_anterior,$array_saldo_anterior);
                //$array_saldo_anterior=[];
                
                $head_3=$pdf->GetY();
            }
            
        }
        $suma_solo_saldo_patrimonio=0;
        if($existe_patrimonio>0){
            $pdf->SetXY(10,$head_3);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(130, 6, 'TOTAL EGRESO GASTOS OPERACION', 0, 0, 'C', 0);
            //$pdf->Cell(105, 6, '', 0, 0, 'C', 0);
            //$pdf->Cell(15, 6, 'S.Anterior', 0, 0, 'R', 0);
            //$pdf->Cell(25, 6, 'Fecha Vencimiento', 'T', 0, 'C', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_ant),2,".",","), 'T', 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            $pdf->Cell(15, 6, "", 0, 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format($suma_solo_saldo_act,2,".",","), 'T', 0, 'R', 0);
           // $pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_debe),2,".",","), 'T', 0, 'R', 0);
            //$pdf->Cell(15, 6, number_format(array_sum($reverse_saldo_haber),2,".",","), 'T', 0, 'R', 0);
            $a="";
            $b="";
            $suma_solo_saldo_patrimonio=$suma_solo_debe-$suma_solo_haber;
            if($suma_solo_saldo_patrimonio<0){
                $suma_solo_saldo_patrimonio=$suma_solo_saldo_patrimonio*-1;
                $a="(";
                $b=")";
            }
            $pdf->Cell(15, 6, $a.number_format($suma_solo_saldo_patrimonio,2,".",",").$b, 0, 0, 'R', 0);
            $pdf->Ln(10);
            $head_cabecera=$pdf->GetY();
        }
        
        $pdf->Ln(10);
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 8);
        $suma_pasv_patri=$suma_solo_saldo_patrimonio+$suma_solo_saldo_pasivo-$suma_solo_saldo_act;
        if($suma_pasv_patri<0){
            $pdf->Cell(90, 6, 'UTILIDAD DEL EJERCICIO', 0, 0, 'C', 0);
            $pdf->Cell(100, 6, number_format(-1*$suma_pasv_patri,2,".",","), 0, 0, 'R', 0);
        }else{
            if($suma_pasv_patri>0){
                $pdf->Cell(90, 6, 'PERDIDA DEL EJERCICIO', 0, 0, 'C', 0);
                $pdf->Cell(100, 6, number_format($suma_pasv_patri,2,".",","), 0, 0, 'R', 0);
            }else{
                if($suma_pasv_patri==0){
                    $pdf->Cell(90, 6, 'RESULTADO DEL EJERCICIO', 0, 0, 'C', 0);
                    $pdf->Cell(100, 6, number_format($suma_pasv_patri,2,".",","), 0, 0, 'R', 0);
                }
            }
        }
        $head_total_pasivo_y_patrimonio=$pdf->GetY();
        $pdf->Ln(23);
        // if($head_total_pasivo_y_patrimonio>($pdf->GetPageHeight()-32)){
        //     $otro_valor=$pdf->GetPageHeight()-$head_total_pasivo_y_patrimonio;
        //     $pdf->SetAutoPageBreak(true,$otro_valor);
        // }else{
        //     $pdf->SetAutoPageBreak(false);
        // }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 8);
        $head_cont_x=$pdf->GetX();
        $head_cont_y=$pdf->GetY();
        $pdf->Cell(30, 6, '', 0, 0, 'C', 0);
        $pdf->Cell(50, 6, 'CONTADOR', 'T', 0, 'C', 0);
        $pdf->Cell(30, 6, '', 0, 0, 'C', 0);
        $pdf->Cell(50, 6, 'GERENTE GENERAL', 'T', 1, 'C', 0);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(30, 6, '', 0, 0, 'C', 0);
        $pdf->Cell(50, 6, utf8_decode($empresa[0]->nombre_contador), 0, 0, 'C', 0);
        $pdf->Cell(30, 6, '', 0, 0, 'C', 0);
        $pdf->Cell(50, 6, utf8_decode($empresa[0]->nomb_representante), 0, 0, 'C', 0);
        $pdf->Ln();
        if($ruta==null){
            $pdf->Output("estado_resultado_integral.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."estado_resultado_integral.pdf", "F");
        }
    }      
    public function cuenta_pagar_reporte($datos, $fec_ini, $fec_fin,$vencido)
    {
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA") . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if (strlen($datos[0]->logo)>0 && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(75, 10);
        $pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de Cuentas por Pagar'), 0, 2, 'C', 0);

        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        
        
        $pdf->SetXY(60,40);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 6);
        $pdf->Cell(6, 6, 'No.', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'FECHA', 1, 0, 'C', 1);
        $pdf->Cell(25, 6, 'RUC', 1, 0, 'C', 1);
        $pdf->Cell(45, 6, 'PROVEEDOR', 1, 0, 'C', 1);
        //$pdf->Cell(12, 6, 'TIPO', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'No CUOTA', 1, 0, 'C', 1);
        $pdf->Cell(16, 6, 'VALOR CUOTA', 1, 0, 'C', 1);
        
            $pdf->Cell(18, 6, 'VALOR PAGADO', 1, 0, 'C', 1);
            $pdf->Cell(25, 6, 'PAGADO POR', 1, 0, 'C', 1);
            $pdf->Cell(23, 6, 'FORMA PAGO', 1, 0, 'C', 1);
        
        
        /*$pdf->Cell(15, 6, 'BASE 12%', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'DESCTO.', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'I.V.A. 12%', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'IVA Ret', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'I.R.F.', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'BASEIMPEXE', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'BASENOGRAVAIVA', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'OTROS', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'TOTAL', 1, 0, 'C', 1);*/
        $pdf->ln();

        $total = 0;
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        
        $datos_filtrado = [];
        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->clave_acceso, $datos_filtrado)) {
                $datos_filtrado[$datos[$key]->clave_acceso] = $datos[$key];
            }
        }
        
        $pago_vencido=0;
        $contador = 1;
        $tbasec = 0;
        $tbased = 0;
        $tivad = 0;
        $tdesc = 0;
        $tivaret = 0;
        $tirf = 0;
        $total = 0;
        $suma_cuota=0;
        $suma_pagado=0;
        foreach($datos as $detail){
            $fecha_pago=date("d/m/Y", strtotime($detail->fecha_pago));
            if($fecha_actual>=$fecha_pago){
                $pago_vencido+=$detail->valor_cuota;
            }
            $total += $detail->valor_cuota;
            $tirf += $detail->valor_pago;
        }
        
        foreach ($datos as $detail) {
            $pdf->SetX(60);
            $fecha_pago=date("d/m/Y", strtotime($detail->fecha_pago));
            $pdf->Cell(6, 6, $contador, 1, 0, 'C', 1);
            $pdf->Cell(15, 6, $fecha_pago, 1, 0, 'C', 1);
            $pdf->Cell(25, 6, $detail->identif_proveedor, 1, 0, 'C', 1);
            $pdf->Cell(45, 6, $detail->nombre_proveedor, 1, 0, 'L', 1);
            //$pdf->Cell(12, 6, 'Factura', 1, 0, 'C', 1);
            $pdf->Cell(15, 6, $detail->num_cuota, 1, 0, 'C', 1);
            $pdf->Cell(16, 6, $detail->valor_cuota, 1, 0, 'C', 1);
            
                $pdf->Cell(18, 6, $detail->valor_pago, 1, 0, 'C', 1);
                if($detail->valor_pago!=0){
                    $pdf->Cell(25, 6,utf8_decode($detail->pagos_por), 1, 0, 'C', 1);
                }else{
                    $pdf->Cell(25, 6, '', 1, 0, 'C', 1);
                }
                
                
                if($detail->valor_pago!=0){
                    $pdf->Cell(23, 6, utf8_decode($detail->descripcion), 1, 0, 'C', 1);
                }else{
                    $pdf->Cell(23, 6, '', 1, 0, 'C', 1);
                }
                
            
            
            /*$pdf->Cell(15, 6, $detail->subtotal_12, 1, 0, 'C', 1);
            $pdf->Cell(15, 6, $detail->descuento, 1, 0, 'C', 1);
            $pdf->Cell(15, 6, $detail->iva_12, 1, 0, 'C', 1);
            if ($detail->cantidadiva != 0 && $detail->cantidadrenta != 0) {
                $cantiva = $detail->cantidadiva;
                $cantrent = $detail->cantidadrenta;
                $pdf->Cell(15, 6, $cantiva, 1, 0, 'C', 1);
                $pdf->Cell(15, 6, $cantrent, 1, 0, 'C', 1);
            } else {
                $cantiva = 0.00;
                $cantrent = 0.00;
                $pdf->Cell(15, 6, $cantiva, 1, 0, 'C', 1);
                $pdf->Cell(15, 6, $cantrent, 1, 0, 'C', 1);
            }
            $pdf->Cell(20, 6, '0.00', 1, 0, 'C', 1);
            $pdf->Cell(20, 6, '0.00', 1, 0, 'C', 1);
            $pdf->Cell(15, 6, '0.00', 1, 0, 'C', 1);
            $pdf->Cell(15, 6, $detail->total_factura, 1, 0, 'C', 1);
            $pdf->Ln();
            $tbasec = $tbasec + $detail->subtotal_0;
            $tbased = $tbased + $detail->subtotal_12;
            $tdesc = $tdesc + $detail->descuento;
            $tivad = $tivad + $detail->iva_12;
            $tivaret = $tivaret + $detail->cantidadiva;
            $tirf = $tirf + $detail->cantidadrenta;
            $total = $total + $detail->total_factura;*/
            $pdf->Ln();
            $contador++;

            
        }
        $total_vecido=0;
        $total_vecido=$vencido[0]->suma-$tirf;
        $suma_cuota=number_format($total,2,".",",");
        $suma_pagado=number_format($tirf,2,".",",");
        $suma_vencido=number_format($total_vecido,2,".",",");
        //footer table
        $pdf->SetX(60);
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(106, 6, 'TOTAL:', 1, 0, 'R', 1);
        /*$pdf->Cell(15, 6, $tbasec, 1, 0, 'C', 1);
        $pdf->Cell(15, 6, $tbased, 1, 0, 'C', 1);
        $pdf->Cell(15, 6, $tdesc, 1, 0, 'C', 1);
        $pdf->Cell(15, 6, $tivad, 1, 0, 'C', 1);
        $pdf->Cell(15, 6, $tivaret, 1, 0, 'C', 1);
        $pdf->Cell(15, 6, $tirf, 1, 0, 'C', 1);
        $pdf->Cell(20, 6, '0.00', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, '0.00', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, '0.00', 1, 0, 'C', 1);*/
        $pdf->Cell(16, 6, $suma_cuota, 1, 0, 'C', 1);
        
            $pdf->Cell(18, 6, $suma_pagado, 1, 0, 'C', 1);
        
        
        if($suma_vencido!==0 && $total>$suma_pagado){
            $pdf->Cell(25, 6, 'TOTAL VENCIDO:', 1, 0, 'C', 1);
        }else{
            $pdf->Cell(25, 6, '', 1, 0, 'C', 1);
        }
        if($suma_vencido!==0 && $total>$suma_pagado){
            $pdf->SetTextColor(220,50,50);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(23, 6, $suma_vencido, 1, 0, 'C', 1);
        }else{
            $pdf->Cell(23, 6, '', 1, 0, 'C', 1);
        }
        
        //$pdf->Cell(25, 6, 'TOTAL VENCIDO:', 1, 0, 'C', 1);
        /*$pdf->SetFillColor(220,50,50);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(18, 6, $pago_vencido, 1, 0, 'C', 1);*/
        $pdf->Output("cuenta_por_pagar.pdf", "D");
    }
    public function cuenta_pagar_reporte_proveedor($datos,$reporte_valores_pagado, $fec_ini, $fec_fin,$vencido,$ruta=null)
    {
        $fecha_actual = date("d/m/Y");
        //$pdf = new FPDF('P', 'mm', 'A4');
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if ($datos[0]->logo!==null && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        $pdf->Cell(155, 8, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de Cuentas por Pagar'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode('Proveedor'), 0, 2, 'C', 0);
        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        
        
        // $pdf->SetXY(10,45);
        // $pdf->SetFillColor(240, 240, 240);
        // $pdf->SetFont('Arial', 'B', 8);
        // //$pdf->Cell(6, 6, 'No.', 1, 0, 'C', 1);
        // //$pdf->Cell(15, 6, 'FECHA', 1, 0, 'C', 1);
        // $pdf->Cell(34, 6, 'IDENTIFICACION', 1, 0, 'C', 0);
        // $pdf->Cell(70, 6, 'PROVEEDOR', 1, 0, 'C', 0);
        // //$pdf->Cell(12, 6, 'TIPO', 1, 0, 'C', 0);
        // //$pdf->Cell(15, 6, 'No CUOTA', 1, 0, 'C', 0);
        // $pdf->Cell(30, 6, 'VALOR FACTURA', 1, 0, 'C', 0);
        
        //     $pdf->Cell(28, 6, 'ABONO', 1, 0, 'C', 0);
        //     $pdf->Cell(28, 6, 'SALDO', 1, 0, 'C', 0);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 8);
        $margin = 10;
            $height = 40;
            $height_products = $height +2;
            $pdf->SetXY($margin, $height_products);
            $pdf->MultiCell(30, 6, 'IDENTIFICACION', 1, 'C', 0);
            $pdf->SetXY(40, $height_products);
            $pdf->MultiCell(95, 6, 'PROVEEDOR', 1, 'C', 0);
            $pdf->SetXY(135, $height_products);
            $pdf->MultiCell(20, 6, 'COMPRAS', 1, 'C', 0);
            $pdf->SetXY(155, $height_products);
            $pdf->MultiCell(20, 6, 'ABONOS', 1, 'C', 0);
            $pdf->SetXY(175, $height_products);
            $pdf->MultiCell(25, 6, 'SALDO ACTUAL', 1, 'C', 0);
            $y = $height_products + 8;
            $pdf->SetFont('Helvetica', '', 4);
            $pdf->SetFillColor(255, 255, 255);
            $pdf->SetFillColor(255, 255, 255);
            $pdf->SetXY($margin, $height_products);
            $pdf->SetWidths(array(30,95,20,20,25));
            //$pdf->Cell(23, 6, 'FORMA PAGO', 1, 0, 'C', 1);
        
        
        /*$pdf->Cell(15, 6, 'BASE 12%', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'DESCTO.', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'I.V.A. 12%', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'IVA Ret', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'I.R.F.', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'BASEIMPEXE', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, 'BASENOGRAVAIVA', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'OTROS', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, 'TOTAL', 1, 0, 'C', 1);*/
        $pdf->ln();

        $total = 0;
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', '', 7);
        
        /*$datos_filtrado = [];
        foreach ($datos as $key => $value) {
            if (!array_key_exists($datos[$key]->clave_acceso, $datos_filtrado)) {
                $datos_filtrado[$datos[$key]->clave_acceso] = $datos[$key];
            }
        }*/
        
        $pago_vencido=0;
        $contador = 1;
        $tbasec = 0;
        $tbased = 0;
        $tivad = 0;
        $tdesc = 0;
        $tivaret = 0;
        $tirf = 0;
        $total = 0;
        $suma_cuota=0;
        $suma_pagado=0;
        $total_saldo=0;
        $suma_saldo=0;
        foreach($datos as $detail){
            $total += $detail->valor_cuota;
            $tirf += $detail->valor_pago;
            //$total_saldo += $detail->descuento;
        }
        $id_prov=0;
        $suma_total_abono=0;
        foreach ($datos as $detail) {
            $id_prov=$detail->id_proveedor;
            $valor_pago=0;
            foreach($reporte_valores_pagado as $detail2){
                if($detail2->id_proveedor==$id_prov){
                    $valor_pago=$detail2->valor_pagado;
                }
            }
            $suma=0;
            $suma=$detail->valor_cuota-$valor_pago;
            $data = array(
                $detail->identif_proveedor."Centrado",
                utf8_decode($detail->nombre_proveedor),
                number_format($detail->valor_cuota,2,".",",")."Derecha",
                number_format($valor_pago,2,".",",")."Derecha",
                number_format($suma,2,".",",")."Derecha"
            );
            $pdf->RowCtas($data, $margin);
            $suma_total_abono+=$valor_pago;
            $total_saldo +=$suma;
            $suma=0;
            $valor_pago=0;
        }
        $total_vecido=0;
        //$total_vecido=$vencido[0]->suma-$tirf;
        //dd($suma_total_abono);
        $suma_cuota=number_format($total,2,".",",");
        $suma_pagado=number_format($suma_total_abono,2,".",",");
        $suma_vencido=number_format($total_vecido,2,".",",");
        $suma_saldo=number_format($total_saldo,2,".",",");
        //footer table
        $pdf->SetX(10);
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(125, 6, 'TOTALES:', 0, 0, 'C', 0);
        /*$pdf->Cell(15, 6, $tbasec, 1, 0, 'C', 1);
        $pdf->Cell(15, 6, $tbased, 1, 0, 'C', 1);
        $pdf->Cell(15, 6, $tdesc, 1, 0, 'C', 1);
        $pdf->Cell(15, 6, $tivad, 1, 0, 'C', 1);
        $pdf->Cell(15, 6, $tivaret, 1, 0, 'C', 1);
        $pdf->Cell(15, 6, $tirf, 1, 0, 'C', 1);
        $pdf->Cell(20, 6, '0.00', 1, 0, 'C', 1);
        $pdf->Cell(20, 6, '0.00', 1, 0, 'C', 1);
        $pdf->Cell(15, 6, '0.00', 1, 0, 'C', 1);*/
        $pdf->Cell(20, 6, $suma_cuota, 0, 0, 'R', 0);
        
            $pdf->Cell(20, 6, $suma_pagado, 0, 0, 'R', 0);
        
            $pdf->Cell(25, 6, $suma_saldo, 0, 0, 'R', 0);
        
       
        //$pdf->Cell(25, 6, 'TOTAL VENCIDO:', 1, 0, 'C', 1);
        /*$pdf->SetFillColor(220,50,50);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(18, 6, $pago_vencido, 1, 0, 'C', 1);*/
        if($ruta==null){
            $pdf->Output("cuenta_por_pagar_Proveedor.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."cuenta_por_pagar_Proveedor.pdf", "F");
        }
        
    }
    public function cuenta_pagar_reporte_detalle_factura($reporte_nuevo,$reporte_valores_pagado,$datos, $fec_ini, $fec_fin,$vencido,$proveedor,$referencia,$empresa,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 13);
        $pdf->SetXY(60, 11);
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>105){
            $pdf->SetFont('Arial', 'B', 11);
            $pdf->MultiCell(105, 3  , utf8_decode($empresa->nombre_empresa), 0,'C', 0);
            $cabecera_empresa=$pdf->GetY();
        }else{
            $pdf->SetFont('Arial', 'B', 13);
            $pdf->SetXY(60, 10);
            $pdf->Cell(105, 8, utf8_decode($empresa->nombre_empresa), 0,2,'C', 0);
        }
        
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>105){
            $pdf->SetXY(33,$cabecera_empresa);
        }else{
            $pdf->SetX(33);
        }
        //$pdf->Cell(155, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de Cuentas por Pagar'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode('Resumen Factura'), 0, 2, 'C', 0);
        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        //$pdf->SetXY(80,40);
        $id_prov="";
        $serie1="";
        $serie2="";
        $documento="";
        $resta=0;
        $resta_total=0;
        $fecha_emision="";
        $fecha_vencimiento="";
        $total_factura=0;
        $total_abono=0;
        $total_saldo=0;
        $suma_factura=0;
        $suma_abono=0;
        $suma_saldo=0;
        $totales_factura=0;
        $totales_abono=0;
        $totales_saldo=0;
        $sumatot_factura=0;
        $sumatot_abono=0;
        $sumatot_saldo=0;
        $suma_facturado_ref=0;
        $suma_abono_ref=0;
        $suma_saldo_ref=0;
        $total_facturado_ref=0;
        $total_abono_ref=0;
        $total_saldo_ref=0;
        $pdf->Ln();
        $contador_prov=0;
        $array_provs=[];
        $cantidad_cuotas=0;
        $total_factura0=0;
        $total_abono0=0;
        $total_saldo0=0;
        $sumatot_factura0=0;
        $sumatot_abono0=0;
        $sumatot_saldo0=0;
        foreach($proveedor as $detail){
            

            $id_prov=$detail->id_proveedor;
            // $exist_referencia=0;
            // $exist_factura=0;
            // $head_prov=0;
            // foreach($referencia as $detail_uno){
            //     if($detail_uno->id_proveedor==$id_prov){
            //         $exist_referencia++;
            //     }
            // }
            // foreach($datos as $detail_dos){
            //     if($detail_dos->id_proveedor==$id_prov){
            //         $exist_factura++;
            //     }
            // }
            foreach($reporte_nuevo as $detail0){
                
                if($detail0->id_proveedor==$id_prov){
                    $cantidad_cuotas++;
                    $factura_id01=$detail0->id_factura;
                    $liquidacion_id01=$detail0->id_liquidacion_compra;
                    $ref_id01=$detail0->referencias;
                    $v_cuota201=$detail0->valor_cuota;
                    $saldo_factura01=0;
                    $saldo_ref01=0;
                    $saldo_lc01=0;
                    $saldo_exist01=0;
                    $exist_fact01=0;
                    $exist_ref01=0;
                    $exist_lc01=0;
                    $total_abono_fact0=0;
                    $total_abonoref0=0;
                    $total_abonolc0=0;
                    $total_saldo_fact0=0;
                    $total_saldoref0=0;
                    $total_saldolc0=0;
                    foreach($reporte_valores_pagado as $detail01){
                        if($detail01->id_factcompra==$factura_id01 && $detail01->referencias==null && $detail01->id_liquidacion_compra==null){
                            $exist_fact01++;
                        }else{
                            if($detail01->referencias==$ref_id01 && $detail01->id_factcompra==null && $detail01->id_proveedor==$id_prov && $detail01->id_liquidacion_compra==null){
                                $exist_ref01++;
                            }else{
                                if($detail01->id_liquidacion_compra==$liquidacion_id01 && $detail01->referencias==null && $detail01->id_factcompra==null){
                                    $exist_lc01++;
                                }
                            } 
                        }
                    }

                    if($exist_fact01>0 || $exist_ref01>0 || $exist_lc01>0){
                        foreach($reporte_valores_pagado as $detail02){
                            if($detail02->id_factcompra==$factura_id01 && $detail02->referencias==null && $detail02->id_liquidacion_compra==null){
                                $saldo_factura01+=$v_cuota201-$detail02->valor_pagado;
                            }else{
                                if($detail02->referencias==$ref_id01 && $detail02->id_factcompra==null && $detail02->id_proveedor==$id_prov && $detail02->id_liquidacion_compra==null){
                                    $saldo_ref01+=$v_cuota201-$detail02->valor_pagado;
                                }else{
                                    if($detail02->id_liquidacion_compra==$liquidacion_id01 && $detail02->referencias==null && $detail02->id_factcompra==null){
                                        $saldo_lc01+=$v_cuota201-$detail02->valor_pagado;
                                    } 
                                } 
                            }
                        }
                    }else{
                        $saldo_factura01+=$v_cuota201;
                    }
                    $saldo_exist01=$saldo_ref01+$saldo_factura01+$saldo_lc01;
                    if($saldo_exist01>0){
                                $id_factura01=$detail0->id_factura;
                                $id_ref0=$detail0->referencias;
                                $id_liquidacion01=$detail0->id_liquidacion_compra;
                                $v_cuota0=$detail0->valor_cuota;
                                $exist_fact_pagado0=0;
                                $exist_refe_pagado0=0;
                                $exist_lc_pagado0=0;
                                foreach($reporte_valores_pagado as $detail60){
                                    if($detail60->id_factcompra==$id_factura01 && $detail60->referencias==null && $detail60->id_liquidacion_compra==null){
                                        $exist_fact_pagado0++;
                                    }else{
                                        if($detail60->referencias==$id_ref0 && $detail60->id_factcompra==null && $detail60->id_proveedor==$id_prov && $detail60->id_liquidacion_compra==null){
                                            $exist_refe_pagado0++;
                                        }else{
                                            if($detail60->id_liquidacion_compra==$id_liquidacion01 && $detail60->referencias==null && $detail60->id_factcompra==null){
                                                $exist_lc_pagado0++;
                                            }
                                        } 
                                    }
                                }
                                
                                if($exist_fact_pagado0>0 || $exist_refe_pagado0>0 || $exist_lc_pagado0>0){
                                    foreach($reporte_valores_pagado as $detail0){
                                        if($detail0->id_factcompra==$id_factura01 && $detail0->referencias==null && $detail0->id_liquidacion_compra==null){
                                            $total_abono_fact0+=$detail0->valor_pagado;
                                            $total_saldo_fact0+=$v_cuota201-$detail0->valor_pagado;
                                        }else{
                                            if($detail0->referencias==$id_ref0 && $detail0->id_factcompra==null && $detail0->id_proveedor==$id_prov && $detail0->id_liquidacion_compra==null){
                                                $total_abonoref0+=$detail0->valor_pagado;
                                                $total_saldoref0+=$v_cuota201-$detail0->valor_pagado;
                                            }else{
                                                if($detail0->id_liquidacion_compra==$id_liquidacion01 && $detail0->referencias==null && $detail0->id_factcompra==null){
                                                    $total_abonolc0+=$detail0->valor_pagado;
                                                    $total_saldolc0+=$v_cuota201-$detail0->valor_pagado;
                                                }
                                            }
                                        }
                                    }
                                }else{
                                                $total_saldo_fact0+=$v_cuota201;
                                }
                    }
                    if($saldo_exist01>0){
                        $total_factura0+=$v_cuota201;
                    }
                    if($saldo_exist01>0){
                        $total_abono0+=$total_abono_fact0+$total_abonoref0+$total_abonolc0;
                    }
                    if($saldo_exist01>0){
                        $total_saldo0+=$total_saldoref0+$total_saldo_fact0+$total_saldolc0;
                    }
                    
                }
            }
            $suma_factura0=number_format($total_factura0,2,".",",");
            $suma_abono0=number_format($total_abono0,2,".",",");
            $suma_saldo0=number_format($total_saldo0,2,".",",");
            
                
                $pdf->SetX(10);
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 8);
                // $pdf->Cell(20, 6, $detail->cod_proveedor, 0, 0, 'C', 0);
                // $pdf->Cell(25, 6, 'IDENTIFICACION', 0, 0, 'C', 0);
                // $pdf->Cell(25, 6, $detail->identif_proveedor, 0, 0, 'R', 0);
                // $pdf->Cell(65, 6, utf8_decode($detail->nombre_proveedor), 0, 0, 'L', 0);
            if($suma_saldo0>0){
                $head_prov=0;
                $pdf->MultiCell(190, 4, $detail->cod_proveedor."   CI/RUC:   ".$detail->identif_proveedor."   PROVEEDOR:   ".utf8_decode($detail->nombre_proveedor).utf8_decode("   TELEFONO:   ".$detail->telefono_prov).utf8_decode("   CONTACTO:   ".$detail->contacto), 0,'L', 0);
                $pdf->Ln(1);
                $pdf->SetX(10);
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 8);
                
                $pdf->Cell(27, 6, 'No Doc', 1, 0, 'C', 0);
                $pdf->Cell(27, 6, 'Serie', 1, 0, 'C', 0);
                $pdf->Cell(27, 6, 'Fecha Emision', 1, 0, 'C', 0);
                $pdf->Cell(28, 6, 'Fecha Vencimiento', 1, 0, 'C', 0);
                $pdf->Cell(27, 6, 'Valor Facturado', 1, 0, 'C', 0);
                $pdf->Cell(27, 6, 'Abonos', 1, 0, 'C', 0);
                $pdf->Cell(27, 6, 'Saldos', 1, 0, 'C', 0);
                $pdf->Ln();
                $contador_prov++;
            }
                $diferencia1="";
                $diferencia2="";
                $diferencia3="";
                $total_factura0=0;
                $total_abono0=0;
                $total_saldo0=0;
                //$total_referencia0=0;
                $total_abono_ref0=0;
                $total_saldo_ref0=0;
                $suma_factura0=0;
                $suma_abono0=0;
                $suma_saldo0=0;
                $cantidad_cuotas01=0;
                foreach($reporte_nuevo as $detail2){
                    if($detail2->id_proveedor==$id_prov){
                        $cantidad_cuotas01++;
                        $pdf->SetX(10);
                        $resta=$detail2->saldo;
                        $resta_total=number_format($resta,2,".",",");
                        $pdf->SetFillColor(255, 255, 255);
                        $pdf->SetFont('Arial', '', 7);
                        $fecha_emision=date("d/m/Y", strtotime($detail2->fecha_emision));
                        $fecha_vencimiento=date("d/m/Y", strtotime($detail2->fecha_pago));
                        
                        if($detail2->observacion){
                            $serie1=substr($detail2->observacion,0,3);
                            $serie2=substr($detail2->observacion,3,3);
                            $documento=substr($detail2->observacion,6,15);
                        }
                            $total_abono_fact=0;
                            $total_abonoref=0;
                            $total_abonolc=0;
                            $total_saldo_fact=0;
                            $total_saldoref=0;
                            $total_saldolc=0;
                            $factura_id=$detail2->id_factura;
                            $liquidacion_id=$detail2->id_liquidacion_compra;
                            $ref_id=$detail2->referencias;
                            $saldo_factura=0;
                            $saldo_ref=0;
                            $saldo_lc=0;
                            $saldo_exist=0;
                            $v_cuota2=$detail2->valor_cuota;
                            $exist_fact=0;
                            $exist_refe=0;
                            $exist_lc=0;
                            foreach($reporte_valores_pagado as $detail8){
                                if($detail8->id_factcompra==$factura_id && $detail8->referencias==null && $detail8->id_liquidacion_compra==null){
                                    $exist_fact++;
                                }else{
                                    if($detail8->referencias==$ref_id && $detail8->id_factcompra==null && $detail8->id_proveedor==$id_prov && $detail8->id_liquidacion_compra==null){
                                        $exist_refe++;
                                    }else{
                                        if($detail8->id_liquidacion_compra==$liquidacion_id && $detail8->referencias==null && $detail8->id_factcompra==null){
                                            $exist_lc++;
                                        }
                                    } 
                                }
                            }

                            if($exist_fact>0 || $exist_refe>0 || $exist_lc>0){
                                foreach($reporte_valores_pagado as $detail7){
                                    if($detail7->id_factcompra==$factura_id && $detail7->referencias==null && $detail7->id_liquidacion_compra==null){
                                        $saldo_factura+=$v_cuota2-$detail7->valor_pagado;
                                    }else{
                                        if($detail7->referencias==$ref_id && $detail7->id_factcompra==null && $detail7->id_proveedor==$id_prov && $detail7->id_liquidacion_compra==null){
                                            $saldo_ref+=$v_cuota2-$detail7->valor_pagado;
                                        }else{
                                            if($detail7->id_liquidacion_compra==$liquidacion_id && $detail7->referencias==null && $detail7->id_factcompra==null){
                                                $saldo_lc+=$v_cuota2-$detail7->valor_pagado;
                                            }
                                        } 
                                    }
                                }
                            }else{
                                $saldo_factura+=$v_cuota2;
                            }
                            $saldo_exist=number_format($saldo_ref+$saldo_factura+$saldo_lc,2,".",",");
                            if($detail2->vencido=='si' && $saldo_exist>0){
                                $pdf->SetFillColor(250, 217, 82);
                                if($detail2->observacion){
                                    $pdf->Cell(27, 6, $documento, 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, $serie1.'-'.$serie2, 1, 0, 'C', 1);
                                }else{
                                    $pdf->Cell(27, 6, $detail2->referencias, 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, '', 1, 0, 'C', 1);
                                }
                                $id_factura=$detail2->id_factura;
                                $id_liquidacion=$detail2->id_liquidacion_compra;
                                $id_ref=$detail2->referencias;
                                $pdf->Cell(27, 6, $fecha_emision, 1, 0, 'C', 1);
                                $pdf->Cell(28, 6, $fecha_vencimiento, 1, 0, 'C', 1);
                                $pdf->Cell(27, 6, $detail2->valor_cuota, 1, 0, 'C', 1);
                                $v_cuota=$detail2->valor_cuota;
                                $exist_fact_pagado=0;
                                $exist_refe_pagado=0;
                                $exist_lc_pagado=0;
                                foreach($reporte_valores_pagado as $detail5){
                                    if($detail5->id_factcompra==$id_factura && $detail5->referencias==null && $detail5->id_liquidacion_compra==null){
                                        $exist_fact_pagado++;
                                    }else{
                                        if($detail5->referencias==$id_ref && $detail5->id_factcompra==null && $detail5->id_proveedor==$id_prov && $detail5->id_liquidacion_compra==null){
                                            $exist_refe_pagado++;
                                        } else{
                                            if($detail5->id_liquidacion_compra==$id_liquidacion && $detail5->referencias==null && $detail5->id_factcompra==null){
                                                $exist_lc_pagado++;
                                            }
                                        }
                                    }
                                }

                                if($exist_fact_pagado>0 || $exist_refe_pagado>0 || $exist_lc_pagado>0){
                                    foreach($reporte_valores_pagado as $detail3){
                                        if($detail3->id_factcompra==$id_factura && $detail3->referencias==null && $detail3->id_liquidacion_compra==null){
                                            $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                            $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                            $total_abono_fact+=$detail3->valor_pagado;
                                            $total_saldo_fact+=$v_cuota-$detail3->valor_pagado;
                                        }else{
                                            if($detail3->referencias==$id_ref && $detail3->id_factcompra==null && $detail3->id_proveedor==$id_prov && $detail3->id_liquidacion_compra==null){
                                                $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                $total_abonoref+=$detail3->valor_pagado;
                                                $total_saldoref+=$v_cuota-$detail3->valor_pagado;
                                            }else{
                                                if($detail3->id_liquidacion_compra==$id_liquidacion && $detail3->referencias==null && $detail3->id_factcompra==null){
                                                    $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                    $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                    $total_abonolc+=$detail3->valor_pagado;
                                                    $total_saldolc+=$v_cuota-$detail3->valor_pagado;
                                                }
                                            }
                                        }
                                    }
                                }else{
                                    $pdf->Cell(27, 6, '0.00', 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, number_format($v_cuota,2,".",","), 1, 0, 'C', 1);
                                    $total_saldo_fact+=$v_cuota;
                                }
                                
                                
                                $pdf->Ln();
                            }else{
                                if($saldo_exist>0 && $detail2->vencido=='no'){
                                    $pdf->SetFillColor(240, 240, 240);
                                    if($detail2->observacion){
                                        $pdf->Cell(27, 6, $documento, 1, 0, 'C', 0);
                                        $pdf->Cell(27, 6, $serie1.'-'.$serie2, 1, 0, 'C', 0);
                                    }else{
                                        $pdf->Cell(27, 6, $detail2->referencias, 1, 0, 'C', 0);
                                        $pdf->Cell(27, 6, '', 1, 0, 'C', 0);
                                    }
                                    $id_factura=$detail2->id_factura;
                                    $id_ref=$detail2->referencias;
                                    $id_liquidacion=$detail2->id_liquidacion_compra;
                                    $pdf->Cell(27, 6, $fecha_emision, 1, 0, 'C', 0);
                                    $pdf->Cell(28, 6, $fecha_vencimiento, 1, 0, 'C', 0);
                                    $pdf->Cell(27, 6, $detail2->valor_cuota, 1, 0, 'C', 0);
                                    $v_cuota=$detail2->valor_cuota;
                                    $exist_fact_pagado=0;
                                    $exist_refe_pagado=0;
                                    $exist_lc_pagado=0;
                                    foreach($reporte_valores_pagado as $detail6){
                                        if($detail6->id_factcompra==$id_factura && $detail6->referencias==null && $detail6->id_liquidacion_compra==null){
                                            $exist_fact_pagado++;
                                        }else{
                                            if($detail6->referencias==$id_ref && $detail6->id_factcompra==null && $detail6->id_proveedor==$id_prov && $detail6->id_liquidacion_compra==null){
                                                $exist_refe_pagado++;
                                            }else{
                                                if($detail6->id_liquidacion_compra==$id_liquidacion && $detail6->referencias==null && $detail6->id_factcompra==null){
                                                    $exist_lc_pagado++;
                                                }
                                            } 
                                        }
                                    }
                                    
                                    if($exist_fact_pagado>0 || $exist_refe_pagado>0 || $exist_lc_pagado>0){
                                        foreach($reporte_valores_pagado as $detail4){
                                            if($detail4->id_factcompra==$id_factura && $detail4->referencias==null && $detail4->id_liquidacion_compra==null){
                                                $pdf->Cell(27, 6, number_format($detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                $pdf->Cell(27, 6, number_format($v_cuota-$detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                $total_abono_fact+=$detail4->valor_pagado;
                                                $total_saldo_fact+=$v_cuota-$detail4->valor_pagado;
                                            }else{
                                                if($detail4->referencias==$id_ref && $detail4->id_factcompra==null && $detail4->id_proveedor==$id_prov && $detail4->id_liquidacion_compra==null){
                                                    $pdf->Cell(27, 6, number_format($detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                    $pdf->Cell(27, 6, number_format($v_cuota-$detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                    $total_abonoref+=$detail4->valor_pagado;
                                                    $total_saldoref+=$v_cuota-$detail4->valor_pagado;
                                                }else{
                                                    if($detail4->id_liquidacion_compra==$id_liquidacion && $detail4->referencias==null && $detail4->id_factcompra==null){
                                                        $pdf->Cell(27, 6, number_format($detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                        $pdf->Cell(27, 6, number_format($v_cuota-$detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                        $total_abonolc+=$detail4->valor_pagado;
                                                        $total_saldolc+=$v_cuota-$detail4->valor_pagado;
                                                    }   
                                                }
                                            }
                                        }
                                    }else{
                                                    $pdf->Cell(27, 6, '0.00', 1, 0, 'C', 0);
                                                    $pdf->Cell(27, 6, number_format($v_cuota,2,".",","), 1, 0, 'C', 0);
                                                    $total_saldo_fact+=$v_cuota;
                                    }
                                    $pdf->Ln(); 
                                }
                               
                                
                                // $pdf->Cell(27, 6, $detail2->valor_pagado, 1, 0, 'C', 0);
                                // $pdf->Cell(27, 6, $resta_total, 1, 0, 'C', 0);
                                //$pdf->Ln();
                            }
                            //$pdf->Ln();
                            // $total_factura+=$detail2->valor_cuota;
                            // $total_abono+=$total_abono_fact+$total_abonoref;
                            // $total_saldo+=$total_saldoref+$total_saldo_fact;
                            // $totales_factura+=$detail2->valor_cuota;
                            // $totales_abono+=$total_abono_fact+$total_abonoref;
                            // $totales_saldo+=$total_saldoref+$total_saldo_fact;
                            $exist_fact=0;
                            $exist_refe=0;
                            if($saldo_exist>0){
                                $total_factura+=$detail2->valor_cuota;
                            }
                            if($saldo_exist>0){
                                $total_abono+=$total_abono_fact+$total_abonoref+$total_abonolc;
                            }
                            if($saldo_exist>0){
                                $total_saldo+=$total_saldoref+$total_saldo_fact+$total_saldolc;
                            }
                            
                            if($saldo_exist>0){
                                $totales_factura+=$detail2->valor_cuota;
                            }
                            if($saldo_exist>0){
                                $totales_abono+=$total_abono_fact+$total_abonoref+$total_abonolc;
                            }
                            if($saldo_exist>0){
                                $totales_saldo+=$total_saldoref+$total_saldo_fact+$total_saldolc;
                            }
                            
                            $v_cuota2=0;
                    }         
                }
                

                $pdf->SetX(10);
                $suma_factura=number_format($total_factura+$suma_facturado_ref,2,".",",");
                $suma_abono=number_format($total_abono+$suma_abono_ref,2,".",",");
                $suma_saldo=number_format($total_saldo+$suma_saldo_ref,2,".",",");
                $sumatot_factura=number_format($totales_factura+$total_facturado_ref,2,".",",");
                $sumatot_abono=number_format($totales_abono+$total_abono_ref,2,".",",");
                $sumatot_saldo=number_format($totales_saldo+$total_saldo_ref,2,".",",");
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 8);
                $pdf->SetTextColor(0, 0, 0);
                $resta_valor_cuota0=0;
                if($suma_saldo>0){
                    $pdf->Cell(109, 6, 'Total', 'T', 0, 'C', 0);
                    $pdf->Cell(27, 6, $suma_factura, 'T', 0, 'C', 0);
                    $pdf->Cell(27, 6, $suma_abono, 'T', 0, 'C', 0);
                    $pdf->Cell(27, 6, $suma_saldo, 'T', 0, 'C', 0);
                    if(count($proveedor)==$contador_prov){
                        $pdf->Ln(5);
                    }else{
                        $pdf->Ln(10);
                    }
                    $head_total=$pdf->GetY();
                   
                    
                    //array_push($array_totales,$head_total.' Total '.$suma_factura);
                    if($head_total>240 && count($proveedor)>$contador_prov){
                        $otro_valor=$pdf->GetPageHeight()-$head_total;
                        $pdf->SetAutoPageBreak(true,$otro_valor);
                    }else{
                        if(count($proveedor)>$contador_prov){
                            $pdf->SetAutoPageBreak(true,2); 
                        }else{
                            $pdf->SetAutoPageBreak(true,5);
                        }
                        
                    }
                    
                }else{
                    $resta_valor_cuota0=$totales_factura;//+$totales_referencia;
                    $head_total=$pdf->GetY();
                    
                    
                    //array_push($array_totales,$head_total.' Total '.$suma_factura);
                    if($head_total>240 && count($proveedor)>$contador_prov){
                        $otro_valor=$pdf->GetPageHeight()-$head_total;
                        $pdf->SetAutoPageBreak(true,$otro_valor);
                    }else{
                        if(count($proveedor)>$contador_prov){
                            $pdf->SetAutoPageBreak(true,2); 
                        }else{
                            $pdf->SetAutoPageBreak(true,2);
                        }
                        
                    }
                }
                $total_factura=0;
                $total_abono=0;
                $total_saldo=0;
                $total_referencia=0;
                $total_abono_ref=0;
                $total_saldo_ref=0;
                $suma_factura=0;
                $suma_abono=0;
                $suma_saldo=0;
                
            //}
                
            
        }
        //dd($array_provs);
            $pdf->SetX(10);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->Cell(109, 6, 'Totales', 0, 0, 'C', 0);
            $pdf->Cell(27, 6, $sumatot_factura, 0, 0, 'C', 0);
            $pdf->Cell(27, 6, $sumatot_abono, 0, 0, 'C', 0);
            $pdf->Cell(27, 6, $sumatot_saldo, 0, 0, 'C', 0);
        //$pdf->Output("cuenta_por_pagar.pdf", "D");
        if($ruta==null){
            $pdf->Output("cuenta_por_pagar_Resumen_Factura.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."cuenta_por_pagar_Resumen_Factura.pdf", "F");
        }
    }
    public function cuenta_pagar_reporte_detalle_factura_vencido($reporte_nuevo,$reporte_valores_pagado,$datos, $fec_ini, $fec_fin,$vencido,$proveedor,$referencia,$empresa,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 13);
        $pdf->SetXY(60, 11);
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>105){
            $pdf->SetFont('Arial', 'B', 11);
            $pdf->MultiCell(105, 3  , utf8_decode($empresa->nombre_empresa), 0,'C', 0);
            $cabecera_empresa=$pdf->GetY();
        }else{
            $pdf->SetFont('Arial', 'B', 13);
            $pdf->SetXY(60, 10);
            $pdf->Cell(105, 8, utf8_decode($empresa->nombre_empresa), 0,2,'C', 0);
        }
        
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>105){
            $pdf->SetXY(33,$cabecera_empresa);
        }else{
            $pdf->SetX(33);
        }
        //$pdf->Cell(155, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de Cuentas por Pagar'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode('Resumen Factura'), 0, 2, 'C', 0);
        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        //$pdf->SetXY(80,40);
        $id_prov="";
        $serie1="";
        $serie2="";
        $documento="";
        $resta=0;
        $resta_total=0;
        $fecha_emision="";
        $fecha_vencimiento="";
        $total_factura=0;
        $total_abono=0;
        $total_saldo=0;
        $suma_factura=0;
        $suma_abono=0;
        $suma_saldo=0;
        $totales_factura=0;
        $totales_abono=0;
        $totales_saldo=0;
        $sumatot_factura=0;
        $sumatot_abono=0;
        $sumatot_saldo=0;
        $suma_facturado_ref=0;
        $suma_abono_ref=0;
        $suma_saldo_ref=0;
        $total_facturado_ref=0;
        $total_abono_ref=0;
        $total_saldo_ref=0;
        $pdf->Ln();
        $contador_prov=0;
        $array_provs=[];
        $cantidad_cuotas=0;
        $total_factura0=0;
        $total_abono0=0;
        $total_saldo0=0;
        $sumatot_factura0=0;
        $sumatot_abono0=0;
        $sumatot_saldo0=0;

        foreach($proveedor as $detail){
            

            $id_prov=$detail->id_proveedor;
            // $exist_referencia=0;
            // $exist_factura=0;
            // $head_prov=0;
            // foreach($referencia as $detail_uno){
            //     if($detail_uno->id_proveedor==$id_prov){
            //         $exist_referencia++;
            //     }
            // }
            // foreach($datos as $detail_dos){
            //     if($detail_dos->id_proveedor==$id_prov){
            //         $exist_factura++;
            //     }
            // }
            $existe_vencidos0=0;
            foreach($reporte_nuevo as $detailven){
                if($detailven->id_proveedor==$id_prov){
                    if($detailven->vencido=='si'){
                        $existe_vencidos0++;
                    }
                }
            }
            foreach($reporte_nuevo as $detail0){
                
                if($detail0->id_proveedor==$id_prov){
                    if($detail0->vencido=='si'){
                        $cantidad_cuotas++;
                        $factura_id01=$detail0->id_factura;
                        $liquidacion_id01=$detail0->id_liquidacion_compra;
                        $ref_id01=$detail0->referencias;
                        $v_cuota201=$detail0->valor_cuota;
                        $saldo_factura01=0;
                        $saldo_ref01=0;
                        $saldo_lc01=0;
                        $saldo_exist01=0;
                        $exist_fact01=0;
                        $exist_ref01=0;
                        $exist_lc01=0;
                        $total_abono_fact0=0;
                        $total_abonoref0=0;
                        $total_abonolc0=0;
                        $total_saldo_fact0=0;
                        $total_saldoref0=0;
                        $total_saldolc0=0;
                        // $existe_vencidos0=0;
                        // if($detail0->vencido=='si'){
                        //     $existe_vencidos0++;
                        // }
                        
                        foreach($reporte_valores_pagado as $detail01){
                            if($detail01->id_factcompra==$factura_id01 && $detail01->referencias==null && $detail01->id_liquidacion_compra==null){
                                $exist_fact01++;
                            }else{
                                if($detail01->referencias==$ref_id01 && $detail01->id_factcompra==null && $detail01->id_proveedor==$id_prov && $detail01->id_liquidacion_compra==null){
                                    $exist_ref01++;
                                }else{
                                    if($detail01->id_liquidacion_compra==$liquidacion_id01 && $detail01->referencias==null && $detail01->id_factcompra==null){
                                        $exist_lc01++;
                                    }
                                } 
                            }
                        }

                        if($exist_fact01>0 || $exist_ref01>0 || $exist_lc01>0){
                            foreach($reporte_valores_pagado as $detail02){
                                if($detail02->id_factcompra==$factura_id01 && $detail02->referencias==null && $detail02->id_liquidacion_compra==null){
                                    $saldo_factura01+=$v_cuota201-$detail02->valor_pagado;
                                }else{
                                    if($detail02->referencias==$ref_id01 && $detail02->id_factcompra==null && $detail02->id_proveedor==$id_prov && $detail02->id_liquidacion_compra==null){
                                        $saldo_ref01+=$v_cuota201-$detail02->valor_pagado;
                                    }else{
                                        if($detail02->id_liquidacion_compra==$liquidacion_id01 && $detail02->referencias==null && $detail02->id_factcompra==null){
                                            $saldo_lc01+=$v_cuota201-$detail02->valor_pagado;
                                        } 
                                    } 
                                }
                            }
                        }else{
                            $saldo_factura01+=$v_cuota201;
                        }
                        $saldo_exist01=$saldo_ref01+$saldo_factura01+$saldo_lc01;
                        if($saldo_exist01>0 || $saldo_exist01<0){
                                    $id_factura01=$detail0->id_factura;
                                    $id_ref0=$detail0->referencias;
                                    $id_liquidacion01=$detail0->id_liquidacion_compra;
                                    $v_cuota0=$detail0->valor_cuota;
                                    $exist_fact_pagado0=0;
                                    $exist_refe_pagado0=0;
                                    $exist_lc_pagado0=0;
                                    foreach($reporte_valores_pagado as $detail60){
                                        if($detail60->id_factcompra==$id_factura01 && $detail60->referencias==null && $detail60->id_liquidacion_compra==null){
                                            $exist_fact_pagado0++;
                                        }else{
                                            if($detail60->referencias==$id_ref0 && $detail60->id_factcompra==null && $detail60->id_proveedor==$id_prov && $detail60->id_liquidacion_compra==null){
                                                $exist_refe_pagado0++;
                                            }else{
                                                if($detail60->id_liquidacion_compra==$id_liquidacion01 && $detail60->referencias==null && $detail60->id_factcompra==null){
                                                    $exist_lc_pagado0++;
                                                }
                                            } 
                                        }
                                    }
                                    
                                    if($exist_fact_pagado0>0 || $exist_refe_pagado0>0 || $exist_lc_pagado0>0){
                                        foreach($reporte_valores_pagado as $detail0){
                                            if($detail0->id_factcompra==$id_factura01 && $detail0->referencias==null && $detail0->id_liquidacion_compra==null){
                                                $total_abono_fact0+=$detail0->valor_pagado;
                                                $total_saldo_fact0+=$v_cuota201-$detail0->valor_pagado;
                                            }else{
                                                if($detail0->referencias==$id_ref0 && $detail0->id_factcompra==null && $detail0->id_proveedor==$id_prov && $detail0->id_liquidacion_compra==null){
                                                    $total_abonoref0+=$detail0->valor_pagado;
                                                    $total_saldoref0+=$v_cuota201-$detail0->valor_pagado;
                                                }else{
                                                    if($detail0->id_liquidacion_compra==$id_liquidacion01 && $detail0->referencias==null && $detail0->id_factcompra==null){
                                                        $total_abonolc0+=$detail0->valor_pagado;
                                                        $total_saldolc0+=$v_cuota201-$detail0->valor_pagado;
                                                    }
                                                }
                                            }
                                        }
                                    }else{
                                                    $total_saldo_fact0+=$v_cuota201;
                                    }
                        }
                        if($saldo_exist01>0 || $saldo_exist01<0){
                            $total_factura0+=$v_cuota201;
                        }
                        if($saldo_exist01>0 || $saldo_exist01<0){
                            $total_abono0+=$total_abono_fact0+$total_abonoref0+$total_abonolc0;
                        }
                        if($saldo_exist01>0 || $saldo_exist01<0){
                            $total_saldo0+=$total_saldoref0+$total_saldo_fact0+$total_saldolc0;
                        }
                    }
                    
                }
            }
           
            $suma_factura0=number_format($total_factura0,2,".",",");
            $suma_abono0=number_format($total_abono0,2,".",",");
            $suma_saldo0=number_format($total_saldo0,2,".",",");
            $suma_existe_vencido=$existe_vencidos0;
            
                
                $pdf->SetX(10);
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 8);
                // $pdf->Cell(20, 6, $detail->cod_proveedor, 0, 0, 'C', 0);
                // $pdf->Cell(25, 6, 'IDENTIFICACION', 0, 0, 'C', 0);
                // $pdf->Cell(25, 6, $detail->identif_proveedor, 0, 0, 'R', 0);
                // $pdf->Cell(65, 6, utf8_decode($detail->nombre_proveedor), 0, 0, 'L', 0);
            //dd($suma_factura0);
            if(($suma_saldo0>0 || $suma_saldo0<0) && $suma_existe_vencido>0){
                $head_prov=0;
                $pdf->MultiCell(190, 4, $detail->cod_proveedor."   CI/RUC:   ".$detail->identif_proveedor."   PROVEEDOR:   ".utf8_decode($detail->nombre_proveedor).utf8_decode("   TELEFONO:   ".$detail->telefono_prov).utf8_decode("   CONTACTO:   ".$detail->contacto), 0,'L', 0);
                $pdf->Ln(1);
                $pdf->SetX(10);
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 8);
                
                $pdf->Cell(27, 6, 'No Doc', 1, 0, 'C', 0);
                $pdf->Cell(27, 6, 'Serie', 1, 0, 'C', 0);
                $pdf->Cell(27, 6, 'Fecha Emision', 1, 0, 'C', 0);
                $pdf->Cell(28, 6, 'Fecha Vencimiento', 1, 0, 'C', 0);
                $pdf->Cell(27, 6, 'Valor Facturado', 1, 0, 'C', 0);
                $pdf->Cell(27, 6, 'Abonos', 1, 0, 'C', 0);
                $pdf->Cell(27, 6, 'Saldos', 1, 0, 'C', 0);
                $pdf->Ln();
                $contador_prov++;
            }
                $diferencia1="";
                $diferencia2="";
                $diferencia3="";
                $total_factura0=0;
                $total_abono0=0;
                $total_saldo0=0;
                //$total_referencia0=0;
                $total_abono_ref0=0;
                $total_saldo_ref0=0;
                $suma_factura0=0;
                $suma_abono0=0;
                $suma_saldo0=0;
                $existe_vencidos0=0;
                $suma_existe_vencido=0;
                $cantidad_cuotas01=0;
                foreach($reporte_nuevo as $detail2){
                    if($detail2->id_proveedor==$id_prov){
                        $cantidad_cuotas01++;
                        $pdf->SetX(10);
                        $resta=$detail2->saldo;
                        $resta_total=number_format($resta,2,".",",");
                        $pdf->SetFillColor(255, 255, 255);
                        $pdf->SetFont('Arial', '', 7);
                        $fecha_emision=date("d/m/Y", strtotime($detail2->fecha_emision));
                        $fecha_vencimiento=date("d/m/Y", strtotime($detail2->fecha_pago));
                        
                        if($detail2->observacion){
                            $serie1=substr($detail2->observacion,0,3);
                            $serie2=substr($detail2->observacion,3,3);
                            $documento=substr($detail2->observacion,6,15);
                        }
                            $total_abono_fact=0;
                            $total_abonoref=0;
                            $total_abonolc=0;
                            $total_saldo_fact=0;
                            $total_saldoref=0;
                            $total_saldolc=0;
                            $factura_id=$detail2->id_factura;
                            $liquidacion_id=$detail2->id_liquidacion_compra;
                            $ref_id=$detail2->referencias;
                            $saldo_factura=0;
                            $saldo_ref=0;
                            $saldo_lc=0;
                            $saldo_exist=0;
                            $v_cuota2=$detail2->valor_cuota;
                            $exist_fact=0;
                            $exist_refe=0;
                            $exist_lc=0;
                            foreach($reporte_valores_pagado as $detail8){
                                if($detail8->id_factcompra==$factura_id && $detail8->referencias==null && $detail8->id_liquidacion_compra==null){
                                    $exist_fact++;
                                }else{
                                    if($detail8->referencias==$ref_id && $detail8->id_factcompra==null && $detail8->id_proveedor==$id_prov && $detail8->id_liquidacion_compra==null){
                                        $exist_refe++;
                                    }else{
                                        if($detail8->id_liquidacion_compra==$liquidacion_id && $detail8->referencias==null && $detail8->id_factcompra==null){
                                            $exist_lc++;
                                        }
                                    } 
                                }
                            }

                            if($exist_fact>0 || $exist_refe>0 || $exist_lc>0){
                                foreach($reporte_valores_pagado as $detail7){
                                    if($detail7->id_factcompra==$factura_id && $detail7->referencias==null && $detail7->id_liquidacion_compra==null){
                                        $saldo_factura+=$v_cuota2-$detail7->valor_pagado;
                                    }else{
                                        if($detail7->referencias==$ref_id && $detail7->id_factcompra==null && $detail7->id_proveedor==$id_prov && $detail7->id_liquidacion_compra==null){
                                            $saldo_ref+=$v_cuota2-$detail7->valor_pagado;
                                        }else{
                                            if($detail7->id_liquidacion_compra==$liquidacion_id && $detail7->referencias==null && $detail7->id_factcompra==null){
                                                $saldo_lc+=$v_cuota2-$detail7->valor_pagado;
                                            }
                                        } 
                                    }
                                }
                            }else{
                                $saldo_factura+=$v_cuota2;
                            }
                            $saldo_exist=number_format($saldo_ref+$saldo_factura+$saldo_lc,2,".",",");
                            if($detail2->vencido=='si' && ($saldo_exist>0 || $saldo_exist<0)){
                                $pdf->SetFillColor(250, 217, 82);
                                if($detail2->observacion){
                                    $pdf->Cell(27, 6, $documento, 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, $serie1.'-'.$serie2, 1, 0, 'C', 1);
                                }else{
                                    $pdf->Cell(27, 6, $detail2->referencias, 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, '', 1, 0, 'C', 1);
                                }
                                $id_factura=$detail2->id_factura;
                                $id_liquidacion=$detail2->id_liquidacion_compra;
                                $id_ref=$detail2->referencias;
                                $pdf->Cell(27, 6, $fecha_emision, 1, 0, 'C', 1);
                                $pdf->Cell(28, 6, $fecha_vencimiento, 1, 0, 'C', 1);
                                $pdf->Cell(27, 6, $detail2->valor_cuota, 1, 0, 'C', 1);
                                $v_cuota=$detail2->valor_cuota;
                                $exist_fact_pagado=0;
                                $exist_refe_pagado=0;
                                $exist_lc_pagado=0;
                                foreach($reporte_valores_pagado as $detail5){
                                    if($detail5->id_factcompra==$id_factura && $detail5->referencias==null && $detail5->id_liquidacion_compra==null){
                                        $exist_fact_pagado++;
                                    }else{
                                        if($detail5->referencias==$id_ref && $detail5->id_factcompra==null && $detail5->id_proveedor==$id_prov && $detail5->id_liquidacion_compra==null){
                                            $exist_refe_pagado++;
                                        } else{
                                            if($detail5->id_liquidacion_compra==$id_liquidacion && $detail5->referencias==null && $detail5->id_factcompra==null){
                                                $exist_lc_pagado++;
                                            }
                                        }
                                    }
                                }

                                if($exist_fact_pagado>0 || $exist_refe_pagado>0 || $exist_lc_pagado>0){
                                    foreach($reporte_valores_pagado as $detail3){
                                        if($detail3->id_factcompra==$id_factura && $detail3->referencias==null && $detail3->id_liquidacion_compra==null){
                                            $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                            $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                            $total_abono_fact+=$detail3->valor_pagado;
                                            $total_saldo_fact+=$v_cuota-$detail3->valor_pagado;
                                        }else{
                                            if($detail3->referencias==$id_ref && $detail3->id_factcompra==null && $detail3->id_proveedor==$id_prov && $detail3->id_liquidacion_compra==null){
                                                $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                $total_abonoref+=$detail3->valor_pagado;
                                                $total_saldoref+=$v_cuota-$detail3->valor_pagado;
                                            }else{
                                                if($detail3->id_liquidacion_compra==$id_liquidacion && $detail3->referencias==null && $detail3->id_factcompra==null){
                                                    $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                    $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                    $total_abonolc+=$detail3->valor_pagado;
                                                    $total_saldolc+=$v_cuota-$detail3->valor_pagado;
                                                }
                                            }
                                        }
                                    }
                                }else{
                                    $pdf->Cell(27, 6, '0.00', 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, number_format($v_cuota,2,".",","), 1, 0, 'C', 1);
                                    $total_saldo_fact+=$v_cuota;
                                }
                                
                                
                                $pdf->Ln();
                            }
                            if($detail2->vencido=='si' && ($saldo_exist>0 || $saldo_exist<0)){
                                $sumatot_factura+=$detail2->valor_cuota;
                                $sumatot_abono+=$total_abono_fact+$total_abonoref+$total_abonolc;
                                $sumatot_saldo+=$total_saldoref+$total_saldo_fact+$total_saldolc;
                            }
                            //$pdf->Ln();
                            // $total_factura+=$detail2->valor_cuota;
                            // $total_abono+=$total_abono_fact+$total_abonoref;
                            // $total_saldo+=$total_saldoref+$total_saldo_fact;
                            // $totales_factura+=$detail2->valor_cuota;
                            // $totales_abono+=$total_abono_fact+$total_abonoref;
                            // $totales_saldo+=$total_saldoref+$total_saldo_fact;
                            $exist_fact=0;
                            $exist_refe=0;
                            // if($saldo_exist>0){
                            //     $total_factura+=$detail2->valor_cuota;
                            // }
                            // if($saldo_exist>0){
                            //     $total_abono+=$total_abono_fact+$total_abonoref+$total_abonolc;
                            // }
                            // if($saldo_exist>0){
                            //     $total_saldo+=$total_saldoref+$total_saldo_fact+$total_saldolc;
                            // }
                            if(($saldo_exist>0 || $saldo_exist<0) && $detail2->vencido=='si'){
                                $total_factura+=$detail2->valor_cuota;
                            }
                            if(($saldo_exist>0 || $saldo_exist<0) && $detail2->vencido=='si'){
                                $total_abono+=$total_abono_fact+$total_abonoref+$total_abonolc;
                            }
                            if(($saldo_exist>0 || $saldo_exist<0) && $detail2->vencido=='si'){
                                $total_saldo+=$total_saldoref+$total_saldo_fact+$total_saldolc;
                            }
                            
                            if($saldo_exist>0 || $saldo_exist<0){
                                $totales_factura+=$detail2->valor_cuota;
                            }
                            if($saldo_exist>0 || $saldo_exist<0){
                                $totales_abono+=$total_abono_fact+$total_abonoref+$total_abonolc;
                            }
                            if($saldo_exist>0 || $saldo_exist<0){
                                $totales_saldo+=$total_saldoref+$total_saldo_fact+$total_saldolc;
                            }
                            
                            $v_cuota2=0;
                    }         
                }
                

                $pdf->SetX(10);
                $suma_factura=number_format($total_factura+$suma_facturado_ref,2,".",",");
                $suma_abono=number_format($total_abono+$suma_abono_ref,2,".",",");
                $suma_saldo=number_format($total_saldo+$suma_saldo_ref,2,".",",");
                // $sumatot_factura=number_format($totales_factura+$total_facturado_ref,2,".",",");
                // $sumatot_abono=number_format($totales_abono+$total_abono_ref,2,".",",");
                // $sumatot_saldo=number_format($totales_saldo+$total_saldo_ref,2,".",",");
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 8);
                $pdf->SetTextColor(0, 0, 0);
                $resta_valor_cuota0=0;
                if($suma_saldo>0){
                    $pdf->Cell(109, 6, 'Total', 'T', 0, 'C', 0);
                    $pdf->Cell(27, 6, $suma_factura, 'T', 0, 'C', 0);
                    $pdf->Cell(27, 6, $suma_abono, 'T', 0, 'C', 0);
                    $pdf->Cell(27, 6, $suma_saldo, 'T', 0, 'C', 0);
                    if(count($proveedor)==$contador_prov){
                        $pdf->Ln(5);
                    }else{
                        $pdf->Ln(10);
                    }
                    $head_total=$pdf->GetY();
                   
                    
                    //array_push($array_totales,$head_total.' Total '.$suma_factura);
                    if($head_total>240 && count($proveedor)>$contador_prov){
                        $otro_valor=$pdf->GetPageHeight()-$head_total;
                        $pdf->SetAutoPageBreak(true,$otro_valor);
                    }else{
                        if(count($proveedor)>$contador_prov){
                            $pdf->SetAutoPageBreak(true,2); 
                        }else{
                            $pdf->SetAutoPageBreak(true,5);
                        }
                        
                    }
                    
                }else{
                    $resta_valor_cuota0=$totales_factura;//+$totales_referencia;
                    $head_total=$pdf->GetY();
                    
                    
                    //array_push($array_totales,$head_total.' Total '.$suma_factura);
                    if($head_total>240 && count($proveedor)>$contador_prov){
                        $otro_valor=$pdf->GetPageHeight()-$head_total;
                        $pdf->SetAutoPageBreak(true,$otro_valor);
                    }else{
                        if(count($proveedor)>$contador_prov){
                            $pdf->SetAutoPageBreak(true,2); 
                        }else{
                            $pdf->SetAutoPageBreak(true,2);
                        }
                        
                    }
                }
                $total_factura=0;
                $total_abono=0;
                $total_saldo=0;
                $total_referencia=0;
                $total_abono_ref=0;
                $total_saldo_ref=0;
                $suma_factura=0;
                $suma_abono=0;
                $suma_saldo=0;
                
                
            //}
                
            
        }
        //dd($array_provs);
            $pdf->SetX(10);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->Cell(109, 6, 'Totales', 0, 0, 'C', 0);
            $pdf->Cell(27, 6, number_format($sumatot_factura,2,".",","), 0, 0, 'C', 0);
            $pdf->Cell(27, 6, number_format($sumatot_abono,2,".",","), 0, 0, 'C', 0);
            $pdf->Cell(27, 6, number_format($sumatot_saldo,2,".",","), 0, 0, 'C', 0);
        //$pdf->Output("cuenta_por_pagar.pdf", "D");
        if($ruta==null){
            $pdf->Output("cuenta_por_pagar_Resumen_Factura.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."cuenta_por_pagar_Resumen_Factura.pdf", "F");
        }
    }
    public function cuenta_pagar_reporte_resumen_factura($reporte_nuevo,$reporte_ctas,$reporte_pagos,$datos, $fec_ini, $fec_fin,$vencido,$proveedor,$referencias,$vencido_referencia,$empresa,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);
        
        //$pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        $pdf->Cell(155, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 5, utf8_decode('Reporte de Cuentas por Pagar'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 5, utf8_decode('Detalle Factura'), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        //$pdf->SetXY(80,40);
        $id_prov="";
        $serie1="";
        $serie2="";
        $documento="";
        $resta=0;
        $resta_total=0;
        $fecha_emision="";
        $fecha_vencimiento="";
        $total_factura=0;
        $total_abono=0;
        $total_saldo=0;
        $suma_factura=0;
        $suma_abono=0;
        $suma_saldo=0;
        $id_fact="";
        $no_doc="";
        $fecha_pag="";
        $totales_factura=0;
        $suma_totales_factura=0;
        $pdf->Ln();
        $exist_referencia=0;
        $exist_facturas=0;
        $id_prov="";
        $id_referencia="";
        $total_referencia=0;
        $total_abono_ref=0;
        $total_saldo_ref=0;
        $totales_referencia=0;
        $suma_saldo_ref=0;
        $suma_totales_referencia=0;
        $suma_totales_cobros=0;
        $pdf->Ln();
        $exist_referencias=0;
        foreach($proveedor as $detail){
            $id_prov=$detail->id_proveedor;
            foreach($referencias as $detail){
                if($detail->id_proveedor==$id_prov){
                    $exist_referencias++;
                }
            }   
        }
        $total_referencia=0;
        $total_referencia_abono=0;
        $total_referencia_pago=0;
        $total_referencia_total=0;
        $total_referencia_total_abono=0;
        $total_referencia_total_pago=0;
        $suma_totales_pro=0;
        $array_totales_fact=[];
        $array_totales_pro=[];
        $contador_cliente=0;
        $contador_ctas=0;
        $id_ctas=count($reporte_ctas)+1;
        $array_comprobante=[];
        foreach($reporte_ctas as $detail){
            $id_ctas_pagos=$detail->id_ctas_pagar_pagos;
            $id_ctas--;
            
                //$contador_cliente++;
               
            foreach($vencido_referencia as $detail2){
                if($detail2->id_ctas_pagar_pagos==$id_ctas_pagos){
                    $cta_pago=$id_ctas;
                    array_push($array_comprobante,$cta_pago.";".$detail2->id_ctas_pagar_pagos.";");
                }
            }
                   
                
            
        }
        //dd($vencido_referencia);
        foreach($proveedor as $detail){
            $contador_cliente++;
            $id_prov=$detail->id_proveedor;
            $head_id_prov=0;
            $head_total_fact=0;
            $head_resta_cab=0;
            $head_suma_cab=0;
                $pdf->SetX(10);
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 8);
                /*$pdf->Cell(15, 6, $detail->codigo, 0, 0, 'C', 0);
                $pdf->Cell(25, 6, 'IDENTIFICACION', 0, 0, 'C', 0);
                $pdf->Cell(25, 6, $detail->identificacion, 0, 0, 'R', 0);
                $pdf->Cell(75, 6, utf8_decode($detail->nombre), 0, 0, 'L', 0);*/
                $head_id_prov=$pdf->GetY();
                array_push($array_totales_fact,$head_id_prov.'Cleinte'.$detail->cod_proveedor);
                                    // if($head_id_prov>190){
                                    //     $otro_valor_prov=$pdf->GetPageHeight()-$head_id_prov;
                                    //     $pdf->SetAutoPageBreak(true,$otro_valor_prov);
                                    // }
                $pdf->MultiCell(190, 4, $detail->cod_proveedor."   CI/RUC:   ".$detail->identif_proveedor."   PROVEEDOR:   ".utf8_decode($detail->nombre_proveedor).utf8_decode("   TELEFONO:   ".$detail->telefono_prov).utf8_decode("   CONTACTO:   ".$detail->contacto), 0,'L', 0);
                $pdf->Ln(2);
                
                foreach($reporte_nuevo as $detail2){
                    
                    if($detail2->id_proveedor==$id_prov){
                        $contador_ctas++;
                        $suma_cuota_total=0;
                        $suma_cuota_abono_fact=0;
                        $suma_cuota_abono_ref=0;
                        $suma_cuota_abono_lcomp=0;
                        $suma_cuota_totales=0;
                        $suma_cuota_total=$detail2->valor_cuota;
                        $factura_id=$detail2->id_factura;
                        $liquidacion_compra_id=$detail2->id_liquidacion_compra;
                        $referencias=$detail2->referencias;
                        foreach($vencido_referencia as $detail3){
                            if($detail3->id_factura_compra==$factura_id && $detail3->referencias==null && $detail3->id_liquidacion_compra==null){
                                $suma_cuota_abono_fact+=$detail3->valor_pagado;
                            }
                            if($detail3->referencias==$referencias && $detail3->id_factura_compra==null && $detail3->id_proveedor==$id_prov && $detail3->id_liquidacion_compra==null){
                                $suma_cuota_abono_ref+=$detail3->valor_pagado;
                            }
                            if($detail3->id_liquidacion_compra==$liquidacion_compra_id && $detail3->referencias==null && $detail3->id_factura_compra==null){
                                $suma_cuota_abono_lcomp+=$detail3->valor_pagado;
                            }
                        }
                        $suma_cuota_totales=$suma_cuota_total-$suma_cuota_abono_fact-$suma_cuota_abono_ref-$suma_cuota_abono_lcomp;
                        //if($suma_cuota_totales>0){
                            $head_cab=0;
                            $head_total_cli=0;
                            $array_head=[];
                            $pdf->SetX(10);
                            $pdf->SetFillColor(240, 240, 240);
                            $pdf->SetFont('Arial', 'B', 8);
                            $head_cab=$pdf->GetY();
                            array_push($array_totales_fact,$head_cab.' No. Comprobante'.$detail2->id_proveedor);
                            $pdf->Cell(31, 6, 'Factura', 1, 0, 'C', 0);
                            //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                            $pdf->Cell(19, 6, 'Fecha', 1, 0, 'C', 0);
                            $pdf->Cell(29, 6, 'Comprobante Pago', 1, 0, 'C', 0);
                            $pdf->Cell(39, 6, 'Pago', 1, 0, 'C', 0);
                            $pdf->Cell(41, 6, 'Forma Pago', 1, 0, 'C', 0);
                            //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                            //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
                            $pdf->Cell(31, 6, 'Valor', 1, 0, 'C', 0);
                            //$pdf->Cell(35, 6, 'Saldos', 1, 0, 'C', 1);
                            $pdf->Ln();
                            
                            $pdf->SetX(10);

                            $resta_total=number_format($resta,2,".",",");
                            $pdf->SetFillColor(240, 240, 240);
                            $pdf->SetFont('Arial', '', 7);
                            
                            $fecha_emision=date("d/m/Y", strtotime($detail2->fecha_emision));
                            $fecha_vencimiento=date("d/m/Y", strtotime($detail2->fecha_pago));
                            if($detail2->vencido=='si' && $suma_cuota_totales>0){
                                $pdf->SetFillColor(250, 217, 82);
                                if($detail2->observacion){
                                    $serie1=substr($detail2->observacion,0,3);
                                    $serie2=substr($detail2->observacion,3,3);
                                    $documento=substr($detail2->observacion,6,15);
                                    $pdf->Cell(31, 6, $documento, 1, 0, 'C', 1);
                                    //$pdf->Cell(23, 6, $serie1.'-'.$serie2, 1, 0, 'C', 1);
                                    
                                }else{
                                    $serie1=substr($detail2->observacion,0,3);
                                    $serie2=substr($detail2->observacion,3,3);
                                    $documento=substr($detail2->observacion,6,15);
                                    $pdf->Cell(31, 6, $detail2->referencias, 1, 0, 'C', 1);
                                    //$pdf->Cell(23, 6, '', 1, 0, 'C', 1);
                                }
                                //$pdf->Cell(12, 6, 'Factura', 0, 0, 'C', 1);
                                //$pdf->Cell(18, 6, $detail->num_cuota, 0, 0, 'C', 1);
                                $pdf->Cell(19, 6, $fecha_vencimiento, 1, 0, 'C', 1);
                                $pdf->Cell(29, 6, '', 1, 0, 'C', 1);
                                
                                $pdf->Cell(39, 6, '', 1, 0, 'R', 1);
                                $pdf->Cell(41, 6, '', 1, 0, 'R', 1);
                                //$pdf->Cell(25, 6, '', 1, 0, 'C', 1);
                                $pdf->Cell(31, 6, $detail2->valor_cuota, 1, 0, 'C', 1);
                            }else{
                                $pdf->SetFillColor(240, 240, 240);
                                if($detail2->observacion){
                                    $serie1=substr($detail2->observacion,0,3);
                                    $serie2=substr($detail2->observacion,3,3);
                                    $documento=substr($detail2->observacion,6,15);
                                    $pdf->Cell(31, 6, $documento, 1, 0, 'C', 0);
                                    //$pdf->Cell(23, 6, $serie1.'-'.$serie2, 1, 0, 'C', 0);
                                }else{
                                    $serie1=substr($detail2->observacion,0,3);
                                    $serie2=substr($detail2->observacion,3,3);
                                    $documento=substr($detail2->observacion,6,15);
                                    $pdf->Cell(31, 6, $detail2->referencias, 1, 0, 'C', 0);
                                    //$pdf->Cell(23, 6, '', 1, 0, 'C', 0);
                                    
                                }
                                //$pdf->Cell(12, 6, 'Factura', 0, 0, 'C', 0);
                                //$pdf->Cell(18, 6, $detail->num_cuota, 0, 0, 'C', 0);
                                $pdf->Cell(19, 6, $fecha_vencimiento, 1, 0, 'C', 0);
                                //$pdf->Cell(31, 6, $fecha_vencimiento, 1, 0, 'R', 0);
                                $pdf->Cell(29, 6, '', 1, 0, 'C', 0);
                                $pdf->Cell(39, 6, '', 1, 0, 'R', 0);
                                $pdf->Cell(41, 6, '', 1, 0, 'R', 0);
                                
                                $pdf->Cell(31, 6, $detail2->valor_cuota, 1, 0, 'C', 0);
                            }
                            $total_factura=0;
                            $id_fact=$detail2->id_factura;
                            $liquidacion_id=$detail2->id_liquidacion_compra;
                            $id_referencia=$detail2->referencias;
                            $total_factura=$detail2->valor_cuota;
                            $doc_nro="";
                            $secuencia="";
                            if($detail2->observacion){
                                $no_doc=$documento;
                                $doc_nro=$documento;
                                $secuencia=$serie1."-".$serie2;
                            }else{
                                $no_doc=$detail2->referencias;
                                $doc_nro=$detail2->referencias;
                            }
                            
                            $pdf->Ln();
                            
                            foreach($vencido_referencia as $detail2){
                                if($detail2->id_factura_compra==$id_fact && $detail2->referencias==null && $detail2->id_liquidacion_compra==null){
                                    $termToSearch = ";".$detail2->id_ctas_pagar_pagos.";";
                                        $matches = array_filter($array_comprobante, function($var) use ($termToSearch) { return stristr($var, $termToSearch); });
                                        if($matches){
                                            $index=key($matches);
                                            $valor_index=$array_comprobante[$index];
                                            $index_valor=substr($array_comprobante[$index],0,-strlen($termToSearch));
                                        }else{
                                            $index_valor="no existe";
                                        }
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(255, 255, 255);
                                    $pdf->SetFont('Arial', '', 7);
                                    /*$serie1=substr($detail2->observacion,24,3);
                                    $serie2=substr($detail2->observacion,27,3);
                                    $documento=substr($detail2->observacion,30,9);*/
                                    //$pdf->Cell(25, 6, $documento, 0, 0, 'C', 0);
                                    if($detail2->fecha_registro){
                                        $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_registro));
                                    }else{
                                        $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_pago));
                                    }
                                    
                                    
                                        $pdf->Cell(31, 6, $no_doc, 1, 0, 'C', 0);
                                        //$pdf->Cell(23, 6, $secuencia, 1, 0, 'C', 0);
                                    
                                    
                                    //$pdf->Cell(45, 6, $detail->numero_tarjeta, 1, 0, 'R', 0);
                                    $pdf->Cell(19, 6, $fecha_pag, 1, 0, 'C', 0);
                                    if($detail2->posicion==null){
                                        $pdf->Cell(29, 6, $index_valor, 1, 0, 'C', 0);
                                    }else{
                                        $pdf->Cell(29, 6, $detail2->posicion, 1, 0, 'C', 0);
                                    }
                                    
                                    $pdf->Cell(39, 6, utf8_decode($detail2->pagos_por) , 1, 0, 'C', 1);
                                    $pdf->Cell(41, 6, utf8_decode($detail2->descripcion), 1, 0, 'L', 1);
                                    //$pdf->Cell(25, 6, utf8_decode($detail2->nro_tarjeta), 1, 0, 'C', 0);
                                    if($detail2->id_nota_credito_compra!==null){
                                        if($detail2->valor_pagado>$detail2->v_pago_cta){
                                            $pdf->Cell(31, 6, '+'.number_format($detail2->v_pago_cta,2,".",","), 1, 0, 'C', 1);
                                        }else{
                                            $pdf->Cell(31, 6, '+'.number_format($detail2->valor_pagado,2,".",","), 1, 0, 'C', 1); 
                                        }
                                    }else{
                                        if($detail2->valor_pagado>$detail2->v_pago_cta){
                                            $pdf->Cell(31, 6, '-'.number_format($detail2->v_pago_cta,2,".",","), 1, 0, 'C', 1);
                                        }else{
                                            $pdf->Cell(31, 6, '-'.number_format($detail2->valor_pagado,2,".",","), 1, 0, 'C', 1); 
                                        }
                                    }
                                    
                                    //$pdf->Cell(31, 6, '-'.number_format($detail2->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                    $pdf->Ln();
                                    //$id_fact=0;
                                    if($detail2->id_nota_credito_compra!==null){
                                        if($detail2->valor_pagado>$detail2->v_pago_cta){
                                            $total_abono-=$detail2->v_pago_cta;
                                        }else{
                                            $total_abono-=$detail2->valor_pagado;
                                        }
                                    }else{
                                        if($detail2->valor_pagado>$detail2->v_pago_cta){
                                            $total_abono+=$detail2->v_pago_cta;
                                        }else{
                                            $total_abono+=$detail2->valor_pagado;
                                        }
                                    }
                                    
                                    
                                }
                                if($detail2->referencias==$id_referencia && $detail2->id_factura_compra==null && $detail2->id_proveedor==$id_prov && $detail2->id_liquidacion_compra==null){
                                        $termToSearch = ";".$detail2->id_ctas_pagar_pagos.";";
                                            $matches = array_filter($array_comprobante, function($var) use ($termToSearch) { return stristr($var, $termToSearch); });
                                            if($matches){
                                                $index=key($matches);
                                                $valor_index=$array_comprobante[$index];
                                                $index_valor=substr($array_comprobante[$index],0,-strlen($termToSearch));
                                            }else{
                                                $index_valor="no existe";
                                            }    
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', '', 7);
                                        //$pdf->Cell(25, 6, $documento, 0, 0, 'C', 0);
                                        if($detail2->fecha_registro){
                                            $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_registro));
                                        }else{
                                            $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_pago));
                                        }
                                        $pdf->Cell(31, 6, $detail2->referencias, 1, 0, 'C', 0);
                                        //$pdf->Cell(23, 6, '', 1, 0, 'C', 0);
                                        //$pdf->Cell(45, 6, $detail->numero_tarjeta, 1, 0, 'R', 0);
                                        $pdf->Cell(19, 6, $fecha_pag, 1, 0, 'C', 0);
                                        $pdf->Cell(29, 6, $index_valor, 1, 0, 'C', 0);
                                        $pdf->Cell(39, 6, utf8_decode($detail2->pagos_por), 1, 0, 'C', 0);
                                        $pdf->Cell(41, 6, utf8_decode($detail2->descripcion), 1, 0, 'L', 0);
                                        //$pdf->Cell(25, 6, utf8_decode($detail2->nro_tarjeta), 1, 0, 'C', 0);
                                        if($detail2->valor_pagado>$detail2->v_pago_cta){
                                            $pdf->Cell(31, 6, '-'.number_format($detail2->v_pago_cta,2,".",","), 1, 0, 'C', 0);
                                        }else{
                                            $pdf->Cell(31, 6, '-'.number_format($detail2->valor_pagado,2,".",","), 1, 0, 'C', 0); 
                                        }
                                        //$pdf->Cell(31, 6, '-'.number_format($detail2->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                        $pdf->Ln();
                                        //$id_fact=0;
                                        if($detail2->valor_pagado>$detail2->v_pago_cta){
                                            $total_abono_ref+=$detail2->v_pago_cta;
                                        }else{
                                            $total_abono_ref+=$detail2->valor_pagado;
                                        }
                                        //$id_referencia=0;
                                        
                                }
                                if($detail2->id_liquidacion_compra==$liquidacion_id && $detail2->referencias==null && $detail2->id_factura_compra==null){
                                    $termToSearch = ";".$detail2->id_ctas_pagar_pagos.";";
                                        $matches = array_filter($array_comprobante, function($var) use ($termToSearch) { return stristr($var, $termToSearch); });
                                        if($matches){
                                            $index=key($matches);
                                            $valor_index=$array_comprobante[$index];
                                            $index_valor=substr($array_comprobante[$index],0,-strlen($termToSearch));
                                        }else{
                                            $index_valor="no existe";
                                        }
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(255, 255, 255);
                                    $pdf->SetFont('Arial', '', 7);
                                    /*$serie1=substr($detail2->observacion,24,3);
                                    $serie2=substr($detail2->observacion,27,3);
                                    $documento=substr($detail2->observacion,30,9);*/
                                    //$pdf->Cell(25, 6, $documento, 0, 0, 'C', 0);
                                    if($detail2->fecha_registro){
                                        $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_registro));
                                    }else{
                                        $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_pago));
                                    }
                                    
                                    
                                        $pdf->Cell(31, 6, $no_doc, 1, 0, 'C', 0);
                                        //$pdf->Cell(23, 6, $secuencia, 1, 0, 'C', 0);
                                    
                                    
                                    //$pdf->Cell(45, 6, $detail->numero_tarjeta, 1, 0, 'R', 0);
                                    $pdf->Cell(19, 6, $fecha_pag, 1, 0, 'C', 0);
                                    $pdf->Cell(29, 6, $index_valor, 1, 0, 'C', 0);
                                    $pdf->Cell(39, 6, utf8_decode($detail2->pagos_por) , 1, 0, 'C', 1);
                                    $pdf->Cell(41, 6, utf8_decode($detail2->descripcion), 1, 0, 'L', 1);
                                    //$pdf->Cell(25, 6, utf8_decode($detail2->nro_tarjeta), 1, 0, 'C', 0);
                                    if($detail2->valor_pagado>$detail2->v_pago_cta){
                                        $pdf->Cell(31, 6, '-'.number_format($detail2->v_pago_cta,2,".",","), 1, 0, 'C', 1);
                                    }else{
                                        $pdf->Cell(31, 6, '-'.number_format($detail2->valor_pagado,2,".",","), 1, 0, 'C', 1); 
                                    }
                                    //$pdf->Cell(31, 6, '-'.number_format($detail2->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                    $pdf->Ln();
                                    //$id_fact=0;
                                    if($detail2->valor_pagado>$detail2->v_pago_cta){
                                        $total_abono+=$detail2->v_pago_cta;
                                    }else{
                                        $total_abono+=$detail2->valor_pagado;
                                    }
                                    
                                }
                                //$total_abono+=$detail2->valor_pagado;
                                
                            }
                                    $total_saldo+=$total_factura-$total_abono-$total_abono_ref;
                                    $total_saldo_ref=$total_factura-$total_abono-$total_abono_ref;
                                    $totales_factura+=$total_saldo;
                                    $suma_saldo=number_format($total_saldo_ref,2,".",",");
                                    $suma_totales_factura=$totales_factura;
                                    $pdf->SetX(15);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 8);
                                    $total_clientes='TOTAL';
                                    $pdf->Cell(159, 6, $total_clientes, 'T', 0, 'C', 0);
                                    //$pdf->Cell(25, 6, $no_doc, 1, 0, 'R', 0);
                                    //$pdf->Cell(25, 6, '', 1, 0, 'R', 0);
                                    //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
                                    //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
                                    $pdf->Cell(22, 6, $suma_saldo, 'T', 0, 'C', 0);
                                    
                                    
                                    
                                    $total_saldo=0;
                                    $total_abono=0;
                                    $total_abono_ref=0;
                                    $total_factura=0;
                                    $total_saldo_ref=0;
                                    $suma_saldo=0;
                                    $no_doc="";
                                    if(count($reporte_nuevo)==$contador_ctas){
                                        $pdf->Ln();
                                    }else{
                                        $pdf->Ln(5);
                                    }
                                    array_push($array_totales_pro,$contador_ctas. "Nro Cuentas por Cliente ".$id_prov);
                                    $head_total_cli=$pdf->GetY();
                                    array_push($array_totales_fact,$head_total_cli.'TOTAL   '.$doc_nro);
                                    $head_resta_cab+=$head_cab-$head_id_prov;
                                    $head_suma_cab+=$head_total_cli-$head_cab+$head_resta_cab;
                                    //array_push($array_totales_pro,$head_suma_cab);
                                    if($head_total_cli>251 && count($reporte_nuevo)>$contador_ctas){
                                        $otro_valor=$pdf->GetPageHeight()-$head_total_cli;
                                        $pdf->SetAutoPageBreak(true,$otro_valor);
                                    }else{
                                        if($head_total_cli>251 && count($reporte_nuevo)==$contador_ctas){
                                            $otro_valor=$pdf->GetPageHeight()-$head_total_cli;
                                            $pdf->SetAutoPageBreak(true,2);
                                        }else{
                                            $pdf->SetAutoPageBreak(true,5);
                                        }
                                        // if(count($reporte_nuevo)>$contador_ctas){
                                        //     $pdf->SetAutoPageBreak(true,2);
                                        // }else{
                                        //     $pdf->SetAutoPageBreak(true,5);
                                        // }
                                        $pdf->SetAutoPageBreak(true,5);
                                        
                                    }
                                    
                        //}
                        
                    }
                }   
                if(isset($head_total_cli)){
                    $pdf->SetXY(20,$head_total_cli+2);
                }else{
                    
                    $pdf->SetX(20);
                    $pdf->Ln(5);
                }
                
                $suma_totales=0;
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 10);
                $pdf->Cell(159, 6, 'TOTALES FACTURAS', 0, 0, 'C', 0);
                $suma_totales=$suma_totales_factura+$suma_totales_referencia;
                $suma_totales_cobros+=$suma_totales_factura+$suma_totales_referencia;
                $pdf->Cell(10, 6, number_format($suma_totales,2,".",","), 0, 0, 'C', 0);
                if(count($proveedor)==$contador_cliente){
                    $pdf->Ln(5);
                }else{
                    $pdf->Ln(9);
                }
                //$pdf->Ln(9);
                $head_total_fact=$pdf->GetY();
                // array_push($array_totales_fact,$head_total_fact." TOTALES FACTURAS ".$suma_totales);
                if($head_total_fact>260 && count($reporte_nuevo)!==$contador_ctas){
                    $otro_total_2=$pdf->GetPageHeight()-$head_total_fact;
                    $pdf->SetAutoPageBreak(true,$otro_total_2);
                }else{
                    if($head_total_fact>190 && count($reporte_nuevo)==$contador_ctas){
                        $otro_total_2=$pdf->GetPageHeight()-$head_total_fact;
                        $pdf->SetAutoPageBreak(true,$otro_total_2);
                    }else{
                        $pdf->SetAutoPageBreak(true,5);
                    }
                    
                }
                $contador_ctas=0;
                $suma_totales_factura=0;
                $suma_totales_referencia=0;
                $totales_factura=0;
                $totales_referencia=0;
                $total_referencia=0;
                $suma_totales=0;
        }
                $pdf->SetXY(20,$head_total_fact);
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 10);
                $pdf->Cell(159, 6, 'TOTAL FACTURA COBROS', 0, 0, 'C', 0);
                $pdf->Cell(10, 6, number_format($suma_totales_cobros,2,".",","), 0, 0, 'C', 0);
        /*foreach($proveedor as $detail){
            $pdf->SetX(95);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(25, 6, 'IDENTIFICACION', 0, 0, 'C', 0);
            $pdf->Cell(25, 6, $detail->identif_proveedor, 0, 0, 'R', 0);
            $pdf->Cell(45, 6, $detail->nombre_proveedor, 0, 0, 'R', 0);
            $id_prov=$detail->id_proveedor;
            $pdf->Ln(15);
            $pdf->SetX(60);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 6);
            
            $pdf->Cell(25, 6, 'No. Doc', 'TB', 0, 'C', 0);
            $pdf->Cell(25, 6, 'Serie', 'TB', 0, 'C', 0);
            $pdf->Cell(25, 6, 'Fecha Emision', 'TB', 0, 'C', 0);
            $pdf->Cell(25, 6, 'Fecha Vencimiento', 'TB', 0, 'C', 0);
            $pdf->Cell(25, 6, 'Num.Compra', 'TB', 0, 'C', 0);
            $pdf->Cell(25, 6, 'Fecha', 'TB', 0, 'C', 0);
            $pdf->Cell(25, 6, 'Valor', 'TB', 0, 'C', 0);
            //$pdf->Cell(25, 6, 'Saldos', 1, 0, 'C', 1);
            $pdf->Ln();
            
            foreach($datos as $detail){
                if($detail->id_proveedor==$id_prov){
                    $pdf->SetX(60);
                    //$resta=$detail->valor_cuota-$detail->valor_pagado;
                    $resta_total=number_format($resta,2,".",",");
                    $pdf->SetFillColor(240, 240, 240);
                    $pdf->SetFont('Arial', '', 6);
                    $serie1=substr($detail->observacion,24,3);
                    $serie2=substr($detail->observacion,27,3);
                    $documento=substr($detail->observacion,30,9);
                    $fecha_emision=date("d/m/Y", strtotime($detail->fech_emision));
                    $fecha_vencimiento=date("d/m/Y", strtotime($detail->fecha_pago));
                    $pdf->Cell(25, 6, $documento, 0, 0, 'C', 0);
                    $pdf->Cell(25, 6, $serie1.'-'.$serie2, 0, 0, 'C', 0);
                    //$pdf->Cell(12, 6, 'Factura', 0, 0, 'C', 1);
                    //$pdf->Cell(18, 6, $detail->num_cuota, 0, 0, 'C', 1);
                    $pdf->Cell(25, 6, $fecha_emision, 0, 0, 'R', 0);
                    $pdf->Cell(25, 6, $fecha_vencimiento, 0, 0, 'R', 0);
                    $pdf->Cell(25, 6, '', 0, 0, 'R', 0);
                    $pdf->Cell(25, 6, '', 0, 0, 'R', 0);
                    $pdf->Cell(25, 6, $detail->valor_cuota, 0, 0, 'R', 0);
                    $id_fact=$detail->id_factura_compra;
                    $total_factura=$detail->valor_cuota;
                    $no_doc=$documento;
                    $pdf->Ln();

                    foreach($vencido as $detail){
                        if($detail->id_factura_compra==$id_fact){
                            $pdf->SetFillColor(240, 240, 240);
                            $pdf->SetFont('Arial', '', 6);
                            $pdf->Cell(150, 6, $detail->id_factura_compra, 0, 0, 'R', 0);
                            $pdf->Cell(25, 6, $detail->numero_tarjeta, 0, 0, 'R', 0);
                            $pdf->Cell(25, 6, '', 0, 0, 'R', 0);
                            $pdf->Cell(25, 6, '-'.$detail->valor_pagado, 0, 0, 'R', 0);
                            $pdf->Ln();
                            $total_abono+=$detail->valor_pagado;
                        }
                            
                    }
                            $total_saldo+=$total_factura-$total_abono;
                            $suma_saldo=number_format($total_saldo,2,".",",");
                            $pdf->SetX(60);
                            $pdf->SetFillColor(240, 240, 240);
                            $pdf->SetFont('Arial', 'B', 6);
                            $pdf->Cell(100, 6, 'TOTAL', 'TB', 0, 'R', 0);
                            $pdf->Cell(25, 6, $no_doc, 'TB', 0, 'R', 0);
                            $pdf->Cell(25, 6, '', 'TB', 0, 'R', 0);
                            $pdf->Cell(25, 6, $suma_saldo, 'TB', 0, 'R', 0);
                            $pdf->Ln();
                            $total_saldo=0;
                            $total_abono=0;
                            $total_factura=0;
                            $no_doc="";
                        
                }
                
            }
            
            $pdf->Ln(15);

        }*/
            /*$pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->Cell(150, 6, 'Totales', 0, 0, 'R', 0);
            $pdf->Cell(25, 6, $vencido[0]->suma, 0, 0, 'R', 0);
            $pdf->Cell(25, 6, $vencido[0]->abono, 0, 0, 'R', 0);
            $pdf->Cell(25, 6, $vencido[0]->saldo, 0, 0, 'R', 0);*/
        //$pdf->Output("cuenta_por_pagar_Resumen_Factura.pdf", "D");
        if($ruta==null){
            $pdf->Output("cuenta_por_pagar_Detalle_Factura.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."cuenta_por_pagar_Detalle_Factura.pdf", "F");
        }
    }
    public function cuenta_pagar_reporte_dias_vencidos($reporte_nuevo,$datos, $fec_ini, $fec_fin,$vencido,$proveedor,$referencia,$empresa,$ruta=null){
        $fecha_actual = date("d/m/Y");
        //$pdf = new FPDF('L', 'mm', 'A4');
        $pdf = new PDF_MC_Table('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(75, 10);
        $pdf->Cell(155, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Reporte de Cuentas por Pagar'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode('Dias Vencimiento'), 0, 2, 'C', 0);
        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        //$pdf->SetXY(80,40);
        $id_prov="";
        $serie1="";
        $serie2="";
        $documento="";
        $resta=0;
        $resta_total=0;
        $fecha_emision="";
        $fecha_vencimiento="";
        $total_factura=0;
        $total_abono=0;
        $total_saldo=0;
        $suma_factura=0;
        $suma_abono=0;
        $suma_saldo=0;
        $totales_factura=0;
        $totales_abono=0;
        $totales_saldo=0;
        $sumatot_factura=0;
        $sumatot_abono=0;
        $sumatot_saldo=0;
        $exist_factura=0;
        $exist_referencia=0;
        foreach($referencia as $detail){
            $exist_referencia++;
        }
        foreach($datos as $detail){
            $exist_factura++;
        }
        $pdf->Ln();
        // if($exist_referencia>0 || $exist_factura>0){
        //     $pdf->Cell(20, 6, 'No. Doc', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, 'Serie', 1, 0, 'C', 0);
        //     $pdf->Cell(45, 6, 'Proveedor', 1, 0, 'C', 0);
        //     $pdf->Cell(20, 6, 'Fecha', 1, 0, 'C', 0);
        //     $pdf->Cell(20, 6, 'Valor', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '-120', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '-90', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '-60', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '-30', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '0', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '30', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '60', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '90', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '120', 1, 0, 'C', 0);
        //     $pdf->Cell(20, 6, 'Total', 1, 0, 'C', 0);
        //     $pdf->Ln();
        // }
        $pdf->SetX(10);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 8);
        //$pdf->Cell(10, 6, 'No. Factura', 1, 0, 'C', 0);
        if($exist_referencia>0 || $exist_factura>0){
            // $pdf->Cell(20, 6, 'No. Doc', 1, 0, 'C', 0);
            // $pdf->Cell(15, 6, 'Serie', 1, 0, 'C', 0);
            // $pdf->Cell(45, 6, 'Proveedor', 1, 0, 'C', 0);
            // $pdf->Cell(20, 6, 'Fecha', 1, 0, 'C', 0);
            // $pdf->Cell(20, 6, 'Valor', 1, 0, 'C', 0);
            // $pdf->Cell(15, 6, '-120', 1, 0, 'C', 0);
            // $pdf->Cell(15, 6, '-90', 1, 0, 'C', 0);
            // $pdf->Cell(15, 6, '-60', 1, 0, 'C', 0);
            // $pdf->Cell(15, 6, '-30', 1, 0, 'C', 0);
            // $pdf->Cell(15, 6, '0', 1, 0, 'C', 0);
            // $pdf->Cell(15, 6, '30', 1, 0, 'C', 0);
            // $pdf->Cell(15, 6, '60', 1, 0, 'C', 0);
            // $pdf->Cell(15, 6, '90', 1, 0, 'C', 0);
            // $pdf->Cell(15, 6, '120', 1, 0, 'C', 0);
            // $pdf->Cell(20, 6, 'Total', 1, 0, 'C', 0);
            // $pdf->Ln();
            $margin = 10;
            $height = $pdf->GetY();
            $height_products = $height +2;
            //$pdf->SetFillColor(141, 207, 140);
                    $pdf->SetXY($margin, $height_products);
                    $pdf->MultiCell(25, 6, utf8_decode('No. Doc'), 1, 'C', 0);
                    $pdf->SetXY(35, $height_products);
                    $pdf->MultiCell(60, 6, utf8_decode('Proveedor'), 1, 'C', 0);
                    $pdf->SetXY(95, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('Fecha'), 1, 'C', 0);
                    $pdf->SetXY(110, $height_products);
                    $pdf->MultiCell(20, 6, utf8_decode('Valor'), 1, 'C', 0);
                    $pdf->SetXY(130, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('-120'), 1, 'C', 0);
                    $pdf->SetXY(145, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('-90'), 1, 'C', 0);
                    $pdf->SetXY(160, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('-60'), 1, 'C', 0);
                    $pdf->SetXY(175, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('-30'), 1, 'C', 0);
                    $pdf->SetXY(190, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('0'), 1, 'C', 0);
                    $pdf->SetXY(205, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('30'), 1, 'C', 0);
                    $pdf->SetXY(220, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('60'), 1, 'C', 0);
                    $pdf->SetXY(235, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('90'), 1, 'C', 0);
                    $pdf->SetXY(250, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('120'), 1, 'C', 0);
                    $pdf->SetXY(265, $height_products);
                    $pdf->MultiCell(20, 6, utf8_decode('Total'), 1, 'C', 0);
                    //dd("X=".$margin."Y=".$height_products);
                    $y = $height_products + 8;
                    $pdf->SetFont('Helvetica', '', 4);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetXY($margin, $height_products+6);
                    $pdf->SetWidths(array(25, 60, 15, 20,15,15,15,15,15,15,15,15,15,20));
        }
        $id_fact="";
        $total_0=0;
        $total_30=0;
        $total_60=0;
        $total_90=0;
        $total_120=0;
        $total_neg30=0;
        $total_neg60=0;
        $total_neg90=0;
        $total_neg120=0;
        $total_fact=0;
        $suma_total_0=0;
        $suma_total_30=0;
        $suma_total_60=0;
        $suma_total_90=0;
        $suma_total_120=0;
        $suma_total_neg30=0;
        $suma_total_neg60=0;
        $suma_total_neg90=0;
        $suma_total_neg120=0;
        $total_0_ref=0;
        $total_30_ref=0;
        $total_60_ref=0;
        $total_90_ref=0;
        $total_120_ref=0;
        $total_neg30_ref=0;
        $total_neg60_ref=0;
        $total_neg90_ref=0;
        $total_neg120_ref=0;
        $total_ref=0;
        $total_referencia=0;
        $suma_total_0_ref=0;
        $suma_total_30_ref=0;
        $suma_total_60_ref=0;
        $suma_total_90_ref=0;
        $suma_total_120_ref=0;
        $suma_total_neg30_ref=0;
        $suma_total_neg60_ref=0;
        $suma_total_neg90_ref=0;
        $suma_total_neg120_ref=0;
        $total_saldo_ref=0;
        $total_abono_ref=0;
        //dd($datos);
        /*foreach ($referencia as $detail) {
            //$item++;
            $documento="";
            if(strlen($detail->observacion)==4){
                $documento= '00000'.''.$detail->observacion;
              }else if(strlen($detail->observacion)==3){
                $documento= '000000'.''.$detail->observacion;
              }else if(strlen($detail->observacion)==2){
                $documento= '0000000'.''.$detail->observacion;
              }else{
                $documento= '00000000'.''.$detail->observacion;
              }
            $nro_doc=substr($detail->observacion,8,9);
            $total_ref+=$detail->mencientoveinte+
                         $detail->mennoventa+
                         $detail->mensesenta+
                         $detail->mentreninta+
                         $detail->cero+
                         $detail->treninta+
                         $detail->sesenta+
                         $detail->noventa+
                         $detail->cientoveinte;
            $total_referencia=number_format($total_ref,2,".",",");
            $total_saldo_ref+=$total_ref;
            $pos = intval($nro_doc);
            $data = array(
                utf8_decode($pos."Centrado"),
                utf8_decode($detail->nombre_proveedor),
                date("d/m/Y", strtotime($detail->fcrea))."Centrado",
                number_format($detail->saldo,2,".",",")."Derecha",
                number_format($detail->mencientoveinte,2,".",",")."Derecha",
                number_format($detail->mennoventa,2,".",",")."Derecha",
                number_format($detail->mensesenta,2,".",",")."Derecha",
                number_format($detail->mentreninta,2,".",",")."Derecha",
                number_format($detail->cero,2,".",",")."Derecha",
                number_format($detail->treninta,2,".",",")."Derecha",
                number_format($detail->sesenta,2,".",",")."Derecha",
                number_format($detail->noventa,2,".",",")."Derecha",
                number_format($detail->cientoveinte,2,".",",")."Derecha",
                $total_referencia."Derecha",
                //utf8_decode('INMEDIATA'),
                
            );
            $total_ref=0;
            //$id_fact="";
            $total_referencia=0;
            $total_abono_ref+=$detail->saldo;
            $total_0_ref+=$detail->cero;
            $total_30_ref+=$detail->treninta;
            $total_60_ref+=$detail->sesenta;
            $total_90_ref+=$detail->noventa;
            $total_120_ref+=$detail->cientoveinte;
            $total_neg30_ref+=$detail->mentreninta;
            $total_neg60_ref+=$detail->mensesenta;
            $total_neg90_ref+=$detail->mennoventa;
            $total_neg120_ref+=$detail->mencientoveinte;
                //array_unshift($data, utf8_decode('* sin imagen'));
            //dd("Imagen:".$imagen.$detail->imagen);
            $pdf->RowCtas($data, $margin);
        }
        foreach ($datos as $detail) {
            $serie1=substr($detail->observacion,0,3);
            $serie2=substr($detail->observacion,3,3);
            $documento=substr($detail->observacion,6,15);
            $total_fact+=$detail->mencientoveinte+
                         $detail->mennoventa+
                         $detail->mensesenta+
                         $detail->mentreninta+
                         $detail->cero+
                         $detail->treninta+
                         $detail->sesenta+
                         $detail->noventa+
                         $detail->cientoveinte;
            $total_factura=number_format($total_fact,2,".",",");
            $total_saldo+=$total_fact;
            $nto_docu=intval($documento);
            $data = array(
                utf8_decode($nto_docu."Centrado"),
                utf8_decode($detail->nombre_proveedor),
                date("d/m/Y", strtotime($detail->fech_emision))."Centrado",
                number_format($detail->saldo,2,".",",")."Derecha",
                number_format($detail->mencientoveinte,2,".",",")."Derecha",
                number_format($detail->mennoventa,2,".",",")."Derecha",
                number_format($detail->mensesenta,2,".",",")."Derecha",
                number_format($detail->mentreninta,2,".",",")."Derecha",
                number_format($detail->cero,2,".",",")."Derecha",
                number_format($detail->treninta,2,".",",")."Derecha",
                number_format($detail->sesenta,2,".",",")."Derecha",
                number_format($detail->noventa,2,".",",")."Derecha",
                number_format($detail->cientoveinte,2,".",",")."Derecha",
                $total_factura."Derecha",
                //utf8_decode('INMEDIATA'),
                
            );
            $total_fact=0;
            //$id_fact="";
            $total_factura=0;
            $total_abono+=$detail->saldo;
            $total_0+=$detail->cero;
            $total_30+=$detail->treninta;
            $total_60+=$detail->sesenta;
            $total_90+=$detail->noventa;
            $total_120+=$detail->cientoveinte;
            $total_neg30+=$detail->mentreninta;
            $total_neg60+=$detail->mensesenta;
            $total_neg90+=$detail->mennoventa;
            $total_neg120+=$detail->mencientoveinte;
                
                //array_unshift($data, utf8_decode('* sin imagen'));
            //dd("Imagen:".$imagen.$detail->imagen);
            $pdf->RowCtas($data, $margin);
        }*/
        foreach($reporte_nuevo as $detail){
            if($detail->observacion){
                $serie1=substr($detail->observacion,0,3);
                $serie2=substr($detail->observacion,3,3);
                $documento=substr($detail->observacion,6,15);
            }else{
                if(strlen($detail->referencias)>10){
                    $serie1=substr($detail->referencias,0,3);
                    $serie2=substr($detail->referencias,4,3);
                    $documento=substr($detail->referencias,8,15);
                }else{
                    $documento=$detail->referencias;
                }
                
            }
            
            $total_fact+=$detail->mencientoveinte+
                         $detail->mennoventa+
                         $detail->mensesenta+
                         $detail->mentreninta+
                         $detail->cero+
                         $detail->treninta+
                         $detail->sesenta+
                         $detail->noventa+
                         $detail->cientoveinte;
            $total_factura=number_format($total_fact,2,".",",");
            $total_saldo+=$total_fact;
            $nto_docu=intval($documento);
            $data = array(
                utf8_decode($nto_docu."Centrado"),
                utf8_decode($detail->nombre),
                date("d/m/Y", strtotime($detail->fecha_emision))."Centrado",
                number_format($detail->saldo,2,".",",")."Derecha",
                number_format($detail->mencientoveinte,2,".",",")."Derecha",
                number_format($detail->mennoventa,2,".",",")."Derecha",
                number_format($detail->mensesenta,2,".",",")."Derecha",
                number_format($detail->mentreninta,2,".",",")."Derecha",
                number_format($detail->cero,2,".",",")."Derecha",
                number_format($detail->treninta,2,".",",")."Derecha",
                number_format($detail->sesenta,2,".",",")."Derecha",
                number_format($detail->noventa,2,".",",")."Derecha",
                number_format($detail->cientoveinte,2,".",",")."Derecha",
                $total_factura."Derecha",
                //utf8_decode('INMEDIATA'),
                
            );
            $total_fact=0;
            //$id_fact="";
            $total_factura=0;
            $total_abono+=$detail->saldo;
            $total_0+=$detail->cero;
            $total_30+=$detail->treninta;
            $total_60+=$detail->sesenta;
            $total_90+=$detail->noventa;
            $total_120+=$detail->cientoveinte;
            $total_neg30+=$detail->mentreninta;
            $total_neg60+=$detail->mensesenta;
            $total_neg90+=$detail->mennoventa;
            $total_neg120+=$detail->mencientoveinte;
                
                //array_unshift($data, utf8_decode('* sin imagen'));
            //dd("Imagen:".$imagen.$detail->imagen);
            $pdf->RowCtas($data, $margin);
        }
        // foreach($referencia as $detail){
        //     $pdf->SetX(10);
        //     $pdf->SetFillColor(240, 240, 240);
        //     $pdf->SetFont('Arial', '', 7);
        //     $documento="";
        //     if(strlen($detail->observacion)==4){
        //         $documento= '00000'.''.$detail->observacion;
        //       }else if(strlen($detail->observacion)==3){
        //         $documento= '000000'.''.$detail->observacion;
        //       }else if(strlen($detail->observacion)==2){
        //         $documento= '0000000'.''.$detail->observacion;
        //       }else{
        //         $documento= '00000000'.''.$detail->observacion;
        //       }
        //     //$pdf->Cell(10, 6, $detail->id_factura_compra, 1, 0, 'C', 0);
        //     //$id_fact=$detail->id_factura_compra;
        //     $pdf->Cell(20, 6, $documento, 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '001-001', 1, 0, 'C', 0);
        //     //$pdf->Cell(45, 6, utf8_decode($detail->nombre_proveedor), 1, 0, 'L', 0);
        //     if($pdf->GetStringWidth(utf8_decode($detail->nombre_proveedor))>45){
        //         $pdf->MultiCell(45, 3, utf8_decode($detail->nombre_proveedor), 1,'L');
        //         $head_prov=$pdf->GetX();
        //     }else{
        //         $pdf->Cell(45, 6, utf8_decode($detail->nombre_proveedor), 1, 0, 'L', 0);
        //     }
            
        //     //$pdf->SetX($head_prov);
        //     $pdf->Cell(20, 6, date("d/m/Y", strtotime($detail->fcrea)), 1, 0, 'C', 0);
        //     $pdf->Cell(20, 6, number_format($detail->saldo,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->mencientoveinte,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->mennoventa,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->mensesenta,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->mentreninta,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->cero,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->treninta,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->sesenta,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->noventa,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->cientoveinte,2,".",","), 1, 0, 'C', 0);
        //     $total_ref+=$detail->mencientoveinte+
        //                  $detail->mennoventa+
        //                  $detail->mensesenta+
        //                  $detail->mentreninta+
        //                  $detail->cero+
        //                  $detail->treninta+
        //                  $detail->sesenta+
        //                  $detail->noventa+
        //                  $detail->cientoveinte;
        //     $total_referencia=number_format($total_ref,2,".",",");
        //     $total_saldo_ref+=$total_ref;
        //     $pdf->Cell(20, 6,  $total_referencia, 1, 0, 'C', 0);
        //     $pdf->Ln();
        //     $total_ref=0;
        //     //$id_fact="";
        //     $total_referencia=0;
        //     $total_abono_ref+=$detail->saldo;
        //     $total_0_ref+=$detail->cero;
        //     $total_30_ref+=$detail->treninta;
        //     $total_60_ref+=$detail->sesenta;
        //     $total_90_ref+=$detail->noventa;
        //     $total_120_ref+=$detail->cientoveinte;
        //     $total_neg30_ref+=$detail->mentreninta;
        //     $total_neg60_ref+=$detail->mensesenta;
        //     $total_neg90_ref+=$detail->mennoventa;
        //     $total_neg120_ref+=$detail->mencientoveinte;
        // }
        // foreach($datos as $detail)
        // {
        //     $pdf->SetX(10);
        //     $pdf->SetFillColor(240, 240, 240);
        //     $pdf->SetFont('Arial', '', 7);
        //     $serie1=substr($detail->observacion,0,3);
        //     $serie2=substr($detail->observacion,3,3);
        //     $documento=substr($detail->observacion,6,15);
        //     //$pdf->Cell(10, 6, $detail->id_factura_compra, 1, 0, 'C', 0);
        //     $id_fact=$detail->id_factura_compra;
        //     $pdf->Cell(20, 6, $documento, 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, $serie1.'-'. $serie2, 1, 0, 'C', 0);
        //     $pdf->Cell(45, 6, utf8_decode($detail->nombre_proveedor), 1, 0, 'L', 0);
        //     $pdf->Cell(20, 6, date("d/m/Y", strtotime($detail->fech_emision)), 1, 0, 'C', 0);
        //     //$pdf->Cell(20, 6, number_format($detail->valor_cuota,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(20, 6, number_format($detail->saldo,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->mencientoveinte,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->mennoventa,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->mensesenta,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->mentreninta,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->cero,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->treninta,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->sesenta,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->noventa,2,".",","), 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, number_format($detail->cientoveinte,2,".",","), 1, 0, 'C', 0);
        //     $total_fact+=$detail->mencientoveinte+
        //                  $detail->mennoventa+
        //                  $detail->mensesenta+
        //                  $detail->mentreninta+
        //                  $detail->cero+
        //                  $detail->treninta+
        //                  $detail->sesenta+
        //                  $detail->noventa+
        //                  $detail->cientoveinte;
        //     $total_factura=number_format($total_fact,2,".",",");
        //     $total_saldo+=$total_fact;
        //     $pdf->Cell(20, 6,  $total_factura, 1, 0, 'C', 0);
        //     $pdf->Ln();
        //     $total_fact=0;
        //     //$id_fact="";
        //     $total_factura=0;
        //     $total_abono+=$detail->saldo;
        //     $total_0+=$detail->cero;
        //     $total_30+=$detail->treninta;
        //     $total_60+=$detail->sesenta;
        //     $total_90+=$detail->noventa;
        //     $total_120+=$detail->cientoveinte;
        //     $total_neg30+=$detail->mentreninta;
        //     $total_neg60+=$detail->mensesenta;
        //     $total_neg90+=$detail->mennoventa;
        //     $total_neg120+=$detail->mencientoveinte;
        //     /*$pdf->Cell(15, 6, '', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '0', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '', 1, 0, 'C', 0);
        //     $pdf->Cell(15, 6, '', 1, 0, 'C', 0);
        //     $pdf->Cell(20, 6, '', 1, 0, 'C', 0);
        //     $pdf->Ln();*/
            
        // }
        
            $sumatot_abono=number_format($total_abono+$total_abono_ref,2,".",",");
            $sumatot_factura=number_format($total_saldo+$total_saldo_ref,2,".",",");
            $suma_total_0=number_format($total_0+$total_0_ref,2,".",",");
            $suma_total_30=number_format($total_30+$total_30_ref,2,".",",");
            $suma_total_60=number_format($total_60+$total_60_ref,2,".",",");
            $suma_total_90=number_format($total_90+$total_90_ref,2,".",",");
            $suma_total_120=number_format($total_120+$total_120_ref,2,".",",");
            $suma_total_neg30=number_format($total_neg30+$total_neg30_ref,2,".",",");
            $suma_total_neg60=number_format($total_neg60+$total_neg60_ref,2,".",",");
            $suma_total_neg90=number_format($total_neg90+$total_neg90_ref,2,".",",");
            $suma_total_neg120=number_format($total_neg120+$total_neg120_ref,2,".",",");
            $pdf->SetX(10);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(100, 6, 'Total', 0, 0, 'C', 0);
            $pdf->Cell(20, 6, $sumatot_abono, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_neg120, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_neg90, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_neg60, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_neg30, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_0, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_30, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_60, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_90, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_120, 0, 0, 'R', 0);
            $pdf->Cell(20, 6, $sumatot_factura, 0, 0, 'R', 0);
            //$pdf->Output("cuenta_por_pagar_Dias_Vencimiento.pdf", "D");
            if($ruta==null){
                $pdf->Output("cuenta_por_pagar_Dias_Vencimiento.pdf", "D");
            }else{
                $pdf->Output($ruta.'/'."cuenta_por_pagar_Dias_Vencimiento.pdf", "F");
            }
    }
    public function cuenta_pagar_reporte_anticipo($clientes, $anticipos, $fec_ini, $fec_fin, $pagos_anticipo,$empresa,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        //$pdf->SetAutoPageBreak(true,5);
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);
        
        //$pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        $pdf->Cell(155, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('CUENTAS POR PAGAR'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode('Anticipo'), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        /*if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {*/
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        /*} else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }*/
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $pdf->Ln();
        $head_id_prov=0;
        foreach($clientes as $detail){
            $pdf->SetX(10);
            $pdf->SetFillColor(255, 255, 255);
            $pdf->SetFont('Arial', 'B', 8);
            /*$pdf->Cell(15, 6, $detail->codigo, 0, 0, 'C', 0);
            $pdf->Cell(25, 6, 'IDENTIFICACION', 0, 0, 'C', 0);
            $pdf->Cell(25, 6, $detail->identificacion, 0, 0, 'R', 0);
            $pdf->Cell(75, 6, utf8_decode($detail->nombre), 0, 0, 'L', 0);*/
            $head_id_prov=$pdf->GetY();
            //array_push($array_totales_fact,$head_id_prov.'Cleinte'.$detail->codigo);
                                // if($head_id_prov>190){
                                //     $otro_valor_prov=$pdf->GetPageHeight()-$head_id_prov;
                                //     $pdf->SetAutoPageBreak(true,$otro_valor_prov);
                                // }
            $pdf->MultiCell(190, 4, $detail->codigo."   CI/RUC:   ".$detail->identificacion."   PROVEEDOR:   ".utf8_decode($detail->nombre).utf8_decode("   TELEFONO:   ".$detail->telefono).utf8_decode("   CONTACTO:   ".$detail->contacto), 0,'L', 0);
            $pdf->Ln(2);
            $pdf->Cell(190, 5, 'ANTICIPOS', 0, 2, 'C', 0);
            $array_head=[];
                            $pdf->SetX(10);
                            $pdf->SetFillColor(2255, 2255, 2255);
                            $pdf->SetFont('Arial', 'B', 8);
                            $head_cab=$pdf->GetY();
                            
                            
                            //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                            $pdf->Cell(19, 6, 'Fecha', 1, 0, 'C', 0);
                           
                            $pdf->Cell(58, 6, 'Nro Cheque', 1, 0, 'C', 0);
                            $pdf->Cell(82, 6, 'Forma Pago', 1, 0, 'C', 0);
                            //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                            //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
                            $pdf->Cell(31, 6, 'Valor', 1, 0, 'C', 0);
                            //$pdf->Cell(35, 6, 'Saldos', 1, 0, 'C', 1);
                            $pdf->Ln();
                            
                            $pdf->SetX(10);
                            $total_anticipo=0;
                            foreach($anticipos as $detail2){
                                if($detail->id_cliente==$detail2->id_cliente){
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(255, 255, 255);
                                    $pdf->SetFont('Arial', '', 7);
            
                                    
                                    
                                    //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                                    $pdf->Cell(19, 6, date("d/m/Y", strtotime($detail2->fecha_anticipo)), 1, 0, 'C', 1);
                                
                                    $pdf->Cell(58, 6, utf8_decode($detail2->numero_transaccion), 1, 0, 'C', 1);
                                    $pdf->Cell(82, 6, utf8_decode($detail2->descripcion_fp), 1, 0, 'L', 1);
                                    //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                                    //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
                                    $pdf->Cell(31, 6, number_format($detail2->valor_cuota,2,".",","), 1, 0, 'R', 1);
                                    //$pdf->Cell(35, 6, 'Saldos', 1, 0, 'C', 1);
                                    $pdf->Ln();
                                    $total_anticipo+=$detail2->valor_cuota;
                                }
                                
                            }
                            $pdf->SetX(10);
                            $pdf->SetFillColor(2255, 2255, 2255);
                            $pdf->SetFont('Arial', 'B', 7);
                            $pdf->Cell(159, 6, 'Total', 'T', 0, 'C', 1);
                            $pdf->Cell(31, 6, number_format($total_anticipo,2,".",","), 'T', 1, 'R', 1);
                            $pdf->Ln(2);
                            $exist_pagos=0;
                            $total_pagos=0;
                            foreach($pagos_anticipo as $detail3){
                                if($detail->id_cliente==$detail3->id_cliente){
                                    $exist_pagos++;
                                    if($exist_pagos==1){
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 8);
                                        $pdf->Cell(190, 5, 'PAGOS', 0, 2, 'C', 0);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 8);
                                        $pdf->Cell(19, 6, 'Fecha', 1, 0, 'C', 0);
                           
                                        $pdf->Cell(58, 6, 'Nro Comprobante', 1, 0, 'C', 0);
                                        $pdf->Cell(82, 6, 'Forma Pago', 1, 0, 'C', 0);
                                        //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                                        //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
                                        $pdf->Cell(31, 6, 'Valor', 1, 0, 'C', 0);
                                        $pdf->Ln();
                                    }
                                    
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(2255, 2255, 2255);
                                    $pdf->SetFont('Arial', '', 7);
									if($detail3->pago_anticipo!==null){
										$documento=$detail3->descripcion;
									}else{
										$serie1=substr($detail3->descripcion,0,3);
										$serie2=substr($detail3->descripcion,3,3);
										$documento0=substr($detail3->descripcion,6,9);
                                        $documento=$serie1."-".$serie2."-".$documento0;
									}
                                    
                                    //$pdf->Cell(31, 6, $documento, 1, 0, 'C', 1);
                                    
                                    //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                                    $pdf->Cell(19, 6, date("d/m/Y", strtotime($detail3->fecha_emision)), 1, 0, 'C', 1);
									if($detail3->pago_anticipo!==null){
										$pdf->Cell(58, 6, $documento, 1, 0, 'C', 1);
										$pdf->Cell(82, 6, 'CIERRE ANTICIPO', 1, 0, 'C', 1);
									}else{
										$pdf->Cell(58, 6, $documento, 1, 0, 'C', 1);
										$pdf->Cell(82, 6, 'ANTICIPO', 1, 0, 'C', 1);
									}
                                    //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                                    //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
                                    $pdf->Cell(31, 6, number_format($detail3->total_pago_ant,2,".",","), 1, 0, 'R', 1);
                                    //$pdf->Cell(35, 6, 'Saldos', 1, 0, 'C', 1);
                                    $pdf->Ln();
                                    $total_pagos+=$detail3->total_pago_ant;
                                }
                                
                            }
                            if($exist_pagos>0){
                                $pdf->SetX(10);
                                $pdf->SetFillColor(2255, 2255, 2255);
                                $pdf->SetFont('Arial', 'B', 7);
                                $pdf->Cell(159, 6, 'Total', 'T', 0, 'C', 1);
                                $pdf->Cell(31, 6, number_format($total_pagos,2,".",","), 'T', 1, 'R', 1);
                                $pdf->Ln(2);
                            }
                                $pdf->SetX(10);
                                $pdf->SetFillColor(2255, 2255, 2255);
                                $pdf->SetFont('Arial', 'B', 8);
                                $pdf->Cell(159, 6, 'TOTAL DEUDA', 0, 0, 'C', 1);
                                $pdf->Cell(31, 6, number_format($total_anticipo-$total_pagos,2,".",","), 0, 1, 'R', 1);
                                $pdf->Ln(2);

        }
        if($ruta==null){
            $pdf->Output("cuenta_por_pagar_Anticipo.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."cuenta_por_pagar_Anticipo.pdf", "F");
        }
    }
    public function Proveedor($datos,$fec_ini, $fec_fin){
        $pdf = new FPDF('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $pdf->AddPage();
        $pdf->AliasNbPages();

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        //$pdf->Image('../server/' . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo, null, null, 65, 25);
        $logo = constant("DATA_EMPRESA") . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if ($datos[0]->logo!==null && file_exists($logo)) {
            $pdf->Image($logo, 11, 12, 48, 17);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(60, 10);
        $pdf->Cell(105, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(105, 8, utf8_decode('Proveedor'), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 8);
        //$pdf->Cell(10, 6, 'No. Factura', 1, 0, 'C', 0);
        $pdf->Cell(20, 6, 'Codigo', 1, 0, 'C', 0);
        $pdf->Cell(25, 6, 'Identificacion', 1, 0, 'C', 0);
        $pdf->Cell(50, 6, 'Proveedor', 1, 0, 'C', 0);
        $pdf->Cell(25, 6, 'Provincia', 1, 0, 'C', 0);
        $pdf->Cell(25, 6, 'Ciudad', 1, 0, 'C', 0);
        $pdf->Cell(45, 6, 'Direccion', 1, 0, 'C', 0);
        /*$pdf->Cell(15, 6, '-120', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '-90', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '-60', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '-30', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '0', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '30', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '60', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '90', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '120', 1, 0, 'C', 0);
        $pdf->Cell(20, 6, 'Total', 1, 0, 'C', 0);*/
        $pdf->Ln();
        foreach($datos as $detail){
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', '', 7);
            $pdf->Cell(20, 6, $detail->cod_proveedor, 1, 0, 'C', 0);
            $pdf->Cell(25, 6, $detail->identif_proveedor, 1, 0, 'C', 0);
            $pdf->Cell(50, 6, $detail->nombre_proveedor, 1, 0, 'L', 0);
            $pdf->Cell(25, 6, $detail->provincia, 1, 0, 'C', 0);
            $pdf->Cell(25, 6, $detail->ciudad, 1, 0, 'C', 0);
            $pdf->Cell(45, 6, $detail->direccion_prov, 1, 0, 'C', 0);
            $pdf->Ln();
        }

        $pdf->OutPut("proveedor.pdf","D");
    }
    public function  Produccion_Pdf($proceso_produccion,$proceso_ingrediente, $proceso_producir,$empresa){
        $fecha_actual = date("d/m/Y");
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        //$pdf->SetAutoPageBreak(true,5);
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);
        $width = $pdf->GetPageWidth();
        //$pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        $pdf->Cell(155, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Proceso Produccion'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        //$pdf->Cell(155, 4, utf8_decode('Anticipo'), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        /*if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {*/
            $fec_desde = date("d/m/Y", strtotime($proceso_produccion[0]->fecha_inicio));
            $fec_hasta = date("d/m/Y", strtotime($proceso_produccion[0]->fecha_fin));
        /*} else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }*/
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $pdf->Ln();
        $height = $pdf->GetY();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell($width / 4, 5, utf8_decode('NUM ORDEN:'), 0, 2, 'L', 0);
        $pdf->Cell($width / 4, 5, utf8_decode('DESCRIPCION:'), 0, 2, 'L', 0);
        $head_cliente=$pdf->GetY();
        $pdf->SetXY($width / 2, $height);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell($width / 4, 5, utf8_decode('PROYECTO:'), 0, 2, 'L', 0);
        $pdf->Cell($width / 4, 5, utf8_decode('BODEGA:'), 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) , $height);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell($width / 4, 5, $proceso_produccion[0]->num_orden, 0, 2, 'L', 0);
        if($pdf->GetStringWidth(utf8_decode($proceso_produccion[0]->detalle))>70){
            $pdf->MultiCell(76, 3, utf8_decode($proceso_produccion[0]->detalle), 0,'L', 0);
            $head_cli=$pdf->GetY();
        }else{
            $pdf->Cell(70, 5, utf8_decode($proceso_produccion[0]->detalle), 0, 2, 'L', 0);
        }
        $pdf->SetXY(($width / 6 * 4) - 15, $height);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell($width / 4, 5, utf8_decode($proceso_produccion[0]->descripcion_proyecto), 0, 2, 'L', 0);
        $pdf->Cell($width / 4, 5, utf8_decode($proceso_producir[0]->nombre_bodega) , 0, 2, 'L', 0);
        //$pdf->MultiCell(190, 4,"NUM ORDEN: " .$proceso_produccion[0]->num_orden."   DESCRIPCION:   ".utf8_decode($proceso_produccion[0]->detalle)."   PROYECTO:   ".utf8_decode($proceso_produccion[0]->descripcion_proyecto).utf8_decode("   BODEGA:   ".$proceso_producir[0]->nombre_bodega), 0,'L', 0);
        $pdf->Ln(2);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->SetX(10);
        $pdf->Cell(190, 5, 'Productos a Producir', 0, 2, 'C', 0);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $margin = 10;
            $height = $pdf->GetY();
            $height_products = $height +2;
            //$pdf->SetFillColor(141, 207, 140);
                    $pdf->SetXY($margin, $height_products);
                    $pdf->MultiCell(25, 6, utf8_decode('Codigo'), 1, 'C', 0);
                    $pdf->SetXY(35, $height_products);
                    $pdf->MultiCell(60, 6, utf8_decode('Producto'), 1, 'C', 0);
                    $pdf->SetXY(95, $height_products);
                    $pdf->MultiCell(35, 6, utf8_decode('Formula'), 1, 'C', 0);
                    $pdf->SetXY(130, $height_products);
                    $pdf->MultiCell(20, 6, utf8_decode('Cantidad'), 1, 'C', 0);
                    $pdf->SetXY(150, $height_products);
                    $pdf->MultiCell(25, 6, utf8_decode('Costo Unitario'), 1, 'C', 0);
                    $pdf->SetXY(175, $height_products);
                    $pdf->MultiCell(25, 6, utf8_decode('Total'), 1, 'C', 0);
                    $pdf->SetXY($margin, $height_products+6);
                    $pdf->SetWidths(array(25,60,35,20,25,25));
        $total_cant_producir=0;
        $total_cost_producir=0;
        $total_costtoal_producir=0;
        foreach($proceso_producir as $detail){
            $total_cant_producir+=$detail->cantidad;
            $total_cost_producir+=$detail->costo_unitario;
            $total_costtoal_producir+=$detail->costo_total;
            $data=array(
                $detail->cod_alterno!==null?utf8_decode($detail->cod_alterno):utf8_decode($detail->cod_principal),
                utf8_decode($detail->nombre),
                utf8_decode($detail->nombre_formula),
                $detail->cantidad."Centrado",
                number_format($detail->costo_unitario,4,".",",")."Derecha",
                number_format($detail->costo_total,4,".",",")."Derecha"
            );
            $pdf->RowProduccion($data, $margin);
        }
        $y_producir=$pdf->GetY();
        $pdf->SetXY(10,$y_producir);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(120, 8, utf8_decode('Total'), 0, 0, 'C', 0);
        $pdf->Cell(20, 8, $total_cant_producir, 0, 0, 'C', 0);
        $pdf->Cell(25, 8, number_format($total_cost_producir,4,".",","), 0, 0, 'R', 0);
        $pdf->Cell(25, 8, number_format($total_costtoal_producir,4,".",","), 0, 1, 'R', 0);
        $pdf->Ln(5);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(190, 5, 'Ingredientes Usados en Produccion', 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 8);
        $margin = 10;
            $height = $pdf->GetY();
            $height_products = $height +2;
            //$pdf->SetFillColor(141, 207, 140);
                    $pdf->SetXY($margin, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('Codigo'), 1, 'C', 0);
                    $pdf->SetXY(25, $height_products);
                    $pdf->MultiCell(40, 6, utf8_decode('Producto'), 1, 'C', 0);
                    $pdf->SetXY(65, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('Proyecto'), 1, 'C', 0);
                    $pdf->SetXY(80, $height_products);
                    $pdf->MultiCell(20, 6, utf8_decode('Bodega'), 1, 'C', 0);
                    $pdf->SetXY(100, $height_products);
                    $pdf->MultiCell(18.3, 3, utf8_decode('Cantidad Orden'), 1, 'C', 0);
                    $pdf->SetXY(118.3, $height_products);
                    $pdf->MultiCell(18.3, 3, utf8_decode('Cantidad Proceso'), 1, 'C', 0);
                    $pdf->SetXY(136.6, $height_products);
                    $pdf->MultiCell(18.3, 3, utf8_decode('Cantidad Total'), 1, 'C', 0);
                    $pdf->SetXY(154.9, $height_products);
                    $pdf->MultiCell(25, 6, utf8_decode('Costo Unitario'), 1, 'C', 0);
                    $pdf->SetXY(179.9, $height_products);
                    $pdf->MultiCell(20, 6, utf8_decode('Total'), 1, 'C', 0);
                    $pdf->SetXY($margin, $height_products+6);
                    $pdf->SetWidths(array(15,40,15,20,18.3,18.3,18.3,25,20));
        $total_cantorden_ingrediente=0;
        $total_cantprod_ingrediente=0;
        $total_cantliq_ingrediente=0;
        $total_cost_ingrediente=0;
        $total_costtoal_ingrediente=0;
        foreach($proceso_ingrediente as $detail){
                $total_cantorden_ingrediente+=$detail->cantidad_orden;
                $total_cantprod_ingrediente+=$detail->cantidad_produccion;
                $total_cantliq_ingrediente+=$detail->cantidad_liquidacion;
                $total_cost_ingrediente+=$detail->costo_unitario_liquidacion;
                $total_costtoal_ingrediente+=$detail->cantidad_liquidacion*$detail->costo_unitario_liquidacion;
                $data=array(
                    $detail->cod_alterno!==null?utf8_decode($detail->cod_alterno):utf8_decode($detail->cod_principal),
                    utf8_decode($detail->nombre),
                    utf8_decode($detail->proyecto),
                    utf8_decode($detail->bodega),
                    $detail->cantidad_orden."Centrado",
                    $detail->cantidad_produccion."Centrado",
                    $detail->cantidad_liquidacion."Centrado",
                    number_format($detail->costo_unitario_liquidacion,4,".",",")."Derecha",
                    number_format($detail->cantidad_liquidacion*$detail->costo_unitario_liquidacion,4,".",",")."Derecha"
                );
                $pdf->RowProduccion($data, $margin);
        }
        $y_ingrediente=$pdf->GetY();
        $pdf->SetXY(10,$y_ingrediente);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(85, 8, utf8_decode('Total'), 0, 0, 'C', 0);
        $pdf->Cell(18.3, 8, $total_cantorden_ingrediente, 0, 0, 'C', 0);
        $pdf->Cell(18.3, 8, $total_cantprod_ingrediente, 0, 0, 'C', 0);
        $pdf->Cell(18.3, 8, $total_cantliq_ingrediente, 0, 0, 'C', 0);
        $pdf->Cell(25, 8, number_format($total_cost_ingrediente,4,".",","), 0, 0, 'R', 0);
        $pdf->Cell(25, 8, number_format($total_costtoal_ingrediente,4,".",","), 0, 1, 'R', 0);
        $pdf->Ln(5);
        $pdf->Output("proceso_produccion.pdf", "D");
    }
    public function balanceComprobacion($datos, $fec_ini, $fec_fin)
    {
        $pdf = new FPDF('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $pdf->AddPage();
        $pdf->AliasNbPages();

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        //$pdf->Image('../server/' . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo, null, null, 65, 25);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(60, 10);
        $pdf->Cell(105, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(105, 8, utf8_decode('BALANCE DE COMPROBACIÃN'), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);

        //HEADER FOR TABLE
        $pdf->SetY(30);
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(15, 6, 'CODIGO', 'TB', 0, 'C', 1);
        $pdf->Cell(85, 6, 'CUENTA', 'TB', 0, 'C', 1);
        $pdf->Cell(25, 6, 'SALDO ANTERIOR', 'TB', 0, 'C', 1);
        $pdf->Cell(20, 6, 'DEBE', 'TB', 0, 'C', 1);
        $pdf->Cell(20, 6, 'HABER', 'TB', 0, 'C', 1);
        $pdf->Cell(25, 6, 'SALDO ACTUAL', 'TB', 0, 'C', 1);
        $pdf->Ln();

        //fill cells
        $tsant = 0;
        $tdebe = 0;
        $thaber = 0;
        $tsactual = 0;
        $pdf->SetFont('Arial', '', 7);

        foreach ($datos as $detail) {
            $pdf->Cell(15, 4, $detail->codcta, 0, 0, 'L', 1);
            $pdf->Cell(85, 4, $detail->nomcta, 0, 0, 'L', 1);
            $pdf->Cell(25, 4, $detail->debe, 0, 0, 'R', 1);
            $pdf->Cell(20, 4, $detail->debe, 0, 0, 'R', 1);
            $pdf->Cell(20, 4, $detail->haber, 0, 0, 'R', 1);
            $pdf->Cell(25, 4, $detail->haber, 0, 0, 'R', 1);
            $pdf->Ln();
            $tsant = $detail->debe + $tsant;
            $tdebe = $detail->debe + $tdebe;
            $thaber = $detail->haber + $thaber;
            $tsactual = $detail->haber + $tsactual;
        }

        //footer
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(100, 6, 'TOTAL:', 'T', 0, 'R', 1);
        $pdf->Cell(25, 6, $tsant, 'T', 0, 'R', 1);
        $pdf->Cell(20, 6, $tdebe, 'T', 0, 'R', 1);
        $pdf->Cell(20, 6, $thaber, 'T', 0, 'R', 1);
        $pdf->Cell(25, 6, $tsactual, 'T', 0, 'R', 1);

        $pdf->Output("ejemplo.pdf", "D");
    }
    public function Producto($datos, $empresa)
    {
        setlocale(LC_TIME, "spanish");
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $width = $pdf->GetPageWidth();
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $url=constant("DATA_EMPRESA");
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa.'/imagen/'.$empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            $pdf->Image($logo,  12, 11, 40, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(0, 0, 0);
        }
        
        $pdf->Image($url.'/'.$empresa->id_empresa.'/imagen/'.$empresa->logo, 12, 11, 40, 18);
        $pdf->SetFont('Arial', 'B', 14);
        $head_emp=0;
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>110){
            $pdf->SetXY(48, 12);
            $pdf->MultiCell(111,4,utf8_decode($empresa->nombre_empresa),0,'C');
            $head_emp=$pdf->GetY();
         }else{
             $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)) / 2), 12);
             $pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)), 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
             $head_emp=$pdf->GetY()-1;
         }
        //$pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)) / 2), 12);
        //$pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)), 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Productos')) / 2), $head_emp-2);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode('Productos')), 8,utf8_decode('Productos'), 0, 2, 'C', 0);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth('') / 2), 22);
        $pdf->Cell($pdf->GetStringWidth(''), 8, '', 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        
        $pdf->SetXY(($width / 6) * 4.5, 11.5);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "Fecha:", 0, 2, 'L', 0);
        //$pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) * 5, 11.5);
        // $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        //if ($fecha_ini != null) {
            //$fec_desde = date("d/m/Y", strtotime($datos[0]->fecha_reguistro));
            //$fec_hasta = date("d/m/Y", strtotime($datos[0]->fecha_conciliacion));
        //}
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($fecha_actual), 5, $fecha_actual, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_desde), 5, $fec_desde, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_hasta), 5, $fec_hasta, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($pdf->PageNo() . ' de {nb}'), 5, $pdf->PageNo() . ' de {nb}' , 0, 2, 'L', 0);
        $pdf->Ln(7);
        $margin = 10;
        $height = $pdf->GetY();
        $height_products = $height + 15;
        $pdf->SetFillColor(141, 207, 140);
                $pdf->SetXY($margin, $height_products);
                $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                $pdf->SetXY(35, $height_products);
                $pdf->MultiCell(15, 8, utf8_decode('CODIGO'), 1, 'C', 1);
                $pdf->SetXY(50, $height_products);
                $pdf->MultiCell(15, 8, utf8_decode('ID'), 1, 'C', 1);
                $pdf->SetXY(65, $height_products);
                $pdf->MultiCell(135, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                //dd("X=".$margin."Y=".$height_products);
                $y = $height_products + 8;
                $pdf->SetFont('Helvetica', '', 4);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(25, 15, 15, 135));
                $imagen=constant("DATA_EMPRESA") . $empresa->id_empresa .'/productos/';
                //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                $sub_total=0;
                $descuento=0;
                $iva=0;
                $total_fact=0;
                $suma_sub_total=0;
                $suma_descuento=0;
                $suma_iva=0;
                $suma_total_fact=0;
                foreach ($datos as $detail) {
                    $data = array(
                        utf8_decode(trim($detail->cod_principal)."Centrado"),
                        utf8_decode(trim($detail->id_producto)."Centrado"),
                        utf8_decode(trim($detail->nombre)."Centrado"),       
                     );
                    
                    if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                    //if ($detail->imagen) {
                        //dd($pdf->GetY());
                        
                            try{
                                array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                            }catch(Exception $e){
                                array_unshift($data, utf8_decode('pdf sin imagen - '.$detail->imagen."Centrado"));
                            }
                                
                            
                        
                        
                    } else {
                        if($detail->imagen){
                            array_unshift($data, utf8_decode('* sin imagen desde producto - '.$detail->imagen."Centrado"));
                        }else{
                            array_unshift($data, utf8_decode("no existe imagen"."Centrado"));
                        }
                       
                    }

                    //dd("Imagen:".$imagen.$detail->imagen);
                    $pdf->RowProducts($data, $margin+10);
                    $head_table=$pdf->GetY();
                }
                $pdf->Output('productos.pdf', "D");
    }
    public function PDFCheque($empresa,$ctas){
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $pdf->AddPage();
        $pdf->AliasNbPages();
        //if(preg_match('/grupo solis/i', $empresa->nombre_empresa)){
        //if($empresa->id_empresa==1){
            if($ctas->cheque=='Pichincha'){
                $imagen=$_SERVER['DOCUMENT_ROOT'] . '/images/cheque grupo solis.PNG';
                $info = getimagesize($imagen);
                //dd("Ancho: " .$width." Alto: " .$height);
                $ancho=$pdf->GetPageWidth()-63;
                $alto=74;
                //dd($info);COMERCIO Y REPRESENTACIONES GLOBALES COREGLO CIA. LTDA.
                //$pdf->Image($imagen, 0, 0, $ancho, $alto);
                $pdf->SetFont('Helvetica', '', 10);
                $pdf->SetXY(18,18);
                if($pdf->GetStringWidth(utf8_decode($ctas->beneficiario))>86){
                    $pdf->SetFont('Helvetica', '', 7);
                    $pdf->MultiCell(86,4,strtoupper(utf8_decode($ctas->beneficiario)),0,'L');
                    $pdf->SetFont('Helvetica', '', 10);
                }else{
                    $pdf->Cell(86,4,strtoupper(utf8_decode($ctas->beneficiario)),0,1,'L');
                }
                $pdf->SetXY(117,18);
                $pdf->Cell(86,4,number_format($ctas->valor_real_pago,2,".",","),0,1,'L');
                $pdf->SetXY(18,25);
                $nro_letra=new Numero_Letra();
                $valor_pago=$nro_letra->convertir($ctas->valor_real_pago);
                $pdf->MultiCell(125,6,$valor_pago,0,'L');
                $pdf->SetXY(15,38);
                if($ctas->fecha_registro){
                    $pdf->Cell(86,4,strtoupper($empresa->nombre_ciudad).", ".date("Y-m-d", strtotime($ctas->fecha_registro)),0,1,'L');
                }else{
                    $pdf->Cell(86,4,strtoupper($empresa->nombre_ciudad).", ".date("Y-m-d", strtotime($ctas->fecha_pago)),0,1,'L');
                }
            }else{
                if($ctas->cheque=='Internacional'){
                    $imagen=$_SERVER['DOCUMENT_ROOT'] . '/images/cheque banco intencional.PNG';
                    $info = getimagesize($imagen);
                    //dd("Ancho: " .$width." Alto: " .$height);
                    $ancho=$pdf->GetPageWidth()-63;
                    $alto=74;
                    //dd($info);COMERCIO Y REPRESENTACIONES GLOBALES COREGLO CIA. LTDA.
                    //$pdf->Image($imagen, 0, 0, $ancho, $alto);
                    $pdf->SetFont('Helvetica', '', 10);
                    $pdf->SetXY(15,18);
                    if($pdf->GetStringWidth(utf8_decode($ctas->beneficiario))>80){
                        $pdf->SetFont('Helvetica', '', 7);
                        $pdf->MultiCell(80,4,strtoupper(utf8_decode($ctas->beneficiario)),0,'L');
                        $pdf->SetFont('Helvetica', '', 10);
                    }else{
                        $pdf->SetXY(15,21);
                        $pdf->Cell(80,4,strtoupper(utf8_decode($ctas->beneficiario)),0,1,'L');
                    }
                    $pdf->SetXY(113,21);
                    $pdf->Cell(86,4,number_format($ctas->valor_real_pago,2,".",","),0,1,'L');
                    $pdf->SetXY(15,26);
                    $nro_letra=new Numero_Letra();
                    $valor_pago=$nro_letra->convertir($ctas->valor_real_pago);
                    $pdf->MultiCell(125,6,$valor_pago,0,'L');
                    $pdf->SetXY(5,38);
                    if($ctas->fecha_registro){
                        $pdf->Cell(86,4,strtoupper($empresa->nombre_ciudad).", ".date("Y-m-d", strtotime($ctas->fecha_registro)),0,1,'L');
                    }else{
                        $pdf->Cell(86,4,strtoupper($empresa->nombre_ciudad).", ".date("Y-m-d", strtotime($ctas->fecha_pago)),0,1,'L');
                    }
                }else{
                    //$imagen=$_SERVER['DOCUMENT_ROOT'] . '/images/cheque produbanco.png';
                    $info = getimagesize($imagen);
                    //dd("Ancho: " .$width." Alto: " .$height);
                    $ancho=$pdf->GetPageWidth()-63;
                    $alto=74;
                    //dd($info);COMERCIO Y REPRESENTACIONES GLOBALES COREGLO CIA. LTDA.
                    //$pdf->Image($imagen, 0, 0, $ancho, $alto);
                    $pdf->SetFont('Helvetica', '', 10);
                    $pdf->SetXY(19,18);
                    if($pdf->GetStringWidth(utf8_decode($ctas->beneficiario))>80){
                        $pdf->SetFont('Helvetica', '', 7);
                        $pdf->MultiCell(80,4,strtoupper(utf8_decode($ctas->beneficiario)),0,'L');
                        $pdf->SetFont('Helvetica', '', 10);
                    }else{
                        $pdf->SetXY(19,21);
                        $pdf->Cell(80,4,strtoupper(utf8_decode($ctas->beneficiario)),0,1,'L');
                    }
                    $pdf->SetXY(123,21);
                    $pdf->Cell(86,4,number_format($ctas->valor_real_pago,2,".",","),0,1,'L');
                    $pdf->SetXY(19,26);
                    $nro_letra=new Numero_Letra();
                    $valor_pago=$nro_letra->convertir($ctas->valor_real_pago);
                    $pdf->MultiCell(125,6,$valor_pago,0,'L');
                    $pdf->SetXY(14,38);
                    if($ctas->fecha_registro){
                        $pdf->Cell(86,4,strtoupper($empresa->nombre_ciudad).", ".date("Y-m-d", strtotime($ctas->fecha_registro)),0,1,'L');
                    }else{
                        $pdf->Cell(86,4,strtoupper($empresa->nombre_ciudad).", ".date("Y-m-d", strtotime($ctas->fecha_pago)),0,1,'L');
                    }
                }
                
            }
            
            
            return $pdf->Output("cheque.pdf", "D");
        //}
    }
    public function PDFChequeAsiento($detalle){
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        
        $pdf->AddPage();
        
        $pdf->AliasNbPages();
        
        $ancho=$pdf->GetPageWidth()-63;
        $alto=74;
        //dd($detalle);
        $pdf->SetFont('Helvetica', '', 10); 
        $contador=0;
        $array=[];
        foreach($detalle as $detail){
            $contador++;
            if($detail->cheque=='Pichincha'){
                $imagen=$_SERVER['DOCUMENT_ROOT'] . '/images/cheque grupo solis.PNG';
                //$pdf->Image($imagen, 0, 0, $ancho, $alto);
                
                $pdf->SetXY(18,18);
                if($pdf->GetStringWidth(utf8_decode($detail->razon_social))>86){
                    $pdf->SetFont('Helvetica', '', 7);
                    $pdf->MultiCell(86,4,strtoupper(utf8_decode($detail->razon_social)),0,'L');
                    $pdf->SetFont('Helvetica', '', 10);
                }else{
                    $pdf->Cell(86,4,strtoupper(utf8_decode($detail->razon_social)),0,1,'L');
                }
                //$pdf->AddPage();
                $pdf->SetXY(117,18);
                $pdf->Cell(86,4,number_format($detail->haber,2,".",","),0,1,'L');
                $nro_letra=new Numero_Letra();
                $valor_pago=$nro_letra->convertir($detail->haber);
                $pdf->SetXY(18,25);
                $pdf->MultiCell(125,6,$valor_pago,0,'L');
                $pdf->SetXY(15,38);
                $pdf->Cell(86,4,strtoupper($detail->ciudad).", ".date("Y-m-d", strtotime($detail->fecha_de_pago)),0,1,'L');
                $pdf->Ln(20);
                array_push($array,$contador);
                if(count($detalle)>$contador){
                    $pdf->AddPage();
                }
            }else{
                if($detail->cheque=='Internacional'){
                    $pdf->SetFont('Helvetica', '', 10);
                    $pdf->SetXY(15,18);
                    if($pdf->GetStringWidth(utf8_decode($detail->razon_social))>80){
                        $pdf->SetFont('Helvetica', '', 7);
                        $pdf->MultiCell(80,4,strtoupper(utf8_decode($detail->razon_social)),0,'L');
                        $pdf->SetFont('Helvetica', '', 10);
                    }else{
                        $pdf->SetXY(15,21);
                        $pdf->Cell(80,4,strtoupper(utf8_decode($detail->razon_social)),0,1,'L');
                    }
                    $pdf->SetXY(113,21);
                    $pdf->Cell(86,4,number_format($detail->haber,2,".",","),0,1,'L');
                    $pdf->SetXY(15,26);
                    $nro_letra=new Numero_Letra();
                    $valor_pago=$nro_letra->convertir($detail->haber);
                    $pdf->MultiCell(125,6,$valor_pago,0,'L');
                    $pdf->SetXY(5,38);
                    $pdf->Cell(86,4,strtoupper($detail->ciudad).", ".date("Y-m-d", strtotime($detail->fecha_de_pago)),0,1,'L');
                    $pdf->Ln(20);
                    array_push($array,$contador);
                    if(count($detalle)>$contador){
                        $pdf->AddPage();
                    }
                }else{
                    //$imagen=$_SERVER['DOCUMENT_ROOT'] . '/images/cheque produbanco.png';
                    //$pdf->Image($imagen, 0, 0, $ancho, $alto);
                    $pdf->SetFont('Helvetica', '', 10);
                    $pdf->SetXY(19,18);
                    if($pdf->GetStringWidth(utf8_decode($detail->razon_social))>80){
                        $pdf->SetFont('Helvetica', '', 7);
                        $pdf->MultiCell(80,4,strtoupper(utf8_decode($detail->razon_social)),0,'L');
                        $pdf->SetFont('Helvetica', '', 10);
                    }else{
                        $pdf->SetXY(19,21);
                        $pdf->Cell(80,4,strtoupper(utf8_decode($detail->razon_social)),0,1,'L');
                    }
                    $pdf->SetXY(123,21);
                    if($detail->haber){
                        $pdf->Cell(86,4,number_format($detail->haber,2,".",","),0,1,'L');
                    }else{
                        $pdf->Cell(86,4,number_format($detail->debe,2,".",","),0,1,'L');
                    }
                    
                    $pdf->SetXY(19,26);
                    $nro_letra=new Numero_Letra();
                    if($detail->haber){
                        $valor_pago=$nro_letra->convertir($detail->haber);
                    }else{
                        $valor_pago=$nro_letra->convertir($detail->debe);
                    }
                    
                    $pdf->MultiCell(125,6,$valor_pago,0,'L');
                    $pdf->SetXY(14,38);
                    $pdf->Cell(86,4,strtoupper($detail->ciudad).", ".date("Y-m-d", strtotime($detail->fecha_de_pago)),0,1,'L');
                    $pdf->Ln(20);
                    array_push($array,$contador);
                    if(count($detalle)>$contador){
                        $pdf->AddPage();
                    }
                }
                
            }
            
            
        }
        //dd(count($detalle));
        return $pdf->Output("cheque-asientos.pdf", "D");
    }
    public function PDFChequeAsientoCPM($detalle){
        $pdf = new PDF_MC_Table('L', 'mm', 'A4');
        
        $pdf->AddPage();
        
        $pdf->AliasNbPages();
        
        $ancho=$pdf->GetPageWidth()-63;
        $alto=74;
        //dd($detalle);
        $pdf->SetFont('Helvetica', '', 10); 
        $contador=0;
        $array=[];
        foreach($detalle as $detail){
            $contador++;
            if($detail->cheque=='Pichincha'){
                // $imagen=$_SERVER['DOCUMENT_ROOT'] . '/images/cheque grupo solis.PNG';
                // $pdf->Image($imagen, 0, 0, $ancho, $alto);
                
                $pdf->SetXY(163,($pdf->GetPageHeight()/2)-19);
                if($pdf->GetStringWidth(utf8_decode($detail->razon_social))>86){
                    $pdf->SetFont('Helvetica', '', 7);
                    $pdf->MultiCell(86,4,strtoupper(utf8_decode($detail->razon_social)),0,'L');
                    $pdf->SetFont('Helvetica', '', 10);
                }else{
                    $pdf->Cell(86,4,strtoupper(utf8_decode($detail->razon_social)),0,1,'L');
                }
                //$pdf->AddPage();
                $pdf->SetXY(262,($pdf->GetPageHeight()/2)-19);
                if($detail->haber>0){
                    $pdf->Cell(86,4,number_format($detail->haber,2,".",","),0,1,'L');
                }else{
                    $pdf->Cell(86,4,number_format($detail->debe,2,".",","),0,1,'L');
                }
                
                $nro_letra=new Numero_Letra();
                if($detail->haber>0){
                    $valor_pago=$nro_letra->convertir($detail->haber);
                }else{
                    
                    $valor_pago=$nro_letra->convertir($detail->debe);
                }
                
                $pdf->SetXY(163,($pdf->GetPageHeight()/2)-12);
                $pdf->MultiCell(125,6,$valor_pago,0,'L');
                $pdf->SetXY(160,($pdf->GetPageHeight()/2)+1);
                $pdf->Cell(86,4,strtoupper($detail->ciudad).", ".date("Y-m-d", strtotime($detail->fecha_de_pago)),0,1,'L');
                $pdf->Ln(20);
                array_push($array,$contador);
                if(count($detalle)>$contador){
                    $pdf->AddPage();
                }
            }else{
                // $imagen=$_SERVER['DOCUMENT_ROOT'] . '/images/cheque banco intencional.PNG';
                // $pdf->Image($imagen, 0, 0, $ancho, $alto);
                $pdf->SetFont('Helvetica', '', 10);
                $pdf->SetXY(159,($pdf->GetPageHeight()/2)-19);
                if($pdf->GetStringWidth(utf8_decode($detail->razon_social))>80){
                    $pdf->SetFont('Helvetica', '', 7);
                    $pdf->MultiCell(80,4,strtoupper(utf8_decode($detail->razon_social)),0,'L');
                    $pdf->SetFont('Helvetica', '', 10);
                }else{
                    $pdf->SetXY(159,($pdf->GetPageHeight()/2)-16);
                    $pdf->Cell(80,4,strtoupper(utf8_decode($detail->razon_social)),0,1,'L');
                }
                $pdf->SetXY(257,($pdf->GetPageHeight()/2)-16);
                if($detail->haber!==null){
                    $pdf->Cell(86,4,number_format($detail->haber,2,".",","),0,1,'L');
                }else{
                    $pdf->Cell(86,4,number_format($detail->debe,2,".",","),0,1,'L');
                }
                
                $pdf->SetXY(159,($pdf->GetPageHeight()/2)-11);
                $nro_letra=new Numero_Letra();
                if($detail->haber!==null){
                    $valor_pago=$nro_letra->convertir($detail->haber);
                }else{
                    $valor_pago=$nro_letra->convertir($detail->debe);
                }
                
                $pdf->MultiCell(125,6,$valor_pago,0,'L');
                $pdf->SetXY(149,($pdf->GetPageHeight()/2)+1);
                $pdf->Cell(86,4,strtoupper($detail->ciudad).", ".date("Y-m-d", strtotime($detail->fecha_de_pago)),0,1,'L');
                $pdf->Ln(20);
                array_push($array,$contador);
                if(count($detalle)>$contador){
                    $pdf->AddPage();
                }
            }
            
            
        }
        //dd(count($detalle));
        return $pdf->Output("cheque-asientos-CPM.pdf", "D");
    }
    public function ReciboCobro($cobros,$empresa,$array_cobro,$ruta=null){
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $pdf->AddPage();
        $fecha_actual = date("d/m/Y");
        $pdf->AliasNbPages();

        $ancho=$pdf->GetPageWidth()-1.5;
        $alto=97.5;

        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', '', 7);
        $pdf->SetXY(89, 25);
        //dd($cobros);
        switch(strlen($cobros->ucrea_cta)){
            case 1:
                $pdf->Cell(23,4,substr($cobros->ucrea_cta,0,1),0,1,'R');
                break;
            case 2:
                $pdf->Cell(23,4,substr($cobros->ucrea_cta,0,1)."    ".substr($cobros->ucrea_cta,1,1),0,1,'R');
                break;
            case 3:
                $pdf->Cell(23,4,substr($cobros->ucrea_cta,0,1)."    ".substr($cobros->ucrea_cta,1,1)."    ".substr($cobros->ucrea_cta,2,1),0,1,'R');
                break;
            case 4:
                $pdf->Cell(23,4,substr($cobros->ucrea_cta,0,1)."    ".substr($cobros->ucrea_cta,1,1)."    ".substr($cobros->ucrea_cta,2,1)."    ".substr($cobros->ucrea_cta,3,1),0,1,'R');
                break;
            case 5:
                $pdf->Cell(23,4,substr($cobros->ucrea_cta,0,1)."    ".substr($cobros->ucrea_cta,1,1)."    ".substr($cobros->ucrea_cta,2,1)."    ".substr($cobros->ucrea_cta,3,1)."    ".substr($cobros->ucrea_cta,4,1),0,1,'R');
                break;
            default:
                $pdf->Cell(23,4,"",0,1,'R');
                break;
        }
        
        $pdf->SetXY(113, 25);
        //dd($cobros);
        
        $pdf->Cell(20,4,substr($fecha_actual,0,1)."   ".substr($fecha_actual,1,1)."   ".substr($fecha_actual,3,1)."   ".substr($fecha_actual,4,1)."    ".substr($fecha_actual,8,1)."   ".substr($fecha_actual,9,1),0,1,'L');
        $pdf->SetXY(135.5, 25);
        $pdf->MultiCell(16,2,utf8_decode($cobros->nombre_punto),0,'L');
        $pdf->SetXY(151.5, 25);
        $pdf->Cell(8,3,substr($cobros->codigo_punto,0,1)."    ".substr($cobros->codigo_punto,2,1),0,1,'L');
        $pdf->SetXY(158, 25);
        if(strlen($cobros->identificacion)==13){
            $pdf->Cell(48,3,substr($cobros->identificacion,0,1)."    ".substr($cobros->identificacion,1,1)."    ".substr($cobros->identificacion,2,1)."   ".substr($cobros->identificacion,3,1)."   ".substr($cobros->identificacion,4,1)."   ".substr($cobros->identificacion,5,1)."   ".substr($cobros->identificacion,6,1)."    ".substr($cobros->identificacion,7,1)."    ".substr($cobros->identificacion,8,1)."    ".substr($cobros->identificacion,9,1)."    ".substr($cobros->identificacion,10,1)."   ".substr($cobros->identificacion,11,1)."   ".substr($cobros->identificacion,12,1),0,1,'L');
        }else{
            $pdf->Cell(48,3,substr($cobros->identificacion,0,1)."    ".substr($cobros->identificacion,1,1)."    ".substr($cobros->identificacion,2,1)."   ".substr($cobros->identificacion,3,1)."   ".substr($cobros->identificacion,4,1)."   ".substr($cobros->identificacion,5,1)."   ".substr($cobros->identificacion,6,1)."    ".substr($cobros->identificacion,7,1)."    ".substr($cobros->identificacion,8,1)."    ".substr($cobros->identificacion,9,1),0,1,'L');
        }
        $pdf->SetXY(46, 33);
        $pdf->Cell(187,4,utf8_decode($cobros->nombre),0,1,'L');
        $pdf->SetXY(40, 37);
        $nro_letra=new Numero_Letra();
        $valor_pago=$nro_letra->convertir($cobros->valor_real_pago);
        $pdf->Cell(128,4,utf8_decode($valor_pago),0,1,'L');
        $pdf->SetXY(46, 42);
        $pdf->Cell(122,4,"Cobro Cliente ".$array_cobro,0,1,'L');
        if($array_cobro=="Anticipo"){
            $pdf->SetXY(74, 47);
            $pdf->Cell(9,4,"X",0,1,'C');
            $pdf->SetXY(81, 47);
            $pdf->Cell(15,4,number_format($cobros->valor_real_pago,2,".",","),0,1,'C');
        }
        if($cobros->descuento_pago!==null){
            $pdf->SetXY(143, 47);
            $pdf->Cell(9,4,"X",0,0,'L');
            $pdf->Cell(22,4,number_format($cobros->descuento_pago,2,".",","),0,1,'L');
        }
        $pdf->SetXY(74, 58);
        $pdf->Cell(9,4,"X",0,1,'C');
        $pdf->SetXY(84, 58);
        $pdf->Cell(15,4,number_format($cobros->valor_real_pago,2,".",","),0,1,'L');
        // $pdf->SetXY(47, 59);
        // $pdf->Cell(122,4,utf8_decode($cobros->pagos_por),0,1,'L');
        $pdf->SetXY(170, 63);
        $pdf->Cell(28,4,number_format($cobros->valor_real_pago,2,".",","),0,1,'L');
        if($cobros->descripcion_fp=='EFECTIVO'){
            $pdf->SetXY(41, 68);
            $pdf->Cell(9,4,"X",0,1,'C');
        }else{
            $pdf->SetXY(74, 68);
            $pdf->Cell(9,4,"X",0,1,'C');
        }
        if($cobros->nro_tarjeta!==null){
            $pdf->SetXY(107, 68 );
            //$cobros->nro_tarjeta
            $pdf->Cell(15,4,$cobros->nro_tarjeta,0,1,'C');
        }
        if($cobros->id_banco!==null){
            
            $exist_banco0=strpos($cobros->nombre_banco,"Banco");
            
            $nombre_banco="";
            if($exist_banco0!==false){
                $exist_banco1=strpos($cobros->nombre_banco,"de ");
                if($exist_banco1!==false){
                    $nombre_banco=substr($cobros->nombre_banco,9,strlen($cobros->nombre_banco));
                }else{
                    $nombre_banco=substr($cobros->nombre_banco,6,strlen($cobros->nombre_banco));
                }
                
            }else{
                $nombre_banco=$cobros->nombre_banco;
            }
            if($pdf->GetStringWidth(utf8_decode($nombre_banco))>27){
                $pdf->SetXY(135, 67.5);
                $pdf->MultiCell(28,2,utf8_decode($nombre_banco),0,'L');
            }else{
                $pdf->SetXY(135, 68);
                $pdf->MultiCell(28,2,utf8_decode($nombre_banco),0,'L');
            }  
        }
        $pdf->SetXY(171, 68);
        if($cobros->fecha_registro==null){
            $pdf->Cell(20,4,date("d/m/Y",strtotime($cobros->fecha_pago)),0,1,'L');
        }else{
            $pdf->Cell(20,4,date("d/m/Y",strtotime($cobros->fecha_registro)),0,1,'L');
        }
        //dd($ruta);
        if($ruta!==null){

            return $pdf->Output($ruta.'/'."recibo_cobro_{$cobros->id_ctas_cobrar_pagos}.pdf", "F");
        }else{
            return $pdf->Output("recibo_cobro.pdf", "D");
        }
        
    }
    public function ATS_reporte($empresa,$fecha_inicio,$fecha_fin,$factura_compra,$factura_venta,$anulados,$retencion_renta,$retencion_iva,$retencion_renta_venta,$retencion_iva_venta,$generar_en_servidor = false, $ruta = null){
        setlocale(LC_TIME, "spanish");
        //$pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $pdf->AddPage();
        $pdf->AliasNbPages();

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 16);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(60, 10);
        $pdf->Cell(105, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        //dd($fecha_fin);
        //$pdf->Cell(105, 8, utf8_decode('CUENTAS POR COBRAR'), 0, 2, 'C', 0);
        $pdf->Cell(105, 8, utf8_decode('ANEXO TRANSACCIONAL'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $mes=date("m", strtotime($fecha_fin));
        $anio = date("Y", strtotime($fecha_fin));
        $pdf->Cell(105, 4, utf8_decode('Periodo '.$mes.'-'.$anio), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        /*if ($fec_ini != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else */
        //if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fecha_inicio));
            $fec_hasta = date("d/m/Y", strtotime($fecha_fin));
        /*} else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }*/
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        
        $pdf->SetXY(10,30);
        $margin = 10;
        $height = $pdf->GetY();
        $cli_atencion = '';
    
        // $pdf->SetFont('Helvetica', 'B', 8);
        // $pdf->Cell(20, 5, utf8_decode('APRECIADO CLIENTE:'), 0, 2, 'L', 0);
        // $pdf->SetFont('Helvetica', '', 8);
        // $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
        $pdf->SetFillColor(85, 175, 84);
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetDrawColor(0, 0, 0);
        
        $height_products = $height + 5;
        $pdf->SetXY(10,30);
        $pdf->SetFont('Arial', 'B', 8);
        $existe_facturas_compra=0;
        $existe_nt_compra=0;
        $existe_ntd_compra=0;
        $existe_facturas_ventas=0;
        $existe_nt_ventas=0;
        $existe_ntc_ventas=0;
        foreach ($factura_compra as $detail) {
            if($detail->id_factcompra>0 && $detail->nro_registros>0){
                $existe_facturas_compra++;
            }
            if($detail->cod_sustento=='04' && $detail->nro_registros>0){
                $existe_nt_compra++;
            }
            if($detail->cod_sustento=='05' && $detail->nro_registros>0){
                $existe_ntd_compra++;
            }
        }
        if($existe_facturas_compra>0 || $existe_nt_compra>0 || $existe_ntd_compra>0){
            $pdf->Cell(195, 5, 'Compras', 0, 0, 'C', 0);
        }
        
        if($existe_facturas_compra>0 || $existe_nt_compra>0 || $existe_ntd_compra>0){
            //cabecera de detalles de productos
            $pdf->SetFont('Arial', 'B', 7);
            
            // if($factura_info->id_empresa==1){
            //     $pdf->SetFillColor(141, 207, 140);
            // }else{
            //     $pdf->SetFillColor(141, 207, 240);
            // }
            //dd("X=".$margin."Y=".$height_products);
            $pdf->SetFillColor(38, 46, 211);
            $pdf->SetTextColor(255,255,255);
            $pdf->SetXY($margin, $height_products);
            //$pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
            //$pdf->SetXY($margin+25, $height_products);
            $pdf->MultiCell(10, 4, utf8_decode('Cod.'), 'TB', 'C', 1);
            $pdf->SetXY($margin+10, $height_products);
            $pdf->MultiCell(65.95, 4, utf8_decode('TransacciÃ³n.'), 'TB', 'C', 1);
            $pdf->SetXY($margin+10+65.95, $height_products);
            $pdf->MultiCell(18.5, 4, utf8_decode('No. Registros'), 'TB', 'C', 1);
            $pdf->SetXY($margin+10+65.95+18.5, $height_products);
            $pdf->MultiCell(22, 4, utf8_decode('BI Tarifa 0%'), 'TB', 'C', 1);
            //$pdf->SetXY($margin+27.85+27.85+27.85+27.85, $height_products);
            // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
            // $pdf->SetXY(120, $height_products);
            // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
            // $pdf->SetXY(132, $height_products);
            // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
            //$pdf->SetXY(144, $height_products);
            //$pdf->MultiCell(20, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
            $pdf->SetXY($margin+10+65.95+18.5+22, $height_products);
            $pdf->MultiCell(29.5, 4, utf8_decode('BI Tarifa Diferente 0%'), 'TB', 'C', 1);
            $pdf->SetXY($margin+10+65.95+18.5+22+29.5, $height_products);
            $pdf->MultiCell(22, 4, utf8_decode('BI No Objeto IVA'), 'TB', 'C', 1);
            $pdf->SetXY($margin+10+65.95+18.5+22+29.5+22, $height_products);
            $pdf->MultiCell(22, 4, utf8_decode('Valor IVA'), 'TB', 'C', 1);
            //$pdf->SetXY($margin+17+118.5+15+14+15+17, $height_products);
            
            //dd("X=".$margin."Y=".$height_products);
            $y = $height_products + 8;
            $pdf->SetFont('Arial', '', 6);
            $pdf->SetFillColor(255, 255, 255);
            $pdf->SetFillColor(85, 175, 84);
            $pdf->SetXY($margin, $height_products+4);
            $pdf->SetWidths(array(10,65.95,18.5,22,29.5,22,22));
        }
        $pdf->SetTextColor(0,0,0);
        $total_bi_tarifa_0=0;
        $total_bi_tarifa_12=0;
        $total_bi_tarifa_no_iva=0;
        $total_valor_iva=0;
        $resta_ntc_compra_bi_tarifa_0=0;
        $resta_ntc_compra_bi_tarifa_12=0;
        $resta_ntc_compra_bi_tarifa_no_iva=0;
        $resta_ntc_compra_valor_iva=0;
        $contador=0;
        foreach ($factura_compra as $detail) {
            $pdf->SetX(10);
            /*$data = array(
                $detail->cod_sustento?utf8_decode(trim($detail->cod_sustento)."Centrado"):'N/E'."Centrado",
                $detail->descrip_sustento?utf8_decode($detail->descrip_sustento):'N/E',
                utf8_decode($detail->nro_registros."Centrado"),
                number_format($detail->bi_tarifa_0,2,".",",")."Derecha",
                number_format($detail->bi_tarifa_12,2,".",",")."Derecha",
                number_format($detail->bi_tarifa_no_iva,2,".",",")."Derecha",
                number_format($detail->valor_iva,2,".",",")."Derecha",
             );
             $pdf->RowWithoutImageATS($data, 10);*/
             $pdf->SetFillColor(174, 176, 208);
             //$pdf->SetTextColor(255,255,255);
             if($detail->nro_registros>0){
                $pdf->Cell(10,4,$detail->cod_sustento,0,0,'C',1);
                $pdf->Cell(65.95,4,utf8_decode($detail->descrip_sustento),0,0,'L',1);
                $pdf->Cell(18.5,4,$detail->nro_registros,0,0,'C',1);
                $pdf->Cell(22,4,number_format($detail->bi_tarifa_0,2,".",","),0,0,'R',1);
                $pdf->Cell(29.5,4, number_format($detail->bi_tarifa_12,2,".",","),0,0,'R',1);
                $pdf->Cell(22,4,number_format($detail->bi_tarifa_no_iva,2,".",","),0,0,'R',1);
                $pdf->Cell(22,4,number_format($detail->valor_iva,2,".",","),0,1,'R',1);
             }
             $contador+=$detail->nro_registros;
             if($detail->cod_sustento!=='04'){
                $total_bi_tarifa_0+=$detail->bi_tarifa_0;
                $total_bi_tarifa_12+=$detail->bi_tarifa_12;
                $total_bi_tarifa_no_iva+=$detail->bi_tarifa_no_iva;
                $total_valor_iva+=$detail->valor_iva;
             }
             
             if($existe_nt_compra>0){
                $resta_ntc_compra_bi_tarifa_0=floatval($detail->bi_tarifa_0);
                $resta_ntc_compra_bi_tarifa_12=floatval($detail->bi_tarifa_12);
                $resta_ntc_compra_bi_tarifa_no_iva=floatval($detail->bi_tarifa_no_iva);
                $resta_ntc_compra_valor_iva=floatval($detail->valor_iva);
             }
        }
        $pdf->SetFont('Helvetica', 'B', 7);
        if($existe_facturas_compra>0 || $existe_nt_compra>0 || $existe_ntd_compra>0){
            $pdf->SetXY(10,$pdf->GetY());
            $pdf->Cell(75.95,4,'Total',0,0,'R',0);
            $pdf->Cell(18.5, 4, $contador, 'T', 0, 'C', 0);
            $pdf->Cell(22,4,number_format($total_bi_tarifa_0-$resta_ntc_compra_bi_tarifa_0,2,".",","),'T',0,'R',0);
            $pdf->Cell(29.5,4, number_format($total_bi_tarifa_12-$resta_ntc_compra_bi_tarifa_12,2,".",","),'T',0,'R',0);
            $pdf->Cell(22,4,number_format($total_bi_tarifa_no_iva-$resta_ntc_compra_bi_tarifa_no_iva,2,".",","),'T',0,'R',0);
            $pdf->Cell(22,4,number_format($total_valor_iva-$resta_ntc_compra_valor_iva,2,".",","),'T',1,'R',0);
        }
        


        $pdf->Ln(3);
        $height = $pdf->GetY();
        foreach ($factura_venta as $detail) {
            if($detail->cod_sustento=='18' && $detail->nro_registros>0){
                $existe_facturas_ventas++;
            }
            if($detail->cod_sustento=='06' && $detail->nro_registros>0){
                $existe_nt_ventas++;
            }
            if($detail->cod_sustento=='04' && $detail->nro_registros>0){
                $existe_ntc_ventas++;
            }
        }
        if($existe_facturas_ventas>0 || $existe_nt_ventas>0 || $existe_ntc_ventas>0){
            $pdf->SetX(10);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(195, 5, 'Ventas', 0, 1, 'C', 0);
            //$pdf->Ln(1);
        }
        
        if($existe_facturas_ventas>0 || $existe_nt_ventas>0 || $existe_ntc_ventas>0){
            $height = $pdf->GetY();
            $height_products = $height+2;
            $pdf->SetFont('Arial', 'B', 7);
            
            // if($factura_info->id_empresa==1){
            //     $pdf->SetFillColor(141, 207, 140);
            // }else{
            //     $pdf->SetFillColor(141, 207, 240);
            // }
            //dd("X=".$margin."Y=".$height_products);
            $pdf->SetFillColor(38, 46, 211);
            $pdf->SetTextColor(255,255,255);
            $pdf->SetXY($margin, $height_products);
            //$pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
            //$pdf->SetXY($margin+25, $height_products);
            $pdf->MultiCell(10, 4, utf8_decode('Cod.'), 'TB', 'C', 1);
            $pdf->SetXY($margin+10, $height_products);
            $pdf->MultiCell(65.95, 4, utf8_decode('TransacciÃ³n.'), 'TB', 'C', 1);
            $pdf->SetXY($margin+10+65.95, $height_products);
            $pdf->MultiCell(18.5, 4, utf8_decode('No. Registros'), 'TB', 'C', 1);
            $pdf->SetXY($margin+10+65.95+18.5, $height_products);
            $pdf->MultiCell(22, 4, utf8_decode('BI Tarifa 0%'), 'TB', 'C', 1);
            //$pdf->SetXY($margin+27.85+27.85+27.85+27.85, $height_products);
            // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
            // $pdf->SetXY(120, $height_products);
            // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
            // $pdf->SetXY(132, $height_products);
            // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
            //$pdf->SetXY(144, $height_products);
            //$pdf->MultiCell(20, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
            $pdf->SetXY($margin+10+65.95+18.5+22, $height_products);
            $pdf->MultiCell(29.5, 4, utf8_decode('BI Tarifa Diferente 0%'), 'TB', 'C', 1);
            $pdf->SetXY($margin+10+65.95+18.5+22+29.5, $height_products);
            $pdf->MultiCell(22, 4, utf8_decode('BI No Objeto IVA'), 'TB', 'C', 1);
            $pdf->SetXY($margin+10+65.95+18.5+22+29.5+22, $height_products);
            $pdf->MultiCell(22, 4, utf8_decode('Valor IVA'), 'TB', 'C', 1);
            //$pdf->SetXY($margin+17+118.5+15+14+15+17, $height_products);
            
            //dd("X=".$margin."Y=".$height_products);
            $y = $height_products + 8;
            $pdf->SetFont('Arial', '', 6);
            $pdf->SetFillColor(255, 255, 255);
            $pdf->SetFillColor(85, 175, 84);
            $pdf->SetXY($margin, $height_products+4);
            $pdf->SetWidths(array(10,65.95,18.5,22,29.5,22,22));
        }



            $pdf->SetTextColor(0,0,0);
            $total_bi_tarifa_0=0;
            $total_bi_tarifa_12=0;
            $total_bi_tarifa_no_iva=0;
            $total_valor_iva=0;
        $resta_ntc_venta_bi_tarifa_0=0;
        $resta_ntc_venta_bi_tarifa_12=0;
        $resta_ntc_venta_bi_tarifa_no_iva=0;
        $resta_ntc_venta_valor_iva=0;
        //dd($existe_ntc_ventas);
        $contador=0;
        foreach($factura_venta as $detail){
            $pdf->SetX(10);
            /*$data = array(
                $detail->cod_sustento?utf8_decode(trim($detail->cod_sustento)."Centrado"):'N/E'."Centrado",
                $detail->descrip_sustento?utf8_decode($detail->descrip_sustento):'N/E',
                utf8_decode($detail->nro_registros."Centrado"),
                number_format($detail->bi_tarifa_0,2,".",",")."Derecha",
                number_format($detail->bi_tarifa_12,2,".",",")."Derecha",
                number_format($detail->bi_tarifa_no_iva,2,".",",")."Derecha",
                number_format($detail->valor_iva,2,".",",")."Derecha",
             );
             $pdf->RowWithoutImageATS($data, 10);*/
             $pdf->SetFillColor(174, 176, 208);
             if($detail->nro_registros>0){
                $pdf->Cell(10,4,$detail->cod_sustento,0,0,'C',1);
                $pdf->Cell(65.95,4,$detail->descrip_sustento,0,0,'L',1);
                $pdf->Cell(18.5,4,$detail->nro_registros,0,0,'C',1);
                $pdf->Cell(22,4,number_format($detail->bi_tarifa_0,2,".",","),0,0,'R',1);
                $pdf->Cell(29.5,4, number_format($detail->bi_tarifa_12,2,".",","),0,0,'R',1);
                $pdf->Cell(22,4,number_format($detail->bi_tarifa_no_iva,2,".",","),0,0,'R',1);
                $pdf->Cell(22,4,number_format($detail->valor_iva,2,".",","),0,1,'R',1);
             }
             $contador+=$detail->nro_registros;
             if($detail->cod_sustento!=='04'){
                $total_bi_tarifa_0+=$detail->bi_tarifa_0;
                $total_bi_tarifa_12+=$detail->bi_tarifa_12;
                $total_bi_tarifa_no_iva+=$detail->bi_tarifa_no_iva;
                $total_valor_iva+=$detail->valor_iva;
             }
             
             if($existe_ntc_ventas>0){
                $resta_ntc_venta_bi_tarifa_0=floatval($detail->bi_tarifa_0);
                $resta_ntc_venta_bi_tarifa_12=floatval($detail->bi_tarifa_12);
                $resta_ntc_venta_bi_tarifa_no_iva=floatval($detail->bi_tarifa_no_iva);
                $resta_ntc_venta_valor_iva=floatval($detail->valor_iva);
             }
        }
        // $total_tarifa_12=floatval($resta_ntc_venta_bi_tarifa_12);
        // $total_tarifa_12_1=floatval($total_bi_tarifa_12);
        // $suma=$total_tarifa_12_1-$total_tarifa_12;
        
        // dd($suma);
        if($existe_facturas_ventas>0 || $existe_nt_ventas>0 || $existe_ntc_ventas>0){
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->SetXY(10,$pdf->GetY());
            $pdf->Cell(75.95,4,'Total',0,0,'R',0);
            $pdf->Cell(18.5, 4, $contador, 'T', 0, 'C', 0);
            $pdf->Cell(22,4,number_format($total_bi_tarifa_0-$resta_ntc_venta_bi_tarifa_0,2,".",","),'T',0,'R',0);
            $pdf->Cell(29.5,4, number_format($total_bi_tarifa_12-$resta_ntc_venta_bi_tarifa_12,2,".",","),'T',0,'R',0);
            $pdf->Cell(22,4,number_format($total_bi_tarifa_no_iva-$resta_ntc_venta_bi_tarifa_no_iva,2,".",","),'T',0,'R',0);
            $pdf->Cell(22,4,number_format($total_valor_iva-$resta_ntc_venta_valor_iva,2,".",","),'T',1,'R',0);
        }
        $total_anulados=0;
        foreach($anulados as $detail){
            $total_anulados+=$detail->nro_registros;
        }
        $pdf->Ln(3);
        if($total_anulados>0){
            $pdf->SetX(10);
            $pdf->SetFillColor(38, 46, 211);
            $pdf->SetTextColor(255,255,255);
            $pdf->SetFont('Arial', 'B', 7);
            $pdf->Cell(180, 4, 'Comprobantes Anulados', 'TB', 0, 'C', 1);
            $pdf->Cell(10, 4, 'No.', 'TB', 1, 'C', 1);
            $pdf->SetTextColor(0,0,0);
            $pdf->SetFont('Arial', '', 6);
            $pdf->SetX(10);
            $pdf->SetFillColor(174, 176, 208);
            $pdf->Cell(180, 5, utf8_decode('Total de Comprobantes Anulados en el perÃ­odo informado (no incluye los dados de baja)'), 0, 0, 'C', 1);
            $pdf->Cell(10, 5, $total_anulados, 0, 1, 'C', 1);
            $pdf->Ln(3);
        }
        $exist_rentencion_renta_compra=0;
        foreach($retencion_renta as $detail){
            if($detail->nro_registo>0){
                $exist_rentencion_renta_compra++;
            }
        }
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(195, 4, 'Resumen de Retenciones - Agente de Retencion', 0, 1, 'C', 0);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 7);
        if($exist_rentencion_renta_compra>0){
            $pdf->Cell(195, 4, 'Retencion en la Fuente de Impuesto a la Renta en Compras', 0, 1, 'C', 0);
            $pdf->Ln(3);
            $pdf->SetFillColor(38, 46, 211);
            $pdf->SetTextColor(255,255,255);
            $pdf->Cell(15,4,'Cod.','TB',0,'C',1);
            $pdf->Cell(98.95,4,utf8_decode('Concepto de RetenciÃ³n'),'TB',0,'C',1);
            //$pdf->Cell(16,4,$detail->nro_registros,'TB',0,'C',1);
            $pdf->Cell(22,4,utf8_decode('No. Registros'),'TB',0,'C',1);
            $pdf->Cell(22,4, utf8_decode('Base Imponible'),'TB',0,'C',1);
            $pdf->Cell(10,4,'%','TB',0,'R',1);
            $pdf->Cell(22,4,utf8_decode('Valor Retenido'),'TB',1,'R',1);
        }
        
        //$pdf->Cell(22,4,number_format($detail->valor_iva,2,".",","),'TB',1,'R',0);
        $total_base_renta=0;
        $total_valor_renta=0;
        $total_base_iva=0;
        $total_valor_iva=0;
        $pdf->SetTextColor(0,0,0);
        $contador=0;
        foreach($retencion_renta as $detail){
                $pdf->SetFillColor(174, 176, 208);
                $pdf->SetX(10);
                $pdf->SetFont('Arial', '', 6);
                if($detail->nro_registo>0){
                    $pdf->Cell(15,4,$detail->cod_imp,0,0,'C',1);
                    $pdf->Cell(98.95,4,utf8_decode($detail->descrip_imp),0,0,'L',1);
                    $pdf->Cell(22,4,$detail->nro_registo,0,0,'C',1);
                    $pdf->Cell(22,4, number_format($detail->base_imponible,2,".",","),0,0,'R',1);
                    $pdf->Cell(10,4,$detail->porcen_imp,0,0,'R',1);
                    $pdf->Cell(22,4,number_format($detail->valor_retencion,2,".",","),0,1,'R',1);
                }
                $total_base_renta+=$detail->base_imponible;
                $total_valor_renta+=$detail->valor_retencion;
                $contador+=$detail->nro_registo;
        }
        if($exist_rentencion_renta_compra>0){
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->SetXY(10,$pdf->GetY());
            $pdf->Cell(113.95, 4, 'Total', 0, 0, 'R', 0);
            $pdf->Cell(22, 4, $contador, 'T', 0, 'C', 0);
            $pdf->Cell(22,4,number_format($total_base_renta,2,".",","),'T',0,'R',0);
            $pdf->Cell(10, 4, '', 'T', 0, 'C', 0);
            $pdf->Cell(22,4,number_format($total_valor_renta,2,".",","),'T',1,'R',0);
            $pdf->Ln(3);
        }
        $exist_rentencion_iva_compra=0;
        foreach($retencion_iva as $detail){
            if($detail->nro_registo>0){
                $exist_rentencion_iva_compra++;
            }
        }
        
        if($exist_rentencion_iva_compra>0){
            $pdf->SetX(10);
            $pdf->SetFont('Arial', 'B', 7);
            $pdf->Cell(195, 4, 'Retencion en la Fuente de Iva en Compras', 0, 1, 'C', 0);
            $pdf->Ln(3);
            $pdf->SetFillColor(38, 46, 211);
            $pdf->SetTextColor(255,255,255);
            $pdf->Cell(15,4,'Cod.','TB',0,'C',1);
            $pdf->Cell(98.95,4,utf8_decode('Concepto de RetenciÃ³n'),'TB',0,'C',1);
            //$pdf->Cell(16,4,$detail->nro_registros,'TB',0,'C',1);
            $pdf->Cell(22,4,utf8_decode('No. Registros'),'TB',0,'C',1);
            $pdf->Cell(22,4, utf8_decode('Base Imponible'),'TB',0,'C',1);
            $pdf->Cell(10,4,'%','TB',0,'R',1);
            $pdf->Cell(22,4,utf8_decode('Valor Retenido'),'TB',1,'R',1);
        }
        
        $pdf->SetTextColor(0,0,0);
        $contador=0;
        foreach($retencion_iva as $detail){
                $pdf->SetFillColor(174, 176, 208);
                $pdf->SetX(10);
                $pdf->SetFont('Arial', '', 6);
                if($detail->nro_registo>0){
                    $pdf->Cell(15,4,$detail->cod_imp,0,0,'C',1);
                    $pdf->Cell(98.95,4,utf8_decode($detail->descrip_imp),0,0,'L',1);
                    $pdf->Cell(22,4,$detail->nro_registo,0,0,'C',1);
                    $pdf->Cell(22,4, number_format($detail->base_imponible,2,".",","),0,0,'R',1);
                    $pdf->Cell(10,4,$detail->porcen_imp,0,0,'R',1);
                    $pdf->Cell(22,4,number_format($detail->valor_retencion,2,".",","),0,1,'R',1);
                }
                
            $total_base_iva+=$detail->base_imponible;
            $total_valor_iva+=$detail->valor_retencion;
            $contador+=$detail->nro_registo;
        }
        if($exist_rentencion_iva_compra>0){
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->SetXY(10,$pdf->GetY());
            $pdf->Cell(113.95, 4, 'Total', 0, 0, 'R', 0);
            $pdf->Cell(22, 4, $contador, 'T', 0, 'C', 0);
            $pdf->Cell(22,4,number_format($total_base_iva,2,".",","),'T',0,'R',0);
            $pdf->Cell(10, 4, '', 'T', 0, 'C', 0);
            $pdf->Cell(22,4,number_format($total_valor_iva,2,".",","),'T',1,'R',0);
            $pdf->Ln(3);
        }
        $exist_retencion_renta_venta=0;
        foreach($retencion_renta_venta as $detail){
            if($detail->nro_registo>0){
                $exist_retencion_renta_venta++;
            }
        }
        if($exist_retencion_renta_venta>0){
            $pdf->SetX(10);
            $pdf->SetFont('Arial', 'B', 7);
            $pdf->Cell(195, 4, 'Retencion en la Fuente de Impuesto a la Renta en Ventas', 0, 1, 'C', 0);
            $pdf->Ln(3);
            $pdf->SetFillColor(38, 46, 211);
            $pdf->SetTextColor(255,255,255);
            $pdf->Cell(15,4,'Cod.','TB',0,'C',1);
            $pdf->Cell(98.95,4,utf8_decode('Concepto de RetenciÃ³n'),'TB',0,'C',1);
            //$pdf->Cell(16,4,$detail->nro_registros,'TB',0,'C',1);
            $pdf->Cell(22,4,utf8_decode('No. Registros'),'TB',0,'C',1);
            $pdf->Cell(22,4, utf8_decode('Base Imponible'),'TB',0,'C',1);
            $pdf->Cell(10,4,'%','TB',0,'R',1);
            $pdf->Cell(22,4,utf8_decode('Valor Retenido'),'TB',1,'R',1);
        }
        
        //$pdf->Cell(22,4,number_format($detail->valor_iva,2,".",","),'TB',1,'R',0);
        $total_base_renta=0;
        $total_valor_renta=0;
        $total_base_iva=0;
        $total_valor_iva=0;
        $pdf->SetTextColor(0,0,0);
        $contador=0;
        foreach($retencion_renta_venta as $detail){
                $pdf->SetFillColor(174, 176, 208);
                $pdf->SetX(10);
                $pdf->SetFont('Arial', '', 6);
                if($detail->nro_registo>0){
                    $pdf->Cell(15,4,$detail->cod_imp,0,0,'C',1);
                    $pdf->Cell(98.95,4,utf8_decode($detail->descrip_imp),0,0,'L',1);
                    $pdf->Cell(22,4,$detail->nro_registo,0,0,'C',1);
                    $pdf->Cell(22,4, number_format($detail->base_imponible,2,".",","),0,0,'R',1);
                    $pdf->Cell(10,4,$detail->porcen_imp,0,0,'R',1);
                    $pdf->Cell(22,4,number_format($detail->valor_retencion,2,".",","),0,1,'R',1);
                }
                
                $total_base_renta+=$detail->base_imponible;
                $total_valor_renta+=$detail->valor_retencion;
                $contador+=$detail->nro_registo;
        }
        if($exist_retencion_renta_venta>0){
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->SetXY(10,$pdf->GetY());
            $pdf->Cell(113.95, 4, 'Total', 0, 0, 'R', 0);
            $pdf->Cell(22, 4, $contador, 'T', 0, 'C', 0);
            $pdf->Cell(22,4,number_format($total_base_renta,2,".",","),'T',0,'R',0);
            $pdf->Cell(10, 4, '', 'T', 0, 'C', 0);
            $pdf->Cell(22,4,number_format($total_valor_renta,2,".",","),'T',1,'R',0);
            $pdf->Ln(3);
        }
        $exist_retencion_iva_venta=0;
        foreach($retencion_iva_venta as $detail){
            if($detail->nro_registo>0){
                $exist_retencion_iva_venta++;
            }
        }
        if($exist_retencion_iva_venta>0){
            $pdf->SetX(10);
            $pdf->SetFont('Arial', 'B', 7);
            $pdf->Cell(195, 4, 'Retencion en la Fuente de Iva en Ventas', 0, 1, 'C', 0);
            $pdf->Ln(3);
            $pdf->SetFillColor(38, 46, 211);
            $pdf->SetTextColor(255,255,255);
            $pdf->Cell(15,4,'Cod.','TB',0,'C',1);
            $pdf->Cell(98.95,4,utf8_decode('Concepto de RetenciÃ³n'),'TB',0,'C',1);
            //$pdf->Cell(16,4,$detail->nro_registros,'TB',0,'C',1);
            $pdf->Cell(22,4,utf8_decode('No. Registros'),'TB',0,'C',1);
            $pdf->Cell(22,4, utf8_decode('Base Imponible'),'TB',0,'C',1);
            $pdf->Cell(10,4,'%','TB',0,'R',1);
            $pdf->Cell(22,4,utf8_decode('Valor Retenido'),'TB',1,'R',1);
        }
        
        $pdf->SetTextColor(0,0,0);
        $contador=0;
        foreach($retencion_iva_venta as $detail){
                $pdf->SetFillColor(174, 176, 208);
                $pdf->SetX(10);
                $pdf->SetFont('Arial', '', 6);
                if($detail->nro_registo>0){
                    $pdf->Cell(15,4,$detail->cod_imp,0,0,'C',1);
                    $pdf->Cell(98.95,4,utf8_decode($detail->descrip_imp),0,0,'L',1);
                    $pdf->Cell(22,4,$detail->nro_registo,0,0,'C',1);
                    $pdf->Cell(22,4, number_format($detail->base_imponible,2,".",","),0,0,'R',1);
                    $pdf->Cell(10,4,$detail->porcen_imp,0,0,'R',1);
                    $pdf->Cell(22,4,number_format($detail->valor_retencion,2,".",","),0,1,'R',1);
                }
                
            $total_base_iva+=$detail->base_imponible;
            $total_valor_iva+=$detail->valor_retencion;
            $contador+=$detail->nro_registo;
        }
        if($exist_retencion_iva_venta>0){
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->SetXY(10,$pdf->GetY());
            $pdf->Cell(113.95, 4, 'Total', 0, 0, 'R', 0);
            $pdf->Cell(22, 4, $contador, 'T', 0, 'C', 0);
            $pdf->Cell(22,4,number_format($total_base_iva,2,".",","),'T',0,'R',0);
            $pdf->Cell(10, 4, '', 'T', 0, 'C', 0);
            $pdf->Cell(22,4,number_format($total_valor_iva,2,".",","),'T',1,'R',0);
        }
        
        $pdf->Ln(20);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->SetXY(40,$pdf->GetY());
        $pdf->Cell(45,4,'','B',0,'R',0);
        $pdf->Cell(39,4,'',0,0,'R',0);
        $pdf->Cell(45,4,'','B',2,'R',0);
        $pdf->SetXY(40,$pdf->GetY());
        $pdf->Cell(45,4,utf8_decode($empresa->nombre_contador),0,0,'C',0);
        $pdf->Cell(39,4,'',0,0,'R',0);
        $pdf->Cell(45,4,utf8_decode($empresa->nomb_representante),0,2,'C',0);

        

        if (!$generar_en_servidor) {
            return $pdf->Output( "ats.pdf", "D");
        } else if ($generar_en_servidor && !is_null($ruta)) {
            if (file_exists($ruta)) {
                $name = $id . '.pdf';
                $location = $ruta . "/" . $name;
                $pdf->Output("F", $location);
                return json_encode(
                    array(
                        "location" => $location,
                        "name" => $name)
                );
            } else {
                throw new Exception("No se pudo generar el ats");
            }

        } else if ($generar_en_servidor && is_null($ruta)) {
            throw new Exception("La ruta para el ats no es valida.");
        } 

    }
    public function ATS_detalle_reporte($empresa,$fecha_inicio,$fecha_fin,$retencion_renta_compra,$retencion_iva_compra,$factura_compra_renta,$factura_compra_iva,$retencion_renta_venta,$retencion_iva_venta,$factura_venta_renta,$factura_venta_iva,$generar_en_servidor = false, $ruta = null){
        setlocale(LC_TIME, "spanish");
        //$pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $pdf->AddPage();
        //$pdf->SetAutoPageBreak(true,10);
        $pdf->AliasNbPages();

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 16);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(60, 10);
        $pdf->Cell(105, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        //dd($fecha_fin);
        //$pdf->Cell(105, 8, utf8_decode('CUENTAS POR COBRAR'), 0, 2, 'C', 0);
        $pdf->Cell(105, 8, utf8_decode('ANEXO TRANSACCIONAL DETALLE'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $mes=date("m", strtotime($fecha_fin));
        $anio = date("Y", strtotime($fecha_fin));
        $pdf->Cell(105, 4, utf8_decode('Periodo '.$mes.'-'.$anio), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        /*if ($fec_ini != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else */
        //if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fecha_inicio));
            $fec_hasta = date("d/m/Y", strtotime($fecha_fin));
        /*} else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }*/
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        
        $pdf->Ln(5);
        $margin = 10;
        $height = $pdf->GetY();
        $cli_atencion = '';
        $array_head_total=[];
        $totales_base=0;
        $totales_valor=0;
        $exist_retencion_renta_compra=0;
        $exist_retencion_iva_compra=0;
        $exist_retencion_renta_venta=0;
        $exist_retencion_iva_venta=0;
        foreach ($retencion_renta_compra as $detalle) {
            if($detalle->nro_registo>0){
                $exist_retencion_renta_compra++;
                $id_imp=$detalle->id_imp;
                $pdf->SetX(10);
                $pdf->SetFont('Arial', 'B', 8);
                $pdf->MultiCell(190,4,"Cod: ".$detalle->cod_imp.utf8_decode("  Retencion Renta Compra:")." ".utf8_decode($detalle->descrip_imp),0,'C',0);
                $height_products=$pdf->GetY();
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->SetFillColor(255,255,255);
                $pdf->SetXY(10,$height_products);
                $margin=10;
                // $pdf->Cell(17.14,4,'Documento','TB',0,'C',0);
                // $pdf->Cell(17.14,4,'Fecha','TB',0,'C',0);
                // $pdf->Cell(17.14,4,'CI/Ruc','TB',0,'C',0);
                // $pdf->Cell(83.14,4,'Proveedor','TB',0,'C',1);
                // $pdf->Cell(20.14,4,'Base','TB',0,'C',1);
                // $pdf->Cell(15.14,4,'%','TB',0,'C',1);
                // $pdf->Cell(20.14,4,'Valor','TB',1,'C',1);
                $pdf->SetFillColor(38, 46, 211);
                $pdf->SetTextColor(255,255,255);
                $pdf->Cell(17.14,4,'Documento','TB',0,'C',1);
                $pdf->Cell(17.14,4,'Fecha','TB',0,'C',1);
                $pdf->Cell(17.14,4,'CI/Ruc','TB',0,'C',1);
                $pdf->Cell(83.14,4,'Proveedor','TB',0,'C',1);
                $pdf->Cell(20.14,4,'Base','TB',0,'C',1);
                $pdf->Cell(15.14,4,'%','TB',0,'C',1);
                $pdf->Cell(20.14,4,'Valor','TB',1,'C',1);



                // $pdf->SetXY($margin, $height_products);
                // //$pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                // //$pdf->SetXY($margin+25, $height_products);
                // $pdf->MultiCell(17.14, 4, utf8_decode('Documento'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14, $height_products);
                // $pdf->MultiCell(17.14, 4, utf8_decode('Fecha'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('CI/Ruc'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14, $height_products);
                // $pdf->MultiCell(80.14, 4, utf8_decode('Proveedor'), 'TB', 'C', 1);
                // //$pdf->SetXY($margin+27.85+27.85+27.85+27.85, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                // // $pdf->SetXY(120, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                // // $pdf->SetXY(132, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                // //$pdf->SetXY(144, $height_products);
                // //$pdf->MultiCell(20, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('Base'), 'TB', 'R', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14+20.14, $height_products);
                // $pdf->MultiCell(15.14, 4, utf8_decode('%'), 'TB', 'R', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14+20.14+15.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('Valor'), 'TB', 'R', 1);
                // //$pdf->SetXY($margin+17+118.5+15+14+15+17, $height_products);
                
                // //dd("X=".$margin."Y=".$height_products);
                // $y = $height_products + 8;
                // $pdf->SetFont('Arial', '', 6);
                // $pdf->SetFillColor(255, 255, 255);
                // $pdf->SetFillColor(85, 175, 84);
                // $pdf->SetXY($margin, $height_products+4);
                // $pdf->SetWidths(array(17.14,17.14,20.14,80.14,20.14,15.14,20.14));
                $pdf->SetTextColor(0,0,0);
                $total_base=0;
                $total_valor=0;
                // foreach($factura_compra as $detail){
                //     if($detail->id_imp==$id_imp){
                //         $doc=substr($detail->descripcion,6,9);
                //         $data=array(
                //             $doc."Centrado",
                //             date("d/m/Y", strtotime($detail->fecha_emision))."Centrado",
                //             $detail->identificacion."Centrado",
                //             utf8_decode($detail->nombre),
                //             number_format($detail->baserenta,2,'.',',')."Derecha",
                //             $detail->porcentajerenta."Derecha",
                //             number_format($detail->cantidadrenta,2,'.',',')."Derecha"
                //         );
                //         $total_base+=$detail->baserenta;
                //         $total_valor+=$detail->cantidadrenta;
                //         $pdf->RowAts($data, $margin);
                //     }
                // }
                $pdf->SetFont('Arial', '', 7);
                foreach($factura_compra_renta as $detail){
                    if($detail->id_imp==$id_imp){
                        $pdf->SetFillColor(174, 176, 208);
                        $doc=substr($detail->descripcion,6,9);
                        $pdf->Cell(17.14,4,$doc,0,0,'C',1);
                        $pdf->Cell(17.14,4,date("d/m/Y", strtotime($detail->fecha_emision)),0,0,'C',1);
                        $pdf->Cell(17.14,4,$detail->identificacion,0,0,'C',1);
                        $pdf->Cell(83.14,4,utf8_decode($detail->nombre),0,0,'L',1);
                        $pdf->Cell(20.14,4,number_format($detail->baserenta,2,'.',','),0,0,'R',1);
                        $pdf->Cell(15.14,4,$detail->porcentajerenta,0,0,'C',1);
                        $pdf->Cell(20.14,4,number_format($detail->cantidadrenta,2,'.',','),0,0,'R',1);
                        $pdf->SetFillColor(255,255,255);
                        $pdf->Cell(20.14,4,'',0,1,'R',1);
                        $total_base+=$detail->baserenta;
                        $total_valor+=$detail->cantidadrenta;
                    }
                }
                $head_facta=$pdf->GetY();
                $pdf->SetXY(10,$head_facta);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(134.56,4,'Total',0,0,'R',0);
                $pdf->Cell(20.14,4,number_format($total_base,2,'.',','),'T',0,'R',0);
                $pdf->Cell(15.14,4,'','T',0,'R',0);
                $pdf->Cell(20.14,4,number_format($total_valor,2,'.',','),'T',0,'R',0);
                $head_total=$pdf->GetY();
                array_push($array_head_total,$head_total." Total:".$total_base);
                // if($head_total>=199){
                //     $otro_total_2=$pdf->GetPageHeight()-$head_total;
                //     $pdf->SetAutoPageBreak(true,$otro_total_2);
                // }else{
                //     $pdf->SetAutoPageBreak(true,10);
                // }
                $pdf->Ln(5);
                $totales_base+=$total_base;
                $totales_valor+=$total_valor;
            }
        }
        if($exist_retencion_renta_compra>0){
            $pdf->Ln(5);
            $pdf->SetX(10);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->Cell(134.56,4,'TOTAL GENERAL RETENCION A LA RENTA EN COMPRAS',0,0,'C',0);
            $pdf->Cell(20.14,4,number_format($totales_base,2,'.',','),0,0,'R',0);
            $pdf->Cell(15.14,4,'',0,0,'R',0);
            $pdf->Cell(20.14,4,number_format($totales_valor,2,'.',','),0,1,'R',0);
            $pdf->Ln(5);
        }
        $totales_base=0;
        $totales_valor=0;
        foreach ($retencion_iva_compra as $detalle) {
            if($detalle->nro_registo>0){
                $exist_retencion_iva_compra++;
                $id_imp=$detalle->id_imp;
                $pdf->SetX(10);
                $pdf->SetFont('Arial', 'B', 8);
                $pdf->MultiCell(190,4,"Cod: ".$detalle->cod_imp.utf8_decode("  Retencion IVA Compra:")." ".utf8_decode($detalle->descrip_imp),0,'C',0);
                $height_products=$pdf->GetY();
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->SetFillColor(255,255,255);
                $pdf->SetXY(10,$height_products);
                $margin=10;
                // $pdf->Cell(17.14,4,'Documento','TB',0,'C',0);
                // $pdf->Cell(17.14,4,'Fecha','TB',0,'C',0);
                // $pdf->Cell(17.14,4,'CI/Ruc','TB',0,'C',0);
                // $pdf->Cell(83.14,4,'Proveedor','TB',0,'C',1);
                // $pdf->Cell(20.14,4,'Base','TB',0,'C',1);
                // $pdf->Cell(15.14,4,'%','TB',0,'C',1);
                // $pdf->Cell(20.14,4,'Valor','TB',1,'C',1);
                $pdf->SetFillColor(38, 46, 211);
                $pdf->SetTextColor(255,255,255);
                $pdf->Cell(17.14,4,'Documento','TB',0,'C',1);
                $pdf->Cell(17.14,4,'Fecha','TB',0,'C',1);
                $pdf->Cell(17.14,4,'CI/Ruc','TB',0,'C',1);
                $pdf->Cell(83.14,4,'Proveedor','TB',0,'C',1);
                $pdf->Cell(20.14,4,'Base','TB',0,'C',1);
                $pdf->Cell(15.14,4,'%','TB',0,'C',1);
                $pdf->Cell(20.14,4,'Valor','TB',1,'C',1);



                // $pdf->SetXY($margin, $height_products);
                // //$pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                // //$pdf->SetXY($margin+25, $height_products);
                // $pdf->MultiCell(17.14, 4, utf8_decode('Documento'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14, $height_products);
                // $pdf->MultiCell(17.14, 4, utf8_decode('Fecha'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('CI/Ruc'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14, $height_products);
                // $pdf->MultiCell(80.14, 4, utf8_decode('Proveedor'), 'TB', 'C', 1);
                // //$pdf->SetXY($margin+27.85+27.85+27.85+27.85, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                // // $pdf->SetXY(120, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                // // $pdf->SetXY(132, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                // //$pdf->SetXY(144, $height_products);
                // //$pdf->MultiCell(20, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('Base'), 'TB', 'R', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14+20.14, $height_products);
                // $pdf->MultiCell(15.14, 4, utf8_decode('%'), 'TB', 'R', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14+20.14+15.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('Valor'), 'TB', 'R', 1);
                // //$pdf->SetXY($margin+17+118.5+15+14+15+17, $height_products);
                
                // //dd("X=".$margin."Y=".$height_products);
                // $y = $height_products + 8;
                // $pdf->SetFont('Arial', '', 6);
                // $pdf->SetFillColor(255, 255, 255);
                // $pdf->SetFillColor(85, 175, 84);
                // $pdf->SetXY($margin, $height_products+4);
                // $pdf->SetWidths(array(17.14,17.14,20.14,80.14,20.14,15.14,20.14));
                $pdf->SetTextColor(0,0,0);
                $total_base=0;
                $total_valor=0;
                // foreach($factura_compra as $detail){
                //     if($detail->id_imp==$id_imp){
                //         $doc=substr($detail->descripcion,6,9);
                //         $data=array(
                //             $doc."Centrado",
                //             date("d/m/Y", strtotime($detail->fecha_emision))."Centrado",
                //             $detail->identificacion."Centrado",
                //             utf8_decode($detail->nombre),
                //             number_format($detail->baserenta,2,'.',',')."Derecha",
                //             $detail->porcentajerenta."Derecha",
                //             number_format($detail->cantidadrenta,2,'.',',')."Derecha"
                //         );
                //         $total_base+=$detail->baserenta;
                //         $total_valor+=$detail->cantidadrenta;
                //         $pdf->RowAts($data, $margin);
                //     }
                // }
                $pdf->SetFont('Arial', '', 7);
                foreach($factura_compra_iva as $detail){
                    if($detail->id_imp==$id_imp){
                        $pdf->SetFillColor(174, 176, 208);
                        $doc=substr($detail->descripcion,6,9);
                        $pdf->Cell(17.14,4,$doc,0,0,'C',1);
                        $pdf->Cell(17.14,4,date("d/m/Y", strtotime($detail->fecha_emision)),0,0,'C',1);
                        $pdf->Cell(17.14,4,$detail->identificacion,0,0,'C',1);
                        $pdf->Cell(83.14,4,utf8_decode($detail->nombre),0,0,'L',1);
                        $pdf->Cell(20.14,4,number_format($detail->baserenta,2,'.',','),0,0,'R',1);
                        $pdf->Cell(15.14,4,$detail->porcentajerenta,0,0,'C',1);
                        $pdf->Cell(20.14,4,number_format($detail->cantidadrenta,2,'.',','),0,0,'R',1);
                        $pdf->SetFillColor(255,255,255);
                        $pdf->Cell(20.14,4,'',0,1,'R',1);
                        $total_base+=$detail->baserenta;
                        $total_valor+=$detail->cantidadrenta;
                    }
                }
                $head_facta_iva=$pdf->GetY();
                $pdf->SetXY(10,$head_facta_iva);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(134.56,4,'Total',0,0,'R',0);
                $pdf->Cell(20.14,4,number_format($total_base,2,'.',','),'T',0,'R',0);
                $pdf->Cell(15.14,4,'','T',0,'R',0);
                $pdf->Cell(20.14,4,number_format($total_valor,2,'.',','),'T',0,'R',0);
                $head_total_iva_compra=$pdf->GetY();
                array_push($array_head_total,$head_total_iva_compra." Total:".$total_base);
                // if($head_total_iva_compra>=199){
                //     $otro_total_ica_compra=$pdf->GetPageHeight()-$head_total_iva_compra;
                //     $pdf->SetAutoPageBreak(true,$otro_total_ica_compra);
                // }else{
                //     $pdf->SetAutoPageBreak(true,10);
                // }
                $pdf->Ln(5);
                $totales_base+=$total_base;
                $totales_valor+=$total_valor;
            }
        }
        if($exist_retencion_iva_compra>0){
            $pdf->Ln(5);
            $pdf->SetX(10);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->Cell(134.56,4,'TOTAL GENERAL RETENCION IVA EN COMPRAS',0,0,'C',0);
            $pdf->Cell(20.14,4,number_format($totales_base,2,'.',','),0,0,'R',0);
            $pdf->Cell(15.14,4,'',0,0,'R',0);
            $pdf->Cell(20.14,4,number_format($totales_valor,2,'.',','),0,1,'R',0);
            $pdf->Ln(5);
        }
        $totales_base=0;
        $totales_valor=0;
        foreach ($retencion_renta_venta as $detalle) {
            if($detalle->nro_registo>0){
                $exist_retencion_renta_venta++;
                $id_imp=$detalle->id_imp;
                $pdf->SetX(10);
                $pdf->SetFont('Arial', 'B', 8);
                $pdf->MultiCell(190,4,"Cod: ".$detalle->cod_imp.utf8_decode("  Retencion Renta Venta:")." ".utf8_decode($detalle->descrip_imp),0,'C',0);
                $height_products=$pdf->GetY();
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->SetFillColor(255,255,255);
                $pdf->SetXY(10,$height_products);
                $margin=10;
                // $pdf->Cell(17.14,4,'Documento','TB',0,'C',0);
                // $pdf->Cell(17.14,4,'Fecha','TB',0,'C',0);
                // $pdf->Cell(17.14,4,'CI/Ruc','TB',0,'C',0);
                // $pdf->Cell(83.14,4,'Proveedor','TB',0,'C',1);
                // $pdf->Cell(20.14,4,'Base','TB',0,'C',1);
                // $pdf->Cell(15.14,4,'%','TB',0,'C',1);
                // $pdf->Cell(20.14,4,'Valor','TB',1,'C',1);
                $pdf->SetFillColor(38, 46, 211);
                $pdf->SetTextColor(255,255,255);
                $pdf->Cell(17.14,4,'Documento','TB',0,'C',1);
                $pdf->Cell(17.14,4,'Fecha','TB',0,'C',1);
                $pdf->Cell(17.14,4,'CI/Ruc','TB',0,'C',1);
                $pdf->Cell(83.14,4,'Proveedor','TB',0,'C',1);
                $pdf->Cell(20.14,4,'Base','TB',0,'C',1);
                $pdf->Cell(15.14,4,'%','TB',0,'C',1);
                $pdf->Cell(20.14,4,'Valor','TB',1,'C',1);



                // $pdf->SetXY($margin, $height_products);
                // //$pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                // //$pdf->SetXY($margin+25, $height_products);
                // $pdf->MultiCell(17.14, 4, utf8_decode('Documento'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14, $height_products);
                // $pdf->MultiCell(17.14, 4, utf8_decode('Fecha'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('CI/Ruc'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14, $height_products);
                // $pdf->MultiCell(80.14, 4, utf8_decode('Proveedor'), 'TB', 'C', 1);
                // //$pdf->SetXY($margin+27.85+27.85+27.85+27.85, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                // // $pdf->SetXY(120, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                // // $pdf->SetXY(132, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                // //$pdf->SetXY(144, $height_products);
                // //$pdf->MultiCell(20, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('Base'), 'TB', 'R', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14+20.14, $height_products);
                // $pdf->MultiCell(15.14, 4, utf8_decode('%'), 'TB', 'R', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14+20.14+15.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('Valor'), 'TB', 'R', 1);
                // //$pdf->SetXY($margin+17+118.5+15+14+15+17, $height_products);
                
                // //dd("X=".$margin."Y=".$height_products);
                // $y = $height_products + 8;
                // $pdf->SetFont('Arial', '', 6);
                // $pdf->SetFillColor(255, 255, 255);
                // $pdf->SetFillColor(85, 175, 84);
                // $pdf->SetXY($margin, $height_products+4);
                // $pdf->SetWidths(array(17.14,17.14,20.14,80.14,20.14,15.14,20.14));
                $pdf->SetTextColor(0,0,0);
                $total_base=0;
                $total_valor=0;
                // foreach($factura_compra as $detail){
                //     if($detail->id_imp==$id_imp){
                //         $doc=substr($detail->descripcion,6,9);
                //         $data=array(
                //             $doc."Centrado",
                //             date("d/m/Y", strtotime($detail->fecha_emision))."Centrado",
                //             $detail->identificacion."Centrado",
                //             utf8_decode($detail->nombre),
                //             number_format($detail->baserenta,2,'.',',')."Derecha",
                //             $detail->porcentajerenta."Derecha",
                //             number_format($detail->cantidadrenta,2,'.',',')."Derecha"
                //         );
                //         $total_base+=$detail->baserenta;
                //         $total_valor+=$detail->cantidadrenta;
                //         $pdf->RowAts($data, $margin);
                //     }
                // }
                $pdf->SetFont('Arial', '', 7);
                foreach($factura_venta_renta as $detail){
                    if($detail->id_imp==$id_imp){
                        $pdf->SetFillColor(174, 176, 208);
                        $doc=substr($detail->descripcion,-19,9);
                        $pdf->Cell(17.14,4,$doc,0,0,'C',1);
                        $pdf->Cell(17.14,4,date("d/m/Y", strtotime($detail->fecha_emision)),0,0,'C',1);
                        $pdf->Cell(17.14,4,$detail->identificacion,0,0,'C',1);
                        $pdf->Cell(83.14,4,utf8_decode($detail->nombre),0,0,'L',1);
                        $pdf->Cell(20.14,4,number_format($detail->baserenta,2,'.',','),0,0,'R',1);
                        $pdf->Cell(15.14,4,$detail->porcentajerenta,0,0,'C',1);
                        $pdf->Cell(20.14,4,number_format($detail->cantidadrenta,2,'.',','),0,0,'R',1);
                        $pdf->SetFillColor(255,255,255);
                        $pdf->Cell(20.14,4,'',0,1,'R',1);
                        $total_base+=$detail->baserenta;
                        $total_valor+=$detail->cantidadrenta;
                    }
                }
                $head_facta=$pdf->GetY();
                $pdf->SetXY(10,$head_facta);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(134.56,4,'Total',0,0,'R',0);
                $pdf->Cell(20.14,4,number_format($total_base,2,'.',','),'T',0,'R',0);
                $pdf->Cell(15.14,4,'','T',0,'R',0);
                $pdf->Cell(20.14,4,number_format($total_valor,2,'.',','),'T',0,'R',0);
                $head_total=$pdf->GetY();
                array_push($array_head_total,$head_total." Total:".$total_base);
                // if($head_total>=199){
                //     $otro_total_2=$pdf->GetPageHeight()-$head_total;
                //     $pdf->SetAutoPageBreak(true,$otro_total_2);
                // }else{
                //     $pdf->SetAutoPageBreak(true,10);
                // }
                $pdf->Ln(5);
                $totales_base+=$total_base;
                $totales_valor+=$total_valor;
            }
        }
        if($exist_retencion_renta_venta>0){
            $pdf->Ln(5);
            $pdf->SetX(10);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->Cell(134.56,4,'TOTAL GENERAL RETENCION A LA RENTA EN VENTAS',0,0,'C',0);
            $pdf->Cell(20.14,4,number_format($totales_base,2,'.',','),0,0,'R',0);
            $pdf->Cell(15.14,4,'',0,0,'R',0);
            $pdf->Cell(20.14,4,number_format($totales_valor,2,'.',','),0,1,'R',0);
            $pdf->Ln(5);
        }
        $totales_base=0;
        $totales_valor=0;
        foreach ($retencion_iva_venta as $detalle) {
            if($detalle->nro_registo>0){
                $exist_retencion_iva_venta++;
                $id_imp=$detalle->id_imp;
                $pdf->SetX(10);
                $pdf->SetFont('Arial', 'B', 8);
                $pdf->MultiCell(190,4,"Cod: ".$detalle->cod_imp.utf8_decode("  Retencion IVA Venta:")." ".utf8_decode($detalle->descrip_imp),0,'C',0);
                $height_products=$pdf->GetY();
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->SetFillColor(255,255,255);
                $pdf->SetXY(10,$height_products);
                $margin=10;
                // $pdf->Cell(17.14,4,'Documento','TB',0,'C',0);
                // $pdf->Cell(17.14,4,'Fecha','TB',0,'C',0);
                // $pdf->Cell(17.14,4,'CI/Ruc','TB',0,'C',0);
                // $pdf->Cell(83.14,4,'Proveedor','TB',0,'C',1);
                // $pdf->Cell(20.14,4,'Base','TB',0,'C',1);
                // $pdf->Cell(15.14,4,'%','TB',0,'C',1);
                // $pdf->Cell(20.14,4,'Valor','TB',1,'C',1);
                $pdf->SetFillColor(38, 46, 211);
                $pdf->SetTextColor(255,255,255);
                $pdf->Cell(17.14,4,'Documento','TB',0,'C',1);
                $pdf->Cell(17.14,4,'Fecha','TB',0,'C',1);
                $pdf->Cell(17.14,4,'CI/Ruc','TB',0,'C',1);
                $pdf->Cell(83.14,4,'Proveedor','TB',0,'C',1);
                $pdf->Cell(20.14,4,'Base','TB',0,'C',1);
                $pdf->Cell(15.14,4,'%','TB',0,'C',1);
                $pdf->Cell(20.14,4,'Valor','TB',1,'C',1);



                // $pdf->SetXY($margin, $height_products);
                // //$pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                // //$pdf->SetXY($margin+25, $height_products);
                // $pdf->MultiCell(17.14, 4, utf8_decode('Documento'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14, $height_products);
                // $pdf->MultiCell(17.14, 4, utf8_decode('Fecha'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('CI/Ruc'), 'TB', 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14, $height_products);
                // $pdf->MultiCell(80.14, 4, utf8_decode('Proveedor'), 'TB', 'C', 1);
                // //$pdf->SetXY($margin+27.85+27.85+27.85+27.85, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                // // $pdf->SetXY(120, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                // // $pdf->SetXY(132, $height_products);
                // // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                // //$pdf->SetXY(144, $height_products);
                // //$pdf->MultiCell(20, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('Base'), 'TB', 'R', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14+20.14, $height_products);
                // $pdf->MultiCell(15.14, 4, utf8_decode('%'), 'TB', 'R', 1);
                // $pdf->SetXY($margin+17.14+17.14+20.14+80.14+20.14+15.14, $height_products);
                // $pdf->MultiCell(20.14, 4, utf8_decode('Valor'), 'TB', 'R', 1);
                // //$pdf->SetXY($margin+17+118.5+15+14+15+17, $height_products);
                
                // //dd("X=".$margin."Y=".$height_products);
                // $y = $height_products + 8;
                // $pdf->SetFont('Arial', '', 6);
                // $pdf->SetFillColor(255, 255, 255);
                // $pdf->SetFillColor(85, 175, 84);
                // $pdf->SetXY($margin, $height_products+4);
                // $pdf->SetWidths(array(17.14,17.14,20.14,80.14,20.14,15.14,20.14));
                $pdf->SetTextColor(0,0,0);
                $total_base=0;
                $total_valor=0;
                // foreach($factura_compra as $detail){
                //     if($detail->id_imp==$id_imp){
                //         $doc=substr($detail->descripcion,6,9);
                //         $data=array(
                //             $doc."Centrado",
                //             date("d/m/Y", strtotime($detail->fecha_emision))."Centrado",
                //             $detail->identificacion."Centrado",
                //             utf8_decode($detail->nombre),
                //             number_format($detail->baserenta,2,'.',',')."Derecha",
                //             $detail->porcentajerenta."Derecha",
                //             number_format($detail->cantidadrenta,2,'.',',')."Derecha"
                //         );
                //         $total_base+=$detail->baserenta;
                //         $total_valor+=$detail->cantidadrenta;
                //         $pdf->RowAts($data, $margin);
                //     }
                // }
                $pdf->SetFont('Arial', '', 7);
                foreach($factura_venta_iva as $detail){
                    if($detail->id_imp==$id_imp){
                        $pdf->SetFillColor(174, 176, 208);
                        $doc=substr($detail->descripcion,-19,9);
                        $pdf->Cell(17.14,4,$doc,0,0,'C',1);
                        $pdf->Cell(17.14,4,date("d/m/Y", strtotime($detail->fecha_emision)),0,0,'C',1);
                        $pdf->Cell(17.14,4,$detail->identificacion,0,0,'C',1);
                        $pdf->Cell(83.14,4,utf8_decode($detail->nombre),0,0,'L',1);
                        $pdf->Cell(20.14,4,number_format($detail->baserenta,2,'.',','),0,0,'R',1);
                        $pdf->Cell(15.14,4,$detail->porcentajerenta,0,0,'C',1);
                        $pdf->Cell(20.14,4,number_format($detail->cantidadrenta,2,'.',','),0,0,'R',1);
                        $pdf->SetFillColor(255,255,255);
                        $pdf->Cell(20.14,4,'',0,1,'R',1);
                        $total_base+=$detail->baserenta;
                        $total_valor+=$detail->cantidadrenta;
                    }
                }
                $head_facta_iva=$pdf->GetY();
                $pdf->SetXY(10,$head_facta_iva);
                $pdf->SetFont('Arial', 'B', 7);
                $pdf->Cell(134.56,4,'Total',0,0,'R',0);
                $pdf->Cell(20.14,4,number_format($total_base,2,'.',','),'T',0,'R',0);
                $pdf->Cell(15.14,4,'','T',0,'R',0);
                $pdf->Cell(20.14,4,number_format($total_valor,2,'.',','),'T',0,'R',0);
                $head_total_iva_compra=$pdf->GetY();
                array_push($array_head_total,$head_total_iva_compra." Total:".$total_base);
                // if($head_total_iva_compra>=199){
                //     $otro_total_ica_compra=$pdf->GetPageHeight()-$head_total_iva_compra;
                //     $pdf->SetAutoPageBreak(true,$otro_total_ica_compra);
                // }else{
                //     $pdf->SetAutoPageBreak(true,10);
                // }
                $pdf->Ln(5);
                $totales_base+=$total_base;
                $totales_valor+=$total_valor;
            }
        }
        if($exist_retencion_iva_venta>0){
            $pdf->Ln(5);
            $pdf->SetX(10);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->Cell(134.56,4,'TOTAL GENERAL RETENCION IVA EN VENTAS',0,0,'C',0);
            $pdf->Cell(20.14,4,number_format($totales_base,2,'.',','),0,0,'R',0);
            $pdf->Cell(15.14,4,'',0,0,'R',0);
            $pdf->Cell(20.14,4,number_format($totales_valor,2,'.',','),0,1,'R',0);
            $pdf->Ln(5);
        }
        $totales_base=0;
        $totales_valor=0;
        $pdf->Ln(20);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->SetXY(40,$pdf->GetY());
        $pdf->Cell(45,4,'','B',0,'R',0);
        $pdf->Cell(39,4,'',0,0,'R',0);
        $pdf->Cell(45,4,'','B',2,'R',0);
        $pdf->SetXY(40,$pdf->GetY());
        $pdf->Cell(45,4,utf8_decode($empresa->nombre_contador),0,0,'C',0);
        $pdf->Cell(39,4,'',0,0,'R',0);
        $pdf->Cell(45,4,utf8_decode($empresa->nomb_representante),0,2,'C',0);
        //dd($array_head_total);
        if (!$generar_en_servidor) {
            return $pdf->Output( "ats_detalle.pdf", "D");
        } else if ($generar_en_servidor && !is_null($ruta)) {
            if (file_exists($ruta)) {
                $name = $id . '.pdf';
                $location = $ruta . "/" . $name;
                $pdf->Output("F", $location);
                return json_encode(
                    array(
                        "location" => $location,
                        "name" => $name)
                );
            } else {
                throw new Exception("No se pudo generar el ats detalle");
            }

        } else if ($generar_en_servidor && is_null($ruta)) {
            throw new Exception("La ruta para el ats detalle no es valida.");
        } 

    }
    public function proforma($id,$datos, $id_proforma, $factura_info, $generar_en_servidor = false, $ruta = null)
    {
        setlocale(LC_TIME, "spanish");
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        //dd($factura_info->id_empresa);

        if(preg_match('/grupo solis/i', $datos[0]->nombre_empresa)){
            //if($factura_info->id_empresa==1){
            $pdf->AliasNbPages();
            $pdf->AddPage();
            $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
            $pdf->SetAutoPageBreak(1, 4);
            $width = $pdf->GetPageWidth();
            if ($datos[0]->logo!==null && file_exists($logo)) {
                if($factura_info->id_empresa==1){
                    
                $pdf->Image($logo, 5, 10, 55, 20);
                //$pdf->Image($logo, 5, 10, 25, 20);
                
                }else{
                    
                $pdf->Image($logo, 5, 6, 50, 35);
                
                }
                
            } else {
                $pdf->SetX(10);
                $pdf->SetTextColor(255, 0, 0);
                $pdf->SetFont('Arial', 'B', 10);
                $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 0, 'C', 0);
                
            }
            if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
            //if ($factura_info->id_empresa==1) {
                /*$pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 31, 13, 30, 25);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 30, 5, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 65, 9, 20, 20);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 90, 17, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/armadura.jpg', 90, 6, 28, 13);*/
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/blacklinesafe.jpg', 130, 6, 28, 13);
            }
            //dd($datos[0]);
            $y_img=40;
            $pdf->SetXY(5, 35);
            /*$pdf->SetTextColor(48,132,70);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 0, 'L', 0);*/
            $y_cot="";
            if($factura_info->id_empresa==1){
                $y_cot=35;
            }else{
                $y_cot=15;
            }
            $pdf->SetXY($width-40,$y_cot);
            //$pdf->SetXY($width-40,$y_cot-20);
            $pdf->SetTextColor(48,132,70);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->Cell(25, 10, utf8_decode('COTIZACIÃN'), 0, 1, 'L', 0);
    
            $pdf->SetXY($width-60,$y_cot+10);
            //$pdf->SetXY($width-60,$y_cot-10);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(25, 5, utf8_decode('FECHA'), 0, 0, 'L', 0);
            $fecha_emision="";
            $fecha_emision=date("d/m/Y", strtotime($datos[0]->fecha_emision));
            $pdf->Cell(25, 5, isset($datos[0]->fecha_emision) ? utf8_decode($fecha_emision) : 'fecha_emision', 1,1, 'C', 0);
            $pdf->SetXY($width-60,$y_cot+15);
            //$pdf->SetXY($width-60,$y_cot-5);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(25, 5, utf8_decode('COTIZACIÃN'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode($id_proforma), 1, 1, 'C', 0);
            $pdf->SetXY($width-60,$y_cot+20);
            //$pdf->SetXY($width-60,$y_cot);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(25, 5, utf8_decode('RUC'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode($datos[0]->ruc_empresa), 1, 1, 'C', 0);
            $pdf->SetXY($width-60,$y_cot+25);
            //$pdf->SetXY($width-60,$y_cot+5);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $fecha_validez=date("d/m/Y", strtotime($factura_info->fecha_expiracion));;
            $pdf->Cell(25, 5, utf8_decode('VALIDO HASTA'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode($fecha_validez), 1, 1, 'C', 0);
            $pdf->SetXY(5,$y_img+5);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Direccion:'), 0, 0, 'L', 0);
            $pdf->Cell(65, 5, utf8_decode($datos[0]->direccion_empresa), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+10);
            $pdf->SetTextColor(0,0,0);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
            $pdf->Cell(65, 5,utf8_decode($datos[0]->ciudad), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+15);
            $pdf->SetTextColor(0,0,0);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Sitio Web:'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode(/*"                ".*/$factura_info->urlweb), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+20);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('TelÃ©fono:'), 0, 0, 'L', 0);
            $pdf->Cell(20, 5, utf8_decode(/*"                (593)".*/"(593)".$factura_info->telefono), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+25);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Asesor de venta:'), 0, 0, 'L', 0);
            $pdf->Cell(75, 5, isset($datos[0]->vendedor) ? utf8_decode(/*"    ".*/$datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
            $pdf->SetXY(5,$y_img+30);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('TelÃ©fono Vendedor:'), 0, 0, 'L', 0);
            if($datos[0]->telefono_vendedor){
                $pdf->Cell(25, 5, "(593)".$datos[0]->telefono_vendedor, 0, 0, 'L', 0);
            }else{
                $pdf->Cell(25, 5, $datos[0]->telefono_vendedor, 0, 0, 'L', 0);
            }
            
            $pdf->SetXY(5,$y_img+35);
            $pdf->SetFillColor(156,156,156);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->SetDrawColor(100, 0, 0);
            $pdf->SetFont('Arial', '', 7);
            $pdf->Cell(95, 5, utf8_decode('CLIENTE'), 0, 1, 'L', 1);
            $pdf->SetXY(5,$y_img+40);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(75, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"CI/RUC:                   ".utf8_decode($datos[0]->identificacion), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"Email:                       ".utf8_decode($datos[0]->email), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"Ciudad:                     ".utf8_decode($datos[0]->ciudad), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"Direccion:                 ".utf8_decode($datos[0]->direccion), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,utf8_decode("TelÃ©fono:                  ").utf8_decode($datos[0]->telefono), 0, 2, 'L', 0);
            
            //$pdf->Cell(155, 8, 'Proyecto: '.ucfirst($proyecto), 0, 1, 'C', 0);
            //$pdf->SetXY(165, 10);
            // HEADER
        
    
            // INFORMATION HEADER
            $margin = 5;
            $height = $pdf->GetY();
            $cli_atencion = '';
        
            $pdf->SetFont('Helvetica', 'B', 8);
            $pdf->Cell(20, 5, utf8_decode('APRECIADO CLIENTE:'), 0, 2, 'L', 0);
            $pdf->SetFont('Helvetica', '', 8);
            $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
            $pdf->SetFillColor(85, 175, 84);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->SetDrawColor(0, 0, 0);
            if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                // SLOGAN
                $pdf->SetXY($margin, $height + 15);
                $pdf->SetFont('Helvetica', 'B', 10);
                $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                $height_products = $height + 25;
            } else {
                $height_products = $height + 15;
            }
            //cabecera de detalles de productos
            $pdf->SetFont('Helvetica', 'B', 6);
            if($factura_info->id_empresa==1){
                $pdf->SetFillColor(141, 207, 140);
            }else{
                $pdf->SetFillColor(141, 207, 240);
            }
            $exist_cps=0;
            foreach ($datos as $detail) {
                if($detail->cpc){
                    $exist_cps++;
                }
            }
            //dd("X=".$margin."Y=".$height_products);
            $pdf->SetTextColor(0, 0, 0);
            if($exist_cps>0){
                $pdf->SetXY($margin, $height_products);
                $pdf->MultiCell(10, 8, utf8_decode('CPC'), 1, 'C', 1);
                $pdf->SetXY($margin+10, $height_products);
                $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                $pdf->SetXY(30+10, $height_products);
                $pdf->MultiCell(16, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                $pdf->SetXY(47+9, $height_products);
                $pdf->MultiCell(24, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                $pdf->SetXY(72+8, $height_products);
                $pdf->MultiCell(17, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                $pdf->SetXY(92+5, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('USO'), 1, 'C', 1);
                $pdf->SetXY(108+1, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                $pdf->SetXY(120+1, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                $pdf->SetXY(132+1, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                $pdf->SetXY(144+1, $height_products);
                $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                $pdf->SetXY(158+1, $height_products);
                $pdf->MultiCell(15, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                $pdf->SetXY(173+1, $height_products);
                $pdf->MultiCell(17, 4, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                $pdf->SetXY(190+1, $height_products);
                $pdf->MultiCell(14, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                //dd("X=".$margin."Y=".$height_products);
                $y = $height_products + 8;
                $pdf->SetFont('Helvetica', '', 4);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(85, 175, 84);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(10,25, 16, 24, 17, 12, 12, 12, 12, 14, 15, 17, 14));
            }else{
                $pdf->SetXY($margin, $height_products);
                $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                $pdf->SetXY(30, $height_products);
                $pdf->MultiCell(17, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                $pdf->SetXY(47, $height_products);
                $pdf->MultiCell(25, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                $pdf->SetXY(72, $height_products);
                $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                $pdf->SetXY(92, $height_products);
                $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                $pdf->SetXY(108, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                $pdf->SetXY(120, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                $pdf->SetXY(132, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                $pdf->SetXY(144, $height_products);
                $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                $pdf->SetXY(158, $height_products);
                $pdf->MultiCell(15, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                $pdf->SetXY(173, $height_products);
                $pdf->MultiCell(17, 4, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                $pdf->SetXY(190, $height_products);
                $pdf->MultiCell(15, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                //dd("X=".$margin."Y=".$height_products);
                $y = $height_products + 8;
                $pdf->SetFont('Helvetica', '', 4);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(85, 175, 84);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(25, 17, 25, 20, 16, 12, 12, 12, 14, 15, 17, 15));
            }
            //dd($datos);
            //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
            $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
            //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
            $sub_total=0;
            $descuento=0;
            $iva=0;
            $total_fact=0;
            $suma_sub_total=0;
            $suma_descuento=0;
            $suma_iva=0;
            $suma_total_fact=0;
            $array_prods=[];
            //dd($datos);
            foreach ($datos as $detail) {
                $caract=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->caracteristicas);
                $norm=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->normativa);
                $uso=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->uso);
                $data = array(
                    utf8_decode(trim($detail->nombre)."Centrado"),
                    utf8_decode($caract."Centrado"),
                    utf8_decode($norm."Centrado"),
                    utf8_decode($uso."Centrado"),
                    utf8_decode(trim($detail->marca)."Centrado"),
                    
                    utf8_decode(trim($detail->nombre_presentacion)."Centrado"),
                    utf8_decode(trim($detail->unidad_medida)."Centrado"),
                    utf8_decode($detail->cantidad."Centrado"),
                    utf8_decode("$ ".$detail->precio."Derecha"),
                    utf8_decode("$ ".$detail->total_pro."Derecha"),
                    $detail->tiempo_entrega!==null ? utf8_decode($detail->tiempo_entrega."Centrado") : utf8_decode('INMEDIATA'),
                        
                 );
                
                
                    $sub_total=$detail->subtotal;
                    $descuento=$detail->descuento;
                    $iva=$detail->iva;
                    $total_fact=$detail->total;
                if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                //if ($detail->imagen) {
                    //dd($pdf->GetY());
                    if($exist_cps>0){ 
                        
                            array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX()+10, $pdf->GetY(), 25, 25));
                        
                        
                    }else{
                        
                            array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                        
                    }
                    
                } else {
                    array_unshift($data, utf8_decode('* sin imagen'."Centrado"));
                }
                if($exist_cps>0){
                    array_unshift($data, utf8_decode($detail->cpc."Centrado"));
                }
                //dd("Imagen:".$imagen.$detail->imagen);
                $pdf->Row($data, $margin+5);
                $head_table=$pdf->GetY();
                array_push($array_prods,$head_table." Total");
            }
            
            $suma_sub_total=number_format($sub_total,2,".",",");
            $suma_descuento=number_format($descuento,2,".",",");
            $suma_iva=number_format($iva,2,".",",");
            $suma_total_fact=number_format($total_fact,2,".",",");
            //dd($head_table." detallee");
            if($exist_cps>0){
                if($head_table>250){
                    $otro_valor=$pdf->GetPageHeight()-$head_table;
                    $pdf->SetAutoPageBreak(true,$otro_valor);
                }
                $pdf->SetXY(133, $head_table);
                $pdf->SetX(133);
            }else{
                if($head_table>250){
                    $otro_valor=$pdf->GetPageHeight()-$head_table;
                    $pdf->SetAutoPageBreak(true,$otro_valor);
                }
                $pdf->SetXY(132, $head_table);
                $pdf->SetX(132);
            }
            
            $pdf->SetFont('Helvetica', 'B', 8);
            if($exist_cps>0){
                
                $pdf->Cell(41, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                $head_subtotal=$pdf->GetY();
            }else{
                
                $pdf->Cell(41, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                $head_subtotal=$pdf->GetY();
            }
            
            $pdf->SetFont('Helvetica', '', 8);
            //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
            $pdf->Cell(17, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
            
            if($exist_cps>0){
                $pdf->SetX(133);
            }else{
                $pdf->SetX(132);
            }
            $pdf->SetFont('Helvetica', 'B', 8);
            
            if($exist_cps>0){
                $pdf->Cell(41, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
            }else{
                $pdf->Cell(41, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
            }
            $pdf->SetFont('Helvetica', '', 8);
            //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
            $pdf->Cell(17, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
            $pdf->SetX(136);
            if($exist_cps>0){
                $pdf->SetX(133);
            }else{
                $pdf->SetX(132);
            }
            $pdf->SetFont('Helvetica', 'B', 8);
            
            if($exist_cps>0){
                $pdf->Cell(41, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
            }else{
                $pdf->Cell(41, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
            }
            $pdf->SetFont('Helvetica', '', 8);
            //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
            $pdf->Cell(17, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
            if($exist_cps>0){
                $pdf->SetX(133);
            }else{
                $pdf->SetX(132);
            }
            /*if($factura_info->id_empresa==1){
                $pdf->SetFillColor(189,236,182);
            }else{
                $pdf->SetFillColor(93,155,155);
            }*/
            $pdf->SetFillColor(156,156,156);
            $pdf->SetFont('Helvetica', 'B', 8);
            
            if($exist_cps>0){
                $pdf->Cell(41, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
            }else{
                $pdf->Cell(41, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
            }
            $pdf->SetFont('Helvetica', '', 8);
            $pdf->Cell(17, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 1);
            $pdf->Ln();
            // if($head_table>250){
            //     $pdf->SetXY(5, $head_table);
            // }else{
            //     $pdf->SetXY(5, $head_table+5);
            // }
            
            //dd($head_subtotal." subtotal");
            if($head_subtotal<12){
                $pdf->SetXY(5, $head_subtotal);
            }else{
                $pdf->SetXY(5, $head_table+5);
            }
            
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->Cell(27, 5,'Observaciones:', 0, 0, 'L', 0);
            $pdf->SetFont('Helvetica', '', 7);
            $pdf->MultiCell(98, 5,utf8_decode($factura_info->observacion), 0, 'L');
            //$head_cp_ad=$pdf->GetY();
            $pdf->SetX(5);
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->Cell(27, 5,'Lugar de Entrega:', 0, 0, 'L', 0);
            $pdf->SetFont('Helvetica', '', 7);
            $pdf->MultiCell(98, 5,utf8_decode($factura_info->lugar_de_entrega), 0, 'L');
            $pdf->SetX(5);
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->Cell(27, 5,'Condiciones de pago:', 0, 0, 'L', 0);
            $pdf->SetFont('Helvetica', '', 7);
            $pdf->MultiCell(98, 5,utf8_decode($factura_info->condiciones_de_pago), 0, 'L');
            $head_cp_ad=$pdf->GetY();
            $pdf->SetXY(5, $head_cp_ad+5);
            $pdf->SetFillColor(141, 207, 140);
            if($factura_info->id_empresa==1){
                $pdf->SetFillColor(141, 207, 140);
            }else{
                $pdf->SetFillColor(141, 207, 240);
            }
            // $pdf->Cell(125, 5,'Terminos y condiciones', 1, 2, 'C', 1);
            // $pdf->Cell(125, 5, utf8_decode('1.Al cliente se le cobrarÃ¡ despuÃ©s de aceptada esta cotizaciÃ³n'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('2.El pago serÃ¡ debitado antes de la entrega de bienes y servicios'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('3.Por favor enviar la cotizaciÃ³n firmada al email indicado anteriormente.'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('La aceptaciÃ³n del cliente (firmar a continuaciÃ³n):'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('x_____________________________________________________'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'Nombre cliente', 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, '', 'LRB', 2, 'L', 0);
            if($head_subtotal<12){
                $pdf->Ln(10);
            }else{
                $pdf->Ln(7);
            }
            $pdf->Ln(7);
    
            $pdf->Cell(190, 5, utf8_decode('Si usted tiene alguna pregunta sobre  esta cotizaciÃ³n, por favor, pÃ³ngase en contacto con nosotros'), 0, 2, 'C', 0);
            $pdf->Cell(190, 5, $factura_info->telefono." , ".$datos[0]->mailvendedor, 0, 2, 'C', 0);
            $current_date = date("Y-m-d");
            //dd($ruta);
            if (!$generar_en_servidor) {
                return $pdf->Output(isset($datos[0]->identificacion) ? "proforma-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
            } else if ($generar_en_servidor && !is_null($ruta)) {
                if (file_exists($ruta)) {
                    $name = $id . '.pdf';
                    $location = $ruta . "/" . $name;
                    $pdf->Output("F", $location);
                    return json_encode(
                        array(
                            "location" => $location,
                            "name" => $name)
                    );
                } else {
                    throw new Exception("No se pudo generar la proforma");
                }

            } else if ($generar_en_servidor && is_null($ruta)) {
                throw new Exception("La ruta para la proforma no es valida.");
            } 
        }else{
                    //empresa diferente a BUSINESS COMPANY INSU-MED 0503458622001 CARRASCO PARCO VICTOR ABELARDO 0201737368001
            if($factura_info->ruc_empresa!=='0503458622001' && $factura_info->ruc_empresa!=='0201737368001'){
                //if($factura_info->id_empresa==51){
                    //empresa MASRESOURCES S.A.
                if($factura_info->ruc_empresa=='1792195454001'){
                    $pdf->AliasNbPages();
                    $pdf->AddPage();
                    $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                    $pdf->SetAutoPageBreak(1, 4);
                    $width = $pdf->GetPageWidth();
                    // HEADER
                    if ($datos[0]->logo!==null && file_exists($logo)) {
                        // if($factura_info->id_empresa==1){
                        //     //$pdf->Image($logo, 10, 10, 55, 20);
                        //     $pdf->Image($logo, 10, 6, 60, 25);
                        // }else{
                        //     $pdf->Image($logo, 10, 6, 50, 35);
                        // }
                        $pdf->Image($logo, 10, 6, 70, 25);
                    } else {
                        $pdf->SetTextColor(255, 0, 0);
                        $pdf->SetFont('Arial', 'B', 020);
                        $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                        //$pdf->SetTextColor(0, 0, 0);
                    }
                    // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/3m.png', 134, 7, 20, 10);
                    // }
                    $pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', 'B', 14);
                    $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth("PROFORMA NÂ°. " . $id_proforma) / 2), 33);
                    $pdf->Cell($pdf->GetStringWidth("PROFORMA NÂ°. " . $id_proforma), 8, utf8_decode("PROFORMA NÂ°. " . $id_proforma), 0, 2, 'C', 0);
                    $pdf->SetXY((($width / 4) * 3)+10, 10);
                    $pdf->SetFont('Arial', 'B', 8);
                    $pdf->Cell(($width / 4) - 10, 6, isset($datos[0]->ruc_empresa) ? utf8_decode('RUC: ' . $datos[0]->ruc_empresa) : '*************', 0, 2, 'C', 0);
                    $pdf->Cell(($width / 4) - 10, 6, isset($factura_info->telefono) ? utf8_decode('TELÃFONO: ' . $factura_info->telefono) : '*************', 0, 2, 'C', 0);
                    $pdf->MultiCell(($width / 4) - 10, 6, isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : 'Sin direccion', 0, 'C', 0);
                    $pdf->Ln();

                    // INFORMATION HEADER
                    $margin = 5;
                    $height = $pdf->GetY();
                    $cli_atencion = '';
                    // if($factura_info->id_empresa==1){
                    //     //$pdf->SetDrawColor(85, 175, 84);
                    //     //$pdf->SetDrawColor(85, 175, 84);
                    //     $pdf->SetDrawColor(122, 198, 58);
                    // }else{
                    //     //$pdf->SetDrawColor(85, 175, 204);
                    //     $pdf->SetDrawColor(85, 175, 204);
                    // }
                    //$pdf->SetDrawColor(85, 175, 204);
                    $pdf->SetDrawColor(154, 205, 50);
                    $pdf->RoundedRect($margin, $height + 10, $width - 14, 25, 2, '1234', 'D');
                    $pdf->SetXY($margin, $height + 12.5);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell($width / 4, 5, utf8_decode('RUC:'), 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, utf8_decode('CLIENTE:'), 0, 2, 'L', 0);
                    $head_cliente=$pdf->GetY();
                    // if($pdf->GetStringWidth('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.')>76){
                    //     $pdf->SetXY($margin, 71.5);
                    //     $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                    //     $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    // }else{
                    //     $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                    //     $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    // }
                    if($pdf->GetStringWidth($datos[0]->cliente)>76){
                        $pdf->SetXY($margin, $head_cliente+1);
                        $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    }else{
                        $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    }
                    
                    $pdf->SetXY($width / 2, $height + 12.5);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell($width / 4, 5, utf8_decode('FECHA:'), 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, utf8_decode('CIUDAD:'), 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, utf8_decode('DIRECCIÃN:'), 0, 2, 'L', 0);
                    //$pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                    if($pdf->GetStringWidth($datos[0]->direccion)>66){
                        $pdf->SetXY($width / 2,74);
                        $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                    }else{
                        $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                    }
                    

                    $pdf->SetXY(($width / 6) - $margin, $height + 12.5);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell($width / 4, 5, isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : 'identificacion', 0, 2, 'L', 0);
                    // if($pdf->GetStringWidth('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.')>76){
                    //     $pdf->MultiCell(73, 3, isset($datos[0]->cliente) ? 'AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.' : 'cliente', 1,'L');
                    //     $head_cli=$pdf->GetY();
                    // }else{
                    //     $pdf->Cell(76, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 1, 2, 'L', 0);
                    // }
                    
                    if($pdf->GetStringWidth($datos[0]->cliente)>76){
                        $pdf->MultiCell(76, 3, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0,'L', 0);
                        $head_cli=$pdf->GetY();
                    }else{
                        $pdf->Cell(76, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                    }
                    //dd($head_cli);
                    //
                    // if($pdf->GetStringWidth('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.')>76){
                    //     $pdf->SetXY(($width / 6) - $margin, $head_cli);
                    // }else{
                    //     $pdf->SetX(($width / 6) - $margin);
                    // }
                    if($pdf->GetStringWidth($datos[0]->cliente)>76){
                        $pdf->SetXY(($width / 6) - $margin,$head_cli);
                    }else{
                        $pdf->SetX(($width / 6) - $margin);
                    }
                    
                    $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                    if($pdf->GetStringWidth($datos[0]->email)>76){
                        $pdf->MultiCell(76, 3, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0,'L', 0);
                        $head_email=$pdf->GetY();
                    }else{
                        $pdf->Cell($width / 4, 5, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0, 2, 'L', 0);
                    }
                    

                    $pdf->SetXY(($width / 6 * 4) - $margin, $height + 12.5);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell($width / 4, 5, isset($datos[0]->fecha_emision) ? utf8_decode($datos[0]->fecha_emision) : 'fecha_emision', 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, isset($datos[0]->ciudad) ? utf8_decode($datos[0]->ciudad) : 'ciudad', 0, 2, 'L', 0);
                    //$pdf->Cell(66, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 1, 2, 'L', 0);
                    if($pdf->GetStringWidth($datos[0]->direccion)>66){
                        $pdf->MultiCell(66, 3, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0,'L', 0);
                        $head_direcc=$pdf->GetY();
                    }else{
                        $pdf->Cell($width / 4, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                    }
                    
                    
                    //dd($head_direcc);
                    if($pdf->GetStringWidth($datos[0]->direccion)>66){
                        $pdf->SetXY(($width / 6 * 4) - $margin, $head_direcc);
                    }
                    // else{
                    //     $pdf->SetXY(($width / 6 * 4) - $margin, $head_direcc+2);
                    // }
                    
                    $pdf->Cell($width / 4, 5, isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : 'telefono', 0, 2, 'L', 0);
                    $pdf->Ln();
                    //dd($width / 4);
                    // MESSAGE
                    $pdf->SetXY($margin, $height + 40);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(20, 5, utf8_decode('APRECIADO CLIENTE:'), 0, 2, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                    $pdf->SetFillColor(85, 175, 84);
                    $pdf->SetTextColor(0, 0, 255);
                    $pdf->SetDrawColor(0, 0, 0);
                    if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                        // SLOGAN
                        $pdf->SetXY($margin, $height + 55);
                        $pdf->SetFont('Helvetica', 'B', 10);
                        $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                        $height_products = $height + 65;
                    } else {
                        $height_products = $height + 55;
                    }
                    //cabecera de detalles de productos
                    $pdf->SetFont('Helvetica', 'B', 6);
                    // if($factura_info->id_empresa==1){
                    //     $pdf->SetFillColor(141, 207, 140);
                    // }else{
                    //     $pdf->SetFillColor(141, 207, 240);
                    // }
                    //dd("X=".$margin."Y=".$height_products);
                    $pdf->SetFillColor(154, 205, 50);
                    $pdf->SetTextColor(0, 0, 0);
                    $pdf->SetXY($margin, $height_products);
                    $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                    $pdf->SetXY(30, $height_products);
                    $pdf->MultiCell(46, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                    $pdf->SetXY(76, $height_products);
                    $pdf->MultiCell(47, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                    // $pdf->SetXY(75, $height_products);
                    // $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                    // $pdf->SetXY(95, $height_products);
                    // $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                    // $pdf->SetXY(111, $height_products);
                    // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                    // $pdf->SetXY(123, $height_products);
                    // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                    // $pdf->SetXY(135, $height_products);
                    // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                    $pdf->SetXY(123, $height_products);
                    $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                    $pdf->SetXY(137, $height_products);
                    $pdf->MultiCell(20, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                    $pdf->SetXY(157, $height_products);
                    $pdf->MultiCell(20, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                    $pdf->SetXY(177, $height_products);
                    $pdf->MultiCell(24, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                    //dd("X=".$margin."Y=".$height_products);
                    $y = $height_products + 8;
                    $pdf->SetFont('Helvetica', '', 4);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetFillColor(85, 175, 84);
                    $pdf->SetXY($margin, $height_products+8);
                    $pdf->SetWidths(array(25, 46, 47, 14, 20, 20, 24));
                    //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                    $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                    //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                    $sub_total=0;
                    $descuento=0;
                    $iva=0;
                    $total_fact=0;
                    $suma_sub_total=0;
                    $suma_descuento=0;
                    $suma_iva=0;
                    $suma_total_fact=0;
                    foreach ($datos as $detail) {
                        $descrip=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);
                        $data = array(
                            utf8_decode($detail->nombre),
                            utf8_decode($descrip),
                            // utf8_decode($detail->normativa),
                            // utf8_decode($detail->uso),
                            // utf8_decode($detail->marca."Centrado"),
                            // utf8_decode($detail->tipo_medida."Centrado"),
                            utf8_decode($detail->cantidad."Centrado"),
                            utf8_decode($detail->precio."Centrado"),
                            utf8_decode($detail->total_pro."Derecha"),
                            utf8_decode($detail->tiempo_entrega."Centrado"),
                            //utf8_decode('INMEDIATA'),
                            
                        );
                            $sub_total=$detail->subtotal;
                            $descuento=$detail->descuento;
                            $iva=$detail->iva;
                            $total_fact=$detail->total;
                        if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                        //if ($detail->imagen) {
                            array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                        } else {
                            array_unshift($data, utf8_decode('* sin imagen'));
                        }
                        //dd("Imagen:".$imagen.$detail->imagen);
                        $pdf->RowDataCompanyMs($data, $margin+5);
                    }
                    
                    $suma_sub_total=number_format($sub_total,2,".",",");
                    $suma_descuento=number_format($descuento,2,".",",");
                    $suma_iva=number_format($iva,2,".",",");
                    $suma_total_fact=number_format($total_fact,2,".",",");
                    $pdf->SetXY(123, $pdf->GetY());
                    $pdf->SetX(123);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                    $pdf->Cell(20, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                    $pdf->SetX(123);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                    $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                    $pdf->SetX(123);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                    $pdf->Cell(20, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                    $pdf->SetX(123);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(20, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                    $pdf->Ln();
                    
                    // if($factura_info->id_empresa==1){
                    //     $pdf->SetDrawColor(85, 175, 84);
                    // }else{
                    //     $pdf->SetDrawColor(141, 207, 240);
                    // }
                    $pdf->SetDrawColor(154, 205, 50);
                    $pdf->SetX(5);
                    $pdf->SetFont('Helvetica', 'BU', 9);
                    $pdf->Cell(200, 6, utf8_decode('CONDICIONES COMERCIALES'), 'T', 1, 'L', 0);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->SetX(5);
                    $pdf->Cell(50, 6, utf8_decode('LUGAR DE ENTREGA:'), 0, 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(150, 6, utf8_decode($factura_info->lugar_de_entrega), 0, 1, 'L', 0);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->SetX(5);
                    $pdf->Cell(50, 6, utf8_decode('CONDICIOINES DE PAGO:'), 0, 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(150, 6, utf8_decode($factura_info->condiciones_de_pago), 0, 1, 'L', 0);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->SetX(5);
                    $pdf->Cell(50, 6, utf8_decode('OBSERVACIONES:'), 0, 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->MultiCell(146, 6, utf8_decode($factura_info->observacion), 0,'L');
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->SetX(5);
                    $pdf->Cell(50, 6, utf8_decode('VALIDEZ DE LA OFERTA:'), 'B', 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(150, 6, utf8_decode($factura_info->fecha_expiracion), 'B', 1, 'L', 0);
                    $pdf->Ln();

                    $pdf->SetX(5);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(25, 6, utf8_decode('Elaborado por:'), 0, 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(75, 6, isset($datos[0]->vendedor) ? utf8_decode($datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                    $pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Helvetica', '', 9);
                    if(isset($factura_info->urlweb) && $factura_info->urlweb!=='null'){
                        $pdf->Cell(100, 6, utf8_decode('Le invitamos a revisar nuestra pÃ¡gina web.'), 0, 1, 'R', 0);
                    }else{
                        $pdf->Cell(100, 6, '', 0, 1, 'R', 0);
                    }
                    
                    
                        $pdf->SetTextColor(0, 0, 255);
                
                    
                    $pdf->SetX(30);
                    $pdf->SetFont('Helvetica', 'U', 8);
                    $url="";
                    
                    $pdf->Cell(120, 6, isset($datos[0]->mailvendedor)  ? utf8_decode($datos[0]->mailvendedor) : '', 0, 0, 'L', 0);
                    // if($factura_info->id_empresa==1){
                    //     $pdf->SetTextColor(4, 255, 0);
                    // }else{
                    //     $pdf->SetTextColor(0, 0, 255);
                    // }
                    $pdf->SetTextColor(4, 255, 0);
                    $pdf->SetFont('', 'U', 9);
                    if(isset($factura_info->urlweb) && $factura_info->urlweb!=='null'){
                        $pdf->Write(6, utf8_decode($factura_info->urlweb), isset($factura_info->urlweb) && $factura_info->urlweb!=='null' ? utf8_decode($factura_info->urlweb) : '');
                    }else{
                        $pdf->Write(6, '', isset($factura_info->urlweb)  ? utf8_decode($factura_info->urlweb) : '');
                    }
                    
                    $current_date = date("Y-m-d");
                    //dd($ruta);
                    if (!$generar_en_servidor) {
                        return $pdf->Output(isset($datos[0]->identificacion) ? "proforma-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                    } else if ($generar_en_servidor && !is_null($ruta)) {
                        if (file_exists($ruta)) {
                            $name = $id . '.pdf';
                            $location = $ruta . "/" . $name;
                            $pdf->Output("F", $location);
                            return json_encode(
                                array(
                                    "location" => $location,
                                    "name" => $name)
                            );
                        } else {
                            throw new Exception("No se pudo generar la proforma");
                        }

                    } else if ($generar_en_servidor && is_null($ruta)) {
                        throw new Exception("La ruta para la proforma no es valida.");
                    }
                }else{
                    //empresa ELECTTEL
                    if($factura_info->ruc_empresa=='1712716974001'){
                        //if($factura_info->id_empresa==1){
                        $pdf->AliasNbPages();
                        $pdf->AddPage();
                        $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                        $pdf->SetAutoPageBreak(1, 4);
                        $width = $pdf->GetPageWidth();
                        // HEADER
                        if ($datos[0]->logo!==null && file_exists($logo)) {
                            
                                $pdf->Image($logo, 10, 6, 55, 35);
                            
                            
                        } else {
                            $pdf->SetTextColor(255, 0, 0);
                            $pdf->SetFont('Arial', 'B', 020);
                            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                        }
                        // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/3m.png', 134, 7, 20, 10);
                        // }
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Arial', 'B', 14);
                        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth("PROFORMA NÂ°. " . $id_proforma) / 2), 33);
                        $pdf->Cell($pdf->GetStringWidth("PROFORMA NÂ°. " . $id_proforma), 8, utf8_decode("PROFORMA NÂ°. " . $id_proforma), 0, 2, 'C', 0);
                        $pdf->SetXY((($width / 4) * 3)+10, 10);
                        $pdf->SetFont('Arial', 'B', 8);
                        $pdf->Cell(($width / 4) - 10, 6, isset($datos[0]->ruc_empresa) ? utf8_decode('RUC: ' . $datos[0]->ruc_empresa) : '*************', 0, 2, 'C', 0);
                        $pdf->MultiCell(($width / 4) - 10, 6, isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : 'Sin direccion', 0, 'C', 0);
                        $pdf->Ln();

                        // INFORMATION HEADER
                        $margin = 5;
                        $height = $pdf->GetY();
                        $cli_atencion = '';
                        // if($factura_info->id_empresa==1){
                        //     //$pdf->SetDrawColor(85, 175, 84);
                        //     $pdf->SetDrawColor(85, 175, 84);
                        // }else{
                        //     //$pdf->SetDrawColor(85, 175, 204);
                        //     $pdf->SetDrawColor(85, 175, 204);
                        // }
                        $pdf->SetDrawColor(85, 175, 204);
                        //$pdf->SetDrawColor(85, 175, 204);
                        $pdf->RoundedRect($margin, $height + 10, $width - 14, 25, 2, '1234', 'D');
                        $pdf->SetXY($margin, $height + 12.5);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell($width / 4, 5, utf8_decode('RUC:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('CLIENTE:'), 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                            $pdf->SetXY($margin, $height+24);
                            $pdf->Cell($width / 4, 5, utf8_decode('ATENCIÃN:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                        }else{
                            $pdf->Cell($width / 4, 5, utf8_decode('ATENCIÃN:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                        }
                        
                        $pdf->SetXY($width / 2, $height + 12.5);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell($width / 4, 5, utf8_decode('FECHA:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('CIUDAD:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('DIRECCIÃN:'), 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                            $pdf->SetXY($width / 2, $height + 28.5);
                            $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                        }else{
                            $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                        }
                        
                        //dd($factura_info);
                        $pdf->SetXY(($width / 6) - $margin, $height + 12.5);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : 'identificacion', 0, 2, 'L', 0);
                        //$pdf->Cell($width / 4, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                            $pdf->MultiCell(76, 3, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0,'L', 0);
                            $head_cli=$pdf->GetY();
                        }else{
                            $pdf->Cell($width / 4, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                        }
                        
                        //$pdf->MultiCell(75, 5, isset($datos[0]->cliente) ? utf8_decode('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.'/*$datos[0]->cliente*/) : 'cliente', 1,'L');
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                            $pdf->SetXY(($width / 6) - $margin,$head_cli+0.5);
                        }
                        $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0, 2, 'L', 0);

                        $pdf->SetXY(($width / 6 * 4) - $margin, $height + 12.5);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->fecha_emision) ? utf8_decode($datos[0]->fecha_emision) : 'fecha_emision', 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->ciudad) ? utf8_decode($datos[0]->ciudad) : 'ciudad', 0, 2, 'L', 0);
                        //$pdf->Cell($width / 4, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                            $pdf->MultiCell(66, 3, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 'L', 0);
                            $gead_dir=$pdf->GetY();
                        }else{
                            $pdf->Cell($width / 4, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                        }
                        
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                            $pdf->SetXY(($width / 6 * 4) - $margin, $gead_dir+0.5);
                        }
                        
                        $pdf->Cell($width / 4, 5, isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : 'telefono', 0, 2, 'L', 0);
                        $pdf->Ln();

                        // MESSAGE
                        $pdf->SetXY($margin, $height + 40);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(20, 5, utf8_decode('APRECIADO CLIENTE:'), 0, 2, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                        $pdf->SetFillColor(85, 175, 84);
                        $pdf->SetTextColor(0, 0, 255);
                        $pdf->SetDrawColor(0, 0, 0);
                        if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                            // SLOGAN
                            $pdf->SetXY($margin, $height + 55);
                            $pdf->SetFont('Helvetica', 'B', 10);
                            $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                            $height_products = $height + 65;
                        } else {
                            $height_products = $height + 55;
                        }
                        //cabecera de detalles de productos
                        $pdf->SetFont('Helvetica', 'B', 6);
                        // if($factura_info->id_empresa==1){
                        //     $pdf->SetFillColor(141, 207, 140);
                        // }else{
                            
                        // }
                        $pdf->SetFillColor(141, 207, 240);
                        //dd("X=".$margin."Y=".$height_products);
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetXY($margin, $height_products);
                        $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                        $pdf->SetXY(30, $height_products);
                        $pdf->MultiCell(56, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                        $pdf->SetXY(86, $height_products);
                        $pdf->MultiCell(61, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                        $pdf->SetXY(147, $height_products);
                        // $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                        // $pdf->SetXY(95, $height_products);
                        // $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                        // $pdf->SetXY(111, $height_products);
                        // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                        // $pdf->SetXY(123, $height_products);
                        // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                        // $pdf->SetXY(135, $height_products);
                        // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                        // $pdf->SetXY(147, $height_products);
                        $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                        $pdf->SetXY(161, $height_products);
                        $pdf->MultiCell(20, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                        $pdf->SetXY(181, $height_products);
                        $pdf->MultiCell(20, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                        //$pdf->SetXY(190, $height_products);
                        //$pdf->MultiCell(15, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                        //dd("X=".$margin."Y=".$height_products);
                        $y = $height_products + 8;
                        $pdf->SetFont('Helvetica', '', 4);
                        $pdf->SetFillColor(255, 255, 255);
                        $pdf->SetFillColor(85, 175, 84);
                        $pdf->SetXY($margin, $height_products+8);
                        $pdf->SetWidths(array(25, 56, 61, 14, 20, 20));
                        //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                        $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                        //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                        $sub_total=0;
                        $descuento=0;
                        $iva=0;
                        $total_fact=0;
                        $suma_sub_total=0;
                        $suma_descuento=0;
                        $suma_iva=0;
                        $suma_total_fact=0;
                        foreach ($datos as $detail) {
                            $descrip=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);

                            $data = array(
                                utf8_decode($detail->nombre),
                                utf8_decode($descrip),
                                // utf8_decode($detail->normativa),
                                // utf8_decode($detail->uso),
                                // utf8_decode($detail->marca."Centrado"),
                                // utf8_decode($detail->tipo_medida."Centrado"),
                                utf8_decode($detail->cantidad."Centrado"),
                                utf8_decode($detail->precio."Centrado"),
                                utf8_decode($detail->total_pro."Derecha"),
                                //utf8_decode($detail->total_pro."Derecha"),
                                //utf8_decode('INMEDIATA'),
                                
                            );
                                $sub_total=$detail->subtotal;
                                $descuento=$detail->descuento;
                                $iva=$detail->iva;
                                $total_fact=$detail->total;
                            if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                            //if ($detail->imagen) {
                                array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                            } else {
                                array_unshift($data, utf8_decode('* sin imagen'));
                            }
                            //dd("Imagen:".$imagen.$detail->imagen);
                            $pdf->RowProductsELETE($data, $margin+5);
                        }
                        
                        $suma_sub_total=number_format($sub_total,2,".",",");
                        $suma_descuento=number_format($descuento,2,".",",");
                        $suma_iva=number_format($iva,2,".",",");
                        $suma_total_fact=number_format($total_fact,2,".",",");
                        $pdf->SetXY(135, $pdf->GetY());
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                        $pdf->Cell(20, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                        $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                        $pdf->Cell(20, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(20, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                        $pdf->Ln();
                        
                        // if($factura_info->id_empresa==1){
                        //     $pdf->SetDrawColor(85, 175, 84);
                        // }else{
                        //     $pdf->SetDrawColor(141, 207, 240);
                        // }
                        $pdf->SetDrawColor(141, 207, 240);
                        $pdf->SetX(5);
                        $pdf->SetFont('Helvetica', 'BU', 9);
                        $pdf->Cell(200, 6, utf8_decode('CONDICIONES COMERCIALES'), 'T', 1, 'L', 0);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->SetX(5);
                        $pdf->Cell(50, 6, utf8_decode('LUGAR DE ENTREGA:'), 0, 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(150, 6, utf8_decode($factura_info->lugar_de_entrega), 0, 1, 'L', 0);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->SetX(5);
                        $pdf->Cell(50, 6, utf8_decode('CONDICIOINES DE PAGO:'), 0, 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(150, 6, utf8_decode($factura_info->condiciones_de_pago), 0, 1, 'L', 0);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->SetX(5);
                        $pdf->Cell(50, 6, utf8_decode('OBSERVACIONES:'), 0, 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->MultiCell(146, 6, utf8_decode($factura_info->observacion), 0,'L');
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->SetX(5);
                        $pdf->Cell(50, 6, utf8_decode('VALIDEZ DE LA OFERTA:'), 'B', 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(150, 6, utf8_decode($factura_info->fecha_expiracion), 'B', 1, 'L', 0);
                        $pdf->Ln();

                        $pdf->SetX(5);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(25, 6, utf8_decode('Elaborado por:'), 0, 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(75, 6, isset($datos[0]->vendedor) ? utf8_decode($datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Helvetica', '', 9);
                        $pdf->Cell(100, 6, utf8_decode('Le invitamos a revisar nuestra pÃ¡gina web.'), 0, 1, 'R', 0);
                        
                        $pdf->SetTextColor(0, 0, 255);
                    
                        
                        $pdf->SetX(30);
                        $pdf->SetFont('Helvetica', 'U', 8);
                        $pdf->Cell(120, 6, isset($datos[0]->mailvendedor) ? utf8_decode($datos[0]->mailvendedor) : 'mailvendedor', 0, 0, 'L', 0);
                        // if($factura_info->id_empresa==1){
                        //     $pdf->SetTextColor(4, 255, 0);
                        // }else{
                        //     $pdf->SetTextColor(0, 0, 255);
                        // }
                        $pdf->SetTextColor(0, 0, 255);
                        $pdf->SetFont('', 'U', 9);
                        $pdf->Write(6, utf8_decode($factura_info->urlweb), utf8_decode($factura_info->urlweb));
                        $current_date = date("Y-m-d");
                        //dd($ruta);
                        if (!$generar_en_servidor) {
                            return $pdf->Output(isset($datos[0]->identificacion) ? "proforma-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                        } else if ($generar_en_servidor && !is_null($ruta)) {
                            if (file_exists($ruta)) {
                                $name = $id . '.pdf';
                                $location = $ruta . "/" . $name;
                                $pdf->Output("F", $location);
                                return json_encode(
                                    array(
                                        "location" => $location,
                                        "name" => $name)
                                );
                            } else {
                                throw new Exception("No se pudo generar la proforma");
                            }

                        } else if ($generar_en_servidor && is_null($ruta)) {
                            throw new Exception("La ruta para la proforma no es valida.");
                        }
                    }else{
                        //empresa MEGAREDES CIA. LTDA.
                        if($factura_info->ruc_empresa=='1791738721001'){
                            //if($factura_info->id_empresa==34){
                            $pdf->AliasNbPages();
                            $pdf->AddPage();
                            $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                            $pdf->SetAutoPageBreak(1, 4);
                            $width = $pdf->GetPageWidth();
                            if ($datos[0]->logo!==null && file_exists($logo)) {
                                if($factura_info->id_empresa==1){
                                        
                                    $pdf->Image($logo, 15, 10, 55, 20);
                                //$pdf->Image($logo, 5, 10, 25, 20);
                                
                                }else{
                                    
                                    $pdf->Image($logo, 6, 3, 50, 29);
                                
                                }
                                
                            } else {
                                $pdf->SetX(8);
                                $pdf->SetTextColor(255, 0, 0);
                                $pdf->SetFont('Arial', 'B', 10);
                                $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 0, 'C', 0);
                                
                            }
                            if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                            //if ($factura_info->id_empresa==1) {
                                /*$pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 31, 13, 30, 25);
                                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 30, 5, 30, 15);
                                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 65, 9, 20, 20);
                                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 90, 17, 30, 15);
                                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/armadura.jpg', 90, 6, 28, 13);*/
                                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/blacklinesafe.jpg', 130, 6, 28, 13);
                            }
                            //dd($datos[0]);
                            $y_img=25;
                            $pdf->SetXY(5, 35);
                            /*$pdf->SetTextColor(48,132,70);
                            $pdf->SetFont('Arial', 'B', 10);
                            $pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 0, 'L', 0);*/
                            $y_cot="";
                            if($factura_info->id_empresa==1){
                                $y_cot=35;
                            }else{
                                $y_cot=15;
                            }

                            $pdf->SetXY($width-64,15);
                            //$pdf->SetXY($width-40,$y_cot-20);
                            $pdf->SetTextColor(99, 125, 171);
                            $pdf->SetFont('Arial', 'B', 27);
                            $pdf->Cell(25, 10, utf8_decode('PROFORMA'), 0, 1, 'L', 0);
                    
                            $pdf->SetXY($width-58,35);
                            //$pdf->SetXY($width-60,$y_cot-10);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 9);
                            $pdf->Cell(25, 5, utf8_decode('NÂ°'), 0, 0, 'R', 0);
                            $pdf->Cell(25, 5, utf8_decode($id_proforma), 1, 1, 'C', 0);
                            $pdf->SetXY($width-58,40);
                            //$pdf->SetXY($width-60,$y_cot-5);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 9);
                            $pdf->Cell(25, 5, utf8_decode('FECHA'), 0, 0, 'R', 0);
                            $fecha_emision="";
                            $fecha_emision=date("d/m/Y", strtotime($datos[0]->fecha_emision));
                            $pdf->Cell(25, 5, isset($datos[0]->fecha_emision) ? utf8_decode($fecha_emision) : 'fecha_emision', 1,1, 'C', 0);
                            // $pdf->SetXY($width-60,$y_cot+20);
                            // //$pdf->SetXY($width-60,$y_cot);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 6);
                            // $pdf->Cell(25, 5, utf8_decode('RUC'), 0, 0, 'L', 0);
                            // $pdf->Cell(25, 5, utf8_decode($datos[0]->ruc_empresa), 1, 1, 'C', 0);
                            // $pdf->SetXY($width-60,$y_cot+25);
                            // //$pdf->SetXY($width-60,$y_cot+5);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 6);
                            // $fecha_validez=date("d/m/Y", strtotime($factura_info->fecha_expiracion));;
                            // $pdf->Cell(25, 5, utf8_decode('VALIDO HASTA'), 0, 0, 'L', 0);
                            // $pdf->Cell(25, 5, utf8_decode($fecha_validez), 1, 1, 'C', 0);

                            // $pdf->SetXY(15,$y_img+5);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('RUC:'), 0, 0, 'L', 0);
                            // $pdf->Cell(65, 5, utf8_decode($datos[0]->direccion_empresa), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+10);
                            // $pdf->SetTextColor(0,0,0);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
                            // $pdf->Cell(65, 5,utf8_decode($datos[0]->ciudad), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+15);
                            // $pdf->SetTextColor(0,0,0);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('Sitio Web:'), 0, 0, 'L', 0);
                            // $pdf->Cell(25, 5, utf8_decode(/*"                ".*/$factura_info->urlweb), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+20);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('TelÃ©fono:'), 0, 0, 'L', 0);
                            // $pdf->Cell(20, 5, utf8_decode(/*"                (593)".*/"(593)".$factura_info->telefono), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+25);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('Asesor de venta:'), 0, 0, 'L', 0);
                            // $pdf->Cell(75, 5, isset($datos[0]->vendedor) ? utf8_decode(/*"    ".*/$datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                            // $pdf->SetXY(15,$y_img+30);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('TelÃ©fono Vendedor:'), 0, 0, 'L', 0);
                            // if($datos[0]->telefono_vendedor){
                            //     $pdf->Cell(25, 5, "(593)".$datos[0]->telefono_vendedor, 0, 0, 'L', 0);
                            // }else{
                            //     $pdf->Cell(25, 5, $datos[0]->telefono_vendedor, 0, 0, 'L', 0);
                            // }

                            $pdf->SetXY(7,$y_img+5);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 10);
                            $pdf->Cell(19, 4, utf8_decode($datos[0]->nombre_empresa), 0, 0, 'L', 0);
                            $pdf->SetXY(7,$y_img+9);
                            $pdf->SetTextColor(0,0,0);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Ruc:'), 0, 0, 'L', 0);
                            $pdf->Cell(65, 4, utf8_decode($datos[0]->ruc_empresa), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+13);
                            $pdf->SetTextColor(0,0,0);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Direccion:'), 0, 0, 'L', 0);
                            $pdf->Cell(65, 4, utf8_decode($datos[0]->direccion_empresa), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+17);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
                            $pdf->Cell(65, 4,utf8_decode($datos[0]->ciudad)." ,Ecuador", 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+21);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('TelÃ©fono:'), 0, 0, 'L', 0);
                            $pdf->Cell(20, 4, utf8_decode(/*"                (593)".*/"(593)"), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+25);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Sitio Web:'), 0, 0, 'L', 0);
                            $pdf->Cell(25, 4, isset($factura_info->urlweb) || $factura_info->urlweb!==null || $factura_info->urlweb!=='null' ? utf8_decode(/*"                ".*/$factura_info->urlweb) : '', 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+32);
                            $pdf->SetFillColor(67, 92, 137);
                            $pdf->SetTextColor(255, 255, 255);
                            $pdf->SetDrawColor(100, 0, 0);
                            $pdf->SetFont('Arial', 'B', 8);
                            $pdf->Cell(195, 5, ''/*utf8_decode('Observaciones: ').utf8_decode($factura_info->observacion)*/, 0, 1, 'L', 1);
                            $pdf->SetXY(7,$y_img+40);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Cliente:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->cliente), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+44);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Contacto:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->contacto), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+48);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('CI/RUC:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->identificacion), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+52);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Direccion:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->direccion), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+56);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->ciudad), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+60);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode("TelÃ©fono:"), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->telefono), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+64);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode("E-mail:"), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->email), 0, 1, 'L', 0);
                            // $pdf->Cell(75, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"CI/RUC:                   ".utf8_decode($datos[0]->identificacion), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"Email:                       ".utf8_decode($datos[0]->email), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"Ciudad:                     ".utf8_decode($datos[0]->ciudad), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"Direccion:                 ".utf8_decode($datos[0]->direccion), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,utf8_decode("TelÃ©fono:                  ").utf8_decode($datos[0]->telefono), 0, 2, 'L', 0);
                            
                            //$pdf->Cell(155, 8, 'Proyecto: '.ucfirst($proyecto), 0, 1, 'C', 0);
                            //$pdf->SetXY(165, 10);
                            // HEADER
                        
                    
                            // INFORMATION HEADER
                            $margin = 7;
                            $height = $pdf->GetY();
                            $cli_atencion = '';
                        
                            // $pdf->SetFont('Helvetica', 'B', 8);
                            // $pdf->Cell(20, 5, utf8_decode('APRECIADO CLIENTE:'), 0, 2, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 8);
                            // $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                            $pdf->SetFillColor(85, 175, 84);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetDrawColor(0, 0, 0);
                            if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                                // SLOGAN
                                $pdf->SetXY($margin, $height + 15);
                                $pdf->SetFont('Helvetica', 'B', 10);
                                $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                                $height_products = $height + 25;
                            } else {
                                $height_products = $height + 5;
                            }
                            //cabecera de detalles de productos
                            $pdf->SetFont('Helvetica', 'B', 6);
                            // if($factura_info->id_empresa==1){
                            //     $pdf->SetFillColor(141, 207, 140);
                            // }else{
                            //     $pdf->SetFillColor(141, 207, 240);
                            // }
                            $pdf->SetFillColor(67, 92, 137);
                            $exist_cps=0;
                            foreach ($datos as $detail) {
                                if($detail->cpc){
                                    $exist_cps++;
                                }
                            }
                            //dd("X=".$margin."Y=".$height_products);
                            $pdf->SetTextColor(255,255,255);
                            // if($exist_cps>0){
                            //     $pdf->SetXY($margin, $height_products);
                            //     $pdf->MultiCell(10, 8, utf8_decode('CPC'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+10, $height_products);
                            //     $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+35, $height_products);
                            //     $pdf->MultiCell(16, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+35, $height_products);
                            //     $pdf->MultiCell(24, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+35, $height_products);
                            //     $pdf->MultiCell(17, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                            //     $pdf->SetXY(92+5, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('USO'), 1, 'C', 1);
                            //     $pdf->SetXY(108+1, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                            //     $pdf->SetXY(120+1, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                            //     $pdf->SetXY(132+1, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                            //     $pdf->SetXY(144+1, $height_products);
                            //     $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                            //     $pdf->SetXY(158+1, $height_products);
                            //     $pdf->MultiCell(15, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                            //     $pdf->SetXY(173+1, $height_products);
                            //     $pdf->MultiCell(17, 4, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                            //     $pdf->SetXY(190+1, $height_products);
                            //     $pdf->MultiCell(14, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                            //     //dd("X=".$margin."Y=".$height_products);
                            //     $y = $height_products + 8;
                            //     $pdf->SetFont('Helvetica', '', 4);
                            //     $pdf->SetFillColor(255, 255, 255);
                            //     $pdf->SetFillColor(85, 175, 84);
                            //     $pdf->SetXY($margin, $height_products+8);
                            //     $pdf->SetWidths(array(10,25, 16, 24, 17, 12, 12, 12, 12, 14, 15, 17, 14));
                            // }else{
                                $pdf->SetXY($margin, $height_products);
                                //$pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                                //$pdf->SetXY($margin+25, $height_products);
                                $pdf->MultiCell(17, 8, utf8_decode('CODIGO'), 1, 'C', 1);
                                $pdf->SetXY($margin+17, $height_products);
                                $pdf->MultiCell(116, 8, utf8_decode('DESCRIPCIÃN'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116, $height_products);
                                // $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                                // $pdf->SetXY($margin+17+20, $height_products);
                                // $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                                // $pdf->SetXY(116, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                                // $pdf->SetXY(120, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                                // $pdf->SetXY(132, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                                //$pdf->SetXY(144, $height_products);
                                //$pdf->MultiCell(20, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116, $height_products);
                                $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116+14, $height_products);
                                $pdf->MultiCell(24, 8, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116+14+24, $height_products);
                                $pdf->MultiCell(24, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                                //$pdf->SetXY($margin+17+116+15+14+15+17, $height_products);
                                
                                //dd("X=".$margin."Y=".$height_products);
                                $y = $height_products + 8;
                                $pdf->SetFont('Helvetica', '', 4);
                                $pdf->SetFillColor(255, 255, 255);
                                $pdf->SetFillColor(85, 175, 84);
                                $pdf->SetXY($margin, $height_products+8);
                                $pdf->SetWidths(array(17, 116,  14, 24, 24));
                            //}
                            $pdf->SetTextColor(0,0,0);
                            //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                            $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                            //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                            $sub_total=0;
                            $descuento=0;
                            $iva=0;
                            $total_fact=0;
                            $suma_sub_total=0;
                            $suma_descuento=0;
                            $suma_iva=0;
                            $suma_total_fact=0;
                            //dd($datos);
                            foreach ($datos as $detail) {
                                $caract=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);
                                $norm=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->normativa);
                                $uso=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->uso);
                                $data = array(
                                    utf8_decode(trim($detail->cod_alterno)."Centrado"),
                                    utf8_decode($caract),
                                    // utf8_decode($norm."Centrado"),
                                    // utf8_decode($uso."Centrado"),
                                    // utf8_decode(trim($detail->marca)."Centrado"),
                                    
                                    // utf8_decode(trim($detail->unidad_medida)."Centrado"),
                                    // utf8_decode(trim($detail->tipo_medida)."Centrado"),
                                    //$detail->tiempo_entrega!==null ? utf8_decode($detail->tiempo_entrega."Centrado") : utf8_decode('INMEDIATA'),
                                    utf8_decode($detail->cantidad."Centrado"),
                                    utf8_decode("$ ".$detail->precio."Derecha"),
                                    utf8_decode("$ ".$detail->total_pro."Derecha"),
                                    
                                        
                                );
                                
                                
                                    $sub_total=$detail->subtotal;
                                    $descuento=$detail->descuento;
                                    $iva=$detail->iva;
                                    $total_fact=$detail->total;
                                // if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                                // //if ($detail->imagen) {
                                //     //dd($pdf->GetY());
                                //     if($exist_cps>0){ 
                                        
                                //             array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX()+10, $pdf->GetY(), 25, 25));
                                        
                                        
                                //     }else{
                                        
                                //             array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                                        
                                //     }
                                    
                                // } else {
                                //     array_unshift($data, utf8_decode('* sin imagen'."Centrado"));
                                // }
                                // if($exist_cps>0){
                                //     array_unshift($data, utf8_decode($detail->cpc."Centrado"));
                                // }
                                //dd("Imagen:".$imagen.$detail->imagen);
                                $pdf->RowDataMegaRedes($data, $margin+5);
                                $head_table=$pdf->GetY();
                            }
                            
                            $suma_sub_total=number_format($sub_total,2,".",",");
                            $suma_descuento=number_format($descuento,2,".",",");
                            $suma_iva=number_format($iva,2,".",",");
                            $suma_total_fact=number_format($total_fact,2,".",",");
                            // if($exist_cps>0){
                            //     $pdf->SetXY(133, $pdf->GetY());
                            //     $pdf->SetX(133);
                            // }else{
                            $fin_tabla=$pdf->GetY();
                            $pdf->SetXY(7,$fin_tabla+3);
                            $pdf->SetFillColor(189, 184, 183);
                            $pdf->SetFont('Helvetica', 'B', 7);
                            $pdf->Cell(133, 5, 'Observaciones', 1, 1, 'L', 1);
                            $pdf->SetX(7);
                            $pdf->SetFont('Helvetica', '', 6);
                            if($factura_info->observacion==null || $factura_info->observacion==''){
                                $pdf->Cell(133, 20, '', 1,0, 'L', 0);
                            }else{
                                $pdf->MultiCell(133, 4, utf8_decode($factura_info->observacion), 1, 'L', 0);
                            }
                            
                            $pdf->SetXY(153, $fin_tabla);
                            $pdf->SetX(153);
                            //}
                            
                            $pdf->SetFont('Helvetica', 'B', 8);
                            if($exist_cps>0){
                                $pdf->Cell(25, 7, utf8_decode('SUBTOTAL'), 0, 0, 'L', 0);
                            }else{
                                $pdf->Cell(25, 7, utf8_decode('SUBTOTAL'), 0, 0, 'L', 0);
                            }
                            
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                            $pdf->Cell(24, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 0, 1, 'R', 0);
                            
                            // if($exist_cps>0){
                            //     $pdf->SetX(133);
                            // }else{
                                $pdf->SetX(153);
                            //}
                            $pdf->SetFont('Helvetica', 'B', 8);
                            
                            if($exist_cps>0){
                                $pdf->Cell(24, 7, utf8_decode('DESCUENTO'), 0, 0, 'L', 0);
                            }else{
                                $pdf->Cell(24, 7, utf8_decode('DESCUENTO'), 0, 0, 'L', 0);
                            }
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                            $pdf->Cell(24, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 0, 1, 'R', 0);
                            $pdf->SetX(136);
                            // if($exist_cps>0){
                            //     $pdf->SetX(133);
                            // }else{
                                $pdf->SetX(153);
                            //}
                            $pdf->SetFont('Helvetica', 'B', 8);
                            
                            if($exist_cps>0){
                                $pdf->Cell(24, 7, utf8_decode('IVA (12%)'), 0, 0, 'L', 0);
                            }else{
                                $pdf->Cell(24, 7, utf8_decode('IVA (12%)'), 0, 0, 'L', 0);
                            }
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                            $pdf->Cell(24, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 0, 1, 'R', 0);
                            // if($exist_cps>0){
                            //     $pdf->SetX(133);
                            // }else{
                            //     $pdf->SetX(153);
                            // }
                            $pdf->SetX(153);
                            /*if($factura_info->id_empresa==1){
                                $pdf->SetFillColor(189,236,182);
                            }else{
                                $pdf->SetFillColor(93,155,155);
                            }*/
                            $pdf->SetFillColor(156,156,156);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            
                            if($exist_cps>0){
                                $pdf->Cell(24, 7, utf8_decode('TOTAL'), 'T', 0, 'L', 0);
                            }else{
                                $pdf->Cell(24, 7, utf8_decode('TOTAL'), 'T', 0, 'L', 0);
                            }
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(24, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 'T', 1, 'R', 1);
                            $pdf->Ln();
                            // $pdf->SetXY(5, $head_table+5);
                            // $pdf->SetFont('Helvetica', 'B', 7);
                            // $pdf->Cell(27, 5,'Observaciones:', 0, 0, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 7);
                            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->observacion), 0, 'L');
                            // //$head_cp_ad=$pdf->GetY();
                            // $pdf->SetX(5);
                            // $pdf->SetFont('Helvetica', 'B', 7);
                            // $pdf->Cell(27, 5,'Lugar de Entrega:', 0, 0, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 7);
                            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->lugar_de_entrega), 0, 'L');
                            // $pdf->SetX(5);
                            // $pdf->SetFont('Helvetica', 'B', 7);
                            // $pdf->Cell(27, 5,'Condiciones de pago:', 0, 0, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 7);
                            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->condiciones_de_pago), 0, 'L');
                            $head_cp_ad=$pdf->GetY();
                            $pdf->SetXY(5, $head_cp_ad);
                            $pdf->SetFillColor(141, 207, 140);
                            if($factura_info->id_empresa==1){
                                $pdf->SetFillColor(141, 207, 140);
                            }else{
                                $pdf->SetFillColor(141, 207, 240);
                            }
                            // $pdf->Cell(125, 5,'Terminos y condiciones', 1, 2, 'C', 1);
                            // $pdf->Cell(125, 5, utf8_decode('1.Al cliente se le cobrarÃ¡ despuÃ©s de aceptada esta cotizaciÃ³n'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('2.El pago serÃ¡ debitado antes de la entrega de bienes y servicios'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('3.Por favor enviar la cotizaciÃ³n firmada al email indicado anteriormente.'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('La aceptaciÃ³n del cliente (firmar a continuaciÃ³n):'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('x_____________________________________________________'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'Nombre cliente', 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, '', 'LRB', 2, 'L', 0);
                            $pdf->Ln();
                    
                            // $pdf->Cell(190, 5, utf8_decode('Si usted tiene alguna pregunta sobre  esta cotizaciÃ³n, por favor, pÃ³ngase en contacto con nosotros'), 0, 2, 'C', 0);
                            // $pdf->Cell(190, 5, $factura_info->telefono." , ".$datos[0]->mailvendedor, 0, 2, 'C', 0);
                            $pdf->SetX(7);
                            $pdf->SetFillColor(67, 92, 137);
                            $pdf->SetTextColor(255,255,255);
                            //$pdf->Cell(73, 5, utf8_decode('Forma de Pago'), 0, 0, 'C', 1);
                            $pdf->Cell(73, 5, utf8_decode('Condiciones de Pago'), 0, 0, 'C', 1);
                            $pdf->Cell(40, 5, utf8_decode('Tiempo de Entrega'), 0, 0, 'C', 1);
                            $pdf->Cell(40, 5, utf8_decode('Lugar de Entrega'), 0, 0, 'C', 1);
                            $pdf->Cell(40, 5, utf8_decode('Validez de Oferta'), 0, 1, 'C', 1);
                            $pdf->SetX(7);
                            $pdf->SetTextColor(0,0,0);
                            //$pdf->Cell(73, 5, utf8_decode($factura_info->forma_pago), 'LRB', 0, 'C', 0);
                            $pdf->Cell(73, 5, utf8_decode($factura_info->condiciones_de_pago), 'LRB', 0, 'C', 0);
                            $pdf->Cell(40, 5, utf8_decode($datos[0]->tiempo_entrega), 'LRB', 0, 'C', 0);
                            $pdf->Cell(40, 5, utf8_decode($factura_info->lugar_de_entrega), 'LRB', 0, 'C', 0);
                            $pdf->Cell(40, 5, date("d/m/Y", strtotime($factura_info->fecha_expiracion)), 'LRB', 1, 'C', 0);
                            $pdf->Ln(10);
                            $forma_pagos=$pdf->GetY();
                            $pdf->SetX(7);
                            $pdf->SetTextColor(0,0,0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(60, 5, utf8_decode('Atentamente,'), 0, 2, 'L', 0);
                            $pdf->Ln(10);
                            $pdf->SetX(7);
                            $pdf->Cell(50,3,'_______________________________',0, 2, 'L', 0);
                            $pdf->SetX(7);
                            $pdf->Cell(50, 5, utf8_decode($datos[0]->vendedor), 0, 0, 'C', 0);
                            //vendedor
                            $current_date = date("Y-m-d");
                            //dd($ruta);
                            if (!$generar_en_servidor) {
                                return $pdf->Output(isset($datos[0]->identificacion) ? "proforma-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                            } else if ($generar_en_servidor && !is_null($ruta)) {
                                if (file_exists($ruta)) {
                                    $name = $id . '.pdf';
                                    $location = $ruta . "/" . $name;
                                    $pdf->Output("F", $location);
                                    return json_encode(
                                        array(
                                            "location" => $location,
                                            "name" => $name)
                                    );
                                } else {
                                    throw new Exception("No se pudo generar la proforma");
                                }

                            } else if ($generar_en_servidor && is_null($ruta)) {
                                throw new Exception("La ruta para la proforma no es valida.");
                            } 
                        }else{
                            //empresa GROY MAS QUE LLANTAS
                            if($factura_info->ruc_empresa=='1725197006001'){
                                $pdf->AliasNbPages();
                                $pdf->AddPage();
                                $logo = constant("DATA_EMPRESA") . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                                $pdf->SetAutoPageBreak(1, 4);
                                $width = $pdf->GetPageWidth();
                                // HEADER
                                if ($datos[0]->logo!==null && file_exists($logo)) {
                                    
                                        $pdf->Image($logo, 10, 6, 50, 35);
                                    
                                    
                                } else {
                                    $pdf->SetTextColor(255, 0, 0);
                                    $pdf->SetFont('Arial', 'B', 020);
                                    $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                                }
                                // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                                //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                                //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                                //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                                //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                                //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/3m.png', 134, 7, 20, 10);
                                // }
                                $pdf->SetTextColor(0, 0, 0);
                                $pdf->SetFont('Arial', 'B', 14);
                                $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth("ORDEN DE TRABAJO NÂ°. " . $id_proforma) / 2), 33);
                                $pdf->Cell($pdf->GetStringWidth("ORDEN DE TRABAJO NÂ°. " . $id_proforma), 8, utf8_decode("ORDEN DE TRABAJO NÂ°. " . $id_proforma), 0, 2, 'C', 0);
                                $pdf->SetXY((($width / 4) * 3)+10, 10);
                                $pdf->SetFont('Arial', 'B', 8);
                                $pdf->Cell(($width / 4) - 10, 6, isset($datos[0]->ruc_empresa) ? utf8_decode('RUC: ' . $datos[0]->ruc_empresa) : '*************', 0, 2, 'C', 0);
                                $pdf->MultiCell(($width / 4) - 10, 6, isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : 'Sin direccion', 0, 'C', 0);
                                $pdf->Ln();

                                // INFORMATION HEADER
                                $margin = 5;
                                $height = $pdf->GetY();
                                $cli_atencion = '';
                                // if($factura_info->id_empresa==1){
                                //     //$pdf->SetDrawColor(85, 175, 84);
                                //     $pdf->SetDrawColor(85, 175, 84);
                                // }else{
                                //     //$pdf->SetDrawColor(85, 175, 204);
                                //     $pdf->SetDrawColor(85, 175, 204);
                                // }
                                $pdf->SetDrawColor(85, 175, 204);
                                //$pdf->SetDrawColor(85, 175, 204);
                                if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76 && $pdf->GetStringWidth(utf8_decode($datos[0]->email))>76){
                                    $pdf->RoundedRect($margin, $height + 10, $width - 14, 27.5, 2, '1234', 'D');
                                }else{
                                    $pdf->RoundedRect($margin, $height + 10, $width - 14, 26, 2, '1234', 'D');
                                }
                                
                                $pdf->SetXY($margin, $height + 12.5);
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->Cell($width / 4, 5, utf8_decode('RUC:'), 0, 2, 'L', 0);
                                $head_ruc=$pdf->GetY();
                                if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                    $pdf->SetXY($margin, $head_ruc+1);
                                }
                                $pdf->Cell($width / 4, 5, utf8_decode('CLIENTE:'), 0, 2, 'L', 0);
                                if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                    $pdf->SetXY($margin, 58);
                                }
                                $pdf->Cell($width / 4, 5, utf8_decode('ATENCIÃN:'), 0, 2, 'L', 0);
                                $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                                $pdf->SetXY($width / 2, $height + 12.5);
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->Cell($width / 4, 5, utf8_decode('FECHA:'), 0, 2, 'L', 0);
                                $pdf->Cell($width / 4, 5, utf8_decode('CIUDAD:'), 0, 2, 'L', 0);
                                $pdf->Cell($width / 4, 5, utf8_decode('DIRECCIÃN:'), 0, 2, 'L', 0);
                                if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                    $pdf->SetXY($width / 2, 63);
                                }
                                $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);

                                $pdf->SetXY(($width / 6) - $margin, $height + 12.5);
                                $pdf->SetFont('Helvetica', '', 8);
                                $pdf->Cell($width / 4, 5, isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : 'identificacion', 0, 2, 'L', 0);
                                if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                    $pdf->MultiCell(76, 3, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0,'L', 0);
                                    $head_cliente=$pdf->GetY();
                                }else{
                                    $pdf->Cell(76, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                                }
                                //dd($head_cliente);
                                //$pdf->MultiCell(75, 5, isset($datos[0]->cliente) ? utf8_decode('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.'/*$datos[0]->cliente*/) : 'cliente', 1,'L');
                                if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                    $pdf->SetXY(($width / 6) - $margin,$head_cliente+0.5);
                                }else{
                                    $pdf->SetX(($width / 6) - $margin);
                                }
                                
                                $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                                if($pdf->GetStringWidth(utf8_decode($datos[0]->email))>76){
                                    $pdf->MultiCell(76, 3, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0,'L', 0);
                                }else{
                                    $pdf->Cell(76, 5, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0, 2, 'L', 0);
                                }
                                

                                $pdf->SetXY(($width / 6 * 4) - $margin, $height + 12.5);
                                $pdf->SetFont('Helvetica', '', 8);
                                $pdf->Cell($width / 4, 5, isset($datos[0]->fecha_emision) ? utf8_decode($datos[0]->fecha_emision) : 'fecha_emision', 0, 2, 'L', 0);
                                $pdf->Cell($width / 4, 5, isset($datos[0]->ciudad) ? utf8_decode($datos[0]->ciudad) : 'ciudad', 0, 2, 'L', 0);
                                if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                    $pdf->MultiCell(66, 3, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0,'L', 0);
                                    $head_dir=$pdf->GetY();
                                }else{
                                    $pdf->Cell(66, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                                }
                                //dd($head_dir);
                                if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                    $pdf->SetXY(($width / 6 * 4) - $margin, $head_dir+0.5);
                                }
                                $pdf->Cell($width / 4, 5, isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : 'telefono', 0, 2, 'L', 0);
                                $pdf->Ln();

                                // MESSAGE
                                $pdf->SetXY($margin, $height + 45);
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->Cell(20, 5, utf8_decode('APRECIADO CLIENTE:'), 0, 2, 'L', 0);
                                $pdf->SetFont('Helvetica', '', 8);
                                $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                                $pdf->SetFillColor(85, 175, 84);
                                $pdf->SetTextColor(0, 0, 255);
                                $pdf->SetDrawColor(0, 0, 0);
                                if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                                    // SLOGAN
                                    $pdf->SetXY($margin, $height + 55);
                                    $pdf->SetFont('Helvetica', 'B', 10);
                                    $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                                    $height_products = $height + 65;
                                } else {
                                    $height_products = $height + 60;
                                }
                                //cabecera de detalles de productos
                                $pdf->SetFont('Helvetica', 'B', 6);
                                // if($factura_info->id_empresa==1){
                                //     $pdf->SetFillColor(141, 207, 140);
                                // }else{
                                    
                                // }
                                $pdf->SetFillColor(141, 207, 240);
                                //dd("X=".$margin."Y=".$height_products);
                                $pdf->SetTextColor(0, 0, 0);
                                $pdf->SetXY($margin, $height_products);
                                $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                                $pdf->SetXY(30, $height_products);
                                $pdf->MultiCell(107, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                                $pdf->SetXY(137, $height_products);
                                // $pdf->MultiCell(25, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                                // $pdf->SetXY(75, $height_products);
                                // $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                                // $pdf->SetXY(95, $height_products);
                                // $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                                // $pdf->SetXY(111, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                                // $pdf->SetXY(123, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                                // $pdf->SetXY(135, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                                // $pdf->SetXY(147, $height_products);
                                $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                                $pdf->SetXY(151, $height_products);
                                $pdf->MultiCell(25, 8, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                                $pdf->SetXY(176, $height_products);
                                $pdf->MultiCell(25, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                                //$pdf->SetXY(190, $height_products);
                                //$pdf->MultiCell(15, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                                //dd("X=".$margin."Y=".$height_products);
                                $y = $height_products + 8;
                                $pdf->SetFont('Helvetica', '', 4);
                                $pdf->SetFillColor(255, 255, 255);
                                $pdf->SetFillColor(85, 175, 84);
                                $pdf->SetXY($margin, $height_products+8);
                                $pdf->SetWidths(array(25, 107, 14,25,25));
                                //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                                $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                                //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                                $sub_total=0;
                                $descuento=0;
                                $iva=0;
                                $total_fact=0;
                                $suma_sub_total=0;
                                $suma_descuento=0;
                                $suma_iva=0;
                                $suma_total_fact=0;
                                foreach ($datos as $detail) {
                                    $caract = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->caracteristicas);
                                    $norm = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->normativa);
                                    $uso = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->uso);
                                    $data = array(
                                        utf8_decode($detail->nombre),
                                        // utf8_decode($caract),
                                        // utf8_decode($norm),
                                        // utf8_decode($uso),
                                        // utf8_decode($detail->marca."Centrado"),
                                        // utf8_decode($detail->unidad_medida."Centrado"),
                                        // utf8_decode($detail->tipo_medida."Centrado"),
                                        utf8_decode($detail->cantidad."Centrado"),
                                        utf8_decode($detail->precio."Derecha"),
                                        utf8_decode($detail->total_pro."Derecha"),
                                        //utf8_decode($detail->total_pro."Derecha"),
                                        //utf8_decode('INMEDIATA'),
                                        
                                    );
                                        $sub_total=$detail->subtotal;
                                        $descuento=$detail->descuento;
                                        $iva=$detail->iva;
                                        $total_fact=$detail->total;
                                    if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                                    //if ($detail->imagen) {
                                        array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                                    } else {
                                        array_unshift($data, utf8_decode('* sin imagen'));
                                    }
                                    //dd("Imagen:".$imagen.$detail->imagen);
                                    $pdf->RowProductsGroy($data, $margin+5);
                                }
                                
                                $suma_sub_total=number_format($sub_total,2,".",",");
                                $suma_descuento=number_format($descuento,2,".",",");
                                $suma_iva=number_format($iva,2,".",",");
                                $suma_total_fact=number_format($total_fact,2,".",",");
                                $pdf->SetXY(137, $pdf->GetY());
                                $pdf->SetX(137);
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->Cell(39, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                                $pdf->SetFont('Helvetica', '', 8);
                                //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                                $pdf->Cell(25, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                                $pdf->SetX(137);
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->Cell(39, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                                $pdf->SetFont('Helvetica', '', 8);
                                //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                                $pdf->Cell(25, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                                $pdf->SetX(137);
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->Cell(39, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
                                $pdf->SetFont('Helvetica', '', 8);
                                //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                                $pdf->Cell(25, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                                $pdf->SetX(137);
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->Cell(39, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                                $pdf->SetFont('Helvetica', '', 8);
                                $pdf->Cell(25, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                                $pdf->Ln();
                                
                                // if($factura_info->id_empresa==1){
                                //     $pdf->SetDrawColor(85, 175, 84);
                                // }else{
                                //     $pdf->SetDrawColor(141, 207, 240);
                                // }
                                $pdf->SetDrawColor(141, 207, 240);
                                $pdf->SetX(5);
                                $pdf->SetFont('Helvetica', 'BU', 9);
                                $pdf->Cell(200, 6, utf8_decode('CONDICIONES COMERCIALES'), 'T', 1, 'L', 0);
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->SetX(5);
                                $pdf->Cell(50, 6, utf8_decode('LUGAR DE ENTREGA:'), 0, 0, 'L', 0);
                                $pdf->SetFont('Helvetica', '', 8);
                                $pdf->Cell(150, 6, utf8_decode($factura_info->lugar_de_entrega), 0, 1, 'L', 0);
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->SetX(5);
                                $pdf->Cell(50, 6, utf8_decode('CONDICIOINES DE PAGO:'), 0, 0, 'L', 0);
                                $pdf->SetFont('Helvetica', '', 8);
                                $pdf->Cell(150, 6, utf8_decode($factura_info->condiciones_de_pago), 0, 1, 'L', 0);
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->SetX(5);
                                $pdf->Cell(50, 6, utf8_decode('OBSERVACIONES:'), 0, 0, 'L', 0);
                                $pdf->SetFont('Helvetica', '', 8);
                                $pdf->MultiCell(146, 6, utf8_decode($factura_info->observacion), 0,'L');
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->SetX(5);
                                $pdf->Cell(50, 6, utf8_decode('VALIDEZ DE LA OFERTA:'), 'B', 0, 'L', 0);
                                $pdf->SetFont('Helvetica', '', 8);
                                $pdf->Cell(150, 6, utf8_decode($factura_info->fecha_expiracion), 'B', 1, 'L', 0);
                                $pdf->Ln();

                                $pdf->SetX(5);
                                $pdf->SetFont('Helvetica', 'B', 8);
                                $pdf->Cell(25, 6, utf8_decode('Elaborado por:'), 0, 0, 'L', 0);
                                $pdf->SetFont('Helvetica', '', 8);
                                $pdf->Cell(75, 6, isset($datos[0]->vendedor) ? utf8_decode($datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                                $pdf->SetTextColor(0, 0, 0);
                                $pdf->SetFont('Helvetica', '', 9);
                                $pdf->Cell(100, 6, utf8_decode('Le invitamos a revisar nuestra pÃ¡gina web.'), 0, 1, 'R', 0);
                                
                                $pdf->SetTextColor(0, 0, 255);
                            
                                
                                $pdf->SetX(30);
                                $pdf->SetFont('Helvetica', 'U', 8);
                                $pdf->Cell(120, 6, isset($datos[0]->mailvendedor) ? utf8_decode($datos[0]->mailvendedor) : 'mailvendedor', 0, 0, 'L', 0);
                                // if($factura_info->id_empresa==1){
                                //     $pdf->SetTextColor(4, 255, 0);
                                // }else{
                                //     $pdf->SetTextColor(0, 0, 255);
                                // }
                                $pdf->SetTextColor(0, 0, 255);
                                $pdf->SetFont('', 'U', 9);
                                $pdf->Write(6, utf8_decode($factura_info->urlweb), utf8_decode($factura_info->urlweb));
                                $current_date = date("Y-m-d");
                                //dd($ruta);
                                if (!$generar_en_servidor) {
                                    return $pdf->Output(isset($datos[0]->identificacion) ? "proforma-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                                } else if ($generar_en_servidor && !is_null($ruta)) {
                                    if (file_exists($ruta)) {
                                        $name = $id . '.pdf';
                                        $location = $ruta . "/" . $name;
                                        $pdf->Output("F", $location);
                                        return json_encode(
                                            array(
                                                "location" => $location,
                                                "name" => $name)
                                        );
                                    } else {
                                        throw new Exception("No se pudo generar la proforma");
                                    }

                                } else if ($generar_en_servidor && is_null($ruta)) {
                                    throw new Exception("La ruta para la proforma no es valida.");
                                }
                            }else{
                                //empresa TECHCOMP SOLUTIONS
                                if($factura_info->ruc_empresa=='1792684706001'){
                                    $pdf->AliasNbPages();
                                    $pdf->AddPage();
                                    
                                    $logo = constant("DATA_EMPRESA") . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                                    $pdf->SetAutoPageBreak(true, 16);
                                    $width = $pdf->GetPageWidth();
                                    // HEADER
                                    if ($datos[0]->logo!==null && file_exists($logo)) {
                                        
                                            $pdf->Image($logo, 7, 3, 55, 35);
                                        
                                        
                                    } else {
                                        $pdf->SetTextColor(255, 0, 0);
                                        $pdf->SetFont('Arial', 'B', 020);
                                        $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                                    }
                                    //dd($factura_info);
                                    $pdf->SetXY(7,34);
                                    $pdf->SetTextColor(75, 75, 75);
                                    $pdf->SetFont('Helvetica', '', 8);
                                    $pdf->Cell(70, 4, utf8_decode($datos[0]->direccion_empresa), 0,2, 'L', 0);
                                    $pdf->Cell(70, 4, utf8_decode('EDIFICIO EL CISNE PISO 2, OF: 2C'), 0,2, 'L', 0);
                                    $pdf->Cell(70, 4, utf8_decode('TEL: 0991410077 - 0999310611'), 0,2, 'L', 0);
                                    $pdf->Cell(70, 4, utf8_decode($datos[0]->ciudad.' - ECUADOR'), 0,2, 'L', 0);
                                    $pdf->SetXY(-62,15);
                                    $pdf->SetTextColor(235, 102, 27);
                                    $pdf->SetFont('Helvetica', 'B', 18);
                                    $pdf->Cell(70, 8, utf8_decode('COTIZACIÃN'), 0,2, 'L', 0);
                                    $pdf->SetTextColor(75, 75, 75);
                                    $pdf->SetFont('Helvetica', 'B', 11);
                                    $pdf->Cell(70, 10, "FECHA: ".date("d", strtotime(($datos[0]->fecha_emision)))." / ".date("m", strtotime(($datos[0]->fecha_emision)))." / ".date("Y", strtotime(($datos[0]->fecha_emision))), 0,2, 'L', 0);
                                    $pdf->SetTextColor(235, 102, 27);
                                    $pdf->SetFont('Helvetica', 'B', 15);
                                    $pdf->Cell(42, 7, utf8_decode("NÂ°"), 0,2, 'C', 0);
                                    $pdf->SetTextColor(75, 75, 75);
                                    $pdf->SetFont('Helvetica', 'B', 11);
                                    if($id_proforma<10){
                                        $pdf->Cell(42, 7, "COT-TECH-".date("Y", strtotime(($datos[0]->fecha_emision)))."-000".$id_proforma, 0,2, 'L', 0);
                                    }else{
                                        if($id_proforma<100){
                                            $pdf->Cell(42, 7, "COT-TECH-".date("Y", strtotime(($datos[0]->fecha_emision)))."-00".$id_proforma, 0,2, 'L', 0);
                                        }else{
                                            if($id_proforma<1000){
                                                $pdf->Cell(42, 7, "COT-TECH-".date("Y", strtotime(($datos[0]->fecha_emision)))."-0".$id_proforma, 0,2, 'L', 0);
                                            }else{
                                                $pdf->Cell(42, 7, "COT-TECH-".date("Y", strtotime(($datos[0]->fecha_emision)))."-".$id_proforma, 0,2, 'L', 0);
                                            }
                                        }
                                    }
                                    $margin = 7;
                                    $height = $pdf->GetY();

                                    
                                    $pdf->RoundedRect($margin, $height + 7, $width - 14, 34, 2, '1234', 'D');
                                    
                                    $pdf->SetXY($margin+2, $height + 9.5);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 10);
                                    $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->cliente), 0, 2, 'L', 0);
                                    $pdf->Ln();
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 7);
                                    $pdf->Cell(8, 3, "RUC:", 0, 0, 'L', 0);
                                    $pdf->SetTextColor(75,75,75);
                                    $pdf->SetFont('Helvetica', '', 7);
                                    $pdf->Cell(15, 3, $datos[0]->identificacion, 0, 1, 'L', 0);
                                    $pdf->SetX($margin+3);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 7);
                                    $pdf->Cell(15, 3, utf8_decode("ATENCIÃN:"), 0, 0, 'L', 0);
                                    $pdf->SetTextColor(75,75,75);
                                    $pdf->SetFont('Helvetica', '', 7);
                                    $pdf->Cell(15, 3, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                                    $pdf->SetX($margin+3);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 7);
                                    $pdf->Cell(11, 3, utf8_decode("CIUDAD:"), 0, 0, 'L', 0);
                                    $pdf->SetTextColor(75,75,75);
                                    $pdf->SetFont('Helvetica', '', 7);
                                    $pdf->Cell(15, 3, $datos[0]->ciudad, 0, 2, 'L', 0);
                                    $pdf->SetX($margin+3);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 7);
                                    $pdf->Cell(15, 3, utf8_decode("TELÃFONO:"), 0, 0, 'L', 0);
                                    $pdf->SetTextColor(75,75,75);
                                    $pdf->SetFont('Helvetica', '', 7);
                                    $pdf->Cell(15, 3, $datos[0]->telefono, 0, 2, 'L', 0);
                                    $pdf->SetX($margin+3);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 7);
                                    $pdf->Cell(10, 3, utf8_decode("EMAIL:"), 0, 0, 'L', 0);
                                    $pdf->SetTextColor(75,75,75);
                                    $pdf->SetFont('Helvetica', '', 7);
                                    $pdf->Cell(15, 3, $datos[0]->email, 0, 2, 'L', 0);
                                    $pdf->SetX($margin+3);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 7);
                                    $pdf->Cell(16, 3, utf8_decode("DIRECCIÃN:"), 0, 0, 'L', 0);
                                    $pdf->SetTextColor(75,75,75);
                                    $pdf->SetFont('Helvetica', '', 7);
                                    $pdf->Cell(15, 3, utf8_decode($datos[0]->direccion), 0, 2, 'L', 0);
                                    $pdf->SetXY($margin,$pdf->GetY()+7);
                                    $pdf->Cell(196, 3, utf8_decode("NUESTRO SERVICIO ESTÃ BASADO EN EL CRECIMIENTO DE NUESTROS PROPIOS CLIENTES, POR TAL MOTIVO ES MUY IMPORTANTE"), 0,1, 'L', 0);
                                    $pdf->SetX($margin);
                                    $pdf->Cell(196, 3, utf8_decode("PARA NOSOTROS SU SATISFACCIÃN AL MOMENTO DE ESTABLECER UNA RELACIÃN COMERCIAL CON USTED."), 0,1, 'L', 0);
                                    $pdf->Ln();
                                    $pdf->SetX($margin);
                                    $pdf->Cell(196, 3, utf8_decode("A CONTINUACIÃN, LE DETALLAMOS NUESTRO SERVICIO:"), 0,1, 'L', 0);
                                    $pdf->Ln();
                                    $pdf->SetFont('Helvetica', 'B', 7);

                                    $height_products = $pdf->GetY();
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetXY($margin, $height_products);
                                    
                                    $pdf->MultiCell(111, 8, utf8_decode('DESCRIPCIÃN'), 1, 'C', 0);
                                    $pdf->SetXY($margin+111, $height_products);
                                    $pdf->MultiCell(22, 8, utf8_decode('ITEM'), 1, 'C', 0);
                                    
                                    $pdf->SetXY($margin+22+111, $height_products);
                                    $pdf->MultiCell(14, 8, utf8_decode('CANT'), 1, 'C', 0);
                                    $pdf->SetXY($margin+22+111+14, $height_products);
                                    $pdf->MultiCell(24, 8, utf8_decode('VALOR UNIT'), 1, 'C', 0);
                                    $pdf->SetXY($margin+22+111+14+24, $height_products);
                                    $pdf->MultiCell(24, 8, utf8_decode('TOTAL'), 1, 'C', 0);
                                    //$pdf->SetXY($margin+17+111+15+14+15+17, $height_products);
                                    
                                    //dd("X=".$margin."Y=".$height_products);
                                    $y = $height_products + 8;
                                    $pdf->SetFont('Helvetica', '', 4);
                                    $pdf->SetFillColor(255, 255, 255);
                                    $pdf->SetFillColor(85, 175, 84);
                                    $pdf->SetXY($margin, $height_products+8);
                                    $pdf->SetWidths(array( 111,22,  14, 24, 24));
                                    $pdf->SetTextColor(0,0,0);
                                    //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                                    $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                                    //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                                    $sub_total=0;
                                    $descuento=0;
                                    $iva=0;
                                    $total_fact=0;
                                    $suma_sub_total=0;
                                    $suma_descuento=0;
                                    $suma_iva=0;
                                    $suma_total_fact=0;
                                    $pdf->SetTextColor(75,75,75);
                                    //dd($datos);
                                    foreach ($datos as $detail) {
                                        $caract=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);
                                        $norm=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->normativa);
                                        $uso=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->uso);
                                        $data = array(
                                            utf8_decode($caract."Centrado"),
                                            utf8_decode(trim($detail->cod_alterno)."Centrado"),
                                            
                                            utf8_decode($detail->cantidad."Centrado"),
                                            utf8_decode("$ ".$detail->precio."Centrado"),
                                            utf8_decode("$ ".$detail->total_pro."Centrado"),
                                            
                                                
                                        );
                                        
                                        
                                            $sub_total=$detail->subtotal;
                                            $descuento=$detail->descuento;
                                            $iva=$detail->iva;
                                            $total_fact=$detail->total;
                                        
                                        $pdf->RowDataTechcomp($data, $margin+2);
                                        $head_table=$pdf->GetY();
                                    }
                                    $pdf->SetXY(154,$head_table);
                                    $pdf->Cell(24, 6, utf8_decode("SUBTOTAL"), 'RL',0, 'L', 0);
                                    $pdf->Cell(24, 6, "$".number_format($sub_total,2,".",","), 'RL',1, 'C', 0);
                                    $pdf->SetX(154);
                                    $pdf->Cell(24, 6, utf8_decode("DESCUENTO"), 'RL',0, 'L', 0);
                                    $pdf->Cell(24, 6, "$".number_format($descuento,2,".",","), 'RL',1, 'C', 0);
                                    $pdf->SetX(154);
                                    $pdf->Cell(24, 6, utf8_decode("IVA(12%)"), 'RL',0, 'L', 0);
                                    $pdf->Cell(24, 6, "$".number_format($iva,2,".",","), 'RL',1, 'C', 0);
                                    $pdf->SetX(154);
                                    $pdf->Cell(24, 6, utf8_decode("TOTAL"), 'RLB',0, 'L', 0);
                                    $pdf->Cell(24, 6, "$".number_format($total_fact,2,".",","), 'RLB',1, 'C', 0);
                                    $pdf->SetXY(7,$head_table+5);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 8);
                                    $pdf->Cell(24, 3, utf8_decode("REALICE DEPÃSITO O TRANSFERENCIA A:"), 0,1, 'L', 0);
                                    $pdf->SetX(7);
                                    $pdf->SetTextColor(75,75,75);
                                    $pdf->SetFont('Helvetica', '', 8);
                                    $pdf->Cell(24, 3, utf8_decode($factura_info->razon_social), 0,1, 'L', 0);
                                    $pdf->SetX(7);
                                    $pdf->SetTextColor(75,75,75);
                                    $pdf->SetFont('Helvetica', '', 8);
                                    $pdf->Cell(49, 3, utf8_decode("BANCO INTERNACIONAL CTA CTE."), 0,0, 'L', 0);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 8);
                                    $pdf->Cell(49, 3, utf8_decode("661419"), 0,1, 'L', 0);
                                    $pdf->SetX(7);
                                    $pdf->SetTextColor(75,75,75);
                                    $pdf->SetFont('Helvetica', '', 8);
                                    $pdf->Cell(49, 3, "RUC: ".$datos[0]->ruc_empresa, 0,1, 'L', 0);
                                    $pdf->SetX(7);
                                    $pdf->SetTextColor(75,75,75);
                                    $pdf->SetFont('Helvetica', '', 8);
                                    $pdf->Cell(49, 3, "EMAIL: ADMINISTRACION@TECHCOMPSOLUTIONS.COM", 0,1, 'L', 0);
                                    $pdf->SetX(7);
                                    $pdf->SetTextColor(75,75,75);
                                    $pdf->SetFont('Helvetica', '', 8);
                                    $pdf->Cell(49, 3, utf8_decode("TELÃFONO: 0991410077"), 0,1, 'L', 0);
                                    $pdf->Ln();
                                    $pdf->SetX(7);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 9);
                                    $pdf->Cell(49, 5, utf8_decode("CONDICIONES COMERCIALES"), 0,1, 'L', 0);
                                    $pdf->Ln();
                                    $pdf->SetX(7);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 8);
                                    $pdf->Cell(27, 5, utf8_decode("OBSERVACIONES:"), 0,1, 'L', 0);
                                    $pdf->SetX(7);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', '', 8);
                                    $pdf->MultiCell(147, 5, utf8_decode($factura_info->observacion),0, 'L', 0);
                                    $pdf->SetXY(7,$pdf->GetY());
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 8);
                                    $pdf->Cell(36, 5, utf8_decode("CONDICIONES DE PAGO:"), 0,0, 'L', 0);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', '', 8);
                                    $pdf->Cell(49, 5, utf8_decode($factura_info->condiciones_de_pago), 0,1, 'L', 0);
                                    $pdf->SetX(7);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', 'B', 8);
                                    $pdf->Cell(18, 5, utf8_decode("VENDEDOR:"), 0,0, 'L', 0);
                                    $pdf->SetTextColor(0,0,0);
                                    $pdf->SetFont('Helvetica', '', 8);
                                    $pdf->Cell(49, 5, utf8_decode($factura_info->condiciones_de_pago), 0,1, 'L', 0);
                                    $pdf->SetAutoPageBreak(false);

                                    // $pdf->SetXY(0,-15);
                                    // $pdf->SetFillColor(20, 99, 171);
                                    // $pdf->SetTextColor(255,255,255);
                                    // $pdf->SetFont('Helvetica', '', 8);
                                    // $pdf->Cell($width, 5, utf8_decode("LA COTIZACIÃN ES VÃLIDA POR 8 DÃAS."), 0,1, 'C', 1);
                                    // $pdf->SetX(0);
                                    // $pdf->Cell($width, 5, utf8_decode("SI NECESITA MÃS INFORMACIÃN, COMUNÃQUESE CON DANNY QUINTUÃA"), 0,1, 'C', 1);
                                    // $pdf->SetX(0);
                                    // $pdf->Cell($width, 5, utf8_decode("0991410077 / 0999310611"), 0,1, 'C', 1);
                                    $pdf->FooterTechComp();
                                    
                                    
                                    $current_date = date("Y-m-d");
                                    if (!$generar_en_servidor) {
                                        return $pdf->Output(isset($datos[0]->identificacion) ? "proforma-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                                    } else if ($generar_en_servidor && !is_null($ruta)) {
                                        if (file_exists($ruta)) {
                                            $name = $id . '.pdf';
                                            $location = $ruta . "/" . $name;
                                            $pdf->Output("F", $location);
                                            return json_encode(
                                                array(
                                                    "location" => $location,
                                                    "name" => $name)
                                            );
                                        } else {
                                            throw new Exception("No se pudo generar la proforma");
                                        }

                                    } else if ($generar_en_servidor && is_null($ruta)) {
                                        throw new Exception("La ruta para la proforma no es valida.");
                                    }
                                }else{
                                    //empresa CORTINAS DLUXE 1720254075001
                                    if($factura_info->ruc_empresa=='1720254075001'){
                                        $pdf->AliasNbPages();
                                        $pdf->AddPage();
                                        $logo = constant("DATA_EMPRESA") . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                                        $pdf->SetAutoPageBreak(1, 4);
                                        $width = $pdf->GetPageWidth();
                                        // HEADER
                                        if ($datos[0]->logo!==null && file_exists($logo)) {
                                            
                                                $pdf->Image($logo, 10, 6, 50, 35);
                                            
                                            
                                        } else {
                                            $pdf->SetTextColor(255, 0, 0);
                                            $pdf->SetFont('Arial', 'B', 20);
                                            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                                        }
                                        // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/3m.png', 134, 7, 20, 10);
                                        // }
                                        $pdf->SetTextColor(0, 0, 0);
                                        $pdf->SetFont('Arial', 'B', 14);
                                        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth("PEDIDO NÂ°. " . $id_proforma) / 2), 33);
                                        $pdf->Cell($pdf->GetStringWidth("PEDIDO NÂ°. " . $id_proforma), 8, utf8_decode("PEDIDO NÂ°. " . $id_proforma), 0, 2, 'C', 0);
                                        $pdf->SetXY((($width / 4) * 3)+10, 10);
                                        $pdf->SetFont('Arial', 'B', 8);
                                        $pdf->Cell(($width / 4) - 10, 6, isset($datos[0]->ruc_empresa) ? utf8_decode('RUC: ' . $datos[0]->ruc_empresa) : '*************', 0, 2, 'C', 0);
                                        $pdf->MultiCell(($width / 4) - 10, 6, isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : 'Sin direccion', 0, 'C', 0);
                                        $pdf->Ln();

                                        // INFORMATION HEADER
                                        $margin = 5;
                                        $height = $pdf->GetY();
                                        $cli_atencion = '';
                                        // if($factura_info->id_empresa==1){
                                        //     //$pdf->SetDrawColor(85, 175, 84);
                                        //     $pdf->SetDrawColor(85, 175, 84);
                                        // }else{
                                        //     //$pdf->SetDrawColor(85, 175, 204);
                                        //     $pdf->SetDrawColor(85, 175, 204);
                                        // }
                                        $pdf->SetDrawColor(85, 175, 204);
                                        //$pdf->SetDrawColor(85, 175, 204);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76 && $pdf->GetStringWidth(utf8_decode($datos[0]->email))>76){
                                            $pdf->RoundedRect($margin, $height + 10, $width - 14, 27.5, 2, '1234', 'D');
                                        }else{
                                            $pdf->RoundedRect($margin, $height + 10, $width - 14, 26, 2, '1234', 'D');
                                        }
                                        
                                        $pdf->SetXY($margin, $height + 12.5);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell($width / 4, 5, utf8_decode('RUC:'), 0, 2, 'L', 0);
                                        $head_ruc=$pdf->GetY();
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                            $pdf->SetXY($margin, $head_ruc+1);
                                        }
                                        $pdf->Cell($width / 4, 5, utf8_decode('CLIENTE:'), 0, 2, 'L', 0);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                            $pdf->SetXY($margin, 58);
                                        }
                                        $pdf->Cell($width / 4, 5, utf8_decode('ATENCIÃN:'), 0, 2, 'L', 0);
                                        $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                                        $pdf->SetXY($width / 2, $height + 12.5);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell($width / 4, 5, utf8_decode('FECHA:'), 0, 2, 'L', 0);
                                        $pdf->Cell($width / 4, 5, utf8_decode('CIUDAD:'), 0, 2, 'L', 0);
                                        $pdf->Cell($width / 4, 5, utf8_decode('DIRECCIÃN:'), 0, 2, 'L', 0);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                            $pdf->SetXY($width / 2, 63);
                                        }
                                        $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);

                                        $pdf->SetXY(($width / 6) - $margin, $height + 12.5);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell($width / 4, 5, isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : 'identificacion', 0, 2, 'L', 0);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                            $pdf->MultiCell(76, 3, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0,'L', 0);
                                            $head_cliente=$pdf->GetY();
                                        }else{
                                            $pdf->Cell(76, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                                        }
                                        //dd($head_cliente);
                                        //$pdf->MultiCell(75, 5, isset($datos[0]->cliente) ? utf8_decode('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.'/*$datos[0]->cliente*/) : 'cliente', 1,'L');
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                            $pdf->SetXY(($width / 6) - $margin,$head_cliente+0.5);
                                        }else{
                                            $pdf->SetX(($width / 6) - $margin);
                                        }
                                        
                                        $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->email))>76){
                                            $pdf->MultiCell(76, 3, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0,'L', 0);
                                        }else{
                                            $pdf->Cell(76, 5, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0, 2, 'L', 0);
                                        }
                                        

                                        $pdf->SetXY(($width / 6 * 4) - $margin, $height + 12.5);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell($width / 4, 5, isset($datos[0]->fecha_emision) ? utf8_decode($datos[0]->fecha_emision) : 'fecha_emision', 0, 2, 'L', 0);
                                        $pdf->Cell($width / 4, 5, isset($datos[0]->ciudad) ? utf8_decode($datos[0]->ciudad) : 'ciudad', 0, 2, 'L', 0);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                            $pdf->MultiCell(66, 3, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0,'L', 0);
                                            $head_dir=$pdf->GetY();
                                        }else{
                                            $pdf->Cell(66, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                                        }
                                        //dd($head_dir);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                            $pdf->SetXY(($width / 6 * 4) - $margin, $head_dir+0.5);
                                        }
                                        $pdf->Cell($width / 4, 5, isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : 'telefono', 0, 2, 'L', 0);
                                        $pdf->Ln();

                                        // MESSAGE
                                        // $pdf->SetXY($margin, $height + 45);
                                        // $pdf->SetFont('Helvetica', 'B', 8);
                                        // $pdf->Cell(20, 5, utf8_decode('APRECIADO CLIENTE:'), 0, 2, 'L', 0);
                                        // $pdf->SetFont('Helvetica', '', 8);
                                        // $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                                        $pdf->SetFillColor(85, 175, 84);
                                        $pdf->SetTextColor(0, 0, 255);
                                        $pdf->SetDrawColor(0, 0, 0);
                                        if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                                            // SLOGAN
                                            $pdf->SetXY($margin, $height + 55);
                                            $pdf->SetFont('Helvetica', 'B', 10);
                                            $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                                            $height_products = $height + 65;
                                        } else {
                                            $height_products = $height + 50;
                                        }
                                        //cabecera de detalles de productos
                                        $pdf->SetFont('Helvetica', 'B', 6);
                                        // if($factura_info->id_empresa==1){
                                        //     $pdf->SetFillColor(141, 207, 140);
                                        // }else{
                                            
                                        // }
                                        $pdf->SetFillColor(141, 207, 240);
                                        //dd("X=".$margin."Y=".$height_products);
                                        $pdf->SetTextColor(0, 0, 0);
                                        $pdf->SetXY($margin, $height_products);
                                        $pdf->MultiCell(15, 8, utf8_decode('CODIGO'), 1, 'C', 1);
                                        $pdf->SetXY(20, $height_products);
                                        $pdf->MultiCell(30, 8, utf8_decode('TIPO DE CORTINA'), 1, 'C', 1);
                                        $pdf->SetXY(50, $height_products);
                                        $pdf->MultiCell(23, 8, utf8_decode('COLOR'), 1, 'C', 1);
                                        $pdf->SetXY(73, $height_products);
                                        $pdf->MultiCell(25, 8, utf8_decode('DETALLE'), 1, 'C', 1);
                                        $pdf->SetXY(98, $height_products);
                                        $pdf->MultiCell(16, 8, utf8_decode('MANDOS'), 1, 'C', 1);
                                        $pdf->SetXY(114, $height_products);
                                        $pdf->MultiCell(14, 8, utf8_decode('ANCHO'), 1, 'C', 1);
                                        $pdf->SetXY(128, $height_products);
                                        $pdf->MultiCell(12, 8, utf8_decode('ALTO'), 1, 'C', 1);
                                        $pdf->SetXY(140, $height_products);
                                        $pdf->MultiCell(12, 8, utf8_decode('M2'), 1, 'C', 1);
                                        $pdf->SetXY(152, $height_products);
                                        $pdf->MultiCell(14, 8, utf8_decode('PRECIO'), 1, 'C', 1);
                                        $pdf->SetXY(166, $height_products);
                                        $pdf->MultiCell(15, 8, utf8_decode('DSC'), 1, 'C', 1);
                                        $pdf->SetXY(181, $height_products);
                                        $pdf->MultiCell(20, 8, utf8_decode('TOTAL'), 1, 'C', 1);
                                        //$pdf->SetXY(190, $height_products);
                                        //$pdf->MultiCell(15, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                                        //dd("X=".$margin."Y=".$height_products);
                                        $y = $height_products + 8;
                                        $pdf->SetFont('Helvetica', '', 5);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFillColor(85, 175, 84);
                                        $pdf->SetXY($margin, $height_products+8);
                                        $pdf->SetWidths(array(15, 30, 23, 25, 16, 14, 12, 12, 14, 15, 20));
                                        //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                                        //$imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                                        //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                                        $sub_total=0;
                                        $descuento=0;
                                        $iva=0;
                                        $total_fact=0;
                                        $suma_sub_total=0;
                                        $suma_descuento=0;
                                        $suma_iva=0;
                                        $suma_total_fact=0;
                                        foreach ($datos as $detail) {
                                            $data = array(
                                                utf8_decode($detail->cod_alterno),
                                                utf8_decode($detail->nombre),
                                                utf8_decode($detail->color),
                                                utf8_decode($detail->detalle_cortina),
                                                utf8_decode($detail->mando),
                                                number_format($detail->ancho,2,".",",")."Derecha",
                                                number_format($detail->alto,2,".",",")."Derecha",
                                                number_format($detail->cantidad,2,".",",")."Derecha",
                                                number_format($detail->precio,2,".",",")."Derecha",
                                                number_format($detail->descuento_prod,2,".",",")."Derecha",
                                                number_format($detail->total_pro,2,".",",")."Derecha"
                                                //utf8_decode($detail->total_pro."Derecha"),
                                                //utf8_decode('INMEDIATA'),
                                                
                                            );
                                            $sub_total=$detail->subtotal;
                                            $descuento=$detail->descuento_prod;
                                            $iva=$detail->iva;
                                            $total_fact=$detail->total;
                                            $pdf->RowProductsCortina($data, $margin+5);
                                        }
                                        
                                        $suma_sub_total=number_format($sub_total,2,".",",");
                                        $suma_descuento=number_format($descuento,2,".",",");
                                        $suma_iva=number_format($iva,2,".",",");
                                        $suma_total_fact=number_format($total_fact,2,".",",");
                                        $pdf->SetXY(135, $pdf->GetY());
                                        // $pdf->SetX(135);
                                        // $pdf->SetFont('Helvetica', 'B', 8);
                                        // $pdf->Cell(46, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                                        // $pdf->SetFont('Helvetica', '', 8);
                                        // //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                                        // $pdf->Cell(20, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                                        // $pdf->SetX(135);
                                        // $pdf->SetFont('Helvetica', 'B', 8);
                                        // $pdf->Cell(46, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                                        // $pdf->SetFont('Helvetica', '', 8);
                                        // //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                                        // $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                                        // $pdf->SetX(135);
                                        // $pdf->SetFont('Helvetica', 'B', 8);
                                        // $pdf->Cell(46, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
                                        // $pdf->SetFont('Helvetica', '', 8);
                                        // //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                                        // $pdf->Cell(20, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                                        $pdf->SetX(140);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell(41, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell(20, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                                        $pdf->Ln();
                                        
                                        // if($factura_info->id_empresa==1){
                                        //     $pdf->SetDrawColor(85, 175, 84);
                                        // }else{
                                        //     $pdf->SetDrawColor(141, 207, 240);
                                        // }
                                        $pdf->SetDrawColor(141, 207, 240);
                                        $pdf->SetX(5);
                                        $pdf->SetFont('Helvetica', 'BU', 9);
                                        $pdf->Cell(200, 6, utf8_decode('CONDICIONES COMERCIALES'), 'T', 1, 'L', 0);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->SetX(5);
                                        $pdf->Cell(50, 6, utf8_decode('LUGAR DE ENTREGA:'), 0, 0, 'L', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell(150, 6, utf8_decode($factura_info->lugar_de_entrega), 0, 1, 'L', 0);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->SetX(5);
                                        $pdf->Cell(50, 6, utf8_decode('CONDICIONES DE PAGO:'), 0, 0, 'L', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell(150, 6, utf8_decode($factura_info->condiciones_de_pago), 0, 1, 'L', 0);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->SetX(5);
                                        $pdf->Cell(50, 6, utf8_decode('OBSERVACIONES:'), 0, 0, 'L', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->MultiCell(146, 6, utf8_decode($factura_info->observacion), 0,'L');
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->SetX(5);
                                        $pdf->Cell(50, 6, utf8_decode('FECHA ENTREGA:'), 'B', 0, 'L', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell(150, 6, utf8_decode($factura_info->fecha_expiracion), 'B', 1, 'L', 0);
                                        $pdf->Ln();

                                        $pdf->SetX(5);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell(25, 6, utf8_decode('Vendedor:'), 0, 0, 'L', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell(75, 6, isset($factura_info->nombre_vendedor) ? utf8_decode($factura_info->nombre_vendedor) : 'vendedor', 0, 0, 'L', 0);
                                        $pdf->SetTextColor(0, 0, 0);
                                        $pdf->SetFont('Helvetica', '', 9);
                                        $pdf->Cell(100, 6, utf8_decode('Le invitamos a revisar nuestra pÃ¡gina web.'), 0, 1, 'R', 0);
                                        
                                        $pdf->SetTextColor(0, 0, 255);
                                    
                                        
                                        $pdf->SetX(30);
                                        $pdf->SetFont('Helvetica', 'U', 8);
                                        $pdf->Cell(112, 6, isset($factura_info->email_vendedor) ? utf8_decode($factura_info->email_vendedor) : 'mailvendedor', 0, 0, 'L', 0);
                                        // if($factura_info->id_empresa==1){
                                        //     $pdf->SetTextColor(4, 255, 0);
                                        // }else{
                                        //     $pdf->SetTextColor(0, 0, 255);
                                        // }
                                        
                                        $pdf->SetTextColor(0, 0, 255);
                                        $pdf->SetFont('', 'U', 9);
                                        $pdf->Write(6, utf8_decode($factura_info->urlweb), utf8_decode($factura_info->urlweb));
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Ln(20);
                                        $pdf->SetX(55);
                                        $pdf->SetTextColor(0, 0, 0);
                                        $head_firma=$pdf->GetY();
                                        $pdf->SetFont('Helvetica', 'B', 7);
                                        $pdf->Cell(40, 5, '____________________________', 0, 0, 'L', 0);
                                        $pdf->Cell(20, 5, '        ', 0, 0, 'L', 0);
                                        $pdf->Cell(40, 5, '____________________________', 0, 1, 'L', 0);
                                        $pdf->SetX(55);
                                        $pdf->SetFont('Helvetica', 'B', 7);
                                        $pdf->Cell(40, 5, 'VENDEDOR', 0, 0, 'C', 0);
                                        $pdf->Cell(20, 5, '        ', 0, 0, 'L', 0);
                                        $pdf->Cell(40, 5, 'CLIENTE', 0,1,'C', 0);
                                        $pdf->SetX(55);
                                        $head_cliente_firma=$pdf->GetX();
                                        $pdf->SetFont('Helvetica', '', 7);
                                        $pdf->Cell(40, 5, utf8_decode($datos[0]->vendedor), 0, 0, 'C', 0);
                                        $pdf->Cell(20, 5, '        ', 0, 0, 'L', 0);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>40){
                                            $pdf->SetXY(116,$pdf->GetY()+1);
                                            $pdf->MultiCell(40, 2, utf8_decode($datos[0]->cliente), 0,'C', 0);
                                        }
                                        else{
                                            $pdf->Cell(40, 5, utf8_decode($datos[0]->cliente), 0,1,'C', 0);
                                        }
                                        
                                        $current_date = date("Y-m-d");
                                        //dd($ruta);
                                        if (!$generar_en_servidor) {
                                            return $pdf->Output(isset($datos[0]->identificacion) ? "proforma-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                                        } else if ($generar_en_servidor && !is_null($ruta)) {
                                            if (file_exists($ruta)) {
                                                $name = $id . '.pdf';
                                                $location = $ruta . "/" . $name;
                                                $pdf->Output("F", $location);
                                                return json_encode(
                                                    array(
                                                        "location" => $location,
                                                        "name" => $name)
                                                );
                                            } else {
                                                throw new Exception("No se pudo generar la proforma");
                                            }

                                        } else if ($generar_en_servidor && is_null($ruta)) {
                                            throw new Exception("La ruta para la proforma no es valida.");
                                        }

                                    }else{
                                        $pdf->AliasNbPages();
                                        $pdf->AddPage();
                                        $logo = constant("DATA_EMPRESA") . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                                        $pdf->SetAutoPageBreak(1, 4);
                                        $width = $pdf->GetPageWidth();
                                        // HEADER
                                        if ($datos[0]->logo!==null && file_exists($logo)) {
                                            
                                                $pdf->Image($logo, 10, 6, 50, 35);
                                            
                                            
                                        } else {
                                            $pdf->SetTextColor(255, 0, 0);
                                            $pdf->SetFont('Arial', 'B', 20);
                                            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                                        }
                                        // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/3m.png', 134, 7, 20, 10);
                                        // }
                                        $pdf->SetTextColor(0, 0, 0);
                                        $pdf->SetFont('Arial', 'B', 14);
                                        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth("PROFORMA NÂ°. " . $id_proforma) / 2), 33);
                                        $pdf->Cell($pdf->GetStringWidth("PROFORMA NÂ°. " . $id_proforma), 8, utf8_decode("PROFORMA NÂ°. " . $id_proforma), 0, 2, 'C', 0);
                                        $pdf->SetXY((($width / 4) * 3)+10, 10);
                                        $pdf->SetFont('Arial', 'B', 8);
                                        $pdf->Cell(($width / 4) - 10, 6, isset($datos[0]->ruc_empresa) ? utf8_decode('RUC: ' . $datos[0]->ruc_empresa) : '*************', 0, 2, 'C', 0);
                                        $pdf->MultiCell(($width / 4) - 10, 6, isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : 'Sin direccion', 0, 'C', 0);
                                        $pdf->Ln();

                                        // INFORMATION HEADER
                                        $margin = 5;
                                        $height = $pdf->GetY();
                                        $cli_atencion = '';
                                        // if($factura_info->id_empresa==1){
                                        //     //$pdf->SetDrawColor(85, 175, 84);
                                        //     $pdf->SetDrawColor(85, 175, 84);
                                        // }else{
                                        //     //$pdf->SetDrawColor(85, 175, 204);
                                        //     $pdf->SetDrawColor(85, 175, 204);
                                        // }
                                        $pdf->SetDrawColor(85, 175, 204);
                                        //$pdf->SetDrawColor(85, 175, 204);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76 && $pdf->GetStringWidth(utf8_decode($datos[0]->email))>76){
                                            $pdf->RoundedRect($margin, $height + 10, $width - 14, 27.5, 2, '1234', 'D');
                                        }else{
                                            $pdf->RoundedRect($margin, $height + 10, $width - 14, 26, 2, '1234', 'D');
                                        }
                                        
                                        $pdf->SetXY($margin, $height + 12.5);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell($width / 4, 5, utf8_decode('RUC:'), 0, 2, 'L', 0);
                                        $head_ruc=$pdf->GetY();
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                            $pdf->SetXY($margin, $head_ruc+1);
                                        }
                                        $pdf->Cell($width / 4, 5, utf8_decode('CLIENTE:'), 0, 2, 'L', 0);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                            $pdf->SetXY($margin, 58);
                                        }
                                        $pdf->Cell($width / 4, 5, utf8_decode('ATENCIÃN:'), 0, 2, 'L', 0);
                                        $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                                        $pdf->SetXY($width / 2, $height + 12.5);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell($width / 4, 5, utf8_decode('FECHA:'), 0, 2, 'L', 0);
                                        $pdf->Cell($width / 4, 5, utf8_decode('CIUDAD:'), 0, 2, 'L', 0);
                                        $pdf->Cell($width / 4, 5, utf8_decode('DIRECCIÃN:'), 0, 2, 'L', 0);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                            $pdf->SetXY($width / 2, 63);
                                        }
                                        $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);

                                        $pdf->SetXY(($width / 6) - $margin, $height + 12.5);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell($width / 4, 5, isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : 'identificacion', 0, 2, 'L', 0);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                            $pdf->MultiCell(76, 3, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0,'L', 0);
                                            $head_cliente=$pdf->GetY();
                                        }else{
                                            $pdf->Cell(76, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                                        }
                                        //dd($head_cliente);
                                        //$pdf->MultiCell(75, 5, isset($datos[0]->cliente) ? utf8_decode('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.'/*$datos[0]->cliente*/) : 'cliente', 1,'L');
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                            $pdf->SetXY(($width / 6) - $margin,$head_cliente+0.5);
                                        }else{
                                            $pdf->SetX(($width / 6) - $margin);
                                        }
                                        
                                        $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->email))>76){
                                            $pdf->MultiCell(76, 3, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0,'L', 0);
                                        }else{
                                            $pdf->Cell(76, 5, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0, 2, 'L', 0);
                                        }
                                        

                                        $pdf->SetXY(($width / 6 * 4) - $margin, $height + 12.5);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell($width / 4, 5, isset($datos[0]->fecha_emision) ? utf8_decode($datos[0]->fecha_emision) : 'fecha_emision', 0, 2, 'L', 0);
                                        $pdf->Cell($width / 4, 5, isset($datos[0]->ciudad) ? utf8_decode($datos[0]->ciudad) : 'ciudad', 0, 2, 'L', 0);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                            $pdf->MultiCell(66, 3, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0,'L', 0);
                                            $head_dir=$pdf->GetY();
                                        }else{
                                            $pdf->Cell(66, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                                        }
                                        //dd($head_dir);
                                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                            $pdf->SetXY(($width / 6 * 4) - $margin, $head_dir+0.5);
                                        }
                                        $pdf->Cell($width / 4, 5, isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : 'telefono', 0, 2, 'L', 0);
                                        $pdf->Ln();

                                        // MESSAGE
                                        $pdf->SetXY($margin, $height + 45);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell(20, 5, utf8_decode('APRECIADO CLIENTE:'), 0, 2, 'L', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                                        $pdf->SetFillColor(85, 175, 84);
                                        $pdf->SetTextColor(0, 0, 255);
                                        $pdf->SetDrawColor(0, 0, 0);
                                        if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                                            // SLOGAN
                                            $pdf->SetXY($margin, $height + 55);
                                            $pdf->SetFont('Helvetica', 'B', 10);
                                            $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                                            $height_products = $height + 65;
                                        } else {
                                            $height_products = $height + 60;
                                        }
                                        //cabecera de detalles de productos
                                        $pdf->SetFont('Helvetica', 'B', 6);
                                        // if($factura_info->id_empresa==1){
                                        //     $pdf->SetFillColor(141, 207, 140);
                                        // }else{
                                            
                                        // }
                                        $pdf->SetFillColor(141, 207, 240);
                                        //dd("X=".$margin."Y=".$height_products);
                                        $pdf->SetTextColor(0, 0, 0);
                                        $pdf->SetXY($margin, $height_products);
                                        $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                                        $pdf->SetXY(30, $height_products);
                                        $pdf->MultiCell(20, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                                        $pdf->SetXY(50, $height_products);
                                        $pdf->MultiCell(25, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                                        $pdf->SetXY(75, $height_products);
                                        $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                                        $pdf->SetXY(95, $height_products);
                                        $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                                        $pdf->SetXY(111, $height_products);
                                        $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                                        $pdf->SetXY(123, $height_products);
                                        $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                                        $pdf->SetXY(135, $height_products);
                                        $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                                        $pdf->SetXY(147, $height_products);
                                        $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                                        $pdf->SetXY(161, $height_products);
                                        $pdf->MultiCell(20, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                                        $pdf->SetXY(181, $height_products);
                                        $pdf->MultiCell(20, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                                        //$pdf->SetXY(190, $height_products);
                                        //$pdf->MultiCell(15, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                                        //dd("X=".$margin."Y=".$height_products);
                                        $y = $height_products + 8;
                                        $pdf->SetFont('Helvetica', '', 4);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFillColor(85, 175, 84);
                                        $pdf->SetXY($margin, $height_products+8);
                                        $pdf->SetWidths(array(25, 20, 25, 20, 16, 12, 12, 12, 14, 20, 20, 15));
                                        //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                                        $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                                        //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                                        $sub_total=0;
                                        $descuento=0;
                                        $iva=0;
                                        $total_fact=0;
                                        $suma_sub_total=0;
                                        $suma_descuento=0;
                                        $suma_iva=0;
                                        $suma_total_fact=0;
                                        foreach ($datos as $detail) {
                                            $caract = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->caracteristicas);
                                            $norm = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->normativa);
                                            $uso = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->uso);
                                            $data = array(
                                                utf8_decode($detail->nombre),
                                                utf8_decode($caract),
                                                utf8_decode($norm),
                                                utf8_decode($uso),
                                                utf8_decode($detail->marca."Centrado"),
                                                utf8_decode($detail->unidad_medida."Centrado"),
                                                utf8_decode($detail->tipo_medida."Centrado"),
                                                utf8_decode($detail->cantidad."Centrado"),
                                                utf8_decode($detail->precio."Centrado"),
                                                utf8_decode($detail->total_pro."Derecha"),
                                                //utf8_decode($detail->total_pro."Derecha"),
                                                //utf8_decode('INMEDIATA'),
                                                
                                            );
                                                $sub_total=$detail->subtotal;
                                                $descuento=$detail->descuento;
                                                $iva=$detail->iva;
                                                $total_fact=$detail->total;
                                            if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                                            //if ($detail->imagen) {
                                                array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                                            } else {
                                                array_unshift($data, utf8_decode('* sin imagen'));
                                            }
                                            //dd("Imagen:".$imagen.$detail->imagen);
                                            $pdf->RowProductsGeneral($data, $margin+5);
                                        }
                                        
                                        $suma_sub_total=number_format($sub_total,2,".",",");
                                        $suma_descuento=number_format($descuento,2,".",",");
                                        $suma_iva=number_format($iva,2,".",",");
                                        $suma_total_fact=number_format($total_fact,2,".",",");
                                        $pdf->SetXY(135, $pdf->GetY());
                                        $pdf->SetX(135);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell(46, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                                        $pdf->Cell(20, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                                        $pdf->SetX(135);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell(46, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                                        $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                                        $pdf->SetX(135);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell(46, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                                        $pdf->Cell(20, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                                        $pdf->SetX(135);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell(46, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell(20, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                                        $pdf->Ln();
                                        
                                        // if($factura_info->id_empresa==1){
                                        //     $pdf->SetDrawColor(85, 175, 84);
                                        // }else{
                                        //     $pdf->SetDrawColor(141, 207, 240);
                                        // }
                                        $pdf->SetDrawColor(141, 207, 240);
                                        $pdf->SetX(5);
                                        $pdf->SetFont('Helvetica', 'BU', 9);
                                        $pdf->Cell(200, 6, utf8_decode('CONDICIONES COMERCIALES'), 'T', 1, 'L', 0);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->SetX(5);
                                        $pdf->Cell(50, 6, utf8_decode('LUGAR DE ENTREGA:'), 0, 0, 'L', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell(150, 6, utf8_decode($factura_info->lugar_de_entrega), 0, 1, 'L', 0);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->SetX(5);
                                        $pdf->Cell(50, 6, utf8_decode('CONDICIONES DE PAGO:'), 0, 0, 'L', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell(150, 6, utf8_decode($factura_info->condiciones_de_pago), 0, 1, 'L', 0);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->SetX(5);
                                        $pdf->Cell(50, 6, utf8_decode('OBSERVACIONES:'), 0, 0, 'L', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->MultiCell(146, 6, utf8_decode($factura_info->observacion), 0,'L');
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->SetX(5);
                                        $pdf->Cell(50, 6, utf8_decode('VALIDEZ DE LA OFERTA:'), 'B', 0, 'L', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell(150, 6, utf8_decode($factura_info->fecha_expiracion), 'B', 1, 'L', 0);
                                        $pdf->Ln();

                                        $pdf->SetX(5);
                                        $pdf->SetFont('Helvetica', 'B', 8);
                                        $pdf->Cell(25, 6, utf8_decode('Elaborado por:'), 0, 0, 'L', 0);
                                        $pdf->SetFont('Helvetica', '', 8);
                                        $pdf->Cell(75, 6, isset($datos[0]->vendedor) ? utf8_decode($datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                                        $pdf->SetTextColor(0, 0, 0);
                                        $pdf->SetFont('Helvetica', '', 9);
                                        $pdf->Cell(100, 6, utf8_decode('Le invitamos a revisar nuestra pÃ¡gina web.'), 0, 1, 'R', 0);
                                        
                                        $pdf->SetTextColor(0, 0, 255);
                                    
                                        
                                        $pdf->SetX(30);
                                        $pdf->SetFont('Helvetica', 'U', 8);
                                        $pdf->Cell(112, 6, isset($datos[0]->mailvendedor) ? utf8_decode($datos[0]->mailvendedor) : 'mailvendedor', 0, 0, 'L', 0);
                                        // if($factura_info->id_empresa==1){
                                        //     $pdf->SetTextColor(4, 255, 0);
                                        // }else{
                                        //     $pdf->SetTextColor(0, 0, 255);
                                        // }
                                        $pdf->SetTextColor(0, 0, 255);
                                        $pdf->SetFont('', 'U', 9);
                                        $pdf->Write(6, utf8_decode($factura_info->urlweb), utf8_decode($factura_info->urlweb));
                                        $current_date = date("Y-m-d");
                                        //dd($ruta);
                                        if (!$generar_en_servidor) {
                                            return $pdf->Output(isset($datos[0]->identificacion) ? "proforma-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                                        } else if ($generar_en_servidor && !is_null($ruta)) {
                                            if (file_exists($ruta)) {
                                                $name = $id . '.pdf';
                                                $location = $ruta . "/" . $name;
                                                $pdf->Output("F", $location);
                                                return json_encode(
                                                    array(
                                                        "location" => $location,
                                                        "name" => $name)
                                                );
                                            } else {
                                                throw new Exception("No se pudo generar la proforma");
                                            }

                                        } else if ($generar_en_servidor && is_null($ruta)) {
                                            throw new Exception("La ruta para la proforma no es valida.");
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }else{
                //dd($factura_info);
                $pdf->SetLeftMargin(30);

                #Establecemos el margen inferior:
                $pdf->SetAutoPageBreak(true,25); 
                //$pdf->AddPage();
                $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                $pdf->SetLeftMargin(30);
                $pdf->SetAutoPageBreak(1, 4);
                $pdf->AddPage();
                $width = $pdf->GetPageWidth();
                //$pdf->Rect(7.5, 7.5, $pdf->GetPageWidth()-15,$pdf->GetPageHeight()-15,'D');
                $pdf->SetLeftMargin(30);
                if(file_exists($logo)){
                    $pdf->Image($logo,15, 15, 55, 20);
                }
                
                $pdf->SetXY(($width / 2) - 20,15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(113,5,'Proveedor: '.utf8_decode($datos[0]->nombre_empresa),0,1,'L');
                //$pdf->Cell(96,5,isset($datos[0]->nombre_empresa) ? utf8_decode($datos[0]->nombre_empresa) : '',0,1,'R');
                $pdf->SetXY($pdf->GetPageWidth()-28,20);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(14,5,'RUC:'.$datos[0]->ruc_empresa,0,1,'R');
                $pdf->SetXY($pdf->GetPageWidth()-144,25);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(130,5,utf8_decode('DirecciÃ³n:').utf8_decode($datos[0]->direccion_empresa),0,1,'R');
                $pdf->SetXY($pdf->GetPageWidth()-54,30);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(40,5,utf8_decode('TelÃ©fono:').$factura_info->telefono,0,1,'R');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(35,5,isset($datos[0]->ruc_empresa) ? utf8_decode($datos[0]->ruc_empresa) : '',0,1,'L');
                $pdf->SetXY(95,50);
                $pdf->SetFont('Helvetica', 'B', 10);
                $pdf->Cell(20,3,utf8_decode('PROFORMA NÂ°').$id_proforma,0,0,'C');
                $margin = 15;
                $height = $pdf->GetY();
                $pdf->SetXY(15,75);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(17,5,'Cliente:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(96,5,isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente',0,0,'L');
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(14,5,'RUC:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(35,5,isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : '',0,1,'L');
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(17,5,'DIR:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(96,5,isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : '',0,0,'L');
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(14,5,'TLF:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(35,5,isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : '',0,1,'L');
                // $pdf->SetX(15);
                
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(17,5,'Proveedor: ',0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(96,5,isset($datos[0]->nombre_empresa) ? utf8_decode($datos[0]->nombre_empresa) : '',0,0,'L');
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(14,5,'RUC:',0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(35,5,isset($datos[0]->ruc_empresa) ? utf8_decode($datos[0]->ruc_empresa) : '',0,1,'L');
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(17,5,utf8_decode('Fecha:'),0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(93,5,strftime("%d de %B del %Y", strtotime($datos[0]->fecha_emision)),0,1,'L');
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(27,5,utf8_decode('Fecha Vencimiento:'),0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(88,5,strftime("%d de %B del %Y", strtotime($factura_info->fecha_expiracion)),0,1,'L');
                // $pdf->SetX(15);
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(17,5,utf8_decode('DirecciÃ³n:'),0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(96,5,isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : '',0,0,'L');
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(14,5,utf8_decode('TelÃ©fono:'),0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(38,5,isset($factura_info->telefono) ? utf8_decode($factura_info->telefono) : '',0,1,'L');
                $height_products = $height + 55;
                $pdf->Ln(15);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetTextColor(0, 0, 0);
                $pdf->Cell(10,8,utf8_decode('ÃTEM'),1,0,'C');
                $pdf->Cell(78,8,utf8_decode('DESCRIPCIÃN'),1,0,'C');
                $pdf->Cell(18,4,utf8_decode('TIEMPO'),'LRT',1,'C');
                $get_x2=$pdf->GetX();
                $get_y2=$pdf->GetY();
                $pdf->SetXY($get_x2+73,$get_y2);
                $pdf->Cell(18,4,utf8_decode('ENTREGA'),'LRB',0,'C');
                $pdf->SetXY($get_x2+91,$get_y2-4);
                $pdf->Cell(18,8,utf8_decode('CANTIDAD'),1,0,'C');
                $pdf->Cell(28,4,utf8_decode('PRECIO'),'LRT',1,'C');
                $get_x=$pdf->GetX();
                $get_y=$pdf->GetY();
                $pdf->SetXY($get_x+109,$get_y);
                $pdf->Cell(28,4,utf8_decode('UNITARIO'),'LRB',0,'C');
                $pdf->SetXY($get_x+137,$get_y-4);
                $pdf->Cell(28,8,utf8_decode('TOTAL'),1,0,'C');
                $pdf->Ln();
                $y = $height_products+8;
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(85, 175, 84);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(10, 78, 18, 18, 28, 28, 28));
                $sub_total=0;
                $descuento=0;
                $iva=0;
                $total_fact=0;
                $suma_sub_total=0;
                $suma_descuento=0;
                $suma_iva=0;
                $suma_total_fact=0;
                $item=0;
                foreach ($datos as $detail) {
                    $item++;
                    $data = array(
                        utf8_decode($item."Centrado"),
                        utf8_decode($detail->nombre),
                        utf8_decode($detail->tiempo_entrega."Centrado"),
                        utf8_decode($detail->cantidad."Centrado"),
                        utf8_decode("$ ".$detail->precio."Derecha"),
                        utf8_decode("$ ".$detail->total_pro."Derecha"),
                        //utf8_decode('INMEDIATA'),
                        
                    );
                        $sub_total=$detail->subtotal;
                        $descuento=$detail->descuento;
                        $iva=$detail->iva;
                        $total_fact=$detail->total;
                        //array_unshift($data, utf8_decode('* sin imagen'));
                    //dd("Imagen:".$imagen.$detail->imagen);
                    $pdf->RowProductoBussinesProf($data, $margin);
                }
                $suma_sub_total=number_format($sub_total,2,".",",");
                $suma_descuento=number_format($descuento,2,".",",");
                $suma_iva=number_format($iva,2,".",",");
                $suma_total_fact=number_format($total_fact,2,".",",");
                $pdf->SetXY(135, $pdf->GetY());
                $pdf->SetX(139);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(28, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                $pdf->SetFont('Helvetica', '', 8);
                //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                $pdf->Cell(28, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                // $pdf->SetX(135);
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(28, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                // $pdf->SetFont('Helvetica', '', 8);
                // //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                // $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                $pdf->SetX(139);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(28, 7, utf8_decode('12% IVA'), 1, 0, 'C', 0);
                $pdf->SetFont('Helvetica', '', 8);
                //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                $pdf->Cell(28, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                $pdf->SetX(139);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(28, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(28, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                $pdf->Ln(15);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('ObservaciÃ³n: '.$factura_info->observacion), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('Fecha Validez: '.strftime("%d de %B del %Y", strtotime($factura_info->fecha_expiracion))), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('Forma Pago: '.$factura_info->forma_pago), 0, 1, 'L', 0);
                $pdf->Ln(5);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('Atentamente,'), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->Cell(190, 5,utf8_decode($datos[0]->vendedor.'.'), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->Cell(190, 5,utf8_decode($datos[0]->nombre_empresa.'.'), 0, 1, 'L', 0);
                $pdf->SetXY(15,-25);
                $pdf->Cell(170, 5,utf8_decode('DirecciÃ³n: ').utf8_decode($datos[0]->direccion_empresa).' Telf.: '.$datos[0]->telefono, 0, 1, 'R', 0);
                $pdf->SetX(15);
                $pdf->Cell(170, 5,utf8_decode($datos[0]->mailvendedor).' - '.utf8_decode($factura_info->urlweb), 0, 1, 'R', 0);
                $pdf->SetX(15);
                $pdf->Cell(170, 5,ucwords(strtolower($datos[0]->ciudad)).' - Ecuador', 0, 1, 'R', 0);
                $width = $pdf->GetPageWidth();
                $current_date = date("Y-m-d");
                if (!$generar_en_servidor) {
                    return $pdf->Output(isset($datos[0]->identificacion) ? "proforma-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                } else if ($generar_en_servidor && !is_null($ruta)) {
                    if (file_exists($ruta)) {
                        $name = $id . '.pdf';
                        $location = $ruta . "/" . $name;
                        $pdf->Output("F", $location);
                        return json_encode(
                            array(
                                "location" => $location,
                                "name" => $name)
                        );
                    } else {
                        throw new Exception("No se pudo generar la proforma");
                    }

                } else if ($generar_en_servidor && is_null($ruta)) {
                    throw new Exception("La ruta para la proforma no es valida.");
                }
            }
        }
        
    }
    public function orden_compraPDF($id,$datos, $id_proforma, $factura_info, $generar_en_servidor = false, $ruta = null)
    {
        setlocale(LC_TIME, "spanish");
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        //dd($factura_info->id_empresa);

        if(preg_match('/grupo solis/i', $datos[0]->nombre_empresa)){
            //if($factura_info->id_empresa==34){
            $pdf->AliasNbPages();
            $pdf->AddPage();
            $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
            $pdf->SetAutoPageBreak(1, 4);
            $width = $pdf->GetPageWidth();
            if ($datos[0]->logo!==null && file_exists($logo)) {
                if($factura_info->id_empresa==1){
                    
                $pdf->Image($logo, 5, 10, 55, 20);
                //$pdf->Image($logo, 5, 10, 25, 20);
                
                }else{
                    
                $pdf->Image($logo, 5, 6, 50, 35);
                
                }
                
            } else {
                $pdf->SetX(10);
                $pdf->SetTextColor(255, 0, 0);
                $pdf->SetFont('Arial', 'B', 10);
                $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 0, 'C', 0);
                $pdf->SetTextColor(255, 255, 255);
            }
            if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
            //if ($factura_info->id_empresa==1) {
                /*$pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 31, 13, 30, 25);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 30, 5, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 65, 9, 20, 20);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 90, 17, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/armadura.jpg', 90, 6, 28, 13);*/
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/blacklinesafe.jpg', 130, 6, 28, 13);
            }
            //dd($datos[0]);
            $y_img=40;
            $pdf->SetXY(5, 35);
            /*$pdf->SetTextColor(48,132,70);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 0, 'L', 0);*/
            $y_cot="";
            if($factura_info->id_empresa==1){
                $y_cot=35;
            }else{
                $y_cot=15;
            }
            $pdf->SetXY($width-40,$y_cot);
            //$pdf->SetXY($width-40,$y_cot-20);
            $pdf->SetTextColor(48,132,70);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->Cell(25, 10, utf8_decode('ORDEN COMPRA'), 0, 1, 'L', 0);
    
            $pdf->SetXY($width-60,$y_cot+10);
            //$pdf->SetXY($width-60,$y_cot-10);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(25, 5, utf8_decode('FECHA'), 0, 0, 'L', 0);
            $fecha_emision="";
            $fecha_emision=date("d/m/Y", strtotime($datos[0]->fecha_emision));
            $pdf->Cell(25, 5, isset($datos[0]->fecha_emision) ? utf8_decode($fecha_emision) : 'fecha_emision', 1,1, 'C', 0);
            $pdf->SetXY($width-60,$y_cot+15);
            //$pdf->SetXY($width-60,$y_cot-5);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(25, 5, utf8_decode('ORDEN COMPRA'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode($id_proforma), 1, 1, 'C', 0);
            $pdf->SetXY($width-60,$y_cot+20);
            //$pdf->SetXY($width-60,$y_cot);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(25, 5, utf8_decode('RUC'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode($datos[0]->ruc_empresa), 1, 1, 'C', 0);
            $pdf->SetXY($width-60,$y_cot+25);
            //$pdf->SetXY($width-60,$y_cot+5);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $fecha_validez=date("d/m/Y", strtotime($factura_info->fecha_expiracion));;
            $pdf->Cell(25, 5, utf8_decode('VALIDO HASTA'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode($fecha_validez), 1, 1, 'C', 0);
            $pdf->SetXY(5,$y_img+5);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Direccion:'), 0, 0, 'L', 0);
            $pdf->Cell(65, 5, utf8_decode($datos[0]->direccion_empresa), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+10);
            $pdf->SetTextColor(0,0,0);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
            $pdf->Cell(65, 5,utf8_decode($datos[0]->ciudad), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+15);
            $pdf->SetTextColor(0,0,0);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Sitio Web:'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode(/*"                ".*/$factura_info->urlweb), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+20);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('TelÃ©fono:'), 0, 0, 'L', 0);
            $pdf->Cell(20, 5, utf8_decode(/*"                (593)".*/"(593)".$factura_info->telefono), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+25);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Asesor de venta:'), 0, 0, 'L', 0);
            $pdf->Cell(75, 5, isset($datos[0]->vendedor) ? utf8_decode(/*"    ".*/$datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
            $pdf->SetXY(5,$y_img+30);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('TelÃ©fono Vendedor:'), 0, 0, 'L', 0);
            if($datos[0]->telefono_vendedor){
                $pdf->Cell(25, 5, "(593)".$datos[0]->telefono_vendedor, 0, 0, 'L', 0);
            }else{
                $pdf->Cell(25, 5, $datos[0]->telefono_vendedor, 0, 0, 'L', 0);
            }
            
            $pdf->SetXY(5,$y_img+35);
            $pdf->SetFillColor(156,156,156);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->SetDrawColor(100, 0, 0);
            $pdf->SetFont('Arial', '', 7);
            $pdf->Cell(95, 5, utf8_decode('Proveedor'), 0, 1, 'L', 1);
            $pdf->SetXY(5,$y_img+40);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(75, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"CI/RUC:                   ".utf8_decode($datos[0]->identificacion), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"Email:                       ".utf8_decode($datos[0]->email), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"Ciudad:                     ".utf8_decode($datos[0]->ciudad), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"Direccion:                 ".utf8_decode($datos[0]->direccion), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,utf8_decode("TelÃ©fono:                  ").utf8_decode($datos[0]->telefono), 0, 2, 'L', 0);
            
            //$pdf->Cell(155, 8, 'Proyecto: '.ucfirst($proyecto), 0, 1, 'C', 0);
            //$pdf->SetXY(165, 10);
            // HEADER
        
    
            // INFORMATION HEADER
            $margin = 5;
            $height = $pdf->GetY();
            $cli_atencion = '';
        
            $pdf->SetFont('Helvetica', 'B', 8);
            $pdf->Cell(20, 5, utf8_decode('APRECIADO PROVEEDOR:'), 0, 2, 'L', 0);
            $pdf->SetFont('Helvetica', '', 8);
            $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
            $pdf->SetFillColor(85, 175, 84);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->SetDrawColor(0, 0, 0);
            if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                // SLOGAN
                $pdf->SetXY($margin, $height + 15);
                $pdf->SetFont('Helvetica', 'B', 10);
                $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                $height_products = $height + 25;
            } else {
                $height_products = $height + 15;
            }
            //cabecera de detalles de productos
            $pdf->SetFont('Helvetica', 'B', 6);
            if($factura_info->id_empresa==1){
                $pdf->SetFillColor(141, 207, 140);
            }else{
                $pdf->SetFillColor(141, 207, 240);
            }
            $exist_cps=0;
            // foreach ($datos as $detail) {
            //     if($detail->cpc){
            //         $exist_cps++;
            //     }
            // }
            //dd("X=".$margin."Y=".$height_products);
            $pdf->SetTextColor(0, 0, 0);
            if($exist_cps>0){
                $pdf->SetXY($margin, $height_products);
                $pdf->MultiCell(10, 8, utf8_decode('CPC'), 1, 'C', 1);
                $pdf->SetXY($margin+10, $height_products);
                $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                $pdf->SetXY(30+10, $height_products);
                $pdf->MultiCell(16, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                $pdf->SetXY(47+9, $height_products);
                $pdf->MultiCell(24, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                $pdf->SetXY(72+8, $height_products);
                $pdf->MultiCell(17, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                $pdf->SetXY(92+5, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('USO'), 1, 'C', 1);
                $pdf->SetXY(108+1, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                $pdf->SetXY(120+1, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                $pdf->SetXY(132+1, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                $pdf->SetXY(144+1, $height_products);
                $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                $pdf->SetXY(158+1, $height_products);
                $pdf->MultiCell(15, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                $pdf->SetXY(173+1, $height_products);
                $pdf->MultiCell(17, 4, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                //$pdf->SetXY(190+1, $height_products);
                //$pdf->MultiCell(14, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                //dd("X=".$margin."Y=".$height_products);
                $y = $height_products + 8;
                $pdf->SetFont('Helvetica', '', 4);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(85, 175, 84);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(10,25, 16, 24, 17, 12, 12, 12, 12, 14, 15, 17));
            }else{
                $pdf->SetXY($margin, $height_products);
                $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                $pdf->SetXY(30, $height_products);
                $pdf->MultiCell(114, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                //$pdf->SetXY(47, $height_products);
                // $pdf->MultiCell(30, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                // $pdf->SetXY(77, $height_products);
                // $pdf->MultiCell(25, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                // $pdf->SetXY(102, $height_products);
                // $pdf->MultiCell(21, 8, utf8_decode('USO'), 1, 'C', 1);
                // $pdf->SetXY(123, $height_products);
                // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                // $pdf->SetXY(135, $height_products);
                // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                // $pdf->SetXY(147, $height_products);
                // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                $pdf->SetXY(144, $height_products);
                $pdf->MultiCell(19, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                $pdf->SetXY(163, $height_products);
                $pdf->MultiCell(20, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                $pdf->SetXY(183, $height_products);
                $pdf->MultiCell(22, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                // $pdf->SetXY(190, $height_products);
                // $pdf->MultiCell(15, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                //dd("X=".$margin."Y=".$height_products);
                $y = $height_products + 8;
                $pdf->SetFont('Helvetica', '', 4);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(85, 175, 84);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(25, 114, 19, 20, 22));
            }
            
            //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
            $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
            //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
            $sub_total=0;
            $descuento=0;
            $iva=0;
            $total_fact=0;
            $suma_sub_total=0;
            $suma_descuento=0;
            $suma_iva=0;
            $suma_total_fact=0;
            foreach ($datos as $detail) {
                $caract=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->caracteristicas);
                $norm=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->normativa);
                $uso=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->uso);
                $data = array(
                    utf8_decode(trim($detail->nombre)."Centrado"),
                    // utf8_decode($caract."Centrado"),
                    // utf8_decode($norm."Centrado"),
                    // utf8_decode($uso."Centrado"),
                    // utf8_decode(trim($detail->marca)."Centrado"),
                    
                    // utf8_decode(trim($detail->unidad_medida)."Centrado"),
                    // utf8_decode(trim($detail->tipo_medida)."Centrado"),
                    utf8_decode($detail->cantidad."Centrado"),
                    utf8_decode("$ ".$detail->precio."Derecha"),
                    utf8_decode("$ ".$detail->total_pro."Derecha"),
                    //$detail->tiempo_entrega!==null ? utf8_decode($detail->tiempo_entrega."Centrado") : utf8_decode('INMEDIATA'),
                        
                 );
                
                
                    $sub_total=$detail->subtotal;
                    $descuento=$detail->descuento;
                    $iva=$detail->iva;
                    $total_fact=$detail->total;
                if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                //if ($detail->imagen) {
                    //dd($pdf->GetY());
                    if($exist_cps>0){ 
                        
                            array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX()+10, $pdf->GetY(), 25, 25));
                        
                        
                    }else{
                        
                            array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                        
                    }
                    
                } else {
                    array_unshift($data, utf8_decode('* sin imagen'."Centrado"));
                }
                if($exist_cps>0){
                    array_unshift($data, utf8_decode($detail->cpc."Centrado"));
                }
                //dd("Imagen:".$imagen.$detail->imagen);
                $pdf->RowOrdenGrpoSolis($data, $margin+5);
                $head_table=$pdf->GetY();
            }
            
            $suma_sub_total=number_format($sub_total,2,".",",");
            $suma_descuento=number_format($descuento,2,".",",");
            $suma_iva=number_format($iva,2,".",",");
            $suma_total_fact=number_format($total_fact,2,".",",");
            if($exist_cps>0){
                $pdf->SetXY(133, $pdf->GetY());
                $pdf->SetX(133);
            }else{
                $pdf->SetXY(144, $pdf->GetY());
                $pdf->SetX(144);
            }
            
            $pdf->SetFont('Helvetica', 'B', 8);
            if($exist_cps>0){
                $pdf->Cell(39, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
            }else{
                $pdf->Cell(39, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
            }
            
            $pdf->SetFont('Helvetica', '', 8);
            //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
            $pdf->Cell(22, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
            
            if($exist_cps>0){
                $pdf->SetX(133);
            }else{
                $pdf->SetX(144);
            }
            $pdf->SetFont('Helvetica', 'B', 8);
            
            if($exist_cps>0){
                $pdf->Cell(39, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
            }else{
                $pdf->Cell(39, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
            }
            $pdf->SetFont('Helvetica', '', 8);
            //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
            $pdf->Cell(22, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
            $pdf->SetX(136);
            if($exist_cps>0){
                $pdf->SetX(133);
            }else{
                $pdf->SetX(144);
            }
            $pdf->SetFont('Helvetica', 'B', 8);
            
            if($exist_cps>0){
                $pdf->Cell(39, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
            }else{
                $pdf->Cell(39, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
            }
            $pdf->SetFont('Helvetica', '', 8);
            //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
            $pdf->Cell(22, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
            if($exist_cps>0){
                $pdf->SetX(133);
            }else{
                $pdf->SetX(144);
            }
            /*if($factura_info->id_empresa==1){
                $pdf->SetFillColor(189,236,182);
            }else{
                $pdf->SetFillColor(93,155,155);
            }*/
            $pdf->SetFillColor(156,156,156);
            $pdf->SetFont('Helvetica', 'B', 8);
            
            if($exist_cps>0){
                $pdf->Cell(39, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
            }else{
                $pdf->Cell(39, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
            }
            $pdf->SetFont('Helvetica', '', 8);
            $pdf->Cell(22, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 1);
            $pdf->Ln();
            $pdf->SetXY(5, $head_table+5);
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->Cell(27, 5,'Observaciones:', 0, 0, 'L', 0);
            $pdf->SetFont('Helvetica', '', 7);
            $pdf->MultiCell(115, 5,utf8_decode($factura_info->observacion), 0, 'L');
            $pdf->SetXY(5, $pdf->GetY());
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->Cell(27, 5,'Fecha Emision:', 0, 0, 'L', 0);
            $pdf->SetFont('Helvetica', '', 7);
            $pdf->MultiCell(115, 5,date("d/m/Y", strtotime($datos[0]->fecha_emision)), 0, 'L');
            $pdf->SetXY(5, $pdf->GetY());
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->Cell(27, 5,'Fecha Expiracion:', 0, 0, 'L', 0);
            $pdf->SetFont('Helvetica', '', 7);
            $pdf->MultiCell(115, 5,date("d/m/Y", strtotime($factura_info->fecha_expiracion)), 0, 'L');
            $pdf->SetXY(5, $pdf->GetY());
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->Cell(27, 5,'Forma de Pago:', 0, 0, 'L', 0);
            $pdf->SetFont('Helvetica', '', 7);
            $pdf->MultiCell(115, 5,utf8_decode($factura_info->forma_pago), 0, 'L');
            $pdf->Ln(1);
            //$head_cp_ad=$pdf->GetY();
            // $pdf->SetX(5);
            // $pdf->SetFont('Helvetica', 'B', 7);
            // $pdf->Cell(27, 5,'Lugar de Entrega:', 0, 0, 'L', 0);
            // $pdf->SetFont('Helvetica', '', 7);
            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->lugar_de_entrega), 0, 'L');
            // $pdf->SetX(5);
            // $pdf->SetFont('Helvetica', 'B', 7);
            // $pdf->Cell(27, 5,'Condiciones de pago:', 0, 0, 'L', 0);
            // $pdf->SetFont('Helvetica', '', 7);
            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->condiciones_de_pago), 0, 'L');
            $head_cp_ad=$pdf->GetY();
            $pdf->SetXY(5, $head_cp_ad+5);
            $pdf->SetFillColor(141, 207, 140);
            if($factura_info->id_empresa==1){
                $pdf->SetFillColor(141, 207, 140);
            }else{
                $pdf->SetFillColor(141, 207, 240);
            }
            // $pdf->Cell(125, 5,'Terminos y condiciones', 1, 2, 'C', 1);
            // $pdf->Cell(125, 5, utf8_decode('1.Al cliente se le cobrarÃ¡ despuÃ©s de aceptada esta cotizaciÃ³n'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('2.El pago serÃ¡ debitado antes de la entrega de bienes y servicios'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('3.Por favor enviar la cotizaciÃ³n firmada al email indicado anteriormente.'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('La aceptaciÃ³n del cliente (firmar a continuaciÃ³n):'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('x_____________________________________________________'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'Nombre cliente', 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, '', 'LRB', 2, 'L', 0);
            $pdf->Ln(7);
    
            $pdf->Cell(190, 5, utf8_decode('Si usted tiene alguna pregunta sobre  esta Orden de Compra, por favor, pÃ³ngase en contacto con nosotros'), 0, 2, 'C', 0);
            $pdf->Cell(190, 5, $factura_info->telefono." , ".$datos[0]->mailvendedor, 0, 2, 'C', 0);
            $current_date = date("Y-m-d");
            //dd($ruta);
            if (!$generar_en_servidor) {
                return $pdf->Output(isset($datos[0]->identificacion) ? "orden_compra-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
            } else if ($generar_en_servidor && !is_null($ruta)) {
                if (file_exists($ruta)) {
                    $name = $id . '.pdf';
                    $location = $ruta . "/" . $name;
                    $pdf->Output("F", $location);
                    return json_encode(
                        array(
                            "location" => $location,
                            "name" => $name)
                    );
                } else {
                    throw new Exception("No se pudo generar la proforma");
                }

            } else if ($generar_en_servidor && is_null($ruta)) {
                throw new Exception("La ruta para la proforma no es valida.");
            } 
        }else{
            //if($factura_info->id_empresa!==32){
            if($datos[0]->nombre_empresa!=='BUSINESS COMPANY INSU-MED'){
                //if($factura_info->id_empresa==51){
                if($datos[0]->nombre_empresa=='MASRESOURCES S.A.'){
                    //if($factura_info->id_empresa==1){
                    $pdf->AliasNbPages();
                    $pdf->AddPage();
                    $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                    $pdf->SetAutoPageBreak(1, 4);
                    $width = $pdf->GetPageWidth();
                    // HEADER
                    if ($datos[0]->logo!==null && file_exists($logo)) {
                        // if($factura_info->id_empresa==1){
                        //     //$pdf->Image($logo, 10, 10, 55, 20);
                        //     $pdf->Image($logo, 10, 6, 60, 25);
                        // }else{
                        //     $pdf->Image($logo, 10, 6, 50, 35);
                        // }
                        $pdf->Image($logo, 10, 6, 70, 25);
                    } else {
                        $pdf->SetTextColor(255, 0, 0);
                        $pdf->SetFont('Arial', 'B', 020);
                        $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                        //$pdf->SetTextColor(0, 0, 0);
                    }
                    // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/3m.png', 134, 7, 20, 10);
                    // }
                    $pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', 'B', 14);
                    $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth("ORDEN COMPRA NÂ°. " . $id_proforma) / 2), 33);
                    $pdf->Cell($pdf->GetStringWidth("ORDEN COMPRA NÂ°. " . $id_proforma), 8, utf8_decode("ORDEN COMPRA NÂ°. " . $id_proforma), 0, 2, 'C', 0);
                    $pdf->SetXY((($width / 4) * 3)+10, 10);
                    $pdf->SetFont('Arial', 'B', 8);
                    $pdf->Cell(($width / 4) - 10, 6, isset($datos[0]->ruc_empresa) ? utf8_decode('RUC: ' . $datos[0]->ruc_empresa) : '*************', 0, 2, 'C', 0);
                    $pdf->Cell(($width / 4) - 10, 6, isset($factura_info->telefono) ? utf8_decode('TELÃFONO: ' . $factura_info->telefono) : '*************', 0, 2, 'C', 0);
                    $pdf->MultiCell(($width / 4) - 10, 6, isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : 'Sin direccion', 0, 'C', 0);
                    $pdf->Ln();

                    // INFORMATION HEADER
                    $margin = 5;
                    $height = $pdf->GetY();
                    $cli_atencion = '';
                    // if($factura_info->id_empresa==1){
                    //     //$pdf->SetDrawColor(85, 175, 84);
                    //     //$pdf->SetDrawColor(85, 175, 84);
                    //     $pdf->SetDrawColor(122, 198, 58);
                    // }else{
                    //     //$pdf->SetDrawColor(85, 175, 204);
                    //     $pdf->SetDrawColor(85, 175, 204);
                    // }
                    //$pdf->SetDrawColor(85, 175, 204);
                    $pdf->SetDrawColor(154, 205, 50);
                    $pdf->RoundedRect($margin, $height + 10, $width - 14, 25, 2, '1234', 'D');
                    $pdf->SetXY($margin, $height + 12.5);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell($width / 4, 5, utf8_decode('RUC:'), 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, utf8_decode('PROVEEDOR:'), 0, 2, 'L', 0);
                    $head_cliente=$pdf->GetY();
                    // if($pdf->GetStringWidth('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.')>76){
                    //     $pdf->SetXY($margin, 71.5);
                    //     $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                    //     $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    // }else{
                    //     $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                    //     $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    // }
                    if($pdf->GetStringWidth($datos[0]->cliente)>76){
                        $pdf->SetXY($margin, $head_cliente+1);
                        $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    }else{
                        $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    }
                    
                    $pdf->SetXY($width / 2, $height + 12.5);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell($width / 4, 5, utf8_decode('FECHA:'), 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, utf8_decode('CIUDAD:'), 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, utf8_decode('DIRECCIÃN:'), 0, 2, 'L', 0);
                    //$pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                    if($pdf->GetStringWidth($datos[0]->direccion)>66){
                        $pdf->SetXY($width / 2,74);
                        $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                    }else{
                        $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                    }
                    

                    $pdf->SetXY(($width / 6) - $margin, $height + 12.5);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell($width / 4, 5, isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : 'identificacion', 0, 2, 'L', 0);
                    // if($pdf->GetStringWidth('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.')>76){
                    //     $pdf->MultiCell(73, 3, isset($datos[0]->cliente) ? 'AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.' : 'cliente', 1,'L');
                    //     $head_cli=$pdf->GetY();
                    // }else{
                    //     $pdf->Cell(76, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 1, 2, 'L', 0);
                    // }
                    
                    if($pdf->GetStringWidth($datos[0]->cliente)>76){
                        $pdf->MultiCell(76, 3, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0,'L', 0);
                        $head_cli=$pdf->GetY();
                    }else{
                        $pdf->Cell(76, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                    }
                    //dd($head_cli);
                    //
                    // if($pdf->GetStringWidth('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.')>76){
                    //     $pdf->SetXY(($width / 6) - $margin, $head_cli);
                    // }else{
                    //     $pdf->SetX(($width / 6) - $margin);
                    // }
                    if($pdf->GetStringWidth($datos[0]->cliente)>76){
                        $pdf->SetXY(($width / 6) - $margin,$head_cli);
                    }else{
                        $pdf->SetX(($width / 6) - $margin);
                    }
                    
                    $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                    if($pdf->GetStringWidth($datos[0]->email)>76){
                        $pdf->MultiCell(76, 3, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0,'L', 0);
                        $head_email=$pdf->GetY();
                    }else{
                        $pdf->Cell($width / 4, 5, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0, 2, 'L', 0);
                    }
                    

                    $pdf->SetXY(($width / 6 * 4) - $margin, $height + 12.5);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell($width / 4, 5, isset($datos[0]->fecha_emision) ? utf8_decode($datos[0]->fecha_emision) : 'fecha_emision', 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, isset($datos[0]->ciudad) ? utf8_decode($datos[0]->ciudad) : 'ciudad', 0, 2, 'L', 0);
                    //$pdf->Cell(66, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 1, 2, 'L', 0);
                    if($pdf->GetStringWidth($datos[0]->direccion)>66){
                        $pdf->MultiCell(66, 3, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0,'L', 0);
                        $head_direcc=$pdf->GetY();
                    }else{
                        $pdf->Cell($width / 4, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                    }
                    
                    
                    //dd($head_direcc);
                    if($pdf->GetStringWidth($datos[0]->direccion)>66){
                        $pdf->SetXY(($width / 6 * 4) - $margin, $head_direcc);
                    }
                    // else{
                    //     $pdf->SetXY(($width / 6 * 4) - $margin, $head_direcc+2);
                    // }
                    
                    $pdf->Cell($width / 4, 5, isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : 'telefono', 0, 2, 'L', 0);
                    $pdf->Ln();
                    //dd($width / 4);
                    // MESSAGE
                    $pdf->SetXY($margin, $height + 40);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(20, 5, utf8_decode('APRECIADO PROVEEDOR:'), 0, 2, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                    $pdf->SetFillColor(85, 175, 84);
                    $pdf->SetTextColor(0, 0, 255);
                    $pdf->SetDrawColor(0, 0, 0);
                    if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                        // SLOGAN
                        $pdf->SetXY($margin, $height + 55);
                        $pdf->SetFont('Helvetica', 'B', 10);
                        $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                        $height_products = $height + 65;
                    } else {
                        $height_products = $height + 55;
                    }
                    //cabecera de detalles de productos
                    $pdf->SetFont('Helvetica', 'B', 6);
                    // if($factura_info->id_empresa==1){
                    //     $pdf->SetFillColor(141, 207, 140);
                    // }else{
                    //     $pdf->SetFillColor(141, 207, 240);
                    // }
                    //dd("X=".$margin."Y=".$height_products);
                    $pdf->SetFillColor(154, 205, 50);
                    $pdf->SetTextColor(0, 0, 0);
                    $pdf->SetXY($margin, $height_products);
                    $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                    $pdf->SetXY(30, $height_products);
                    $pdf->MultiCell(58, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                    $pdf->SetXY(88, $height_products);
                    $pdf->MultiCell(59, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                    // $pdf->SetXY(75, $height_products);
                    // $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                    // $pdf->SetXY(95, $height_products);
                    // $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                    // $pdf->SetXY(111, $height_products);
                    // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                    // $pdf->SetXY(123, $height_products);
                    // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                    // $pdf->SetXY(135, $height_products);
                    // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                    $pdf->SetXY(147, $height_products);
                    $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                    $pdf->SetXY(161, $height_products);
                    $pdf->MultiCell(20, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                    $pdf->SetXY(181, $height_products);
                    $pdf->MultiCell(20, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                    // $pdf->SetXY(177, $height_products);
                    // $pdf->MultiCell(24, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                    //dd("X=".$margin."Y=".$height_products);
                    $y = $height_products + 8;
                    $pdf->SetFont('Helvetica', '', 4);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetFillColor(85, 175, 84);
                    $pdf->SetXY($margin, $height_products+8);
                    $pdf->SetWidths(array(25, 58, 59, 14, 20, 20));
                    //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                    $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                    //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                    $sub_total=0;
                    $descuento=0;
                    $iva=0;
                    $total_fact=0;
                    $suma_sub_total=0;
                    $suma_descuento=0;
                    $suma_iva=0;
                    $suma_total_fact=0;
                    foreach ($datos as $detail) {
                        $descrip=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);
                        $data = array(
                            utf8_decode($detail->nombre),
                            utf8_decode($descrip),
                            // utf8_decode($detail->normativa),
                            // utf8_decode($detail->uso),
                            // utf8_decode($detail->marca."Centrado"),
                            // utf8_decode($detail->tipo_medida."Centrado"),
                            utf8_decode($detail->cantidad."Centrado"),
                            utf8_decode($detail->precio."Centrado"),
                            utf8_decode($detail->total_pro."Derecha"),
                            //utf8_decode($detail->tiempo_entrega."Centrado"),
                            //utf8_decode('INMEDIATA'),
                            
                        );
                            $sub_total=$detail->subtotal;
                            $descuento=$detail->descuento;
                            $iva=$detail->iva;
                            $total_fact=$detail->total;
                        if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                        //if ($detail->imagen) {
                            array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                        } else {
                            array_unshift($data, utf8_decode('* sin imagen'));
                        }
                        //dd("Imagen:".$imagen.$detail->imagen);
                        $pdf->RowDataCompanyMs($data, $margin+5);
                    }
                    
                    $suma_sub_total=number_format($sub_total,2,".",",");
                    $suma_descuento=number_format($descuento,2,".",",");
                    $suma_iva=number_format($iva,2,".",",");
                    $suma_total_fact=number_format($total_fact,2,".",",");
                    $pdf->SetXY(147, $pdf->GetY());
                    $pdf->SetX(147);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                    $pdf->Cell(20, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                    $pdf->SetX(147);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                    $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                    $pdf->SetX(147);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                    $pdf->Cell(20, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                    $pdf->SetX(147);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(20, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                    $pdf->Ln();
                    
                    // if($factura_info->id_empresa==1){
                    //     $pdf->SetDrawColor(85, 175, 84);
                    // }else{
                    //     $pdf->SetDrawColor(141, 207, 240);
                    // }
                    $pdf->SetDrawColor(154, 205, 50);
                    $pdf->SetX(5);
                    $pdf->SetFont('Helvetica', 'BU', 9);
                    $pdf->Cell(200, 6, utf8_decode('CONDICIONES COMERCIALES'), 'T', 1, 'L', 0);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->SetX(5);
                    // $pdf->Cell(50, 6, utf8_decode('LUGAR DE ENTREGA:'), 0, 0, 'L', 0);
                    // $pdf->SetFont('Helvetica', '', 8);
                    // $pdf->Cell(150, 6, utf8_decode($factura_info->lugar_de_entrega), 0, 1, 'L', 0);
                    // $pdf->SetFont('Helvetica', 'B', 8);
                    // $pdf->SetX(5);
                    // $pdf->Cell(50, 6, utf8_decode('CONDICIOINES DE PAGO:'), 0, 0, 'L', 0);
                    // $pdf->SetFont('Helvetica', '', 8);
                    // $pdf->Cell(150, 6, utf8_decode($factura_info->condiciones_de_pago), 0, 1, 'L', 0);
                    // $pdf->SetFont('Helvetica', 'B', 8);
                    // $pdf->SetX(5);
                    $pdf->Cell(50, 6, utf8_decode('OBSERVACIONES:'), 0, 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->MultiCell(146, 6, utf8_decode($factura_info->observacion), 0,'L');
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->SetX(5);
                    $pdf->Cell(50, 6, utf8_decode('VALIDEZ DE LA OFERTA:'), 'B', 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(150, 6, utf8_decode($factura_info->fecha_expiracion), 'B', 1, 'L', 0);
                    $pdf->Ln();

                    $pdf->SetX(5);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(25, 6, utf8_decode('Elaborado por:'), 0, 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(75, 6, isset($datos[0]->vendedor) ? utf8_decode($datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                    $pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Helvetica', '', 9);
                    if(isset($factura_info->urlweb) && $factura_info->urlweb!=='null'){
                        $pdf->Cell(100, 6, utf8_decode('Le invitamos a revisar nuestra pÃ¡gina web.'), 0, 1, 'R', 0);
                    }else{
                        $pdf->Cell(100, 6, '', 0, 1, 'R', 0);
                    }
                    
                    
                        $pdf->SetTextColor(0, 0, 255);
                
                    
                    $pdf->SetX(30);
                    $pdf->SetFont('Helvetica', 'U', 8);
                    $url="";
                    
                    $pdf->Cell(120, 6, isset($datos[0]->mailvendedor)  ? utf8_decode($datos[0]->mailvendedor) : '', 0, 0, 'L', 0);
                    // if($factura_info->id_empresa==1){
                    //     $pdf->SetTextColor(4, 255, 0);
                    // }else{
                    //     $pdf->SetTextColor(0, 0, 255);
                    // }
                    $pdf->SetTextColor(4, 255, 0);
                    $pdf->SetFont('', 'U', 9);
                    if(isset($factura_info->urlweb) && $factura_info->urlweb!=='null'){
                        $pdf->Write(6, utf8_decode($factura_info->urlweb), isset($factura_info->urlweb) && $factura_info->urlweb!=='null' ? utf8_decode($factura_info->urlweb) : '');
                    }else{
                        $pdf->Write(6, '', isset($factura_info->urlweb)  ? utf8_decode($factura_info->urlweb) : '');
                    }
                    
                    $current_date = date("Y-m-d");
                    //dd($ruta);
                    if (!$generar_en_servidor) {
                        return $pdf->Output(isset($datos[0]->identificacion) ? "orden_compra-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                    } else if ($generar_en_servidor && !is_null($ruta)) {
                        if (file_exists($ruta)) {
                            $name = $id . '.pdf';
                            $location = $ruta . "/" . $name;
                            $pdf->Output("F", $location);
                            return json_encode(
                                array(
                                    "location" => $location,
                                    "name" => $name)
                            );
                        } else {
                            throw new Exception("No se pudo generar la proforma");
                        }

                    } else if ($generar_en_servidor && is_null($ruta)) {
                        throw new Exception("La ruta para la proforma no es valida.");
                    }
                }else{
                    if($datos[0]->nombre_empresa=='ELECTTEL'){
                        //if($factura_info->id_empresa==1){
                        $pdf->AliasNbPages();
                        $pdf->AddPage();
                        $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                        $pdf->SetAutoPageBreak(1, 4);
                        $width = $pdf->GetPageWidth();
                        // HEADER
                        if ($datos[0]->logo!==null && file_exists($logo)) {
                            
                                $pdf->Image($logo, 10, 6, 55, 35);
                            
                            
                        } else {
                            $pdf->SetTextColor(255, 0, 0);
                            $pdf->SetFont('Arial', 'B', 020);
                            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                        }
                        // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/3m.png', 134, 7, 20, 10);
                        // }
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Arial', 'B', 14);
                        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth("ORDEN COMPRA NÂ°. " . $id_proforma) / 2), 33);
                        $pdf->Cell($pdf->GetStringWidth("ORDEN COMPRA NÂ°. " . $id_proforma), 8, utf8_decode("ORDEN COMPRA NÂ°. " . $id_proforma), 0, 2, 'C', 0);
                        $pdf->SetXY((($width / 4) * 3)+10, 10);
                        $pdf->SetFont('Arial', 'B', 8);
                        $pdf->Cell(($width / 4) - 10, 6, isset($datos[0]->ruc_empresa) ? utf8_decode('RUC: ' . $datos[0]->ruc_empresa) : '*************', 0, 2, 'C', 0);
                        $pdf->MultiCell(($width / 4) - 10, 6, isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : 'Sin direccion', 0, 'C', 0);
                        $pdf->Ln();

                        // INFORMATION HEADER
                        $margin = 5;
                        $height = $pdf->GetY();
                        $cli_atencion = '';
                        // if($factura_info->id_empresa==1){
                        //     //$pdf->SetDrawColor(85, 175, 84);
                        //     $pdf->SetDrawColor(85, 175, 84);
                        // }else{
                        //     //$pdf->SetDrawColor(85, 175, 204);
                        //     $pdf->SetDrawColor(85, 175, 204);
                        // }
                        $pdf->SetDrawColor(85, 175, 204);
                        //$pdf->SetDrawColor(85, 175, 204);
                        $pdf->RoundedRect($margin, $height + 10, $width - 14, 25, 2, '1234', 'D');
                        $pdf->SetXY($margin, $height + 12.5);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell($width / 4, 5, utf8_decode('RUC:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('PROVEEDOR:'), 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                            $pdf->SetXY($margin, $height+24);
                            $pdf->Cell($width / 4, 5, utf8_decode('ATENCIÃN:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                        }else{
                            $pdf->Cell($width / 4, 5, utf8_decode('ATENCIÃN:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                        }
                        
                        $pdf->SetXY($width / 2, $height + 12.5);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell($width / 4, 5, utf8_decode('FECHA:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('CIUDAD:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('DIRECCIÃN:'), 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                            $pdf->SetXY($width / 2, $height + 28.5);
                            $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                        }else{
                            $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                        }
                        
                        //dd($factura_info);
                        $pdf->SetXY(($width / 6) - $margin, $height + 12.5);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : 'identificacion', 0, 2, 'L', 0);
                        //$pdf->Cell($width / 4, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                            $pdf->MultiCell(76, 3, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0,'L', 0);
                            $head_cli=$pdf->GetY();
                        }else{
                            $pdf->Cell($width / 4, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                        }
                        
                        //$pdf->MultiCell(75, 5, isset($datos[0]->cliente) ? utf8_decode('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.'/*$datos[0]->cliente*/) : 'cliente', 1,'L');
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                            $pdf->SetXY(($width / 6) - $margin,$head_cli+0.5);
                        }
                        $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0, 2, 'L', 0);

                        $pdf->SetXY(($width / 6 * 4) - $margin, $height + 12.5);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->fecha_emision) ? utf8_decode($datos[0]->fecha_emision) : 'fecha_emision', 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->ciudad) ? utf8_decode($datos[0]->ciudad) : 'ciudad', 0, 2, 'L', 0);
                        //$pdf->Cell($width / 4, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                            $pdf->MultiCell(66, 3, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 'L', 0);
                            $gead_dir=$pdf->GetY();
                        }else{
                            $pdf->Cell($width / 4, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                        }
                        
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                            $pdf->SetXY(($width / 6 * 4) - $margin, $gead_dir+0.5);
                        }
                        
                        $pdf->Cell($width / 4, 5, isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : 'telefono', 0, 2, 'L', 0);
                        $pdf->Ln();

                        // MESSAGE
                        $pdf->SetXY($margin, $height + 40);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(20, 5, utf8_decode('APRECIADO PROVEEDOR:'), 0, 2, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                        $pdf->SetFillColor(85, 175, 84);
                        $pdf->SetTextColor(0, 0, 255);
                        $pdf->SetDrawColor(0, 0, 0);
                        if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                            // SLOGAN
                            $pdf->SetXY($margin, $height + 55);
                            $pdf->SetFont('Helvetica', 'B', 10);
                            $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                            $height_products = $height + 65;
                        } else {
                            $height_products = $height + 55;
                        }
                        //cabecera de detalles de productos
                        $pdf->SetFont('Helvetica', 'B', 6);
                        // if($factura_info->id_empresa==1){
                        //     $pdf->SetFillColor(141, 207, 140);
                        // }else{
                            
                        // }
                        $pdf->SetFillColor(141, 207, 240);
                        //dd("X=".$margin."Y=".$height_products);
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetXY($margin, $height_products);
                        $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                        $pdf->SetXY(30, $height_products);
                        $pdf->MultiCell(56, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                        $pdf->SetXY(86, $height_products);
                        $pdf->MultiCell(61, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                        $pdf->SetXY(147, $height_products);
                        // $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                        // $pdf->SetXY(95, $height_products);
                        // $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                        // $pdf->SetXY(111, $height_products);
                        // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                        // $pdf->SetXY(123, $height_products);
                        // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                        // $pdf->SetXY(135, $height_products);
                        // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                        // $pdf->SetXY(147, $height_products);
                        $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                        $pdf->SetXY(161, $height_products);
                        $pdf->MultiCell(20, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                        $pdf->SetXY(181, $height_products);
                        $pdf->MultiCell(20, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                        //$pdf->SetXY(190, $height_products);
                        //$pdf->MultiCell(15, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                        //dd("X=".$margin."Y=".$height_products);
                        $y = $height_products + 8;
                        $pdf->SetFont('Helvetica', '', 4);
                        $pdf->SetFillColor(255, 255, 255);
                        $pdf->SetFillColor(85, 175, 84);
                        $pdf->SetXY($margin, $height_products+8);
                        $pdf->SetWidths(array(25, 56, 61, 14, 20, 20));
                        //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                        $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                        //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                        $sub_total=0;
                        $descuento=0;
                        $iva=0;
                        $total_fact=0;
                        $suma_sub_total=0;
                        $suma_descuento=0;
                        $suma_iva=0;
                        $suma_total_fact=0;
                        foreach ($datos as $detail) {
                            $descrip=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);

                            $data = array(
                                utf8_decode($detail->nombre),
                                utf8_decode($descrip),
                                // utf8_decode($detail->normativa),
                                // utf8_decode($detail->uso),
                                // utf8_decode($detail->marca."Centrado"),
                                // utf8_decode($detail->tipo_medida."Centrado"),
                                utf8_decode($detail->cantidad."Centrado"),
                                utf8_decode($detail->precio."Centrado"),
                                utf8_decode($detail->total_pro."Derecha"),
                                //utf8_decode($detail->total_pro."Derecha"),
                                //utf8_decode('INMEDIATA'),
                                
                            );
                                $sub_total=$detail->subtotal;
                                $descuento=$detail->descuento;
                                $iva=$detail->iva;
                                $total_fact=$detail->total;
                            if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                            //if ($detail->imagen) {
                                array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                            } else {
                                array_unshift($data, utf8_decode('* sin imagen'));
                            }
                            //dd("Imagen:".$imagen.$detail->imagen);
                            $pdf->RowProductsELETE($data, $margin+5);
                        }
                        
                        $suma_sub_total=number_format($sub_total,2,".",",");
                        $suma_descuento=number_format($descuento,2,".",",");
                        $suma_iva=number_format($iva,2,".",",");
                        $suma_total_fact=number_format($total_fact,2,".",",");
                        $pdf->SetXY(135, $pdf->GetY());
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                        $pdf->Cell(20, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                        $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                        $pdf->Cell(20, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(20, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                        $pdf->Ln();
                        
                        // if($factura_info->id_empresa==1){
                        //     $pdf->SetDrawColor(85, 175, 84);
                        // }else{
                        //     $pdf->SetDrawColor(141, 207, 240);
                        // }
                        $pdf->SetDrawColor(141, 207, 240);
                        $pdf->SetX(5);
                        $pdf->SetFont('Helvetica', 'BU', 9);
                        $pdf->Cell(200, 6, utf8_decode('CONDICIONES COMERCIALES'), 'T', 1, 'L', 0);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->SetX(5);
                        // $pdf->Cell(50, 6, utf8_decode('LUGAR DE ENTREGA:'), 0, 0, 'L', 0);
                        // $pdf->SetFont('Helvetica', '', 8);
                        // $pdf->Cell(150, 6, utf8_decode($factura_info->lugar_de_entrega), 0, 1, 'L', 0);
                        // $pdf->SetFont('Helvetica', 'B', 8);
                        // $pdf->SetX(5);
                        // $pdf->Cell(50, 6, utf8_decode('CONDICIOINES DE PAGO:'), 0, 0, 'L', 0);
                        // $pdf->SetFont('Helvetica', '', 8);
                        // $pdf->Cell(150, 6, utf8_decode($factura_info->condiciones_de_pago), 0, 1, 'L', 0);
                        // $pdf->SetFont('Helvetica', 'B', 8);
                        // $pdf->SetX(5);
                        $pdf->Cell(50, 6, utf8_decode('OBSERVACIONES:'), 0, 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->MultiCell(146, 6, utf8_decode($factura_info->observacion), 0,'L');
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->SetX(5);
                        $pdf->Cell(50, 6, utf8_decode('VALIDEZ DE LA OFERTA:'), 'B', 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(150, 6, utf8_decode($factura_info->fecha_expiracion), 'B', 1, 'L', 0);
                        $pdf->Ln();

                        $pdf->SetX(5);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(25, 6, utf8_decode('Elaborado por:'), 0, 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(75, 6, isset($datos[0]->vendedor) ? utf8_decode($datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Helvetica', '', 9);
                        $pdf->Cell(100, 6, utf8_decode('Le invitamos a revisar nuestra pÃ¡gina web.'), 0, 1, 'R', 0);
                        
                        $pdf->SetTextColor(0, 0, 255);
                    
                        
                        $pdf->SetX(30);
                        $pdf->SetFont('Helvetica', 'U', 8);
                        $pdf->Cell(120, 6, isset($datos[0]->mailvendedor) ? utf8_decode($datos[0]->mailvendedor) : 'mailvendedor', 0, 0, 'L', 0);
                        // if($factura_info->id_empresa==1){
                        //     $pdf->SetTextColor(4, 255, 0);
                        // }else{
                        //     $pdf->SetTextColor(0, 0, 255);
                        // }
                        $pdf->SetTextColor(0, 0, 255);
                        $pdf->SetFont('', 'U', 9);
                        $pdf->Write(6, utf8_decode($factura_info->urlweb), utf8_decode($factura_info->urlweb));
                        $current_date = date("Y-m-d");
                        //dd($ruta);
                        if (!$generar_en_servidor) {
                            return $pdf->Output(isset($datos[0]->identificacion) ? "orden_compra-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                        } else if ($generar_en_servidor && !is_null($ruta)) {
                            if (file_exists($ruta)) {
                                $name = $id . '.pdf';
                                $location = $ruta . "/" . $name;
                                $pdf->Output("F", $location);
                                return json_encode(
                                    array(
                                        "location" => $location,
                                        "name" => $name)
                                );
                            } else {
                                throw new Exception("No se pudo generar la proforma");
                            }

                        } else if ($generar_en_servidor && is_null($ruta)) {
                            throw new Exception("La ruta para la proforma no es valida.");
                        }
                    }else{
                        if($datos[0]->nombre_empresa=='MEGAREDES CIA. LTDA.'){
                            //if($factura_info->id_empresa==1){
                            $pdf->AliasNbPages();
                            $pdf->AddPage();
                            $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                            $pdf->SetAutoPageBreak(1, 4);
                            $width = $pdf->GetPageWidth();
                            if ($datos[0]->logo!==null && file_exists($logo)) {
                                // if($factura_info->id_empresa==1){
                                        
                                //     $pdf->Image($logo, 15, 10, 55, 20);
                                // //$pdf->Image($logo, 5, 10, 25, 20);
                                
                                // }else{
                                    
                                    $pdf->Image($logo, 6, 3, 50, 29);
                                
                                //}
                                
                            } else {
                                $pdf->SetX(8);
                                $pdf->SetTextColor(255, 0, 0);
                                $pdf->SetFont('Arial', 'B', 10);
                                $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 0, 'C', 0);
                                $pdf->SetTextColor(0, 0, 0);
                                
                            }
                            //dd($datos[0]);
                            $y_img=25;
                            $pdf->SetXY(5, 35);
                            /*$pdf->SetTextColor(48,132,70);
                            $pdf->SetFont('Arial', 'B', 10);
                            $pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 0, 'L', 0);*/
                            $y_cot="";
                            if($factura_info->id_empresa==1){
                                $y_cot=35;
                            }else{
                                $y_cot=15;
                            }

                            $pdf->SetXY($width-82,15);
                            //$pdf->SetXY($width-40,$y_cot-20);
                            $pdf->SetTextColor(99, 125, 171);
                            $pdf->SetFont('Arial', 'B', 25);
                            $pdf->Cell(25, 10, utf8_decode('ORDEN COMPRA'), 0, 1, 'L', 0);
                    
                            $pdf->SetXY($width-58,35);
                            //$pdf->SetXY($width-60,$y_cot-10);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 9);
                            $pdf->Cell(25, 5, utf8_decode('NÂ°'), 0, 0, 'R', 0);
                            $pdf->Cell(25, 5, utf8_decode($id_proforma), 1, 1, 'C', 0);
                            $pdf->SetXY($width-58,40);
                            //$pdf->SetXY($width-60,$y_cot-5);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 9);
                            $pdf->Cell(25, 5, utf8_decode('FECHA'), 0, 0, 'R', 0);
                            $fecha_emision="";
                            $fecha_emision=date("d/m/Y", strtotime($datos[0]->fecha_emision));
                            $pdf->Cell(25, 5, isset($datos[0]->fecha_emision) ? utf8_decode($fecha_emision) : 'fecha_emision', 1,1, 'C', 0);
                            // $pdf->SetXY($width-60,$y_cot+20);
                            // //$pdf->SetXY($width-60,$y_cot);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 6);
                            // $pdf->Cell(25, 5, utf8_decode('RUC'), 0, 0, 'L', 0);
                            // $pdf->Cell(25, 5, utf8_decode($datos[0]->ruc_empresa), 1, 1, 'C', 0);
                            // $pdf->SetXY($width-60,$y_cot+25);
                            // //$pdf->SetXY($width-60,$y_cot+5);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 6);
                            // $fecha_validez=date("d/m/Y", strtotime($factura_info->fecha_expiracion));;
                            // $pdf->Cell(25, 5, utf8_decode('VALIDO HASTA'), 0, 0, 'L', 0);
                            // $pdf->Cell(25, 5, utf8_decode($fecha_validez), 1, 1, 'C', 0);

                            // $pdf->SetXY(15,$y_img+5);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('RUC:'), 0, 0, 'L', 0);
                            // $pdf->Cell(65, 5, utf8_decode($datos[0]->direccion_empresa), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+10);
                            // $pdf->SetTextColor(0,0,0);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
                            // $pdf->Cell(65, 5,utf8_decode($datos[0]->ciudad), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+15);
                            // $pdf->SetTextColor(0,0,0);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('Sitio Web:'), 0, 0, 'L', 0);
                            // $pdf->Cell(25, 5, utf8_decode(/*"                ".*/$factura_info->urlweb), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+20);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('TelÃ©fono:'), 0, 0, 'L', 0);
                            // $pdf->Cell(20, 5, utf8_decode(/*"                (593)".*/"(593)".$factura_info->telefono), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+25);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('Asesor de venta:'), 0, 0, 'L', 0);
                            // $pdf->Cell(75, 5, isset($datos[0]->vendedor) ? utf8_decode(/*"    ".*/$datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                            // $pdf->SetXY(15,$y_img+30);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('TelÃ©fono Vendedor:'), 0, 0, 'L', 0);
                            // if($datos[0]->telefono_vendedor){
                            //     $pdf->Cell(25, 5, "(593)".$datos[0]->telefono_vendedor, 0, 0, 'L', 0);
                            // }else{
                            //     $pdf->Cell(25, 5, $datos[0]->telefono_vendedor, 0, 0, 'L', 0);
                            // }

                            $pdf->SetXY(7,$y_img+5);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 10);
                            $pdf->Cell(19, 4, utf8_decode($datos[0]->nombre_empresa), 0, 0, 'L', 0);
                            $pdf->SetXY(7,$y_img+9);
                            $pdf->SetTextColor(0,0,0);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Ruc:'), 0, 0, 'L', 0);
                            $pdf->Cell(65, 4, utf8_decode($datos[0]->ruc_empresa), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+13);
                            $pdf->SetTextColor(0,0,0);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Direccion:'), 0, 0, 'L', 0);
                            $pdf->Cell(65, 4, utf8_decode($datos[0]->direccion_empresa), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+17);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
                            $pdf->Cell(65, 4,utf8_decode($datos[0]->ciudad)." ,Ecuador", 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+21);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('TelÃ©fono:'), 0, 0, 'L', 0);
                            $pdf->Cell(20, 4, utf8_decode(/*"                (593)".*/"(593)"), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+25);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Sitio Web:'), 0, 0, 'L', 0);
                            $pdf->Cell(25, 4, isset($factura_info->urlweb) || $factura_info->urlweb!==null || $factura_info->urlweb!=='null' ? utf8_decode(/*"                ".*/$factura_info->urlweb) : '', 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+32);
                            $pdf->SetFillColor(67, 92, 137);
                            $pdf->SetTextColor(255, 255, 255);
                            $pdf->SetDrawColor(100, 0, 0);
                            $pdf->SetFont('Arial', 'B', 8);
                            $pdf->Cell(195, 5, ''/*utf8_decode('Observaciones: ').utf8_decode($factura_info->observacion)*/, 0, 1, 'L', 1);
                            $pdf->SetXY(7,$y_img+40);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Proveedor:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->cliente), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+44);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Contacto:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->contacto), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+48);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('CI/RUC:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->identificacion), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+52);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Direccion:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->direccion), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+56);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->ciudad), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+60);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode("TelÃ©fono:"), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->telefono), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+64);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode("E-mail:"), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->email), 0, 1, 'L', 0);
                            // $pdf->Cell(75, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"CI/RUC:                   ".utf8_decode($datos[0]->identificacion), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"Email:                       ".utf8_decode($datos[0]->email), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"Ciudad:                     ".utf8_decode($datos[0]->ciudad), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"Direccion:                 ".utf8_decode($datos[0]->direccion), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,utf8_decode("TelÃ©fono:                  ").utf8_decode($datos[0]->telefono), 0, 2, 'L', 0);
                            
                            //$pdf->Cell(155, 8, 'Proyecto: '.ucfirst($proyecto), 0, 1, 'C', 0);
                            //$pdf->SetXY(165, 10);
                            // HEADER
                        
                    
                            // INFORMATION HEADER
                            $margin = 7;
                            $height = $pdf->GetY();
                            $cli_atencion = '';
                        
                            // $pdf->SetFont('Helvetica', 'B', 8);
                            // $pdf->Cell(20, 5, utf8_decode('APRECIADO CLIENTE:'), 0, 2, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 8);
                            // $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                            $pdf->SetFillColor(85, 175, 84);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetDrawColor(0, 0, 0);
                            // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                            //     // SLOGAN
                            //     $pdf->SetXY($margin, $height + 15);
                            //     $pdf->SetFont('Helvetica', 'B', 10);
                            //     $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                            //     $height_products = $height + 25;
                            // } else {
                                $height_products = $height + 5;
                            //}
                            //cabecera de detalles de productos
                            $pdf->SetFont('Helvetica', 'B', 6);
                            // if($factura_info->id_empresa==1){
                            //     $pdf->SetFillColor(141, 207, 140);
                            // }else{
                            //     $pdf->SetFillColor(141, 207, 240);
                            // }
                            $pdf->SetFillColor(67, 92, 137);
                            $exist_cps=0;
                            foreach ($datos as $detail) {
                                if($detail->cpc){
                                    $exist_cps++;
                                }
                            }
                            //dd("X=".$margin."Y=".$height_products);
                            $pdf->SetTextColor(255,255,255);
                            // if($exist_cps>0){
                            //     $pdf->SetXY($margin, $height_products);
                            //     $pdf->MultiCell(10, 8, utf8_decode('CPC'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+10, $height_products);
                            //     $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+35, $height_products);
                            //     $pdf->MultiCell(16, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+35, $height_products);
                            //     $pdf->MultiCell(24, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+35, $height_products);
                            //     $pdf->MultiCell(17, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                            //     $pdf->SetXY(92+5, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('USO'), 1, 'C', 1);
                            //     $pdf->SetXY(108+1, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                            //     $pdf->SetXY(120+1, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                            //     $pdf->SetXY(132+1, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                            //     $pdf->SetXY(144+1, $height_products);
                            //     $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                            //     $pdf->SetXY(158+1, $height_products);
                            //     $pdf->MultiCell(15, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                            //     $pdf->SetXY(173+1, $height_products);
                            //     $pdf->MultiCell(17, 4, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                            //     $pdf->SetXY(190+1, $height_products);
                            //     $pdf->MultiCell(14, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                            //     //dd("X=".$margin."Y=".$height_products);
                            //     $y = $height_products + 8;
                            //     $pdf->SetFont('Helvetica', '', 4);
                            //     $pdf->SetFillColor(255, 255, 255);
                            //     $pdf->SetFillColor(85, 175, 84);
                            //     $pdf->SetXY($margin, $height_products+8);
                            //     $pdf->SetWidths(array(10,25, 16, 24, 17, 12, 12, 12, 12, 14, 15, 17, 14));
                            // }else{
                                $pdf->SetXY($margin, $height_products);
                                //$pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                                //$pdf->SetXY($margin+25, $height_products);
                                $pdf->MultiCell(17, 8, utf8_decode('CODIGO'), 1, 'C', 1);
                                $pdf->SetXY($margin+17, $height_products);
                                $pdf->MultiCell(116, 8, utf8_decode('DESCRIPCIÃN'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116, $height_products);
                                // $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                                // $pdf->SetXY($margin+17+20, $height_products);
                                // $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                                // $pdf->SetXY(116, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                                // $pdf->SetXY(120, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                                // $pdf->SetXY(132, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                                //$pdf->SetXY(144, $height_products);
                                //$pdf->MultiCell(20, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116, $height_products);
                                $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116+14, $height_products);
                                $pdf->MultiCell(24, 8, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116+14+24, $height_products);
                                $pdf->MultiCell(24, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                                //$pdf->SetXY($margin+17+116+15+14+15+17, $height_products);
                                
                                //dd("X=".$margin."Y=".$height_products);
                                $y = $height_products + 8;
                                $pdf->SetFont('Helvetica', '', 4);
                                $pdf->SetFillColor(255, 255, 255);
                                $pdf->SetFillColor(85, 175, 84);
                                $pdf->SetXY($margin, $height_products+8);
                                $pdf->SetWidths(array(17, 116,  14, 24, 24));
                            //}
                            $pdf->SetTextColor(0,0,0);
                            //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                            $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                            //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                            $sub_total=0;
                            $descuento=0;
                            $iva=0;
                            $total_fact=0;
                            $suma_sub_total=0;
                            $suma_descuento=0;
                            $suma_iva=0;
                            $suma_total_fact=0;
                            //dd($datos);
                            foreach ($datos as $detail) {
                                $caract=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);
                                $norm=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->normativa);
                                $uso=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->uso);
                                $data = array(
                                    utf8_decode(trim($detail->cod_alterno)."Centrado"),
                                    utf8_decode($caract),
                                    // utf8_decode($norm."Centrado"),
                                    // utf8_decode($uso."Centrado"),
                                    // utf8_decode(trim($detail->marca)."Centrado"),
                                    
                                    // utf8_decode(trim($detail->unidad_medida)."Centrado"),
                                    // utf8_decode(trim($detail->tipo_medida)."Centrado"),
                                    //$detail->tiempo_entrega!==null ? utf8_decode($detail->tiempo_entrega."Centrado") : utf8_decode('INMEDIATA'),
                                    utf8_decode($detail->cantidad."Centrado"),
                                    utf8_decode("$ ".$detail->precio."Derecha"),
                                    utf8_decode("$ ".$detail->total_pro."Derecha"),
                                    
                                        
                                );
                                
                                
                                    $sub_total=$detail->subtotal;
                                    $descuento=$detail->descuento;
                                    $iva=$detail->iva;
                                    $total_fact=$detail->total;
                                // if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                                // //if ($detail->imagen) {
                                //     //dd($pdf->GetY());
                                //     if($exist_cps>0){ 
                                        
                                //             array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX()+10, $pdf->GetY(), 25, 25));
                                        
                                        
                                //     }else{
                                        
                                //             array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                                        
                                //     }
                                    
                                // } else {
                                //     array_unshift($data, utf8_decode('* sin imagen'."Centrado"));
                                // }
                                // if($exist_cps>0){
                                //     array_unshift($data, utf8_decode($detail->cpc."Centrado"));
                                // }
                                //dd("Imagen:".$imagen.$detail->imagen);
                                $pdf->RowDataMegaRedes($data, $margin+5);
                                $head_table=$pdf->GetY();
                            }
                            
                            $suma_sub_total=number_format($sub_total,2,".",",");
                            $suma_descuento=number_format($descuento,2,".",",");
                            $suma_iva=number_format($iva,2,".",",");
                            $suma_total_fact=number_format($total_fact,2,".",",");
                            // if($exist_cps>0){
                            //     $pdf->SetXY(133, $pdf->GetY());
                            //     $pdf->SetX(133);
                            // }else{
                            $fin_tabla=$pdf->GetY();
                            $pdf->SetXY(7,$fin_tabla+3);
                            $pdf->SetFillColor(189, 184, 183);
                            $pdf->SetFont('Helvetica', 'B', 7);
                            $pdf->Cell(133, 5, 'Observaciones', 1, 1, 'L', 1);
                            $pdf->SetX(7);
                            $pdf->SetFont('Helvetica', '', 6);
                            if($factura_info->observacion==null || $factura_info->observacion==''){
                                $pdf->Cell(133, 20, '', 1,0, 'L', 0);
                            }else{
                                $pdf->MultiCell(133, 4, utf8_decode($factura_info->observacion), 1, 'L', 0);
                            }
                            
                            $pdf->SetXY(153, $fin_tabla);
                            $pdf->SetX(153);
                            //}
                            
                            $pdf->SetFont('Helvetica', 'B', 8);
                            if($exist_cps>0){
                                $pdf->Cell(25, 7, utf8_decode('SUBTOTAL'), 0, 0, 'L', 0);
                            }else{
                                $pdf->Cell(25, 7, utf8_decode('SUBTOTAL'), 0, 0, 'L', 0);
                            }
                            
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                            $pdf->Cell(24, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 0, 1, 'R', 0);
                            
                            // if($exist_cps>0){
                            //     $pdf->SetX(133);
                            // }else{
                                $pdf->SetX(153);
                            //}
                            $pdf->SetFont('Helvetica', 'B', 8);
                            
                            if($exist_cps>0){
                                $pdf->Cell(24, 7, utf8_decode('DESCUENTO'), 0, 0, 'L', 0);
                            }else{
                                $pdf->Cell(24, 7, utf8_decode('DESCUENTO'), 0, 0, 'L', 0);
                            }
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                            $pdf->Cell(24, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 0, 1, 'R', 0);
                            $pdf->SetX(136);
                            // if($exist_cps>0){
                            //     $pdf->SetX(133);
                            // }else{
                                $pdf->SetX(153);
                            //}
                            $pdf->SetFont('Helvetica', 'B', 8);
                            
                            if($exist_cps>0){
                                $pdf->Cell(24, 7, utf8_decode('IVA (12%)'), 0, 0, 'L', 0);
                            }else{
                                $pdf->Cell(24, 7, utf8_decode('IVA (12%)'), 0, 0, 'L', 0);
                            }
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                            $pdf->Cell(24, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 0, 1, 'R', 0);
                            // if($exist_cps>0){
                            //     $pdf->SetX(133);
                            // }else{
                            //     $pdf->SetX(153);
                            // }
                            $pdf->SetX(153);
                            /*if($factura_info->id_empresa==1){
                                $pdf->SetFillColor(189,236,182);
                            }else{
                                $pdf->SetFillColor(93,155,155);
                            }*/
                            $pdf->SetFillColor(156,156,156);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            
                            if($exist_cps>0){
                                $pdf->Cell(24, 7, utf8_decode('TOTAL'), 'T', 0, 'L', 0);
                            }else{
                                $pdf->Cell(24, 7, utf8_decode('TOTAL'), 'T', 0, 'L', 0);
                            }
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(24, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 'T', 1, 'R', 1);
                            $pdf->Ln();
                            // $pdf->SetXY(5, $head_table+5);
                            // $pdf->SetFont('Helvetica', 'B', 7);
                            // $pdf->Cell(27, 5,'Observaciones:', 0, 0, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 7);
                            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->observacion), 0, 'L');
                            // //$head_cp_ad=$pdf->GetY();
                            // $pdf->SetX(5);
                            // $pdf->SetFont('Helvetica', 'B', 7);
                            // $pdf->Cell(27, 5,'Lugar de Entrega:', 0, 0, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 7);
                            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->lugar_de_entrega), 0, 'L');
                            // $pdf->SetX(5);
                            // $pdf->SetFont('Helvetica', 'B', 7);
                            // $pdf->Cell(27, 5,'Condiciones de pago:', 0, 0, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 7);
                            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->condiciones_de_pago), 0, 'L');
                            $head_cp_ad=$pdf->GetY();
                            $pdf->SetXY(5, $head_cp_ad);
                            $pdf->SetFillColor(141, 207, 140);
                            if($factura_info->id_empresa==1){
                                $pdf->SetFillColor(141, 207, 140);
                            }else{
                                $pdf->SetFillColor(141, 207, 240);
                            }
                            // $pdf->Cell(125, 5,'Terminos y condiciones', 1, 2, 'C', 1);
                            // $pdf->Cell(125, 5, utf8_decode('1.Al cliente se le cobrarÃ¡ despuÃ©s de aceptada esta cotizaciÃ³n'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('2.El pago serÃ¡ debitado antes de la entrega de bienes y servicios'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('3.Por favor enviar la cotizaciÃ³n firmada al email indicado anteriormente.'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('La aceptaciÃ³n del cliente (firmar a continuaciÃ³n):'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('x_____________________________________________________'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'Nombre cliente', 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, '', 'LRB', 2, 'L', 0);
                            $pdf->Ln();
                    
                            // $pdf->Cell(190, 5, utf8_decode('Si usted tiene alguna pregunta sobre  esta cotizaciÃ³n, por favor, pÃ³ngase en contacto con nosotros'), 0, 2, 'C', 0);
                            // $pdf->Cell(190, 5, $factura_info->telefono." , ".$datos[0]->mailvendedor, 0, 2, 'C', 0);
                            $pdf->SetX(7);
                            $pdf->SetFillColor(67, 92, 137);
                            $pdf->SetTextColor(255,255,255);
                            //$pdf->Cell(73, 5, utf8_decode('Forma de Pago'), 0, 0, 'C', 1);
                            $pdf->Cell(97.5, 5, utf8_decode('Forma de Pago'), 0, 0, 'C', 1);
                                // $pdf->Cell(40, 5, utf8_decode('Tiempo de Entrega'), 0, 0, 'C', 1);
                                // $pdf->Cell(40, 5, utf8_decode('Lugar de Entrega'), 0, 0, 'C', 1);
                            $pdf->Cell(97.5, 5, utf8_decode('Validez de Oferta'), 0, 1, 'C', 1);
                            $pdf->SetX(7);
                            $pdf->SetTextColor(0,0,0);
                            //$pdf->Cell(73, 5, utf8_decode($factura_info->forma_pago), 'LRB', 0, 'C', 0);
                            $pdf->Cell(97.5, 5, utf8_decode($factura_info->forma_pago), 'LRB', 0, 'C', 0);
                            // $pdf->Cell(40, 5, utf8_decode($datos[0]->tiempo_entrega), 'LRB', 0, 'C', 0);
                            // $pdf->Cell(40, 5, utf8_decode($factura_info->lugar_de_entrega), 'LRB', 0, 'C', 0);
                            $pdf->Cell(97.5, 5, date("d/m/Y", strtotime($factura_info->fecha_expiracion)), 'LRB', 1, 'C', 0);
                            $pdf->Ln(10);
                            $forma_pagos=$pdf->GetY();
                            $pdf->SetX(7);
                            $pdf->SetTextColor(0,0,0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(60, 5, utf8_decode('Atentamente,'), 0, 2, 'L', 0);
                            $pdf->Ln(10);
                            $pdf->SetX(7);
                            $pdf->Cell(50,3,'_______________________________',0, 2, 'L', 0);
                            $pdf->SetX(7);
                            $pdf->Cell(50, 5, utf8_decode($datos[0]->vendedor), 0, 0, 'C', 0);
                            //vendedor
                            $current_date = date("Y-m-d");
                            //dd($ruta);
                            if (!$generar_en_servidor) {
                                return $pdf->Output(isset($datos[0]->identificacion) ? "orden_compra-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                            } else if ($generar_en_servidor && !is_null($ruta)) {
                                if (file_exists($ruta)) {
                                    $name = $id . '.pdf';
                                    $location = $ruta . "/" . $name;
                                    $pdf->Output("F", $location);
                                    return json_encode(
                                        array(
                                            "location" => $location,
                                            "name" => $name)
                                    );
                                } else {
                                    throw new Exception("No se pudo generar la orden compra");
                                }

                            } else if ($generar_en_servidor && is_null($ruta)) {
                                throw new Exception("La ruta para la orden compra no es valida.");
                            } 
                        }else{
                            $pdf->AliasNbPages();
                            $pdf->AddPage();
                            $logo = constant("DATA_EMPRESA") . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                            $pdf->SetAutoPageBreak(1, 4);
                            $width = $pdf->GetPageWidth();
                            // HEADER
                            if ($datos[0]->logo!==null && file_exists($logo)) {
                                
                                    $pdf->Image($logo, 10, 6, 50, 35);
                                
                                
                            } else {
                                $pdf->SetTextColor(255, 0, 0);
                                $pdf->SetFont('Arial', 'B', 020);
                                $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                            }
                            // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                            //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                            //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                            //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                            //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                            //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/3m.png', 134, 7, 20, 10);
                            // }
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', 'B', 14);
                            $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth("ORDEN COMPRA NÂ°. " . $id_proforma) / 2), 33);
                            $pdf->Cell($pdf->GetStringWidth("ORDEN COMPRA NÂ°. " . $id_proforma), 8, utf8_decode("ORDEN COMPRA NÂ°. " . $id_proforma), 0, 2, 'C', 0);
                            $pdf->SetXY((($width / 4) * 3)+10, 10);
                            $pdf->SetFont('Arial', 'B', 8);
                            $pdf->Cell(($width / 4) - 10, 6, isset($datos[0]->ruc_empresa) ? utf8_decode('RUC: ' . $datos[0]->ruc_empresa) : '*************', 0, 2, 'C', 0);
                            $pdf->MultiCell(($width / 4) - 10, 6, isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : 'Sin direccion', 0, 'C', 0);
                            $pdf->Ln();

                            // INFORMATION HEADER
                            $margin = 5;
                            $height = $pdf->GetY();
                            $cli_atencion = '';
                            // if($factura_info->id_empresa==1){
                            //     //$pdf->SetDrawColor(85, 175, 84);
                            //     $pdf->SetDrawColor(85, 175, 84);
                            // }else{
                            //     //$pdf->SetDrawColor(85, 175, 204);
                            //     $pdf->SetDrawColor(85, 175, 204);
                            // }
                            $pdf->SetDrawColor(85, 175, 204);
                            //$pdf->SetDrawColor(85, 175, 204);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76 && $pdf->GetStringWidth(utf8_decode($datos[0]->email))>76){
                                $pdf->RoundedRect($margin, $height + 10, $width - 14, 27.5, 2, '1234', 'D');
                            }else{
                                $pdf->RoundedRect($margin, $height + 10, $width - 14, 26, 2, '1234', 'D');
                            }
                            
                            $pdf->SetXY($margin, $height + 12.5);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell($width / 4, 5, utf8_decode('RUC:'), 0, 2, 'L', 0);
                            $head_ruc=$pdf->GetY();
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                $pdf->SetXY($margin, $head_ruc+1);
                            }
                            $pdf->Cell($width / 4, 5, utf8_decode('PROVEEDOR:'), 0, 2, 'L', 0);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                $pdf->SetXY($margin, 58);
                            }
                            $pdf->Cell($width / 4, 5, utf8_decode('ATENCIÃN:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                            $pdf->SetXY($width / 2, $height + 12.5);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell($width / 4, 5, utf8_decode('FECHA:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('CIUDAD:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('DIRECCIÃN:'), 0, 2, 'L', 0);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                $pdf->SetXY($width / 2, 63);
                            }
                            $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);

                            $pdf->SetXY(($width / 6) - $margin, $height + 12.5);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell($width / 4, 5, isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : 'identificacion', 0, 2, 'L', 0);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                $pdf->MultiCell(76, 3, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0,'L', 0);
                                $head_cliente=$pdf->GetY();
                            }else{
                                $pdf->Cell(76, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                            }
                            //dd($head_cliente);
                            //$pdf->MultiCell(75, 5, isset($datos[0]->cliente) ? utf8_decode('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.'/*$datos[0]->cliente*/) : 'cliente', 1,'L');
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                $pdf->SetXY(($width / 6) - $margin,$head_cliente+0.5);
                            }else{
                                $pdf->SetX(($width / 6) - $margin);
                            }
                            
                            $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->email))>76){
                                $pdf->MultiCell(76, 3, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0,'L', 0);
                            }else{
                                $pdf->Cell(76, 5, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0, 2, 'L', 0);
                            }
                            

                            $pdf->SetXY(($width / 6 * 4) - $margin, $height + 12.5);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell($width / 4, 5, isset($datos[0]->fecha_emision) ? utf8_decode($datos[0]->fecha_emision) : 'fecha_emision', 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, isset($datos[0]->ciudad) ? utf8_decode($datos[0]->ciudad) : 'ciudad', 0, 2, 'L', 0);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                $pdf->MultiCell(66, 3, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0,'L', 0);
                                $head_dir=$pdf->GetY();
                            }else{
                                $pdf->Cell(66, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                            }
                            //dd($head_dir);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                $pdf->SetXY(($width / 6 * 4) - $margin, $head_dir+0.5);
                            }
                            $pdf->Cell($width / 4, 5, isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : 'telefono', 0, 2, 'L', 0);
                            $pdf->Ln();

                            // MESSAGE
                            $pdf->SetXY($margin, $height + 45);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(20, 5, utf8_decode('APRECIADO PROVEEDOR:'), 0, 2, 'L', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                            $pdf->SetFillColor(85, 175, 84);
                            $pdf->SetTextColor(0, 0, 255);
                            $pdf->SetDrawColor(0, 0, 0);
                            if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                                // SLOGAN
                                $pdf->SetXY($margin, $height + 55);
                                $pdf->SetFont('Helvetica', 'B', 10);
                                $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                                $height_products = $height + 65;
                            } else {
                                $height_products = $height + 60;
                            }
                            //cabecera de detalles de productos
                            $pdf->SetFont('Helvetica', 'B', 6);
                            // if($factura_info->id_empresa==1){
                            //     $pdf->SetFillColor(141, 207, 140);
                            // }else{
                                
                            // }
                            $pdf->SetFillColor(141, 207, 240);
                            //dd("X=".$margin."Y=".$height_products);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetXY($margin, $height_products);
                            $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                            $pdf->SetXY(30, $height_products);
                            $pdf->MultiCell(20, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                            $pdf->SetXY(50, $height_products);
                            $pdf->MultiCell(25, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                            $pdf->SetXY(75, $height_products);
                            $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                            $pdf->SetXY(95, $height_products);
                            $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                            $pdf->SetXY(111, $height_products);
                            $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                            $pdf->SetXY(123, $height_products);
                            $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                            $pdf->SetXY(135, $height_products);
                            $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                            $pdf->SetXY(147, $height_products);
                            $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                            $pdf->SetXY(161, $height_products);
                            $pdf->MultiCell(20, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                            $pdf->SetXY(181, $height_products);
                            $pdf->MultiCell(20, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                            //$pdf->SetXY(190, $height_products);
                            //$pdf->MultiCell(15, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                            //dd("X=".$margin."Y=".$height_products);
                            $y = $height_products + 8;
                            $pdf->SetFont('Helvetica', '', 4);
                            $pdf->SetFillColor(255, 255, 255);
                            $pdf->SetFillColor(85, 175, 84);
                            $pdf->SetXY($margin, $height_products+8);
                            $pdf->SetWidths(array(25, 20, 25, 20, 16, 12, 12, 12, 14, 20, 20, 15));
                            //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                            $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                            //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                            $sub_total=0;
                            $descuento=0;
                            $iva=0;
                            $total_fact=0;
                            $suma_sub_total=0;
                            $suma_descuento=0;
                            $suma_iva=0;
                            $suma_total_fact=0;
                            foreach ($datos as $detail) {
                                $caract = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->caracteristicas);
                                $norm = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->normativa);
                                $uso = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->uso);
                                $data = array(
                                    utf8_decode($detail->nombre),
                                    utf8_decode($caract),
                                    utf8_decode($norm),
                                    utf8_decode($uso),
                                    utf8_decode($detail->marca."Centrado"),
                                    utf8_decode($detail->unidad_medida."Centrado"),
                                    utf8_decode($detail->tipo_medida."Centrado"),
                                    utf8_decode($detail->cantidad."Centrado"),
                                    utf8_decode($detail->precio."Centrado"),
                                    utf8_decode($detail->total_pro."Derecha"),
                                    //utf8_decode($detail->total_pro."Derecha"),
                                    //utf8_decode('INMEDIATA'),
                                    
                                );
                                    $sub_total=$detail->subtotal;
                                    $descuento=$detail->descuento;
                                    $iva=$detail->iva;
                                    $total_fact=$detail->total;
                                if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                                //if ($detail->imagen) {
                                    array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                                } else {
                                    array_unshift($data, utf8_decode('* sin imagen'));
                                }
                                //dd("Imagen:".$imagen.$detail->imagen);
                                $pdf->RowProductsGeneral($data, $margin+5);
                            }
                            
                            $suma_sub_total=number_format($sub_total,2,".",",");
                            $suma_descuento=number_format($descuento,2,".",",");
                            $suma_iva=number_format($iva,2,".",",");
                            $suma_total_fact=number_format($total_fact,2,".",",");
                            $pdf->SetXY(135, $pdf->GetY());
                            $pdf->SetX(135);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(46, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                            $pdf->Cell(20, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                            $pdf->SetX(135);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(46, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                            $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                            $pdf->SetX(135);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(46, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                            $pdf->Cell(20, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                            $pdf->SetX(135);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(46, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(20, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                            $pdf->Ln();
                            
                            // if($factura_info->id_empresa==1){
                            //     $pdf->SetDrawColor(85, 175, 84);
                            // }else{
                            //     $pdf->SetDrawColor(141, 207, 240);
                            // }
                            $pdf->SetDrawColor(141, 207, 240);
                            $pdf->SetX(5);
                            $pdf->SetFont('Helvetica', 'BU', 9);
                            $pdf->Cell(200, 6, utf8_decode('CONDICIONES COMERCIALES'), 'T', 1, 'L', 0);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->SetX(5);
                            // $pdf->Cell(50, 6, utf8_decode('LUGAR DE ENTREGA:'), 0, 0, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 8);
                            // $pdf->Cell(150, 6, utf8_decode($factura_info->lugar_de_entrega), 0, 1, 'L', 0);
                            // $pdf->SetFont('Helvetica', 'B', 8);
                            // $pdf->SetX(5);
                            // $pdf->Cell(50, 6, utf8_decode('CONDICIOINES DE PAGO:'), 0, 0, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 8);
                            // $pdf->Cell(150, 6, utf8_decode($factura_info->condiciones_de_pago), 0, 1, 'L', 0);
                            // $pdf->SetFont('Helvetica', 'B', 8);
                            // $pdf->SetX(5);
                            $pdf->Cell(50, 6, utf8_decode('OBSERVACIONES:'), 0, 0, 'L', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->MultiCell(146, 6, utf8_decode($factura_info->observacion), 0,'L');
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->SetX(5);
                            $pdf->Cell(50, 6, utf8_decode('VALIDEZ DE LA OFERTA:'), 'B', 0, 'L', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(150, 6, utf8_decode($factura_info->fecha_expiracion), 'B', 1, 'L', 0);
                            $pdf->Ln();

                            $pdf->SetX(5);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(25, 6, utf8_decode('Elaborado por:'), 0, 0, 'L', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(75, 6, isset($datos[0]->vendedor) ? utf8_decode($datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Helvetica', '', 9);
                            $pdf->Cell(100, 6, utf8_decode('Le invitamos a revisar nuestra pÃ¡gina web.'), 0, 1, 'R', 0);
                            
                            $pdf->SetTextColor(0, 0, 255);
                        
                            
                            $pdf->SetX(30);
                            $pdf->SetFont('Helvetica', 'U', 8);
                            $pdf->Cell(120, 6, isset($datos[0]->mailvendedor) ? utf8_decode($datos[0]->mailvendedor) : 'mailvendedor', 0, 0, 'L', 0);
                            // if($factura_info->id_empresa==1){
                            //     $pdf->SetTextColor(4, 255, 0);
                            // }else{
                            //     $pdf->SetTextColor(0, 0, 255);
                            // }
                            $pdf->SetTextColor(0, 0, 255);
                            $pdf->SetFont('', 'U', 9);
                            $pdf->Write(6, utf8_decode($factura_info->urlweb), utf8_decode($factura_info->urlweb));
                            $current_date = date("Y-m-d");
                            //dd($ruta);
                            if (!$generar_en_servidor) {
                                return $pdf->Output(isset($datos[0]->identificacion) ? "orden_compra-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                            } else if ($generar_en_servidor && !is_null($ruta)) {
                                if (file_exists($ruta)) {
                                    $name = $id . '.pdf';
                                    $location = $ruta . "/" . $name;
                                    $pdf->Output("F", $location);
                                    return json_encode(
                                        array(
                                            "location" => $location,
                                            "name" => $name)
                                    );
                                } else {
                                    throw new Exception("No se pudo generar la proforma");
                                }

                            } else if ($generar_en_servidor && is_null($ruta)) {
                                throw new Exception("La ruta para la proforma no es valida.");
                            }
                        }
                    }
                }
            }else{
                //dd($factura_info);
                $pdf->SetLeftMargin(30);

                #Establecemos el margen inferior:
                $pdf->SetAutoPageBreak(true,25); 
                //$pdf->AddPage();
                $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                $pdf->SetLeftMargin(30);
                $pdf->SetAutoPageBreak(1, 4);
                $pdf->AddPage();
                $width = $pdf->GetPageWidth();
                //$pdf->Rect(7.5, 7.5, $pdf->GetPageWidth()-15,$pdf->GetPageHeight()-15,'D');
                $pdf->SetLeftMargin(30);
                $pdf->Image($logo,15, 15, 55, 20);
                $pdf->SetXY(($width / 2) - 20,15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(113,5,'Empresa: '.utf8_decode($datos[0]->nombre_empresa),0,1,'L');
                //$pdf->Cell(96,5,isset($datos[0]->nombre_empresa) ? utf8_decode($datos[0]->nombre_empresa) : '',0,1,'R');
                $pdf->SetXY($pdf->GetPageWidth()-28,20);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(14,5,'RUC:'.$datos[0]->ruc_empresa,0,1,'R');
                $pdf->SetXY($pdf->GetPageWidth()-144,25);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(130,5,utf8_decode('DirecciÃ³n:').utf8_decode($datos[0]->direccion_empresa),0,1,'R');
                $pdf->SetXY($pdf->GetPageWidth()-54,30);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(40,5,utf8_decode('TelÃ©fono:').$factura_info->telefono,0,1,'R');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(35,5,isset($datos[0]->ruc_empresa) ? utf8_decode($datos[0]->ruc_empresa) : '',0,1,'L');
                $pdf->SetXY(95,50);
                $pdf->SetFont('Helvetica', 'B', 10);
                $pdf->Cell(20,3,utf8_decode('ORDEN COMPRA NÂ°').$id_proforma,0,0,'C');
                $margin = 15;
                $height = $pdf->GetY();
                $pdf->SetXY(15,75);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(17,5,'Proveedor:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(96,5,isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente',0,0,'L');
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(14,5,'RUC:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(35,5,isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : '',0,1,'L');
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(17,5,'DIR:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(96,5,isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : '',0,0,'L');
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(14,5,'TLF:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(35,5,isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : '',0,1,'L');
                // $pdf->SetX(15);
                
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(17,5,'Proveedor: ',0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(96,5,isset($datos[0]->nombre_empresa) ? utf8_decode($datos[0]->nombre_empresa) : '',0,0,'L');
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(14,5,'RUC:',0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(35,5,isset($datos[0]->ruc_empresa) ? utf8_decode($datos[0]->ruc_empresa) : '',0,1,'L');
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(17,5,utf8_decode('Fecha:'),0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(93,5,strftime("%d de %B del %Y", strtotime($datos[0]->fecha_emision)),0,1,'L');
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(27,5,utf8_decode('Fecha Vencimiento:'),0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(88,5,strftime("%d de %B del %Y", strtotime($factura_info->fecha_expiracion)),0,1,'L');
                // $pdf->SetX(15);
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(17,5,utf8_decode('DirecciÃ³n:'),0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(96,5,isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : '',0,0,'L');
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(14,5,utf8_decode('TelÃ©fono:'),0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(38,5,isset($factura_info->telefono) ? utf8_decode($factura_info->telefono) : '',0,1,'L');
                $height_products = $height + 55;
                $pdf->Ln(15);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetTextColor(0, 0, 0);
                $pdf->Cell(10,8,utf8_decode('ÃTEM'),1,0,'C');
                $pdf->Cell(78,8,utf8_decode('DESCRIPCIÃN'),1,0,'C');
                $pdf->Cell(18,4,utf8_decode('TIEMPO'),'LRT',1,'C');
                $get_x2=$pdf->GetX();
                $get_y2=$pdf->GetY();
                $pdf->SetXY($get_x2+73,$get_y2);
                $pdf->Cell(18,4,utf8_decode('ENTREGA'),'LRB',0,'C');
                $pdf->SetXY($get_x2+91,$get_y2-4);
                $pdf->Cell(18,8,utf8_decode('CANTIDAD'),1,0,'C');
                $pdf->Cell(28,4,utf8_decode('PRECIO'),'LRT',1,'C');
                $get_x=$pdf->GetX();
                $get_y=$pdf->GetY();
                $pdf->SetXY($get_x+109,$get_y);
                $pdf->Cell(28,4,utf8_decode('UNITARIO'),'LRB',0,'C');
                $pdf->SetXY($get_x+137,$get_y-4);
                $pdf->Cell(28,8,utf8_decode('TOTAL'),1,0,'C');
                $pdf->Ln();
                $y = $height_products+8;
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(85, 175, 84);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(10, 78, 18, 18, 28, 28, 28));
                $sub_total=0;
                $descuento=0;
                $iva=0;
                $total_fact=0;
                $suma_sub_total=0;
                $suma_descuento=0;
                $suma_iva=0;
                $suma_total_fact=0;
                $item=0;
                foreach ($datos as $detail) {
                    $item++;
                    $data = array(
                        utf8_decode($item."Centrado"),
                        utf8_decode($detail->nombre),
                        utf8_decode($detail->tiempo_entrega."Centrado"),
                        utf8_decode($detail->cantidad."Centrado"),
                        utf8_decode("$ ".$detail->precio."Derecha"),
                        utf8_decode("$ ".$detail->total_pro."Derecha"),
                        //utf8_decode('INMEDIATA'),
                        
                    );
                        $sub_total=$detail->subtotal;
                        $descuento=$detail->descuento;
                        $iva=$detail->iva;
                        $total_fact=$detail->total;
                        //array_unshift($data, utf8_decode('* sin imagen'));
                    //dd("Imagen:".$imagen.$detail->imagen);
                    $pdf->RowProducto($data, $margin);
                }
                $suma_sub_total=number_format($sub_total,2,".",",");
                $suma_descuento=number_format($descuento,2,".",",");
                $suma_iva=number_format($iva,2,".",",");
                $suma_total_fact=number_format($total_fact,2,".",",");
                $pdf->SetXY(135, $pdf->GetY());
                $pdf->SetX(139);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(28, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                $pdf->SetFont('Helvetica', '', 8);
                //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                $pdf->Cell(28, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                // $pdf->SetX(135);
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(28, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                // $pdf->SetFont('Helvetica', '', 8);
                // //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                // $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                $pdf->SetX(139);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(28, 7, utf8_decode('12% IVA'), 1, 0, 'C', 0);
                $pdf->SetFont('Helvetica', '', 8);
                //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                $pdf->Cell(28, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                $pdf->SetX(139);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(28, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(28, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                $pdf->Ln(15);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('ObservaciÃ³n: '.$factura_info->observacion), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('Fecha Validez: '.strftime("%d de %B del %Y", strtotime($factura_info->fecha_expiracion))), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('Forma Pago: '.$factura_info->forma_pago), 0, 1, 'L', 0);
                $pdf->Ln(5);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('Atentamente,'), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->Cell(190, 5,utf8_decode($datos[0]->vendedor.'.'), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->Cell(190, 5,utf8_decode($datos[0]->nombre_empresa.'.'), 0, 1, 'L', 0);
                $pdf->SetXY(15,-25);
                $pdf->Cell(170, 5,utf8_decode('DirecciÃ³n: ').utf8_decode($datos[0]->direccion_empresa).' Telf.: '.$datos[0]->telefono, 0, 1, 'R', 0);
                $pdf->SetX(15);
                $pdf->Cell(170, 5,utf8_decode($datos[0]->mailvendedor).' - '.utf8_decode($factura_info->urlweb), 0, 1, 'R', 0);
                $pdf->SetX(15);
                $pdf->Cell(170, 5,ucwords(strtolower($datos[0]->ciudad)).' - Ecuador', 0, 1, 'R', 0);
                $width = $pdf->GetPageWidth();
                $current_date = date("Y-m-d");
                if (!$generar_en_servidor) {
                    return $pdf->Output(isset($datos[0]->identificacion) ? "orden_compra-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                } else if ($generar_en_servidor && !is_null($ruta)) {
                    if (file_exists($ruta)) {
                        $name = $id . '.pdf';
                        $location = $ruta . "/" . $name;
                        $pdf->Output("F", $location);
                        return json_encode(
                            array(
                                "location" => $location,
                                "name" => $name)
                        );
                    } else {
                        throw new Exception("No se pudo generar la proforma");
                    }

                } else if ($generar_en_servidor && is_null($ruta)) {
                    throw new Exception("La ruta para la proforma no es valida.");
                }
            }
        }
        
    }
    public function importacionPDF($id,$datos, $id_proforma, $factura_info, $generar_en_servidor = false, $ruta = null)
    {
        setlocale(LC_TIME, "spanish");
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        //dd($factura_info->id_empresa);

            //if(preg_match('/grupo solis/i', $datos[0]->nombre_empresa)){
        if($factura_info->id_empresa==30){
            $pdf->AliasNbPages();
            $pdf->AddPage();
            $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
            $pdf->SetAutoPageBreak(1, 4);
            $width = $pdf->GetPageWidth();
            if ($datos[0]->logo!==null && file_exists($logo)) {
                if($factura_info->id_empresa==1){
                    
                $pdf->Image($logo, 5, 10, 55, 20);
                //$pdf->Image($logo, 5, 10, 25, 20);
                
                }else{
                    
                $pdf->Image($logo, 5, 6, 50, 35);
                
                }
                
            } else {
                $pdf->SetX(10);
                $pdf->SetTextColor(255, 0, 0);
                $pdf->SetFont('Arial', 'B', 10);
                $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 0, 'C', 0);
                $pdf->SetTextColor(255, 255, 255);
            }
            if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
            //if ($factura_info->id_empresa==1) {
                /*$pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 31, 13, 30, 25);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 30, 5, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 65, 9, 20, 20);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 90, 17, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/armadura.jpg', 90, 6, 28, 13);*/
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/blacklinesafe.jpg', 130, 6, 28, 13);
            }
            //dd($datos[0]);
            $y_img=40;
            $pdf->SetXY(5, 35);
            /*$pdf->SetTextColor(48,132,70);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 0, 'L', 0);*/
            $y_cot="";
            if($factura_info->id_empresa==1){
                $y_cot=35;
            }else{
                $y_cot=15;
            }
            $pdf->SetXY($width-40,$y_cot);
            //$pdf->SetXY($width-40,$y_cot-20);
            $pdf->SetTextColor(48,132,70);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->Cell(25, 10, utf8_decode('IMPORTACION'), 0, 1, 'L', 0);
    
            $pdf->SetXY($width-60,$y_cot+10);
            //$pdf->SetXY($width-60,$y_cot-10);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(25, 5, utf8_decode('FECHA'), 0, 0, 'L', 0);
            $fecha_emision="";
            $fecha_emision=date("d/m/Y", strtotime($datos[0]->fecha_emision));
            $pdf->Cell(25, 5, isset($datos[0]->fecha_emision) ? utf8_decode($fecha_emision) : 'fecha_emision', 1,1, 'C', 0);
            $pdf->SetXY($width-60,$y_cot+15);
            //$pdf->SetXY($width-60,$y_cot-5);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(25, 5, utf8_decode('IMPORTACION'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode($id_proforma), 1, 1, 'C', 0);
            $pdf->SetXY($width-60,$y_cot+20);
            //$pdf->SetXY($width-60,$y_cot);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(25, 5, utf8_decode('RUC'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode($datos[0]->ruc_empresa), 1, 1, 'C', 0);
            $pdf->SetXY($width-60,$y_cot+25);
            //$pdf->SetXY($width-60,$y_cot+5);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $fecha_validez=date("d/m/Y", strtotime($factura_info->fecha_expiracion));
            $pdf->Cell(25, 5, utf8_decode('VALIDO HASTA'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode($fecha_validez), 1, 1, 'C', 0);
            $pdf->SetXY(5,$y_img+5);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Direccion:'), 0, 0, 'L', 0);
            $pdf->Cell(65, 5, utf8_decode($datos[0]->direccion_empresa), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+10);
            $pdf->SetTextColor(0,0,0);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
            $pdf->Cell(65, 5,utf8_decode($datos[0]->ciudad), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+15);
            $pdf->SetTextColor(0,0,0);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Sitio Web:'), 0, 0, 'L', 0);
            $pdf->Cell(25, 5, utf8_decode(/*"                ".*/$factura_info->urlweb), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+20);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('TelÃ©fono:'), 0, 0, 'L', 0);
            $pdf->Cell(20, 5, utf8_decode(/*"                (593)".*/"(593)".$factura_info->telefono), 0, 1, 'L', 0);
            $pdf->SetXY(5,$y_img+25);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('Asesor de venta:'), 0, 0, 'L', 0);
            $pdf->Cell(75, 5, isset($datos[0]->vendedor) ? utf8_decode(/*"    ".*/$datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
            $pdf->SetXY(5,$y_img+30);
            $pdf->SetTextColor(0,0,0,);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(19, 5, utf8_decode('TelÃ©fono Vendedor:'), 0, 0, 'L', 0);
            if($datos[0]->telefono_vendedor){
                $pdf->Cell(25, 5, "(593)".$datos[0]->telefono_vendedor, 0, 0, 'L', 0);
            }else{
                $pdf->Cell(25, 5, $datos[0]->telefono_vendedor, 0, 0, 'L', 0);
            }
            
            $pdf->SetXY(5,$y_img+35);
            $pdf->SetFillColor(156,156,156);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->SetDrawColor(100, 0, 0);
            $pdf->SetFont('Arial', '', 7);
            $pdf->Cell(95, 5, utf8_decode('Proveedor'), 0, 1, 'L', 1);
            $pdf->SetXY(5,$y_img+40);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->SetFont('Arial', '', 6);
            $pdf->Cell(75, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"CI/RUC:                   ".utf8_decode($datos[0]->identificacion), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"Email:                       ".utf8_decode($datos[0]->email), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"Ciudad:                     ".utf8_decode($datos[0]->ciudad), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,"Direccion:                 ".utf8_decode($datos[0]->direccion), 0, 2, 'L', 0);
            $pdf->Cell(75, 5,utf8_decode("TelÃ©fono:                  ").utf8_decode($datos[0]->telefono), 0, 2, 'L', 0);
            
            //$pdf->Cell(155, 8, 'Proyecto: '.ucfirst($proyecto), 0, 1, 'C', 0);
            //$pdf->SetXY(165, 10);
            // HEADER
        
    
            // INFORMATION HEADER
            $margin = 5;
            $height = $pdf->GetY();
            $cli_atencion = '';
        
            $pdf->SetFont('Helvetica', 'B', 8);
            $pdf->Cell(20, 5, utf8_decode('APRECIADO PROVEEDOR:'), 0, 2, 'L', 0);
            $pdf->SetFont('Helvetica', '', 8);
            $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
            $pdf->SetFillColor(85, 175, 84);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->SetDrawColor(0, 0, 0);
            if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                // SLOGAN
                $pdf->SetXY($margin, $height + 15);
                $pdf->SetFont('Helvetica', 'B', 10);
                $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                $height_products = $height + 25;
            } else {
                $height_products = $height + 15;
            }
            //cabecera de detalles de productos
            $pdf->SetFont('Helvetica', 'B', 6);
            if($factura_info->id_empresa==1){
                $pdf->SetFillColor(141, 207, 140);
            }else{
                $pdf->SetFillColor(141, 207, 240);
            }
            $exist_cps=0;
            foreach ($datos as $detail) {
                if($detail->cpc){
                    $exist_cps++;
                }
            }
            //dd("X=".$margin."Y=".$height_products);
            $pdf->SetTextColor(0, 0, 0);
            if($exist_cps>0){
                $pdf->SetXY($margin, $height_products);
                $pdf->MultiCell(10, 8, utf8_decode('CPC'), 1, 'C', 1);
                $pdf->SetXY($margin+10, $height_products);
                $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                $pdf->SetXY(30+10, $height_products);
                $pdf->MultiCell(16, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                $pdf->SetXY(47+9, $height_products);
                $pdf->MultiCell(24, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                $pdf->SetXY(72+8, $height_products);
                $pdf->MultiCell(17, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                $pdf->SetXY(92+5, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('USO'), 1, 'C', 1);
                $pdf->SetXY(108+1, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                $pdf->SetXY(120+1, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                $pdf->SetXY(132+1, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                $pdf->SetXY(144+1, $height_products);
                $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                $pdf->SetXY(158+1, $height_products);
                $pdf->MultiCell(15, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                $pdf->SetXY(173+1, $height_products);
                $pdf->MultiCell(17, 4, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                //$pdf->SetXY(190+1, $height_products);
                //$pdf->MultiCell(14, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                //dd("X=".$margin."Y=".$height_products);
                $y = $height_products + 8;
                $pdf->SetFont('Helvetica', '', 4);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(85, 175, 84);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(10,25, 16, 24, 17, 12, 12, 12, 12, 14, 15, 17));
            }else{
                $pdf->SetXY($margin, $height_products);
                $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                $pdf->SetXY(30, $height_products);
                $pdf->MultiCell(17, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                $pdf->SetXY(47, $height_products);
                $pdf->MultiCell(30, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                $pdf->SetXY(77, $height_products);
                $pdf->MultiCell(25, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                $pdf->SetXY(102, $height_products);
                $pdf->MultiCell(21, 8, utf8_decode('USO'), 1, 'C', 1);
                $pdf->SetXY(123, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                $pdf->SetXY(135, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                $pdf->SetXY(147, $height_products);
                $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                $pdf->SetXY(159, $height_products);
                $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                $pdf->SetXY(173, $height_products);
                $pdf->MultiCell(15, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                $pdf->SetXY(188, $height_products);
                $pdf->MultiCell(17, 4, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                // $pdf->SetXY(190, $height_products);
                // $pdf->MultiCell(15, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                //dd("X=".$margin."Y=".$height_products);
                $y = $height_products + 8;
                $pdf->SetFont('Helvetica', '', 4);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(85, 175, 84);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(25, 17, 30, 25, 21, 12, 12, 12, 14, 15, 17));
            }
            
            //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
            $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
            //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
            $sub_total=0;
            $descuento=0;
            $iva=0;
            $total_fact=0;
            $suma_sub_total=0;
            $suma_descuento=0;
            $suma_iva=0;
            $suma_total_fact=0;
            foreach ($datos as $detail) {
                $caract=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->caracteristicas);
                $norm=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->normativa);
                $uso=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->uso);
                $data = array(
                    utf8_decode(trim($detail->nombre)."Centrado"),
                    utf8_decode($caract."Centrado"),
                    utf8_decode($norm."Centrado"),
                    utf8_decode($uso."Centrado"),
                    utf8_decode(trim($detail->marca)."Centrado"),
                    
                    utf8_decode(trim($detail->unidad_medida)."Centrado"),
                    utf8_decode(trim($detail->tipo_medida)."Centrado"),
                    utf8_decode($detail->cantidad."Centrado"),
                    utf8_decode("$ ".$detail->precio."Derecha"),
                    utf8_decode("$ ".$detail->total_pro."Derecha"),
                    //$detail->tiempo_entrega!==null ? utf8_decode($detail->tiempo_entrega."Centrado") : utf8_decode('INMEDIATA'),
                        
                 );
                
                
                    $sub_total=$detail->subtotal;
                    $descuento=$detail->descuento;
                    $iva=$detail->iva;
                    $total_fact=$detail->total;
                if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                //if ($detail->imagen) {
                    //dd($pdf->GetY());
                    if($exist_cps>0){ 
                        
                            array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX()+10, $pdf->GetY(), 25, 25));
                        
                        
                    }else{
                        
                            array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                        
                    }
                    
                } else {
                    array_unshift($data, utf8_decode('* sin imagen'."Centrado"));
                }
                if($exist_cps>0){
                    array_unshift($data, utf8_decode($detail->cpc."Centrado"));
                }
                //dd("Imagen:".$imagen.$detail->imagen);
                $pdf->Row($data, $margin+5);
                $head_table=$pdf->GetY();
            }
            
            $suma_sub_total=number_format($sub_total,2,".",",");
            $suma_descuento=number_format($descuento,2,".",",");
            $suma_iva=number_format($iva,2,".",",");
            $suma_total_fact=number_format($total_fact,2,".",",");
            if($exist_cps>0){
                $pdf->SetXY(133, $pdf->GetY());
                $pdf->SetX(133);
            }else{
                $pdf->SetXY(147, $pdf->GetY());
                $pdf->SetX(147);
            }
            
            $pdf->SetFont('Helvetica', 'B', 8);
            if($exist_cps>0){
                $pdf->Cell(41, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
            }else{
                $pdf->Cell(41, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
            }
            
            $pdf->SetFont('Helvetica', '', 8);
            //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
            $pdf->Cell(17, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
            
            if($exist_cps>0){
                $pdf->SetX(133);
            }else{
                $pdf->SetX(147);
            }
            $pdf->SetFont('Helvetica', 'B', 8);
            
            if($exist_cps>0){
                $pdf->Cell(41, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
            }else{
                $pdf->Cell(41, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
            }
            $pdf->SetFont('Helvetica', '', 8);
            //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
            $pdf->Cell(17, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
            $pdf->SetX(136);
            if($exist_cps>0){
                $pdf->SetX(133);
            }else{
                $pdf->SetX(147);
            }
            $pdf->SetFont('Helvetica', 'B', 8);
            
            if($exist_cps>0){
                $pdf->Cell(41, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
            }else{
                $pdf->Cell(41, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
            }
            $pdf->SetFont('Helvetica', '', 8);
            //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
            $pdf->Cell(17, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
            if($exist_cps>0){
                $pdf->SetX(133);
            }else{
                $pdf->SetX(147);
            }
            /*if($factura_info->id_empresa==1){
                $pdf->SetFillColor(189,236,182);
            }else{
                $pdf->SetFillColor(93,155,155);
            }*/
            $pdf->SetFillColor(156,156,156);
            $pdf->SetFont('Helvetica', 'B', 8);
            
            if($exist_cps>0){
                $pdf->Cell(41, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
            }else{
                $pdf->Cell(41, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
            }
            $pdf->SetFont('Helvetica', '', 8);
            $pdf->Cell(17, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 1);
            $pdf->Ln();
            $pdf->SetXY(5, $head_table+5);
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->Cell(27, 5,'Periodo Inicio:', 0, 0, 'L', 0);
            $pdf->SetFont('Helvetica', '', 7);
            $pdf->Cell(115, 5,date("d/m/Y", strtotime($factura_info->fecha_inicio)), 0,1, 'L',0);
            $pdf->SetX(5);
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->Cell(27, 5,'Periodo Fin:', 0, 0, 'L', 0);
            $pdf->SetFont('Helvetica', '', 7);
            $pdf->Cell(115, 5,date("d/m/Y", strtotime($factura_info->fecha_expiracion)), 0,1, 'L',0);
            $pdf->SetX(5);
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->Cell(27, 5,'Fecha Embarque :', 0, 0, 'L', 0);
            $pdf->SetFont('Helvetica', '', 7);
            $pdf->Cell(115, 5,date("d/m/Y", strtotime($factura_info->fech_embarque)), 0,1, 'L',0);
            $pdf->SetX(5);
            $pdf->SetFont('Helvetica', 'B', 7);
            $pdf->Cell(27, 5,'Fecha Arribo :', 0, 0, 'L', 0);
            $pdf->SetFont('Helvetica', '', 7);
            $pdf->Cell(115, 5,date("d/m/Y", strtotime($factura_info->fech_arribo)), 0,1, 'L',0);
            $pdf->Ln(5);

            // $pdf->Cell(48.75, 5, date("d/m/Y", strtotime($factura_info->fecha_inicio)), 'LRB', 0, 'C', 0);
            //                 $pdf->Cell(48.75, 5, date("d/m/Y", strtotime($factura_info->fecha_expiracion)), 'LRB', 0, 'C', 0);
            //                 $pdf->Cell(48.75, 5, date("d/m/Y", strtotime($factura_info->fech_embarque)), 'LRB', 0, 'C', 0);
            //                 $pdf->Cell(48.75, 5, date("d/m/Y", strtotime($factura_info->fech_arribo)), 'LRB', 1, 'C', 0);

            //$head_cp_ad=$pdf->GetY();
            // $pdf->SetX(5);
            // $pdf->SetFont('Helvetica', 'B', 7);
            // $pdf->Cell(27, 5,'Lugar de Entrega:', 0, 0, 'L', 0);
            // $pdf->SetFont('Helvetica', '', 7);
            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->lugar_de_entrega), 0, 'L');
            // $pdf->SetX(5);
            // $pdf->SetFont('Helvetica', 'B', 7);
            // $pdf->Cell(27, 5,'Condiciones de pago:', 0, 0, 'L', 0);
            // $pdf->SetFont('Helvetica', '', 7);
            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->condiciones_de_pago), 0, 'L');
            $head_cp_ad=$pdf->GetY();
            $pdf->SetXY(5, $head_cp_ad+5);
            $pdf->SetFillColor(141, 207, 140);
            if($factura_info->id_empresa==1){
                $pdf->SetFillColor(141, 207, 140);
            }else{
                $pdf->SetFillColor(141, 207, 240);
            }
            // $pdf->Cell(125, 5,'Terminos y condiciones', 1, 2, 'C', 1);
            // $pdf->Cell(125, 5, utf8_decode('1.Al cliente se le cobrarÃ¡ despuÃ©s de aceptada esta cotizaciÃ³n'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('2.El pago serÃ¡ debitado antes de la entrega de bienes y servicios'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('3.Por favor enviar la cotizaciÃ³n firmada al email indicado anteriormente.'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('La aceptaciÃ³n del cliente (firmar a continuaciÃ³n):'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, utf8_decode('x_____________________________________________________'), 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'Nombre cliente', 'LR', 2, 'L', 0);
            // $pdf->Cell(125, 5, '', 'LRB', 2, 'L', 0);
            $pdf->Ln(7);
    
            $pdf->Cell(190, 5, utf8_decode('Si usted tiene alguna pregunta sobre  esta Importacion, por favor, pÃ³ngase en contacto con nosotros'), 0, 2, 'C', 0);
            $pdf->Cell(190, 5, $factura_info->telefono." , ".$datos[0]->mailvendedor, 0, 2, 'C', 0);
            $current_date = date("Y-m-d");
            //dd($ruta);
            if (!$generar_en_servidor) {
                return $pdf->Output(isset($datos[0]->identificacion) ? "importacion-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
            } else if ($generar_en_servidor && !is_null($ruta)) {
                if (file_exists($ruta)) {
                    $name = $id . '.pdf';
                    $location = $ruta . "/" . $name;
                    $pdf->Output("F", $location);
                    return json_encode(
                        array(
                            "location" => $location,
                            "name" => $name)
                    );
                } else {
                    throw new Exception("No se pudo generar la importacion");
                }

            } else if ($generar_en_servidor && is_null($ruta)) {
                throw new Exception("La ruta para la importacion no es valida.");
            } 
        }else{
            //if($factura_info->id_empresa!==32){
            if($datos[0]->nombre_empresa!=='BUSINESS COMPANY INSU-MED'){
                //if($factura_info->id_empresa==51){
                if($datos[0]->nombre_empresa=='MASRESOURCES S.A.'){
                    //if($factura_info->id_empresa==1){
                    $pdf->AliasNbPages();
                    $pdf->AddPage();
                    $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                    $pdf->SetAutoPageBreak(1, 4);
                    $width = $pdf->GetPageWidth();
                    // HEADER
                    if ($datos[0]->logo!==null && file_exists($logo)) {
                        // if($factura_info->id_empresa==1){
                        //     //$pdf->Image($logo, 10, 10, 55, 20);
                        //     $pdf->Image($logo, 10, 6, 60, 25);
                        // }else{
                        //     $pdf->Image($logo, 10, 6, 50, 35);
                        // }
                        $pdf->Image($logo, 10, 6, 70, 25);
                    } else {
                        $pdf->SetTextColor(255, 0, 0);
                        $pdf->SetFont('Arial', 'B', 020);
                        $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                        //$pdf->SetTextColor(0, 0, 0);
                    }
                    // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                    //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/3m.png', 134, 7, 20, 10);
                    // }
                    $pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Arial', 'B', 14);
                    $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth("IMPORTACION NÂ°. " . $id_proforma) / 2), 33);
                    $pdf->Cell($pdf->GetStringWidth("IMPORTACION NÂ°. " . $id_proforma), 8, utf8_decode("IMPORTACION NÂ°. " . $id_proforma), 0, 2, 'C', 0);
                    $pdf->SetXY((($width / 4) * 3)+10, 10);
                    $pdf->SetFont('Arial', 'B', 8);
                    $pdf->Cell(($width / 4) - 10, 6, isset($datos[0]->ruc_empresa) ? utf8_decode('RUC: ' . $datos[0]->ruc_empresa) : '*************', 0, 2, 'C', 0);
                    $pdf->Cell(($width / 4) - 10, 6, isset($factura_info->telefono) ? utf8_decode('TELÃFONO: ' . $factura_info->telefono) : '*************', 0, 2, 'C', 0);
                    $pdf->MultiCell(($width / 4) - 10, 6, isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : 'Sin direccion', 0, 'C', 0);
                    $pdf->Ln();

                    // INFORMATION HEADER
                    $margin = 5;
                    $height = $pdf->GetY();
                    $cli_atencion = '';
                    // if($factura_info->id_empresa==1){
                    //     //$pdf->SetDrawColor(85, 175, 84);
                    //     //$pdf->SetDrawColor(85, 175, 84);
                    //     $pdf->SetDrawColor(122, 198, 58);
                    // }else{
                    //     //$pdf->SetDrawColor(85, 175, 204);
                    //     $pdf->SetDrawColor(85, 175, 204);
                    // }
                    //$pdf->SetDrawColor(85, 175, 204);
                    $pdf->SetDrawColor(154, 205, 50);
                    $pdf->RoundedRect($margin, $height + 10, $width - 14, 25, 2, '1234', 'D');
                    $pdf->SetXY($margin, $height + 12.5);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell($width / 4, 5, utf8_decode('RUC:'), 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, utf8_decode('PROVEEDOR:'), 0, 2, 'L', 0);
                    $head_cliente=$pdf->GetY();
                    // if($pdf->GetStringWidth('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.')>76){
                    //     $pdf->SetXY($margin, 71.5);
                    //     $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                    //     $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    // }else{
                    //     $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                    //     $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    // }
                    if($pdf->GetStringWidth($datos[0]->cliente)>76){
                        $pdf->SetXY($margin, $head_cliente+1);
                        $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    }else{
                        $pdf->Cell($width / 4, 5, utf8_decode('CONTACTO:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                    }
                    
                    $pdf->SetXY($width / 2, $height + 12.5);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell($width / 4, 5, utf8_decode('FECHA:'), 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, utf8_decode('CIUDAD:'), 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, utf8_decode('DIRECCIÃN:'), 0, 2, 'L', 0);
                    //$pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                    if($pdf->GetStringWidth($datos[0]->direccion)>66){
                        $pdf->SetXY($width / 2,74);
                        $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                    }else{
                        $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                    }
                    

                    $pdf->SetXY(($width / 6) - $margin, $height + 12.5);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell($width / 4, 5, isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : 'identificacion', 0, 2, 'L', 0);
                    // if($pdf->GetStringWidth('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.')>76){
                    //     $pdf->MultiCell(73, 3, isset($datos[0]->cliente) ? 'AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.' : 'cliente', 1,'L');
                    //     $head_cli=$pdf->GetY();
                    // }else{
                    //     $pdf->Cell(76, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 1, 2, 'L', 0);
                    // }
                    
                    if($pdf->GetStringWidth($datos[0]->cliente)>76){
                        $pdf->MultiCell(76, 3, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0,'L', 0);
                        $head_cli=$pdf->GetY();
                    }else{
                        $pdf->Cell(76, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                    }
                    //dd($head_cli);
                    //
                    // if($pdf->GetStringWidth('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.')>76){
                    //     $pdf->SetXY(($width / 6) - $margin, $head_cli);
                    // }else{
                    //     $pdf->SetX(($width / 6) - $margin);
                    // }
                    if($pdf->GetStringWidth($datos[0]->cliente)>76){
                        $pdf->SetXY(($width / 6) - $margin,$head_cli);
                    }else{
                        $pdf->SetX(($width / 6) - $margin);
                    }
                    
                    $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                    if($pdf->GetStringWidth($datos[0]->email)>76){
                        $pdf->MultiCell(76, 3, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0,'L', 0);
                        $head_email=$pdf->GetY();
                    }else{
                        $pdf->Cell($width / 4, 5, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0, 2, 'L', 0);
                    }
                    

                    $pdf->SetXY(($width / 6 * 4) - $margin, $height + 12.5);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell($width / 4, 5, isset($datos[0]->fecha_emision) ? date("d/m/Y", strtotime($datos[0]->fecha_emision)) : 'fecha_emision', 0, 2, 'L', 0);
                    $pdf->Cell($width / 4, 5, isset($datos[0]->ciudad) ? utf8_decode($datos[0]->ciudad) : 'ciudad', 0, 2, 'L', 0);
                    //$pdf->Cell(66, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 1, 2, 'L', 0);
                    if($pdf->GetStringWidth($datos[0]->direccion)>66){
                        $pdf->MultiCell(66, 3, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0,'L', 0);
                        $head_direcc=$pdf->GetY();
                    }else{
                        $pdf->Cell($width / 4, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                    }
                    
                    
                    //dd($head_direcc);
                    if($pdf->GetStringWidth($datos[0]->direccion)>66){
                        $pdf->SetXY(($width / 6 * 4) - $margin, $head_direcc);
                    }
                    // else{
                    //     $pdf->SetXY(($width / 6 * 4) - $margin, $head_direcc+2);
                    // }
                    //dd($datos[0]);
                    $pdf->Cell($width / 4, 5, isset($datos[0]->telefono) ? $datos[0]->telefono : 'telefono', 0, 2, 'L', 0);
                    $pdf->Ln();
                    //dd($width / 4);
                    // MESSAGE
                    $pdf->SetXY($margin, $height + 40);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(20, 5, utf8_decode('APRECIADO PROVEEDOR:'), 0, 2, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                    $pdf->SetFillColor(85, 175, 84);
                    $pdf->SetTextColor(0, 0, 255);
                    $pdf->SetDrawColor(0, 0, 0);
                    if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                        // SLOGAN
                        $pdf->SetXY($margin, $height + 55);
                        $pdf->SetFont('Helvetica', 'B', 10);
                        $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                        $height_products = $height + 65;
                    } else {
                        $height_products = $height + 55;
                    }
                    //cabecera de detalles de productos
                    $pdf->SetFont('Helvetica', 'B', 6);
                    // if($factura_info->id_empresa==1){
                    //     $pdf->SetFillColor(141, 207, 140);
                    // }else{
                    //     $pdf->SetFillColor(141, 207, 240);
                    // }
                    //dd("X=".$margin."Y=".$height_products);
                    $pdf->SetFillColor(154, 205, 50);
                    $pdf->SetTextColor(0, 0, 0);
                    $pdf->SetXY($margin, $height_products);
                    $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                    $pdf->SetXY(30, $height_products);
                    $pdf->MultiCell(58, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                    $pdf->SetXY(88, $height_products);
                    $pdf->MultiCell(59, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                    // $pdf->SetXY(75, $height_products);
                    // $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                    // $pdf->SetXY(95, $height_products);
                    // $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                    // $pdf->SetXY(111, $height_products);
                    // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                    // $pdf->SetXY(123, $height_products);
                    // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                    // $pdf->SetXY(135, $height_products);
                    // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                    $pdf->SetXY(147, $height_products);
                    $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                    $pdf->SetXY(161, $height_products);
                    $pdf->MultiCell(20, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                    $pdf->SetXY(181, $height_products);
                    $pdf->MultiCell(20, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                    // $pdf->SetXY(177, $height_products);
                    // $pdf->MultiCell(24, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                    //dd("X=".$margin."Y=".$height_products);
                    $y = $height_products + 8;
                    $pdf->SetFont('Helvetica', '', 4);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetFillColor(85, 175, 84);
                    $pdf->SetXY($margin, $height_products+8);
                    $pdf->SetWidths(array(25, 58, 59, 14, 20, 20));
                    //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                    $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                    //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                    $sub_total=0;
                    $descuento=0;
                    $iva=0;
                    $total_fact=0;
                    $suma_sub_total=0;
                    $suma_descuento=0;
                    $suma_iva=0;
                    $suma_total_fact=0;
                    foreach ($datos as $detail) {
                        $descrip=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);
                        $data = array(
                            utf8_decode($detail->nombre),
                            utf8_decode($descrip),
                            // utf8_decode($detail->normativa),
                            // utf8_decode($detail->uso),
                            // utf8_decode($detail->marca."Centrado"),
                            // utf8_decode($detail->tipo_medida."Centrado"),
                            utf8_decode($detail->cantidad."Centrado"),
                            utf8_decode($detail->precio."Centrado"),
                            utf8_decode($detail->total_pro."Derecha"),
                            //utf8_decode($detail->tiempo_entrega."Centrado"),
                            //utf8_decode('INMEDIATA'),
                            
                        );
                            $sub_total=$detail->subtotal;
                            $descuento=$detail->descuento;
                            $iva=$detail->iva;
                            $total_fact=$detail->total;
                        if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                        //if ($detail->imagen) {
                            array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                        } else {
                            array_unshift($data, utf8_decode('* sin imagen'));
                        }
                        //dd("Imagen:".$imagen.$detail->imagen);
                        $pdf->RowDataCompanyMs($data, $margin+5);
                    }
                    
                    $suma_sub_total=number_format($sub_total,2,".",",");
                    $suma_descuento=number_format($descuento,2,".",",");
                    $suma_iva=number_format($iva,2,".",",");
                    $suma_total_fact=number_format($total_fact,2,".",",");
                    $pdf->SetXY(147, $pdf->GetY());
                    $pdf->SetX(147);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                    $pdf->Cell(20, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                    $pdf->SetX(147);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                    $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                    $pdf->SetX(147);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                    $pdf->Cell(20, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                    $pdf->SetX(147);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(34, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(20, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                    $pdf->Ln();
                    
                    // if($factura_info->id_empresa==1){
                    //     $pdf->SetDrawColor(85, 175, 84);
                    // }else{
                    //     $pdf->SetDrawColor(141, 207, 240);
                    // }
                    $pdf->SetDrawColor(154, 205, 50);
                    $pdf->SetX(5);
                    $pdf->SetFont('Helvetica', 'BU', 9);
                    $pdf->Cell(200, 6, utf8_decode('CONDICIONES COMERCIALES'), 'T', 1, 'L', 0);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->SetX(5);
                    $pdf->Cell(50, 6, utf8_decode('PERIODO INICIO:'), 0, 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(150, 6, date("d/m/Y", strtotime($factura_info->fecha_inicio)), 0, 1, 'L', 0);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->SetX(5);
                    $pdf->Cell(50, 6, utf8_decode('PERIODO FIN:'), 0, 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(150, 6, date("d/m/Y", strtotime($factura_info->fecha_expiracion)), 0, 1, 'L', 0);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->SetX(5);
                    $pdf->Cell(50, 6, utf8_decode('FECHA EMBARQUE:'), 0, 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->MultiCell(146, 6, date("d/m/Y", strtotime($factura_info->fech_embarque)), 0,'L');
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->SetX(5);
                    $pdf->Cell(50, 6, utf8_decode('FECHA ARRIBO:'), 'B', 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(150, 6, date("d/m/Y", strtotime($factura_info->fech_arribo)), 'B', 1, 'L', 0);
                    $pdf->Ln();

                    $pdf->SetX(5);
                    $pdf->SetFont('Helvetica', 'B', 8);
                    $pdf->Cell(25, 6, utf8_decode('Elaborado por:'), 0, 0, 'L', 0);
                    $pdf->SetFont('Helvetica', '', 8);
                    $pdf->Cell(75, 6, isset($datos[0]->vendedor) ? utf8_decode($datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                    $pdf->SetTextColor(0, 0, 0);
                    $pdf->SetFont('Helvetica', '', 9);
                    if(isset($factura_info->urlweb) && $factura_info->urlweb!=='null'){
                        $pdf->Cell(100, 6, utf8_decode('Le invitamos a revisar nuestra pÃ¡gina web.'), 0, 1, 'R', 0);
                    }else{
                        $pdf->Cell(100, 6, '', 0, 1, 'R', 0);
                    }
                    
                    
                        $pdf->SetTextColor(0, 0, 255);
                
                    
                    $pdf->SetX(30);
                    $pdf->SetFont('Helvetica', 'U', 8);
                    $url="";
                    
                    $pdf->Cell(120, 6, isset($datos[0]->mailvendedor)  ? utf8_decode($datos[0]->mailvendedor) : '', 0, 0, 'L', 0);
                    // if($factura_info->id_empresa==1){
                    //     $pdf->SetTextColor(4, 255, 0);
                    // }else{
                    //     $pdf->SetTextColor(0, 0, 255);
                    // }
                    $pdf->SetTextColor(4, 255, 0);
                    $pdf->SetFont('', 'U', 9);
                    if(isset($factura_info->urlweb) && $factura_info->urlweb!=='null'){
                        $pdf->Write(6, utf8_decode($factura_info->urlweb), isset($factura_info->urlweb) && $factura_info->urlweb!=='null' ? utf8_decode($factura_info->urlweb) : '');
                    }else{
                        $pdf->Write(6, '', isset($factura_info->urlweb)  ? utf8_decode($factura_info->urlweb) : '');
                    }
                    
                    $current_date = date("Y-m-d");
                    //dd($ruta);
                    if (!$generar_en_servidor) {
                        return $pdf->Output(isset($datos[0]->identificacion) ? "importacion-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                    } else if ($generar_en_servidor && !is_null($ruta)) {
                        if (file_exists($ruta)) {
                            $name = $id . '.pdf';
                            $location = $ruta . "/" . $name;
                            $pdf->Output("F", $location);
                            return json_encode(
                                array(
                                    "location" => $location,
                                    "name" => $name)
                            );
                        } else {
                            throw new Exception("No se pudo generar la proforma");
                        }

                    } else if ($generar_en_servidor && is_null($ruta)) {
                        throw new Exception("La ruta para la proforma no es valida.");
                    }
                }else{
                    if($datos[0]->nombre_empresa=='ELECTTEL'){
                        //if($factura_info->id_empresa==1){
                        $pdf->AliasNbPages();
                        $pdf->AddPage();
                        $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                        $pdf->SetAutoPageBreak(1, 4);
                        $width = $pdf->GetPageWidth();
                        // HEADER
                        if ($datos[0]->logo!==null && file_exists($logo)) {
                            
                                $pdf->Image($logo, 10, 6, 55, 35);
                            
                            
                        } else {
                            $pdf->SetTextColor(255, 0, 0);
                            $pdf->SetFont('Arial', 'B', 020);
                            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                        }
                        // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                        //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/3m.png', 134, 7, 20, 10);
                        // }
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Arial', 'B', 14);
                        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth("IMPORTACION NÂ°. " . $id_proforma) / 2), 33);
                        $pdf->Cell($pdf->GetStringWidth("IMPORTACION NÂ°. " . $id_proforma), 8, utf8_decode("IMPORTACION NÂ°. " . $id_proforma), 0, 2, 'C', 0);
                        $pdf->SetXY((($width / 4) * 3)+10, 10);
                        $pdf->SetFont('Arial', 'B', 8);
                        $pdf->Cell(($width / 4) - 10, 6, isset($datos[0]->ruc_empresa) ? utf8_decode('RUC: ' . $datos[0]->ruc_empresa) : '*************', 0, 2, 'C', 0);
                        $pdf->MultiCell(($width / 4) - 10, 6, isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : 'Sin direccion', 0, 'C', 0);
                        $pdf->Ln();

                        // INFORMATION HEADER
                        $margin = 5;
                        $height = $pdf->GetY();
                        $cli_atencion = '';
                        // if($factura_info->id_empresa==1){
                        //     //$pdf->SetDrawColor(85, 175, 84);
                        //     $pdf->SetDrawColor(85, 175, 84);
                        // }else{
                        //     //$pdf->SetDrawColor(85, 175, 204);
                        //     $pdf->SetDrawColor(85, 175, 204);
                        // }
                        $pdf->SetDrawColor(85, 175, 204);
                        //$pdf->SetDrawColor(85, 175, 204);
                        $pdf->RoundedRect($margin, $height + 10, $width - 14, 25, 2, '1234', 'D');
                        $pdf->SetXY($margin, $height + 12.5);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell($width / 4, 5, utf8_decode('RUC:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('PROVEEDOR:'), 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                            $pdf->SetXY($margin, $height+24);
                            $pdf->Cell($width / 4, 5, utf8_decode('ATENCIÃN:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                        }else{
                            $pdf->Cell($width / 4, 5, utf8_decode('ATENCIÃN:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                        }
                        
                        $pdf->SetXY($width / 2, $height + 12.5);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell($width / 4, 5, utf8_decode('FECHA:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('CIUDAD:'), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, utf8_decode('DIRECCIÃN:'), 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                            $pdf->SetXY($width / 2, $height + 28.5);
                            $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                        }else{
                            $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);
                        }
                        
                        //dd($factura_info);
                        $pdf->SetXY(($width / 6) - $margin, $height + 12.5);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : 'identificacion', 0, 2, 'L', 0);
                        //$pdf->Cell($width / 4, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                            $pdf->MultiCell(76, 3, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0,'L', 0);
                            $head_cli=$pdf->GetY();
                        }else{
                            $pdf->Cell($width / 4, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                        }
                        
                        //$pdf->MultiCell(75, 5, isset($datos[0]->cliente) ? utf8_decode('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.'/*$datos[0]->cliente*/) : 'cliente', 1,'L');
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                            $pdf->SetXY(($width / 6) - $margin,$head_cli+0.5);
                        }
                        $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0, 2, 'L', 0);

                        $pdf->SetXY(($width / 6 * 4) - $margin, $height + 12.5);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->fecha_emision) ? date("d/m/Y", strtotime($datos[0]->fecha_emision)) : 'fecha_emision', 0, 2, 'L', 0);
                        $pdf->Cell($width / 4, 5, isset($datos[0]->ciudad) ? utf8_decode($datos[0]->ciudad) : 'ciudad', 0, 2, 'L', 0);
                        //$pdf->Cell($width / 4, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                            $pdf->MultiCell(66, 3, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 'L', 0);
                            $gead_dir=$pdf->GetY();
                        }else{
                            $pdf->Cell($width / 4, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                        }
                        
                        if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                            $pdf->SetXY(($width / 6 * 4) - $margin, $gead_dir+0.5);
                        }
                        
                        $pdf->Cell($width / 4, 5, isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : 'telefono', 0, 2, 'L', 0);
                        $pdf->Ln();

                        // MESSAGE
                        $pdf->SetXY($margin, $height + 40);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(20, 5, utf8_decode('APRECIADO PROVEEDOR:'), 0, 2, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                        $pdf->SetFillColor(85, 175, 84);
                        $pdf->SetTextColor(0, 0, 255);
                        $pdf->SetDrawColor(0, 0, 0);
                        if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                            // SLOGAN
                            $pdf->SetXY($margin, $height + 55);
                            $pdf->SetFont('Helvetica', 'B', 10);
                            $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                            $height_products = $height + 65;
                        } else {
                            $height_products = $height + 55;
                        }
                        //cabecera de detalles de productos
                        $pdf->SetFont('Helvetica', 'B', 6);
                        // if($factura_info->id_empresa==1){
                        //     $pdf->SetFillColor(141, 207, 140);
                        // }else{
                            
                        // }
                        $pdf->SetFillColor(141, 207, 240);
                        //dd("X=".$margin."Y=".$height_products);
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetXY($margin, $height_products);
                        $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                        $pdf->SetXY(30, $height_products);
                        $pdf->MultiCell(56, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                        $pdf->SetXY(86, $height_products);
                        $pdf->MultiCell(61, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                        $pdf->SetXY(147, $height_products);
                        // $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                        // $pdf->SetXY(95, $height_products);
                        // $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                        // $pdf->SetXY(111, $height_products);
                        // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                        // $pdf->SetXY(123, $height_products);
                        // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                        // $pdf->SetXY(135, $height_products);
                        // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                        // $pdf->SetXY(147, $height_products);
                        $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                        $pdf->SetXY(161, $height_products);
                        $pdf->MultiCell(20, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                        $pdf->SetXY(181, $height_products);
                        $pdf->MultiCell(20, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                        //$pdf->SetXY(190, $height_products);
                        //$pdf->MultiCell(15, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                        //dd("X=".$margin."Y=".$height_products);
                        $y = $height_products + 8;
                        $pdf->SetFont('Helvetica', '', 4);
                        $pdf->SetFillColor(255, 255, 255);
                        $pdf->SetFillColor(85, 175, 84);
                        $pdf->SetXY($margin, $height_products+8);
                        $pdf->SetWidths(array(25, 56, 61, 14, 20, 20));
                        //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                        $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                        //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                        $sub_total=0;
                        $descuento=0;
                        $iva=0;
                        $total_fact=0;
                        $suma_sub_total=0;
                        $suma_descuento=0;
                        $suma_iva=0;
                        $suma_total_fact=0;
                        foreach ($datos as $detail) {
                            $descrip=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);

                            $data = array(
                                utf8_decode($detail->nombre),
                                utf8_decode($descrip),
                                // utf8_decode($detail->normativa),
                                // utf8_decode($detail->uso),
                                // utf8_decode($detail->marca."Centrado"),
                                // utf8_decode($detail->tipo_medida."Centrado"),
                                utf8_decode($detail->cantidad."Centrado"),
                                utf8_decode($detail->precio."Centrado"),
                                utf8_decode($detail->total_pro."Derecha"),
                                //utf8_decode($detail->total_pro."Derecha"),
                                //utf8_decode('INMEDIATA'),
                                
                            );
                                $sub_total=$detail->subtotal;
                                $descuento=$detail->descuento;
                                $iva=$detail->iva;
                                $total_fact=$detail->total;
                            if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                            //if ($detail->imagen) {
                                array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                            } else {
                                array_unshift($data, utf8_decode('* sin imagen'));
                            }
                            //dd("Imagen:".$imagen.$detail->imagen);
                            $pdf->RowProductsELETEIMport($data, $margin+5);
                        }
                        
                        $suma_sub_total=number_format($sub_total,2,".",",");
                        $suma_descuento=number_format($descuento,2,".",",");
                        $suma_iva=number_format($iva,2,".",",");
                        $suma_total_fact=number_format($total_fact,2,".",",");
                        $pdf->SetXY(135, $pdf->GetY());
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                        $pdf->Cell(20, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                        $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                        $pdf->Cell(20, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                        $pdf->SetX(135);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(46, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(20, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                        $pdf->Ln();
                        
                        // if($factura_info->id_empresa==1){
                        //     $pdf->SetDrawColor(85, 175, 84);
                        // }else{
                        //     $pdf->SetDrawColor(141, 207, 240);
                        // }
                        $pdf->SetDrawColor(141, 207, 240);
                        $pdf->SetX(5);
                        $pdf->SetFont('Helvetica', 'BU', 9);
                        $pdf->Cell(200, 6, utf8_decode('CONDICIONES COMERCIALES'), 'T', 1, 'L', 0);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->SetX(5);
                        $pdf->Cell(50, 6, utf8_decode('PERIODO INICIO:'), 0, 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(150, 6, date("d/m/Y",strtotime($factura_info->fecha_inicio)), 0, 1, 'L', 0);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->SetX(5);
                        $pdf->Cell(50, 6, utf8_decode('PERIODO FIN:'), 0, 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(150, 6, date("d/m/Y",strtotime($factura_info->fecha_expiracion)), 0, 1, 'L', 0);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->SetX(5);
                        $pdf->Cell(50, 6, utf8_decode('FECHA EMBARGUE:'), 0, 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->MultiCell(146, 6, date("d/m/Y",strtotime($factura_info->fech_embarque)), 0,'L');
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->SetX(5);
                        $pdf->Cell(50, 6, utf8_decode('FECHA ARRIBO:'), 'B', 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(150, 6, date("d/m/Y",strtotime($factura_info->fech_arribo)), 'B', 1, 'L', 0);
                        $pdf->Ln();

                        $pdf->SetX(5);
                        $pdf->SetFont('Helvetica', 'B', 8);
                        $pdf->Cell(25, 6, utf8_decode('Elaborado por:'), 0, 0, 'L', 0);
                        $pdf->SetFont('Helvetica', '', 8);
                        $pdf->Cell(75, 6, isset($datos[0]->vendedor) ? utf8_decode($datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                        $pdf->SetTextColor(0, 0, 0);
                        $pdf->SetFont('Helvetica', '', 9);
                        $pdf->Cell(100, 6, utf8_decode('Le invitamos a revisar nuestra pÃ¡gina web.'), 0, 1, 'R', 0);
                        
                        $pdf->SetTextColor(0, 0, 255);
                    
                        
                        $pdf->SetX(30);
                        $pdf->SetFont('Helvetica', 'U', 8);
                        $pdf->Cell(120, 6, isset($datos[0]->mailvendedor) ? utf8_decode($datos[0]->mailvendedor) : 'mailvendedor', 0, 0, 'L', 0);
                        // if($factura_info->id_empresa==1){
                        //     $pdf->SetTextColor(4, 255, 0);
                        // }else{
                        //     $pdf->SetTextColor(0, 0, 255);
                        // }
                        $pdf->SetTextColor(0, 0, 255);
                        $pdf->SetFont('', 'U', 9);
                        $pdf->Write(6, utf8_decode($factura_info->urlweb), utf8_decode($factura_info->urlweb));
                        $current_date = date("Y-m-d");
                        //dd($ruta);
                        if (!$generar_en_servidor) {
                            return $pdf->Output(isset($datos[0]->identificacion) ? "importacion-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                        } else if ($generar_en_servidor && !is_null($ruta)) {
                            if (file_exists($ruta)) {
                                $name = $id . '.pdf';
                                $location = $ruta . "/" . $name;
                                $pdf->Output("F", $location);
                                return json_encode(
                                    array(
                                        "location" => $location,
                                        "name" => $name)
                                );
                            } else {
                                throw new Exception("No se pudo generar la importacion");
                            }

                        } else if ($generar_en_servidor && is_null($ruta)) {
                            throw new Exception("La ruta para la importacion no es valida.");
                        }
                    }else{
                        if($datos[0]->nombre_empresa=='MEGAREDES CIA. LTDA.'){
                            //if($factura_info->id_empresa==1){
                            $pdf->AliasNbPages();
                            $pdf->AddPage();
                            $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                            $pdf->SetAutoPageBreak(1, 4);
                            $width = $pdf->GetPageWidth();
                            if ($datos[0]->logo!==null && file_exists($logo)) {
                                // if($factura_info->id_empresa==1){
                                        
                                //     $pdf->Image($logo, 15, 10, 55, 20);
                                // //$pdf->Image($logo, 5, 10, 25, 20);
                                
                                // }else{
                                    
                                    $pdf->Image($logo, 6, 3, 50, 29);
                                
                                //}
                                
                            } else {
                                $pdf->SetX(8);
                                $pdf->SetTextColor(255, 0, 0);
                                $pdf->SetFont('Arial', 'B', 10);
                                $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 0, 'C', 0);
                                $pdf->SetTextColor(0, 0, 0);
                                
                            }
                            //dd($datos[0]);
                            $y_img=25;
                            $pdf->SetXY(5, 35);
                            /*$pdf->SetTextColor(48,132,70);
                            $pdf->SetFont('Arial', 'B', 10);
                            $pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 0, 'L', 0);*/
                            $y_cot="";
                            if($factura_info->id_empresa==1){
                                $y_cot=35;
                            }else{
                                $y_cot=15;
                            }

                            $pdf->SetXY($width-70,15);
                            //$pdf->SetXY($width-40,$y_cot-20);
                            $pdf->SetTextColor(99, 125, 171);
                            $pdf->SetFont('Arial', 'B', 25);
                            $pdf->Cell(25, 10, utf8_decode('IMPORTACION'), 0, 1, 'L', 0);
                    
                            $pdf->SetXY($width-58,35);
                            //$pdf->SetXY($width-60,$y_cot-10);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 9);
                            $pdf->Cell(25, 5, utf8_decode('NÂ°'), 0, 0, 'R', 0);
                            $pdf->Cell(25, 5, utf8_decode($id_proforma), 1, 1, 'C', 0);
                            $pdf->SetXY($width-58,40);
                            //$pdf->SetXY($width-60,$y_cot-5);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 9);
                            $pdf->Cell(25, 5, utf8_decode('FECHA'), 0, 0, 'R', 0);
                            $fecha_emision="";
                            $fecha_emision=date("d/m/Y", strtotime($datos[0]->fecha_emision));
                            $pdf->Cell(25, 5, isset($datos[0]->fecha_emision) ? utf8_decode($fecha_emision) : 'fecha_emision', 1,1, 'C', 0);
                            // $pdf->SetXY($width-60,$y_cot+20);
                            // //$pdf->SetXY($width-60,$y_cot);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 6);
                            // $pdf->Cell(25, 5, utf8_decode('RUC'), 0, 0, 'L', 0);
                            // $pdf->Cell(25, 5, utf8_decode($datos[0]->ruc_empresa), 1, 1, 'C', 0);
                            // $pdf->SetXY($width-60,$y_cot+25);
                            // //$pdf->SetXY($width-60,$y_cot+5);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 6);
                            // $fecha_validez=date("d/m/Y", strtotime($factura_info->fecha_expiracion));;
                            // $pdf->Cell(25, 5, utf8_decode('VALIDO HASTA'), 0, 0, 'L', 0);
                            // $pdf->Cell(25, 5, utf8_decode($fecha_validez), 1, 1, 'C', 0);

                            // $pdf->SetXY(15,$y_img+5);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('RUC:'), 0, 0, 'L', 0);
                            // $pdf->Cell(65, 5, utf8_decode($datos[0]->direccion_empresa), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+10);
                            // $pdf->SetTextColor(0,0,0);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
                            // $pdf->Cell(65, 5,utf8_decode($datos[0]->ciudad), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+15);
                            // $pdf->SetTextColor(0,0,0);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('Sitio Web:'), 0, 0, 'L', 0);
                            // $pdf->Cell(25, 5, utf8_decode(/*"                ".*/$factura_info->urlweb), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+20);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('TelÃ©fono:'), 0, 0, 'L', 0);
                            // $pdf->Cell(20, 5, utf8_decode(/*"                (593)".*/"(593)".$factura_info->telefono), 0, 1, 'L', 0);
                            // $pdf->SetXY(15,$y_img+25);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('Asesor de venta:'), 0, 0, 'L', 0);
                            // $pdf->Cell(75, 5, isset($datos[0]->vendedor) ? utf8_decode(/*"    ".*/$datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                            // $pdf->SetXY(15,$y_img+30);
                            // $pdf->SetTextColor(0,0,0,);
                            // $pdf->SetFont('Arial', '', 8);
                            // $pdf->Cell(19, 5, utf8_decode('TelÃ©fono Vendedor:'), 0, 0, 'L', 0);
                            // if($datos[0]->telefono_vendedor){
                            //     $pdf->Cell(25, 5, "(593)".$datos[0]->telefono_vendedor, 0, 0, 'L', 0);
                            // }else{
                            //     $pdf->Cell(25, 5, $datos[0]->telefono_vendedor, 0, 0, 'L', 0);
                            // }

                            $pdf->SetXY(7,$y_img+5);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 10);
                            $pdf->Cell(19, 4, utf8_decode($datos[0]->nombre_empresa), 0, 0, 'L', 0);
                            $pdf->SetXY(7,$y_img+9);
                            $pdf->SetTextColor(0,0,0);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Ruc:'), 0, 0, 'L', 0);
                            $pdf->Cell(65, 4, utf8_decode($datos[0]->ruc_empresa), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+13);
                            $pdf->SetTextColor(0,0,0);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Direccion:'), 0, 0, 'L', 0);
                            $pdf->Cell(65, 4, utf8_decode($datos[0]->direccion_empresa), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+17);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
                            $pdf->Cell(65, 4,utf8_decode($datos[0]->ciudad)." ,Ecuador", 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+21);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('TelÃ©fono:'), 0, 0, 'L', 0);
                            $pdf->Cell(20, 4, utf8_decode(/*"                (593)".*/"(593)"), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+25);
                            $pdf->SetTextColor(0,0,0,);
                            $pdf->SetFont('Arial', '', 8);
                            //$pdf->Cell(19, 4, utf8_decode('Sitio Web:'), 0, 0, 'L', 0);
                            $pdf->Cell(25, 4, isset($factura_info->urlweb) || $factura_info->urlweb!==null || $factura_info->urlweb!=='null' ? utf8_decode(/*"                ".*/$factura_info->urlweb) : '', 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+32);
                            $pdf->SetFillColor(67, 92, 137);
                            $pdf->SetTextColor(255, 255, 255);
                            $pdf->SetDrawColor(100, 0, 0);
                            $pdf->SetFont('Arial', 'B', 8);
                            $pdf->Cell(195, 5, ''/*utf8_decode('Observaciones: ').utf8_decode($factura_info->observacion)*/, 0, 1, 'L', 1);
                            $pdf->SetXY(7,$y_img+40);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Proveedor:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->cliente), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+44);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Contacto:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->contacto), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+48);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('CI/RUC:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->identificacion), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+52);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Direccion:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->direccion), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+56);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode('Ciudad:'), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->ciudad), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+60);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode("TelÃ©fono:"), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->telefono), 0, 1, 'L', 0);
                            $pdf->SetXY(7,$y_img+64);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(19, 4, utf8_decode("E-mail:"), 0, 0, 'L', 0);
                            $pdf->Cell(165, 4, utf8_decode($datos[0]->email), 0, 1, 'L', 0);
                            // $pdf->Cell(75, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"CI/RUC:                   ".utf8_decode($datos[0]->identificacion), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"Email:                       ".utf8_decode($datos[0]->email), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"Ciudad:                     ".utf8_decode($datos[0]->ciudad), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,"Direccion:                 ".utf8_decode($datos[0]->direccion), 0, 2, 'L', 0);
                            // $pdf->Cell(75, 5,utf8_decode("TelÃ©fono:                  ").utf8_decode($datos[0]->telefono), 0, 2, 'L', 0);
                            
                            //$pdf->Cell(155, 8, 'Proyecto: '.ucfirst($proyecto), 0, 1, 'C', 0);
                            //$pdf->SetXY(165, 10);
                            // HEADER
                        
                    
                            // INFORMATION HEADER
                            $margin = 7;
                            $height = $pdf->GetY();
                            $cli_atencion = '';
                        
                            // $pdf->SetFont('Helvetica', 'B', 8);
                            // $pdf->Cell(20, 5, utf8_decode('APRECIADO CLIENTE:'), 0, 2, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 8);
                            // $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                            $pdf->SetFillColor(85, 175, 84);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetDrawColor(0, 0, 0);
                            // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                            //     // SLOGAN
                            //     $pdf->SetXY($margin, $height + 15);
                            //     $pdf->SetFont('Helvetica', 'B', 10);
                            //     $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                            //     $height_products = $height + 25;
                            // } else {
                                $height_products = $height + 5;
                            //}
                            //cabecera de detalles de productos
                            $pdf->SetFont('Helvetica', 'B', 6);
                            // if($factura_info->id_empresa==1){
                            //     $pdf->SetFillColor(141, 207, 140);
                            // }else{
                            //     $pdf->SetFillColor(141, 207, 240);
                            // }
                            $pdf->SetFillColor(67, 92, 137);
                            $exist_cps=0;
                            foreach ($datos as $detail) {
                                if($detail->cpc){
                                    $exist_cps++;
                                }
                            }
                            //dd("X=".$margin."Y=".$height_products);
                            $pdf->SetTextColor(255,255,255);
                            // if($exist_cps>0){
                            //     $pdf->SetXY($margin, $height_products);
                            //     $pdf->MultiCell(10, 8, utf8_decode('CPC'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+10, $height_products);
                            //     $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+35, $height_products);
                            //     $pdf->MultiCell(16, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+35, $height_products);
                            //     $pdf->MultiCell(24, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                            //     $pdf->SetXY($margin+35, $height_products);
                            //     $pdf->MultiCell(17, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                            //     $pdf->SetXY(92+5, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('USO'), 1, 'C', 1);
                            //     $pdf->SetXY(108+1, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                            //     $pdf->SetXY(120+1, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                            //     $pdf->SetXY(132+1, $height_products);
                            //     $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                            //     $pdf->SetXY(144+1, $height_products);
                            //     $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                            //     $pdf->SetXY(158+1, $height_products);
                            //     $pdf->MultiCell(15, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                            //     $pdf->SetXY(173+1, $height_products);
                            //     $pdf->MultiCell(17, 4, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                            //     $pdf->SetXY(190+1, $height_products);
                            //     $pdf->MultiCell(14, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                            //     //dd("X=".$margin."Y=".$height_products);
                            //     $y = $height_products + 8;
                            //     $pdf->SetFont('Helvetica', '', 4);
                            //     $pdf->SetFillColor(255, 255, 255);
                            //     $pdf->SetFillColor(85, 175, 84);
                            //     $pdf->SetXY($margin, $height_products+8);
                            //     $pdf->SetWidths(array(10,25, 16, 24, 17, 12, 12, 12, 12, 14, 15, 17, 14));
                            // }else{
                                $pdf->SetXY($margin, $height_products);
                                //$pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                                //$pdf->SetXY($margin+25, $height_products);
                                $pdf->MultiCell(17, 8, utf8_decode('CODIGO'), 1, 'C', 1);
                                $pdf->SetXY($margin+17, $height_products);
                                $pdf->MultiCell(116, 8, utf8_decode('DESCRIPCIÃN'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116, $height_products);
                                // $pdf->MultiCell(20, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                                // $pdf->SetXY($margin+17+20, $height_products);
                                // $pdf->MultiCell(16, 8, utf8_decode('USO'), 1, 'C', 1);
                                // $pdf->SetXY(116, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                                // $pdf->SetXY(120, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                                // $pdf->SetXY(132, $height_products);
                                // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                                //$pdf->SetXY(144, $height_products);
                                //$pdf->MultiCell(20, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116, $height_products);
                                $pdf->MultiCell(14, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116+14, $height_products);
                                $pdf->MultiCell(24, 8, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                                $pdf->SetXY($margin+17+116+14+24, $height_products);
                                $pdf->MultiCell(24, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                                //$pdf->SetXY($margin+17+116+15+14+15+17, $height_products);
                                
                                //dd("X=".$margin."Y=".$height_products);
                                $y = $height_products + 8;
                                $pdf->SetFont('Helvetica', '', 4);
                                $pdf->SetFillColor(255, 255, 255);
                                $pdf->SetFillColor(85, 175, 84);
                                $pdf->SetXY($margin, $height_products+8);
                                $pdf->SetWidths(array(17, 116,  14, 24, 24));
                            //}
                            $pdf->SetTextColor(0,0,0);
                            //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                            $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                            //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                            $sub_total=0;
                            $descuento=0;
                            $iva=0;
                            $total_fact=0;
                            $suma_sub_total=0;
                            $suma_descuento=0;
                            $suma_iva=0;
                            $suma_total_fact=0;
                            //dd($datos);
                            foreach ($datos as $detail) {
                                $caract=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);
                                $norm=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->normativa);
                                $uso=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->uso);
                                $data = array(
                                    utf8_decode(trim($detail->cod_alterno)."Centrado"),
                                    utf8_decode($caract),
                                    // utf8_decode($norm."Centrado"),
                                    // utf8_decode($uso."Centrado"),
                                    // utf8_decode(trim($detail->marca)."Centrado"),
                                    
                                    // utf8_decode(trim($detail->unidad_medida)."Centrado"),
                                    // utf8_decode(trim($detail->tipo_medida)."Centrado"),
                                    //$detail->tiempo_entrega!==null ? utf8_decode($detail->tiempo_entrega."Centrado") : utf8_decode('INMEDIATA'),
                                    utf8_decode($detail->cantidad."Centrado"),
                                    utf8_decode("$ ".$detail->precio."Derecha"),
                                    utf8_decode("$ ".$detail->total_pro."Derecha"),
                                    
                                        
                                );
                                
                                
                                    $sub_total=$detail->subtotal;
                                    $descuento=$detail->descuento;
                                    $iva=$detail->iva;
                                    $total_fact=$detail->total;
                                // if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                                // //if ($detail->imagen) {
                                //     //dd($pdf->GetY());
                                //     if($exist_cps>0){ 
                                        
                                //             array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX()+10, $pdf->GetY(), 25, 25));
                                        
                                        
                                //     }else{
                                        
                                //             array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                                        
                                //     }
                                    
                                // } else {
                                //     array_unshift($data, utf8_decode('* sin imagen'."Centrado"));
                                // }
                                // if($exist_cps>0){
                                //     array_unshift($data, utf8_decode($detail->cpc."Centrado"));
                                // }
                                //dd("Imagen:".$imagen.$detail->imagen);
                                $pdf->RowDataMegaRedes($data, $margin+5);
                                $head_table=$pdf->GetY();
                            }
                            
                            $suma_sub_total=number_format($sub_total,2,".",",");
                            $suma_descuento=number_format($descuento,2,".",",");
                            $suma_iva=number_format($iva,2,".",",");
                            $suma_total_fact=number_format($total_fact,2,".",",");
                            // if($exist_cps>0){
                            //     $pdf->SetXY(133, $pdf->GetY());
                            //     $pdf->SetX(133);
                            // }else{
                            $fin_tabla=$pdf->GetY();
                            // $pdf->SetXY(7,$fin_tabla+3);
                            // $pdf->SetFillColor(189, 184, 183);
                            // $pdf->SetFont('Helvetica', 'B', 7);
                            // $pdf->Cell(133, 5, 'Observaciones', 1, 1, 'L', 1);
                            // $pdf->SetX(7);
                            // $pdf->SetFont('Helvetica', '', 6);
                            // if($factura_info->observacion==null || $factura_info->observacion==''){
                            //     $pdf->Cell(133, 20, '', 1,0, 'L', 0);
                            // }else{
                            //     $pdf->MultiCell(133, 4, utf8_decode($factura_info->observacion), 1, 'L', 0);
                            // }
                            
                            $pdf->SetXY(153, $fin_tabla);
                            $pdf->SetX(153);
                            //}
                            
                            $pdf->SetFont('Helvetica', 'B', 8);
                            if($exist_cps>0){
                                $pdf->Cell(25, 7, utf8_decode('SUBTOTAL'), 0, 0, 'L', 0);
                            }else{
                                $pdf->Cell(25, 7, utf8_decode('SUBTOTAL'), 0, 0, 'L', 0);
                            }
                            
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                            $pdf->Cell(24, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 0, 1, 'R', 0);
                            
                            // if($exist_cps>0){
                            //     $pdf->SetX(133);
                            // }else{
                                $pdf->SetX(153);
                            //}
                            $pdf->SetFont('Helvetica', 'B', 8);
                            
                            if($exist_cps>0){
                                $pdf->Cell(24, 7, utf8_decode('DESCUENTO'), 0, 0, 'L', 0);
                            }else{
                                $pdf->Cell(24, 7, utf8_decode('DESCUENTO'), 0, 0, 'L', 0);
                            }
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                            $pdf->Cell(24, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 0, 1, 'R', 0);
                            $pdf->SetX(136);
                            // if($exist_cps>0){
                            //     $pdf->SetX(133);
                            // }else{
                                $pdf->SetX(153);
                            //}
                            $pdf->SetFont('Helvetica', 'B', 8);
                            
                            if($exist_cps>0){
                                $pdf->Cell(24, 7, utf8_decode('IVA (12%)'), 0, 0, 'L', 0);
                            }else{
                                $pdf->Cell(24, 7, utf8_decode('IVA (12%)'), 0, 0, 'L', 0);
                            }
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                            $pdf->Cell(24, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 0, 1, 'R', 0);
                            // if($exist_cps>0){
                            //     $pdf->SetX(133);
                            // }else{
                            //     $pdf->SetX(153);
                            // }
                            $pdf->SetX(153);
                            /*if($factura_info->id_empresa==1){
                                $pdf->SetFillColor(189,236,182);
                            }else{
                                $pdf->SetFillColor(93,155,155);
                            }*/
                            $pdf->SetFillColor(156,156,156);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            
                            if($exist_cps>0){
                                $pdf->Cell(24, 7, utf8_decode('TOTAL'), 'T', 0, 'L', 0);
                            }else{
                                $pdf->Cell(24, 7, utf8_decode('TOTAL'), 'T', 0, 'L', 0);
                            }
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(24, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 'T', 1, 'R', 1);
                            $pdf->Ln();
                            // $pdf->SetXY(5, $head_table+5);
                            // $pdf->SetFont('Helvetica', 'B', 7);
                            // $pdf->Cell(27, 5,'Observaciones:', 0, 0, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 7);
                            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->observacion), 0, 'L');
                            // //$head_cp_ad=$pdf->GetY();
                            // $pdf->SetX(5);
                            // $pdf->SetFont('Helvetica', 'B', 7);
                            // $pdf->Cell(27, 5,'Lugar de Entrega:', 0, 0, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 7);
                            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->lugar_de_entrega), 0, 'L');
                            // $pdf->SetX(5);
                            // $pdf->SetFont('Helvetica', 'B', 7);
                            // $pdf->Cell(27, 5,'Condiciones de pago:', 0, 0, 'L', 0);
                            // $pdf->SetFont('Helvetica', '', 7);
                            // $pdf->MultiCell(98, 5,utf8_decode($factura_info->condiciones_de_pago), 0, 'L');
                            $head_cp_ad=$pdf->GetY();
                            $pdf->SetXY(5, $head_cp_ad);
                            $pdf->SetFillColor(141, 207, 140);
                            if($factura_info->id_empresa==1){
                                $pdf->SetFillColor(141, 207, 140);
                            }else{
                                $pdf->SetFillColor(141, 207, 240);
                            }
                            // $pdf->Cell(125, 5,'Terminos y condiciones', 1, 2, 'C', 1);
                            // $pdf->Cell(125, 5, utf8_decode('1.Al cliente se le cobrarÃ¡ despuÃ©s de aceptada esta cotizaciÃ³n'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('2.El pago serÃ¡ debitado antes de la entrega de bienes y servicios'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('3.Por favor enviar la cotizaciÃ³n firmada al email indicado anteriormente.'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('La aceptaciÃ³n del cliente (firmar a continuaciÃ³n):'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, '', 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, utf8_decode('x_____________________________________________________'), 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'Nombre cliente', 'LR', 2, 'L', 0);
                            // $pdf->Cell(125, 5, '', 'LRB', 2, 'L', 0);
                            $pdf->Ln();
                    
                            // $pdf->Cell(190, 5, utf8_decode('Si usted tiene alguna pregunta sobre  esta cotizaciÃ³n, por favor, pÃ³ngase en contacto con nosotros'), 0, 2, 'C', 0);
                            // $pdf->Cell(190, 5, $factura_info->telefono." , ".$datos[0]->mailvendedor, 0, 2, 'C', 0);
                            $pdf->SetX(7);
                            $pdf->SetFillColor(67, 92, 137);
                            $pdf->SetTextColor(255,255,255);
                            //$pdf->Cell(73, 5, utf8_decode('Forma de Pago'), 0, 0, 'C', 1);
                            $pdf->Cell(48.75, 5, utf8_decode('Periodo Inicio'), 0, 0, 'C', 1);
                            $pdf->Cell(48.75, 5, utf8_decode('Periodo Fin'), 0, 0, 'C', 1);
                            $pdf->Cell(48.75, 5, utf8_decode('Fecha Embarque'), 0, 0, 'C', 1);
                            $pdf->Cell(48.75, 5, utf8_decode('Fecha Arribo'), 0, 1, 'C', 1);
                            $pdf->SetX(7);
                            $pdf->SetTextColor(0,0,0);
                            //$pdf->Cell(73, 5, utf8_decode($factura_info->forma_pago), 'LRB', 0, 'C', 0);
                            $pdf->Cell(48.75, 5, date("d/m/Y", strtotime($factura_info->fecha_inicio)), 'LRB', 0, 'C', 0);
                            $pdf->Cell(48.75, 5, date("d/m/Y", strtotime($factura_info->fecha_expiracion)), 'LRB', 0, 'C', 0);
                            $pdf->Cell(48.75, 5, date("d/m/Y", strtotime($factura_info->fech_embarque)), 'LRB', 0, 'C', 0);
                            $pdf->Cell(48.75, 5, date("d/m/Y", strtotime($factura_info->fech_arribo)), 'LRB', 1, 'C', 0);
                            $pdf->Ln(10);
                            $forma_pagos=$pdf->GetY();
                            $pdf->SetX(7);
                            $pdf->SetTextColor(0,0,0);
                            $pdf->SetFont('Arial', '', 8);
                            $pdf->Cell(60, 5, utf8_decode('Atentamente,'), 0, 2, 'L', 0);
                            $pdf->Ln(10);
                            $pdf->SetX(7);
                            $pdf->Cell(50,3,'_______________________________',0, 2, 'L', 0);
                            $pdf->SetX(7);
                            $pdf->Cell(50, 5, utf8_decode($datos[0]->vendedor), 0, 0, 'C', 0);
                            //vendedor
                            $current_date = date("Y-m-d");
                            //dd($ruta);
                            if (!$generar_en_servidor) {
                                return $pdf->Output(isset($datos[0]->identificacion) ? "importacion-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                            } else if ($generar_en_servidor && !is_null($ruta)) {
                                if (file_exists($ruta)) {
                                    $name = $id . '.pdf';
                                    $location = $ruta . "/" . $name;
                                    $pdf->Output("F", $location);
                                    return json_encode(
                                        array(
                                            "location" => $location,
                                            "name" => $name)
                                    );
                                } else {
                                    throw new Exception("No se pudo generar la importacion");
                                }

                            } else if ($generar_en_servidor && is_null($ruta)) {
                                throw new Exception("La ruta para la importacion no es valida.");
                            } 
                        }else{
                            $pdf->AliasNbPages();
                            $pdf->AddPage();
                            $logo = constant("DATA_EMPRESA") . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                            $pdf->SetAutoPageBreak(1, 4);
                            $width = $pdf->GetPageWidth();
                            // HEADER
                            if ($datos[0]->logo!==null && file_exists($logo)) {
                                
                                    $pdf->Image($logo, 10, 6, 50, 35);
                                
                                
                            } else {
                                $pdf->SetTextColor(255, 0, 0);
                                $pdf->SetFont('Arial', 'B', 020);
                                $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
                            }
                            // if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                            //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/trivento.jpeg', 71, 13, 30, 25);
                            //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/robusta.jpg', 70, 5, 30, 15);
                            //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/safety.jpeg', 105, 9, 20, 20);
                            //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/cellery.jpeg', 130, 17, 30, 15);
                            //     $pdf->Image(isset($datos[0]->logo) && file_exists($datos[0]->logo) ? $datos[0]->logo : $_SERVER['DOCUMENT_ROOT'] . '/images/img-solis/3m.png', 134, 7, 20, 10);
                            // }
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Arial', 'B', 14);
                            $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth("IMPORTACION NÂ°. " . $id_proforma) / 2), 33);
                            $pdf->Cell($pdf->GetStringWidth("IMPORTACION NÂ°. " . $id_proforma), 8, utf8_decode("IMPORTACION NÂ°. " . $id_proforma), 0, 2, 'C', 0);
                            $pdf->SetXY((($width / 4) * 3)+10, 10);
                            $pdf->SetFont('Arial', 'B', 8);
                            $pdf->Cell(($width / 4) - 10, 6, isset($datos[0]->ruc_empresa) ? utf8_decode('RUC: ' . $datos[0]->ruc_empresa) : '*************', 0, 2, 'C', 0);
                            $pdf->MultiCell(($width / 4) - 10, 6, isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : 'Sin direccion', 0, 'C', 0);
                            $pdf->Ln();

                            // INFORMATION HEADER
                            $margin = 5;
                            $height = $pdf->GetY();
                            $cli_atencion = '';
                            // if($factura_info->id_empresa==1){
                            //     //$pdf->SetDrawColor(85, 175, 84);
                            //     $pdf->SetDrawColor(85, 175, 84);
                            // }else{
                            //     //$pdf->SetDrawColor(85, 175, 204);
                            //     $pdf->SetDrawColor(85, 175, 204);
                            // }
                            $pdf->SetDrawColor(85, 175, 204);
                            //$pdf->SetDrawColor(85, 175, 204);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76 && $pdf->GetStringWidth(utf8_decode($datos[0]->email))>76){
                                $pdf->RoundedRect($margin, $height + 10, $width - 14, 27.5, 2, '1234', 'D');
                            }else{
                                $pdf->RoundedRect($margin, $height + 10, $width - 14, 26, 2, '1234', 'D');
                            }
                            
                            $pdf->SetXY($margin, $height + 12.5);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell($width / 4, 5, utf8_decode('RUC:'), 0, 2, 'L', 0);
                            $head_ruc=$pdf->GetY();
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                $pdf->SetXY($margin, $head_ruc+1);
                            }
                            $pdf->Cell($width / 4, 5, utf8_decode('PROVEEDOR:'), 0, 2, 'L', 0);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                $pdf->SetXY($margin, 58);
                            }
                            $pdf->Cell($width / 4, 5, utf8_decode('ATENCIÃN:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('E-MAIL:'), 0, 2, 'L', 0);
                            $pdf->SetXY($width / 2, $height + 12.5);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell($width / 4, 5, utf8_decode('FECHA:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('CIUDAD:'), 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, utf8_decode('DIRECCIÃN:'), 0, 2, 'L', 0);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                $pdf->SetXY($width / 2, 63);
                            }
                            $pdf->Cell($width / 4, 5, utf8_decode('TELÃFONO:'), 0, 2, 'L', 0);

                            $pdf->SetXY(($width / 6) - $margin, $height + 12.5);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell($width / 4, 5, isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : 'identificacion', 0, 2, 'L', 0);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                $pdf->MultiCell(76, 3, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0,'L', 0);
                                $head_cliente=$pdf->GetY();
                            }else{
                                $pdf->Cell(76, 5, isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente', 0, 2, 'L', 0);
                            }
                            //dd($head_cliente);
                            //$pdf->MultiCell(75, 5, isset($datos[0]->cliente) ? utf8_decode('AGENCIA NACIONAL DE REGULACION Y CONTROL DEL TRANSPORTE TERRESTRE TRANSITO Y SEGURIDAD VIAL.'/*$datos[0]->cliente*/) : 'cliente', 1,'L');
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->cliente))>76){
                                $pdf->SetXY(($width / 6) - $margin,$head_cliente+0.5);
                            }else{
                                $pdf->SetX(($width / 6) - $margin);
                            }
                            
                            $pdf->Cell($width / 4, 5, utf8_decode($datos[0]->contacto), 0, 2, 'L', 0);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->email))>76){
                                $pdf->MultiCell(76, 3, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0,'L', 0);
                            }else{
                                $pdf->Cell(76, 5, isset($datos[0]->email) ? utf8_decode($datos[0]->email) : 'email', 0, 2, 'L', 0);
                            }
                            

                            $pdf->SetXY(($width / 6 * 4) - $margin, $height + 12.5);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell($width / 4, 5, isset($datos[0]->fecha_emision) ? date("d/m/Y",strtotime($datos[0]->fecha_emision)) : 'fecha_emision', 0, 2, 'L', 0);
                            $pdf->Cell($width / 4, 5, isset($datos[0]->ciudad) ? utf8_decode($datos[0]->ciudad) : 'ciudad', 0, 2, 'L', 0);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                $pdf->MultiCell(66, 3, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0,'L', 0);
                                $head_dir=$pdf->GetY();
                            }else{
                                $pdf->Cell(66, 5, isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : 'direccion', 0, 2, 'L', 0);
                            }
                            //dd($head_dir);
                            if($pdf->GetStringWidth(utf8_decode($datos[0]->direccion))>66){
                                $pdf->SetXY(($width / 6 * 4) - $margin, $head_dir+0.5);
                            }
                            $pdf->Cell($width / 4, 5, isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : 'telefono', 0, 2, 'L', 0);
                            $pdf->Ln();

                            // MESSAGE
                            $pdf->SetXY($margin, $height + 45);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(20, 5, utf8_decode('APRECIADO PROVEEDOR:'), 0, 2, 'L', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(20, 5, utf8_decode('De acuerdo a su  solicitud nos permitimos enviar nuestra propuesta comercial:'), 0, 2, 'L', 0);
                            $pdf->SetFillColor(85, 175, 84);
                            $pdf->SetTextColor(0, 0, 255);
                            $pdf->SetDrawColor(0, 0, 0);
                            if (preg_match('/grupo solis/i', $datos[0]->nombre_empresa)) {
                                // SLOGAN
                                $pdf->SetXY($margin, $height + 55);
                                $pdf->SetFont('Helvetica', 'B', 10);
                                $pdf->MultiCell(200, 10, utf8_decode('EN GRUPO SOLIS NOS PREOCUPAMOS POR SU SEGURIDAD.'), 1, 'C', 1);
                                $height_products = $height + 65;
                            } else {
                                $height_products = $height + 60;
                            }
                            //cabecera de detalles de productos
                            $pdf->SetFont('Helvetica', 'B', 6);
                            // if($factura_info->id_empresa==1){
                            //     $pdf->SetFillColor(141, 207, 140);
                            // }else{
                                
                            // }
                            
                            $pdf->SetFillColor(141, 207, 240);
                            //dd("X=".$margin."Y=".$height_products);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetXY($margin, $height_products);
                            $pdf->SetXY($margin, $height_products);
                            $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                            $pdf->SetXY(30, $height_products);
                            $pdf->MultiCell(110, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                            //$pdf->SetXY(47, $height_products);
                            // $pdf->MultiCell(30, 8, utf8_decode('CARACTERÃSTICAS'), 1, 'C', 1);
                            // $pdf->SetXY(77, $height_products);
                            // $pdf->MultiCell(25, 8, utf8_decode('NORMATIVA'), 1, 'C', 1);
                            // $pdf->SetXY(102, $height_products);
                            // $pdf->MultiCell(21, 8, utf8_decode('USO'), 1, 'C', 1);
                            // $pdf->SetXY(123, $height_products);
                            // $pdf->MultiCell(12, 8, utf8_decode('MARCA'), 1, 'C', 1);
                            // $pdf->SetXY(135, $height_products);
                            // $pdf->MultiCell(12, 8, utf8_decode('UNIDAD'), 1, 'C', 1);
                            // $pdf->SetXY(147, $height_products);
                            // $pdf->MultiCell(12, 8, utf8_decode('TALLA'), 1, 'C', 1);
                            $pdf->SetXY(140, $height_products);
                            $pdf->MultiCell(19, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                            $pdf->SetXY(159, $height_products);
                            $pdf->MultiCell(20, 4, utf8_decode('VALOR UNITARIO'), 1, 'C', 1);
                            $pdf->SetXY(179, $height_products);
                            $pdf->MultiCell(22, 8, utf8_decode('VALOR TOTAL'), 1, 'C', 1);
                            // $pdf->SetXY(190, $height_products);
                            // $pdf->MultiCell(15, 4, utf8_decode('TIEMPO DE ENTREGA'), 1, 'C', 1);
                            //dd("X=".$margin."Y=".$height_products);
                            $y = $height_products + 8;
                            $pdf->SetFont('Helvetica', '', 4);
                            $pdf->SetFillColor(255, 255, 255);
                            $pdf->SetFillColor(85, 175, 84);
                            $pdf->SetXY($margin, $height_products+8);
                            $pdf->SetWidths(array(25, 110, 19, 20, 22));
                            //$logo = constant("DATA_EMPRESA") . "/" . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                            $imagen=constant("DATA_EMPRESA") . $factura_info->id_empresa .'/productos/';
                            //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                            $sub_total=0;
                            $descuento=0;
                            $iva=0;
                            $total_fact=0;
                            $suma_sub_total=0;
                            $suma_descuento=0;
                            $suma_iva=0;
                            $suma_total_fact=0;
                            foreach ($datos as $detail) {
                                $caract = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->caracteristicas);
                                $norm = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->normativa);
                                $uso = preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->uso);
                                $data = array(
                                    utf8_decode($detail->nombre),
                                    // utf8_decode($caract),
                                    // utf8_decode($norm),
                                    // utf8_decode($uso),
                                    // utf8_decode($detail->marca."Centrado"),
                                    // utf8_decode($detail->unidad_medida."Centrado"),
                                    // utf8_decode($detail->tipo_medida."Centrado"),
                                    utf8_decode($detail->cantidad."Centrado"),
                                    utf8_decode($detail->precio."Centrado"),
                                    utf8_decode($detail->total_pro."Derecha"),
                                    //utf8_decode($detail->total_pro."Derecha"),
                                    //utf8_decode('INMEDIATA'),
                                    
                                );
                                    $sub_total=$detail->subtotal;
                                    $descuento=$detail->descuento;
                                    $iva=$detail->iva;
                                    $total_fact=$detail->total;
                                if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                                //if ($detail->imagen) {
                                    array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                                } else {
                                    array_unshift($data, utf8_decode('* sin imagen'));
                                }
                                //dd("Imagen:".$imagen.$detail->imagen);
                                //$pdf->RowProductsGeneral($data, $margin+5);
                                $pdf->RowProductsGeneralImport($data, $margin+5);
                            }
                            
                            $suma_sub_total=number_format($sub_total,2,".",",");
                            $suma_descuento=number_format($descuento,2,".",",");
                            $suma_iva=number_format($iva,2,".",",");
                            $suma_total_fact=number_format($total_fact,2,".",",");
                            $pdf->SetXY(140, $pdf->GetY());
                            $pdf->SetX(140);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(39, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                            $pdf->Cell(22, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                            $pdf->SetX(140);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(39, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                            $pdf->Cell(22, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                            $pdf->SetX(140);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(39, 7, utf8_decode('IVA (12%)'), 1, 0, 'C', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                            $pdf->Cell(22, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                            $pdf->SetX(140);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(39, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(22, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                            $pdf->Ln();
                            
                            // if($factura_info->id_empresa==1){
                            //     $pdf->SetDrawColor(85, 175, 84);
                            // }else{
                            //     $pdf->SetDrawColor(141, 207, 240);
                            // }
                            $pdf->SetDrawColor(141, 207, 240);
                            $pdf->SetX(5);
                            $pdf->SetFont('Helvetica', 'BU', 9);
                            $pdf->Cell(200, 6, utf8_decode('CONDICIONES COMERCIALES'), 'T', 1, 'L', 0);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->SetX(5);
                            $pdf->Cell(50, 6, utf8_decode('PERIODO INICIO:'), 0, 0, 'L', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(150, 6, date("d/m/Y",strtotime($factura_info->fecha_inicio)), 0, 1, 'L', 0);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->SetX(5);
                            $pdf->Cell(50, 6, utf8_decode('PERIODO FIN:'), 0, 0, 'L', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(150, 6, date("d/m/Y",strtotime($factura_info->fecha_expiracion)), 0, 1, 'L', 0);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->SetX(5);
                            $pdf->Cell(50, 6, utf8_decode('FECHA EMBARQUE:'), 0, 0, 'L', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->MultiCell(146, 6, date("d/m/Y",strtotime($factura_info->fech_embarque)), 0,'L');
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->SetX(5);
                            $pdf->Cell(50, 6, utf8_decode('FECHA ARRIBO:'), 'B', 0, 'L', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(150, 6, date("d/m/Y",strtotime($factura_info->fech_arribo)), 'B', 1, 'L', 0);
                            $pdf->Ln();

                            $pdf->SetX(5);
                            $pdf->SetFont('Helvetica', 'B', 8);
                            $pdf->Cell(25, 6, utf8_decode('Elaborado por:'), 0, 0, 'L', 0);
                            $pdf->SetFont('Helvetica', '', 8);
                            $pdf->Cell(75, 6, isset($datos[0]->vendedor) ? utf8_decode($datos[0]->vendedor) : 'vendedor', 0, 0, 'L', 0);
                            $pdf->SetTextColor(0, 0, 0);
                            $pdf->SetFont('Helvetica', '', 9);
                            $pdf->Cell(100, 6, utf8_decode('Le invitamos a revisar nuestra pÃ¡gina web.'), 0, 1, 'R', 0);
                            
                            $pdf->SetTextColor(0, 0, 255);
                        
                            
                            $pdf->SetX(30);
                            $pdf->SetFont('Helvetica', 'U', 8);
                            $pdf->Cell(120, 6, isset($datos[0]->mailvendedor) ? utf8_decode($datos[0]->mailvendedor) : 'mailvendedor', 0, 0, 'L', 0);
                            // if($factura_info->id_empresa==1){
                            //     $pdf->SetTextColor(4, 255, 0);
                            // }else{
                            //     $pdf->SetTextColor(0, 0, 255);
                            // }
                            $pdf->SetTextColor(0, 0, 255);
                            $pdf->SetFont('', 'U', 9);
                            $pdf->Write(6, utf8_decode($factura_info->urlweb), utf8_decode($factura_info->urlweb));
                            $current_date = date("Y-m-d");
                            //dd($ruta);
                            if (!$generar_en_servidor) {
                                return $pdf->Output(isset($datos[0]->identificacion) ? "importacion-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                            } else if ($generar_en_servidor && !is_null($ruta)) {
                                if (file_exists($ruta)) {
                                    $name = $id . '.pdf';
                                    $location = $ruta . "/" . $name;
                                    $pdf->Output("F", $location);
                                    return json_encode(
                                        array(
                                            "location" => $location,
                                            "name" => $name)
                                    );
                                } else {
                                    throw new Exception("No se pudo generar la proforma");
                                }

                            } else if ($generar_en_servidor && is_null($ruta)) {
                                throw new Exception("La ruta para la proforma no es valida.");
                            }
                        }
                    }
                }
            }else{
                //dd($factura_info);
                $pdf->SetLeftMargin(30);

                #Establecemos el margen inferior:
                $pdf->SetAutoPageBreak(true,25); 
                //$pdf->AddPage();
                $logo = constant("DATA_EMPRESA")  . $factura_info->id_empresa . '/imagen/' . $datos[0]->logo;
                $pdf->SetLeftMargin(30);
                $pdf->SetAutoPageBreak(1, 4);
                $pdf->AddPage();
                $width = $pdf->GetPageWidth();
                //$pdf->Rect(7.5, 7.5, $pdf->GetPageWidth()-15,$pdf->GetPageHeight()-15,'D');
                $pdf->SetLeftMargin(30);
                $pdf->Image($logo,15, 15, 55, 20);
                $pdf->SetXY(($width / 2) - 20,15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(113,5,'Empresa: '.utf8_decode($datos[0]->nombre_empresa),0,1,'L');
                //$pdf->Cell(96,5,isset($datos[0]->nombre_empresa) ? utf8_decode($datos[0]->nombre_empresa) : '',0,1,'R');
                $pdf->SetXY($pdf->GetPageWidth()-28,20);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(14,5,'RUC:'.$datos[0]->ruc_empresa,0,1,'R');
                $pdf->SetXY($pdf->GetPageWidth()-144,25);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(130,5,utf8_decode('DirecciÃ³n:').utf8_decode($datos[0]->direccion_empresa),0,1,'R');
                $pdf->SetXY($pdf->GetPageWidth()-54,30);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(40,5,utf8_decode('TelÃ©fono:').$factura_info->telefono,0,1,'R');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(35,5,isset($datos[0]->ruc_empresa) ? utf8_decode($datos[0]->ruc_empresa) : '',0,1,'L');
                $pdf->SetXY(95,50);
                $pdf->SetFont('Helvetica', 'B', 10);
                $pdf->Cell(20,3,utf8_decode('IMPORTACION NÂ°').$id_proforma,0,0,'C');
                $margin = 15;
                $height = $pdf->GetY();
                $pdf->SetXY(15,75);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(17,5,'Proveedor:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(96,5,isset($datos[0]->cliente) ? utf8_decode($datos[0]->cliente) : 'cliente',0,0,'L');
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(14,5,'RUC:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(35,5,isset($datos[0]->identificacion) ? utf8_decode($datos[0]->identificacion) : '',0,1,'L');
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(17,5,'DIR:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(96,5,isset($datos[0]->direccion) ? utf8_decode($datos[0]->direccion) : '',0,0,'L');
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(14,5,'TLF:',0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(35,5,isset($datos[0]->telefono) ? utf8_decode($datos[0]->telefono) : '',0,1,'L');
                // $pdf->SetX(15);
                
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(17,5,'Proveedor: ',0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(96,5,isset($datos[0]->nombre_empresa) ? utf8_decode($datos[0]->nombre_empresa) : '',0,0,'L');
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(14,5,'RUC:',0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(35,5,isset($datos[0]->ruc_empresa) ? utf8_decode($datos[0]->ruc_empresa) : '',0,1,'L');
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(17,5,utf8_decode('Fecha:'),0,0,'L');
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(93,5,strftime("%d de %B del %Y", strtotime($datos[0]->fecha_emision)),0,1,'L');
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(27,5,utf8_decode('Fecha Vencimiento:'),0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(88,5,strftime("%d de %B del %Y", strtotime($factura_info->fecha_expiracion)),0,1,'L');
                // $pdf->SetX(15);
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(17,5,utf8_decode('DirecciÃ³n:'),0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(96,5,isset($datos[0]->direccion_empresa) ? utf8_decode($datos[0]->direccion_empresa) : '',0,0,'L');
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(14,5,utf8_decode('TelÃ©fono:'),0,0,'L');
                // $pdf->SetFont('Helvetica', '', 8);
                // $pdf->Cell(38,5,isset($factura_info->telefono) ? utf8_decode($factura_info->telefono) : '',0,1,'L');
                $height_products = $height + 55;
                $pdf->Ln(15);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetTextColor(0, 0, 0);
                $pdf->Cell(10,8,utf8_decode('ÃTEM'),1,0,'C');
                $pdf->Cell(78,8,utf8_decode('DESCRIPCIÃN'),1,0,'C');
                $pdf->Cell(18,4,utf8_decode('TIEMPO'),'LRT',1,'C');
                $get_x2=$pdf->GetX();
                $get_y2=$pdf->GetY();
                $pdf->SetXY($get_x2+73,$get_y2);
                $pdf->Cell(18,4,utf8_decode('ENTREGA'),'LRB',0,'C');
                $pdf->SetXY($get_x2+91,$get_y2-4);
                $pdf->Cell(18,8,utf8_decode('CANTIDAD'),1,0,'C');
                $pdf->Cell(28,4,utf8_decode('PRECIO'),'LRT',1,'C');
                $get_x=$pdf->GetX();
                $get_y=$pdf->GetY();
                $pdf->SetXY($get_x+109,$get_y);
                $pdf->Cell(28,4,utf8_decode('UNITARIO'),'LRB',0,'C');
                $pdf->SetXY($get_x+137,$get_y-4);
                $pdf->Cell(28,8,utf8_decode('TOTAL'),1,0,'C');
                $pdf->Ln();
                $y = $height_products+8;
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(85, 175, 84);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(10, 78, 18, 18, 28, 28, 28));
                $sub_total=0;
                $descuento=0;
                $iva=0;
                $total_fact=0;
                $suma_sub_total=0;
                $suma_descuento=0;
                $suma_iva=0;
                $suma_total_fact=0;
                $item=0;
                foreach ($datos as $detail) {
                    $item++;
                    $data = array(
                        utf8_decode($item."Centrado"),
                        utf8_decode($detail->nombre),
                        utf8_decode($detail->tiempo_entrega."Centrado"),
                        utf8_decode($detail->cantidad."Centrado"),
                        utf8_decode("$ ".$detail->precio."Derecha"),
                        utf8_decode("$ ".$detail->total_pro."Derecha"),
                        //utf8_decode('INMEDIATA'),
                        
                    );
                        $sub_total=$detail->subtotal;
                        $descuento=$detail->descuento;
                        $iva=$detail->iva;
                        $total_fact=$detail->total;
                        //array_unshift($data, utf8_decode('* sin imagen'));
                    //dd("Imagen:".$imagen.$detail->imagen);
                    $pdf->RowProducto($data, $margin);
                }
                $suma_sub_total=number_format($sub_total,2,".",",");
                $suma_descuento=number_format($descuento,2,".",",");
                $suma_iva=number_format($iva,2,".",",");
                $suma_total_fact=number_format($total_fact,2,".",",");
                $pdf->SetXY(135, $pdf->GetY());
                $pdf->SetX(139);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(28, 7, utf8_decode('SUBTOTAL'), 1, 0, 'C', 0);
                $pdf->SetFont('Helvetica', '', 8);
                //$pdf->Cell(20, 7, isset($datos[0]->subtotal) ? utf8_decode('$  ' . $datos[0]->subtotal) : 'subtotal', 1, 1, 'R', 0);
                $pdf->Cell(28, 7, isset($suma_sub_total) ? utf8_decode('$  ' . $suma_sub_total) : 'subtotal', 1, 1, 'R', 0);
                // $pdf->SetX(135);
                // $pdf->SetFont('Helvetica', 'B', 8);
                // $pdf->Cell(28, 7, utf8_decode('DESCUENTO'), 1, 0, 'C', 0);
                // $pdf->SetFont('Helvetica', '', 8);
                // //$pdf->Cell(20, 7, isset($datos[0]->descuento) ? utf8_decode('$  ' . $datos[0]->descuento) : 'descuento', 1, 1, 'R', 0);
                // $pdf->Cell(20, 7, isset($suma_descuento) ? utf8_decode('$  ' . $suma_descuento) : 'descuento', 1, 1, 'R', 0);
                $pdf->SetX(139);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(28, 7, utf8_decode('12% IVA'), 1, 0, 'C', 0);
                $pdf->SetFont('Helvetica', '', 8);
                //$pdf->Cell(20, 7, isset($datos[0]->iva) ? utf8_decode('$  ' . $datos[0]->iva) : 'iva', 1, 1, 'R', 0);
                $pdf->Cell(28, 7, isset($suma_iva) ? utf8_decode('$  ' . $suma_iva) : 'iva', 1, 1, 'R', 0);
                $pdf->SetX(139);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(28, 7, utf8_decode('TOTAL'), 1, 0, 'C', 0);
                $pdf->SetFont('Helvetica', '', 8);
                $pdf->Cell(28, 7, isset($suma_total_fact) ? utf8_decode('$  ' . $suma_total_fact) : 'total', 1, 1, 'R', 0);
                $pdf->Ln(15);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('ObservaciÃ³n: '.$factura_info->observacion), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('Fecha Validez: '.strftime("%d de %B del %Y", strtotime($factura_info->fecha_expiracion))), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('Forma Pago: '.$factura_info->forma_pago), 0, 1, 'L', 0);
                $pdf->Ln(5);
                $pdf->SetX(15);
                $pdf->SetFont('Helvetica', 'B', 8);
                $pdf->Cell(190, 5,utf8_decode('Atentamente,'), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->Cell(190, 5,utf8_decode($datos[0]->vendedor.'.'), 0, 1, 'L', 0);
                $pdf->SetX(15);
                $pdf->Cell(190, 5,utf8_decode($datos[0]->nombre_empresa.'.'), 0, 1, 'L', 0);
                $pdf->SetXY(15,-25);
                $pdf->Cell(170, 5,utf8_decode('DirecciÃ³n: ').utf8_decode($datos[0]->direccion_empresa).' Telf.: '.$datos[0]->telefono, 0, 1, 'R', 0);
                $pdf->SetX(15);
                $pdf->Cell(170, 5,utf8_decode($datos[0]->mailvendedor).' - '.utf8_decode($factura_info->urlweb), 0, 1, 'R', 0);
                $pdf->SetX(15);
                $pdf->Cell(170, 5,ucwords(strtolower($datos[0]->ciudad)).' - Ecuador', 0, 1, 'R', 0);
                $width = $pdf->GetPageWidth();
                $current_date = date("Y-m-d");
                if (!$generar_en_servidor) {
                    return $pdf->Output(isset($datos[0]->identificacion) ? "importacion-" . $datos[0]->identificacion . "-" . $current_date . ".pdf" : 'no-data.pdf', "D");
                } else if ($generar_en_servidor && !is_null($ruta)) {
                    if (file_exists($ruta)) {
                        $name = $id . '.pdf';
                        $location = $ruta . "/" . $name;
                        $pdf->Output("F", $location);
                        return json_encode(
                            array(
                                "location" => $location,
                                "name" => $name)
                        );
                    } else {
                        throw new Exception("No se pudo generar la proforma");
                    }

                } else if ($generar_en_servidor && is_null($ruta)) {
                    throw new Exception("La ruta para la proforma no es valida.");
                }
            }
        }
        
    }
    public function ListaPrecioPdf($datos,$empresa,$marca,$modelo,$presentacion,$linea_prod,$tipo_prod){
        setlocale(LC_TIME, "spanish");
        ini_set('memory_limit','200M');
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $width = $pdf->GetPageWidth();
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $url=constant("DATA_EMPRESA");
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa.'/imagen/'.$empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            $pdf->Image($logo,  12, 11, 40, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(0, 0, 0);
        }
        
        //$pdf->Image($url.'/'.$empresa->id_empresa.'/imagen/'.$empresa->logo, 12, 11, 40, 18);
        $pdf->SetFont('Arial', 'B', 14);
        $head_emp=0;
        $emp_sin_img=strpos($empresa->nombre_empresa,'SUMIPAN');
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>110){
            $pdf->SetXY(48, 12);
            $pdf->MultiCell(111,4,utf8_decode($empresa->nombre_empresa),0,'C');
            $head_emp=$pdf->GetY();
         }else{
             $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)) / 2), 12);
             $pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)), 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
             $head_emp=$pdf->GetY()-1;
         }
        //$pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)) / 2), 12);
        //$pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)), 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Lista de Precios')) / 2), $head_emp-2);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode('Lista de Precios')), 8,utf8_decode('Lista de Precios'), 0, 2, 'C', 0);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth('') / 2), 22);
        $pdf->Cell($pdf->GetStringWidth(''), 8, '', 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $array_cabecera=[];
        $nombre_marca=$marca?utf8_decode("Marca: ".$marca):'';
        $nombre_modelo=$modelo?utf8_decode("Modelo: ".$modelo):'';
        $nombre_presentacion=$presentacion?utf8_decode("Presentacion: ".$presentacion):'';
        $nombre_linea_prod=$linea_prod?utf8_decode("Linea Producto: ".$linea_prod):'';
        $nombre_tipo_prod=$tipo_prod?utf8_decode("Tipo Producto: ".$tipo_prod):'';
        if($nombre_linea_prod){
            array_push($array_cabecera,$nombre_linea_prod);
        }
        if($nombre_tipo_prod){
            array_push($array_cabecera,$nombre_tipo_prod);
        }
        if($nombre_marca){
            array_push($array_cabecera,$nombre_marca);
        }
        if($nombre_modelo){
            array_push($array_cabecera,$nombre_modelo);
        }
        if($nombre_presentacion){
            array_push($array_cabecera,$nombre_presentacion);
        }
        
        $array_cabecera=implode(" , ",$array_cabecera);
        $pdf->SetXY(($width / 6) * 4.5, 11.5);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "Fecha:", 0, 2, 'L', 0);
        //$pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) * 5, 11.5);
        // $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        //if ($fecha_ini != null) {
            //$fec_desde = date("d/m/Y", strtotime($datos[0]->fecha_reguistro));
            //$fec_hasta = date("d/m/Y", strtotime($datos[0]->fecha_conciliacion));
        //}
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($fecha_actual), 5, $fecha_actual, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_desde), 5, $fec_desde, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_hasta), 5, $fec_hasta, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($pdf->PageNo() . ' de {nb}'), 5, $pdf->PageNo() . ' de {nb}' , 0, 2, 'L', 0);
        $pdf->Ln();
        $pdf->SetFont('Arial', 'B', 9);
        $pdf->SetX(10);
        $pdf->MultiCell(190, 6, $array_cabecera, 0, 'C', 0);
        $margin = 10;
        $height = $pdf->GetY();
        $height_products = $height + 5;
        $pdf->SetFillColor(141, 207, 140);
                $pdf->SetXY($margin, $height_products);
                $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                $pdf->SetXY(35, $height_products);
                $pdf->MultiCell(15, 8, utf8_decode('CODIGO'), 1, 'C', 1);
                $pdf->SetXY(50, $height_products);
                // $pdf->MultiCell(15, 8, utf8_decode('ID'), 1, 'C', 1);
                // $pdf->SetXY(65, $height_products);
                $pdf->MultiCell(75, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                $pdf->SetXY(125, $height_products);
                $pdf->MultiCell(15, 8, utf8_decode('PVP1'), 1, 'C', 1);
                $pdf->SetXY(140, $height_products);
                $pdf->MultiCell(15, 8, utf8_decode('PVP2'), 1, 'C', 1);
                $pdf->SetXY(155, $height_products);
                $pdf->MultiCell(15, 8, utf8_decode('PVP3'), 1, 'C', 1);
                $pdf->SetXY(170, $height_products);
                $pdf->MultiCell(15, 8, utf8_decode('PVP4'), 1, 'C', 1);
                $pdf->SetXY(185, $height_products);
                $pdf->MultiCell(15, 8, utf8_decode('PVP5'), 1, 'C', 1);
                //dd("X=".$margin."Y=".$height_products);
                $y = $height_products + 8;
                $pdf->SetFont('Helvetica', '', 4);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(25, 15, 75,15,15,15,15,15));
                $imagen=constant("DATA_EMPRESA") . $empresa->id_empresa .'/productos/';
                //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                $sub_total=0;
                $descuento=0;
                $iva=0;
                $total_fact=0;
                $suma_sub_total=0;
                $suma_descuento=0;
                $suma_iva=0;
                $suma_total_fact=0;
                $array_productos_sin_imagen=[];
                foreach ($datos as $detail) {
                    $data = array(
                        $detail->cod_alterno!==null?utf8_decode(trim($detail->cod_alterno)."Centrado"):utf8_decode(trim($detail->cod_principal)."Centrado"),
                        //utf8_decode(trim($detail->id_producto)."Centrado"),
                        utf8_decode(trim($detail->nombre)."Centrado"), 
                        $detail->pvp_precio1?utf8_decode('$ '.trim($detail->pvp_precio1)."Derecha"):'', 
                        $detail->precio2?utf8_decode('$ '.trim($detail->precio2)."Derecha"):'',
                        $detail->precio3?utf8_decode('$ '.trim($detail->precio3)."Derecha"):'',
                        $detail->precio4?utf8_decode('$ '.trim($detail->precio4)."Derecha"):'',
                        $detail->precio5?utf8_decode('$ '.trim($detail->precio5)."Derecha"):'',     
                     );
                    
                    if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                    //if ($detail->imagen) {
                        //dd($pdf->GetY());
                        
                            try{
                                if($emp_sin_img!==false){
                                    array_unshift($data, '* sin imagen ');
                                }else{
                                    array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                                }
                                
                            }catch(Exception $e){
                                array_unshift($data, "");
                            }
                                
                            
                        
                        
                    } else {
                        if($detail->imagen){
                            array_push($array_productos_sin_imagen, utf8_decode('* sin imagen desde producto - '.$detail->imagen));
                            array_unshift($data, utf8_decode('* sin imagen '."Centrado"));
                        }else{
                            array_unshift($data, utf8_decode('* sin imagen '."Centrado"));
                        }
                       
                    }

                    //dd("Imagen:".$imagen.$detail->imagen);
                    $pdf->RowProducts($data, $margin+10);
                    $head_table=$pdf->GetY();
                }
                //print_r($array_productos_sin_imagen);
                $pdf->Output('lista_precio.pdf', "D");
    }
    public function PDFInventario($datos,$bodega,$empresa){
        setlocale(LC_TIME, "spanish");
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $width = $pdf->GetPageWidth();
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $url=constant("DATA_EMPRESA");
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa.'/imagen/'.$empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            $pdf->Image($logo,  12, 11, 40, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(0, 0, 0);
        }
        
        $pdf->Image($url.'/'.$empresa->id_empresa.'/imagen/'.$empresa->logo, 12, 11, 40, 18);
        $pdf->SetFont('Arial', 'B', 14);
        $head_emp=0;
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>110){
            $pdf->SetXY(48, 12);
            $pdf->MultiCell(111,4,utf8_decode($empresa->nombre_empresa),0,'C');
            $head_emp=$pdf->GetY();
         }else{
             $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)) / 2), 12);
             $pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)), 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
             $head_emp=$pdf->GetY()-1;
         }
        //$pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)) / 2), 12);
        //$pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)), 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Inventario')) / 2), $head_emp-2);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode('Inventario')), 8,utf8_decode('Inventario'), 0, 2, 'C', 0);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($bodega[0]->nombre)) / 2), 22);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode($bodega[0]->nombre)), 8, utf8_decode($bodega[0]->nombre), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        
        $pdf->SetXY(($width / 6) * 4.5, 11.5);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "Fecha:", 0, 2, 'L', 0);
        //$pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) * 5, 11.5);
        // $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        //if ($fecha_ini != null) {
            //$fec_desde = date("d/m/Y", strtotime($datos[0]->fecha_reguistro));
            //$fec_hasta = date("d/m/Y", strtotime($datos[0]->fecha_conciliacion));
        //}
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($fecha_actual), 5, $fecha_actual, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_desde), 5, $fec_desde, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_hasta), 5, $fec_hasta, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($pdf->PageNo() . ' de {nb}'), 5, $pdf->PageNo() . ' de {nb}' , 0, 2, 'L', 0);
        $pdf->Ln();
        $pdf->SetFont('Arial', 'B', 9);
        $pdf->SetX(10);
        //$pdf->MultiCell(190, 6, $array_cabecera, 0, 'C', 0);
        $margin = 10;
        $height = $pdf->GetY();
        $height_products = $height + 5;
        $pdf->SetFillColor(141, 207, 140);
                $pdf->SetXY($margin, $height_products);
                // $pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
                // $pdf->SetXY(35, $height_products);
                $pdf->MultiCell(15, 8, utf8_decode('CODIGO'), 1, 'C', 1);
                $pdf->SetXY(25, $height_products);
                // $pdf->MultiCell(15, 8, utf8_decode('ID'), 1, 'C', 1);
                // $pdf->SetXY(65, $height_products);
                $pdf->MultiCell(61.5, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                $pdf->SetXY(86.5, $height_products);
                $pdf->MultiCell(61.5, 8, utf8_decode('DESCRIPCION'), 1, 'C', 1);
                $pdf->SetXY(148, $height_products);
                $pdf->MultiCell(20, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                $pdf->SetXY(168, $height_products);
                $pdf->MultiCell(15, 8, utf8_decode('PRECIO'), 1, 'C', 1);
                $pdf->SetXY(183, $height_products);
                $pdf->MultiCell(17, 8, utf8_decode('TOTAL'), 1, 'C', 1);
                //dd("X=".$margin."Y=".$height_products);
                $y = $height_products + 8;
                $pdf->SetFont('Helvetica', '', 4);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(15, 61.5,61.5,20,15,17));
                $imagen=constant("DATA_EMPRESA") . $empresa->id_empresa .'/productos/';
                //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                $sub_total=0;
                $descuento=0;
                $iva=0;
                $total_fact=0;
                $suma_sub_total=0;
                $suma_descuento=0;
                $suma_iva=0;
                $suma_total_fact=0;
                $array_productos_sin_imagen=[];
                $cantidad_total=0;
                $costo_uni_total=0;
                $costo_total=0;
                foreach ($datos as $detail) {
                    $descrip=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);
                    $data = array(
                        utf8_decode(trim($detail->cod_principal)."Centrado"),
                        //utf8_decode(trim($detail->id_producto)."Centrado"),
                        utf8_decode(trim($detail->nombrep)."Centrado"), 
                        utf8_decode($descrip."Centrado"), 
                        trim($detail->cantidad)."Centrado",
                        "$ ".number_format($detail->costo_unitario,2,".",",")."Derecha",
                        "$ ".number_format($detail->costo_total,2,".",",")."Derecha",     
                     );
                    
                    // if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                    // //if ($detail->imagen) {
                    //     //dd($pdf->GetY());
                        
                    //         try{
                    //             array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                    //         }catch(Exception $e){
                    //             array_unshift($data, "");
                    //         }
                                
                            
                        
                        
                    // } else {
                    //     if($detail->imagen){
                    //         array_push($array_productos_sin_imagen, utf8_decode('* sin imagen desde producto - '.$detail->imagen));
                    //         array_unshift($data, utf8_decode('* sin imagen '."Centrado"));
                    //     }else{
                    //         array_unshift($data, utf8_decode('* sin imagen '."Centrado"));
                    //     }
                       
                    // }

                    //dd("Imagen:".$imagen.$detail->imagen);
                    $pdf->RowProductsInventario($data, $margin+10);
                    $head_table=$pdf->GetY();
                    $cantidad_total+=$detail->cantidad;
                    $costo_uni_total+=$detail->costo_unitario;
                    $costo_total+=$detail->costo_total;
                }
                $pdf->SetXY(10,$pdf->GetY());
                $pdf->SetFont('Helvetica', 'B', 6);
                $pdf->Cell(140, 8,utf8_decode('Total Inventario'), 0, 0, 'C', 0);
                $pdf->Cell(20, 8,$cantidad_total, 0, 0, 'R', 0);
                $pdf->Cell(15, 8,number_format($costo_uni_total,2,".",","), 0, 0, 'R', 0);
                $pdf->Cell(15, 8,number_format($costo_total,2,".",","), 0, 1, 'R', 0);
                //print_r($array_productos_sin_imagen);
                $pdf->Output('inventario '.utf8_decode($bodega[0]->nombre).'.pdf', "D");
    }
    public function ReporteInventario($datos,$bodega,$empresa,$array_cabecera, $fecha){
        setlocale(LC_TIME, "spanish");
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y", strtotime($fecha));
        $width = $pdf->GetPageWidth();
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $pdf->SetAutoPageBreak(true,5);
        $url=constant("DATA_EMPRESA");
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa.'/imagen/'.$empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            $pdf->Image($logo,  12, 11, 40, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(0, 0, 0);
        }
        
        //$pdf->Image($url.'/'.$empresa->id_empresa.'/imagen/'.$empresa->logo, 12, 11, 40, 18);
        $pdf->SetFont('Arial', 'B', 14);
        $head_emp=0;
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>110){
            $pdf->SetXY(48, 12);
            $pdf->MultiCell(111,4,utf8_decode($empresa->nombre_empresa),0,'C');
            $head_emp=$pdf->GetY();
         }else{
             $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)) / 2), 12);
             $pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)), 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
             $head_emp=$pdf->GetY()-1;
         }
        //$pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)) / 2), 12);
        //$pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)), 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Inventario')) / 2), $head_emp-2);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode('Inventario')), 8,utf8_decode('Inventario'), 0, 2, 'C', 0);
        // $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($bodega[0]->nombre)) / 2), 22);
        // $pdf->Cell($pdf->GetStringWidth(utf8_decode($bodega[0]->nombre)), 8, utf8_decode($bodega[0]->nombre), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        
        $pdf->SetXY(($width / 6) * 4.5, 11.5);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "Fecha:", 0, 2, 'L', 0);
        //$pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) * 5, 11.5);
        // $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        //if ($fecha_ini != null) {
            //$fec_desde = date("d/m/Y", strtotime($datos[0]->fecha_reguistro));
            //$fec_hasta = date("d/m/Y", strtotime($datos[0]->fecha_conciliacion));
        //}
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($fecha_actual), 5, $fecha_actual, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_desde), 5, $fec_desde, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_hasta), 5, $fec_hasta, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($pdf->PageNo() . ' de {nb}'), 5, $pdf->PageNo() . ' de {nb}' , 0, 2, 'L', 0);
        $pdf->Ln();
        $pdf->SetFont('Arial', 'B', 9);
        $pdf->SetX(10);
        $cantidad_total=0;
        $costo_uni_total=0;
        $costo_total=0;
        if(strlen($array_cabecera)>0){
            $pdf->MultiCell(190, 6, $array_cabecera, 0, 'C', 0);
            
        }
        
        foreach ($bodega as $detail0){
            $id_bodega=$detail0->id_bodega;
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->SetX(10);
            $pdf->MultiCell(190, 8, utf8_decode($detail0->nombre), 0, 'C', 0);
            // if(){

            // }
                $margin = 10;
                $height = $pdf->GetY();
                $height_products = $height;
                $pdf->SetFillColor(141, 207, 140);
                $pdf->SetXY($margin, $height_products);
                //$pdf->MultiCell(25, 8, utf8_decode('IMAGEN'), 1, 'C', 1);
               // $pdf->SetXY(35, $height_products);
                $pdf->MultiCell(15, 8, utf8_decode('CODIGO'), 1, 'C', 1);
                $pdf->SetXY(25, $height_products);
                // $pdf->MultiCell(15, 8, utf8_decode('ID'), 1, 'C', 1);
                // $pdf->SetXY(65, $height_products);
                $pdf->MultiCell(57.5, 8, utf8_decode('PRODUCTO'), 1, 'C', 1);
                $pdf->SetXY(82.5, $height_products);
                $pdf->MultiCell(57.5, 8, utf8_decode('DESCRIPCION'), 1, 'C', 1);
                $pdf->SetXY(140, $height_products);
                $pdf->MultiCell(20, 8, utf8_decode('CANTIDAD'), 1, 'C', 1);
                $pdf->SetXY(160, $height_products);
                $pdf->MultiCell(20, 8, utf8_decode('PRECIO'), 1, 'C', 1);
                $pdf->SetXY(180, $height_products);
                $pdf->MultiCell(20, 8, utf8_decode('TOTAL'), 1, 'C', 1);
                //dd("X=".$margin."Y=".$height_products);
                $y = $height_products + 8;
                $pdf->SetFont('Helvetica', '', 4);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetFillColor(255, 255, 255);
                $pdf->SetXY($margin, $height_products+8);
                $pdf->SetWidths(array(15, 57.5,57.5,20,20,20));
                $imagen=constant("DATA_EMPRESA") . $empresa->id_empresa .'/productos/';
                //$pdf->Image($imagen.$datos[0]->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25);
                $sub_total=0;
                $descuento=0;
                $iva=0;
                $total_fact=0;
                $suma_sub_total=0;
                $suma_descuento=0;
                $suma_iva=0;
                $suma_total_fact=0;
                $array_productos_sin_imagen=[];
                $exist_cod_alterno=0;
                if($empresa->nombre_empresa=='C.E. FUEGOS GROUP' || $empresa->nombre_empresa=='C.E.FUEGOS SYSTEM' || $empresa->nombre_empresa=='C.E. FUEGOS'){
                    $exist_cod_alterno=1;
                }
                //dd($datos);
                foreach ($datos as $detail) {
                    if($id_bodega==$detail->id_bodega){
                        $descrip=preg_replace(array('/\s{2,}/', '/[\t\n]/'), ' ', $detail->descripcion);
						$detail->nombrep = $detail->nombre_producto;
                        $data = array(
                            $detail->cod_alterno!==null?utf8_decode(trim($detail->cod_alterno)."Centrado"):utf8_decode(trim($detail->cod_principal)."Centrado"),
                            //utf8_decode(trim($detail->id_producto)."Centrado"),
                            utf8_decode(trim($detail->nombrep)."Centrado"), 
                            utf8_decode($descrip."Centrado"), 
                            $empresa->nombre_empresa=='CORTINAS DLUXE'?trim($detail->cantidad)."Centrado":trim($detail->cantidad)."Centrado",
                            $empresa->nombre_empresa=='CORTINAS DLUXE'?"$ ".number_format($detail->costo_unitario,4,".",",")."Derecha":"$ ".number_format($detail->costo_unitario,2,".",",")."Derecha",
                            $empresa->nombre_empresa=='CORTINAS DLUXE'?"$ ".number_format($detail->costo_total,4,".",",")."Derecha":"$ ".number_format($detail->costo_total,2,".",",")."Derecha",     
                        );
                        
                        // if ($detail->imagen && file_exists($imagen.$detail->imagen)) {
                        // //if ($detail->imagen) {
                        //     //dd($pdf->GetY());
                            
                        //         try{
                        //             array_unshift($data, $pdf->Image($imagen.$detail->imagen, $pdf->GetX(), $pdf->GetY(), 25, 25));
                        //         }catch(Exception $e){
                        //             array_unshift($data, "");
                        //         }
                                    
                                
                            
                            
                        // } else {
                        //     if($detail->imagen){
                        //         array_push($array_productos_sin_imagen, utf8_decode('* sin imagen desde producto - '.$detail->imagen));
                        //         array_unshift($data, utf8_decode('* sin imagen '."Centrado"));
                        //     }else{
                        //         array_unshift($data, utf8_decode('* sin imagen '."Centrado"));
                        //     }
                        
                        // }

                        //dd("Imagen:".$imagen.$detail->imagen);
                        $pdf->RowProductsInventario($data, $margin+10);
                        $head_table=$pdf->GetY();
                        $cantidad_total+=$detail->cantidad;
                        $costo_uni_total+=$detail->costo_unitario;
                        $costo_total+=$detail->costo_total;
                    }
                    
                }
            $pdf->Ln();
        }
        
                //print_r($array_productos_sin_imagen);
                $nombre_bodega="";
                if(count($bodega)==1){
                    $nombre_bodega=$bodega[0]->nombre;
                }
                $head_total_prod=$pdf->GetY()-2;
                $pdf->SetXY(10,$head_total_prod);
                $pdf->SetFont('Helvetica', 'B', 9);
                $pdf->MultiCell(130, 8,utf8_decode('Total Inventario'), 1, 'C', 0);
                $pdf->SetXY(140,$head_total_prod);

                if($empresa->nombre_empresa=='CORTINAS DLUXE'){
                    if($pdf->GetStringWidth($cantidad_total)>20){
                        $pdf->MultiCell(20, 4,$cantidad_total, 1, 'R', 0);
                        $pdf->SetXY(160,$head_total_prod);
                    }else{
                        $pdf->MultiCell(20, 8,$cantidad_total, 1, 'R', 0);
                        $pdf->SetXY(160,$head_total_prod);
                    }
                    if($pdf->GetStringWidth("$ ".number_format($costo_uni_total,2,".","."))>20){
                        $pdf->MultiCell(20, 4,"$ ".number_format($costo_uni_total,2,".","."), 1, 'R', 0);
                        $pdf->SetXY(180,$head_total_prod);
                    }else{
                        $pdf->MultiCell(20, 8,"$ ".number_format($costo_uni_total,2,".","."), 1, 'R', 0);
                        $pdf->SetXY(180,$head_total_prod);
                    }
                    if($pdf->GetStringWidth("$ ".number_format($costo_total,2,".","."))>20){
                        $pdf->MultiCell(20, 4,"$ ".number_format($costo_total,2,".","."), 1,  'R', 0);
                    }else{
                        $pdf->MultiCell(20, 8,"$ ".number_format($costo_total,2,".","."), 1,  'R', 0);
                    }
                    
                }else{
                    if($pdf->GetStringWidth($cantidad_total)>20){
                        $pdf->MultiCell(20, 4,$cantidad_total, 1, 'R', 0);
                        $pdf->SetXY(160,$head_total_prod);
                    }else{
                        $pdf->MultiCell(20, 8,$cantidad_total, 1, 'R', 0);
                        $pdf->SetXY(160,$head_total_prod);
                    }
                    if($pdf->GetStringWidth("$ ".number_format($costo_uni_total,2,".","."))>20){
                        $pdf->MultiCell(20, 4,"$ ".number_format($costo_uni_total,2,".","."), 1, 'R', 0);
                        $pdf->SetXY(180,$head_total_prod);
                    }else{
                        $pdf->MultiCell(20, 8,"$ ".number_format($costo_uni_total,2,".","."), 1, 'R', 0);
                        $pdf->SetXY(180,$head_total_prod);
                    }
                    if($pdf->GetStringWidth("$ ".number_format($costo_total,2,".","."))>20){
                        $pdf->MultiCell(20, 4,"$ ".number_format($costo_total,2,".","."), 1,  'R', 0);
                    }else{
                        $pdf->MultiCell(20, 8,"$ ".number_format($costo_total,2,".","."), 1,  'R', 0);
                    }
                }
                // $pdf->Cell(130, 8,utf8_decode('Total Inventario'), 1, 0, 'C', 0);
                // $pdf->Cell(20, 8,$cantidad_total, 1, 0, 'R', 0);
                // if($empresa->nombre_empresa=='CORTINAS DLUXE'){
                //     $pdf->Cell(20, 8,"$ ".number_format($costo_uni_total,4,".","."), 1, 0, 'R', 0);
                //     $pdf->Cell(20, 8,"$ ".number_format($costo_total,4,".","."), 1, 1, 'R', 0);
                // }else{
                //     $pdf->Cell(20, 8,"$ ".number_format($costo_uni_total,2,".","."), 1, 0, 'R', 0);
                //     $pdf->Cell(20, 8,"$ ".number_format($costo_total,2,".","."), 1, 1, 'R', 0);
                // }
                

                $pdf->Output('reporte inventario '.utf8_decode($nombre_bodega).'.pdf', "D");
    }

    public function asiento()
    {
        $pdf = new FPDF('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y H:i:s");
        $pdf->AddPage();
        $pdf->AliasNbPages();

        //$pdf->Cell(20);
        $pdf->SetXY(20, 15);
        //$pdf->Image('../server/'.$id_empresa.'/imagen/'.$imagen, null, null, 80, 30);

        //variables de empresa que emite
        $emp_dir_sucursal = '';
        $emp_contri_especial = '';

        //cuadros detalle empresa que emite
        $pdf->RoundedRect(10, 40, 98, 30, 2, '1234', 'D');
        $pdf->Ln(30);
        $pdf->SetXY(10, 41);
        $pdf->SetFont('Helvetica', 'B', 10);
        $pdf->Cell(96, 6, utf8_decode($document->infoTributaria->razonSocial), 0, 2, 'C', 0);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(22, 5, utf8_decode('DirecciÃ³n Matriz: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(29, 5, utf8_decode($document->infoTributaria->dirMatriz), 0, 1, 'L', 0);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(25, 5, utf8_decode('DirecciÃ³n Sucursal: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(23, 5, utf8_decode($emp_dir_sucursal), 0, 1, 'L', 0);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(36, 5, utf8_decode('Contribuyente Especial Nro.: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(29, 5, utf8_decode($emp_contri_especial), 0, 1, 'L', 0);
        $pdf->SetFont('Helvetica', 'B', 7);
        if ($document->infoCompRetencion->obligadoContabilidad == 'SI') {

            $contabilidad = "Obligado a llevar contabilidad : SI";
        } else {
            $contabilidad = "Obligado a llevar contabilidad : NO";
        }
        $pdf->Cell(39, 5, utf8_decode('Obligado A Llevar Contabilidad: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(29, 5, utf8_decode($contabilidad), 0, 2, 'L', 0);

        $pdf->SetXY(111, 38);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(45, 5, utf8_decode('FECHA Y HORA DE AUTORIZACION: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(30, 5, $fecha_actual, 0, 1, 'L', 0);
        $pdf->SetXY(111, 42);
        $pdf->SetFont('Helvetica', 'B', 7);
        if ($document->infoTributaria->ambiente == 2) {
            $ambiente = 'PRODUCCION';
        } else {
            $ambiente = 'PRUEBAS';
        }
        $pdf->Cell(16, 5, utf8_decode('AMBIENTE: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(58, 5, utf8_decode($ambiente), 0, 1, 'L', 0);
        $pdf->SetXY(111, 46);
        $pdf->SetFont('Helvetica', 'B', 7);
        if ($document->infoTributaria->tipoEmision == 1) {
            $emision = 'NORMAL';
        } else {
            $emision = 'NORMAL';
        }
        $pdf->Cell(13, 5, utf8_decode('EMISIÃN: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(88, 5, utf8_decode($emision), 0, 1, 'L', 0);
        $pdf->SetXY(111, 50);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(88, 5, utf8_decode('CLAVE DE ACCESO'), 0, 2, 'C', 0);
        $this->generarCodigoBarras($claveAcceso, $id_empresa);
        $pdf->image('../server/' . $id_empresa . '/comprobantes/retencion/codigosbarras/codigo_' . $claveAcceso . '.png', null, null, 100, 20);
        $pdf->SetXY(111, 65);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(88, 5, $claveAcceso, 0, 2, 'C', 0);
        //cuadro detalle factura
        $pdf->SetXY(111, 11);
        $pdf->SetFont('Helvetica', '', 12);
        $pdf->RoundedRect(110, 10, 90, 60, 2, '1234', 'D');
        $pdf->Cell(88, 6, utf8_decode('R.U.C: ') . $document->infoTributaria->ruc, 0, 2, 'C', 0);
        $pdf->SetFont('Helvetica', 'B', 12);
        $pdf->Cell(88, 6, utf8_decode('COMPROBANTE DE RETENCIÃN'), 0, 2, 'C', 0);
        $pdf->Cell(88, 6, utf8_decode('No. ') . $document->infoTributaria->estab . $document->infoTributaria->ptoEmi . $document->infoTributaria->secuencial, 0, 2, 'C', 0);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(88, 5, utf8_decode('NUMERO DE AUTORIZACION: '), 0, 2, 'C', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(88, 5, utf8_decode($claveAcceso), 0, 2, 'C', 0);
        $pdf->SetFont('Helvetica', 'B', 7);

        //cuadro de datos del cliente
        $pdf->SetXY(10, 73);
        $pdf->SetFont('Helvetica', '', 8);
        $pdf->RoundedRect(10, 72, 190, 12, 2, '1234', 'D');
        $pdf->Cell(110, 5, utf8_decode('RazÃ³n Social / Nombres y Apellidos: ' . $document->infoCompRetencion->razonSocialSujetoRetenido), 0, 0, 'L', 0);
        $pdf->Cell(29, 5, utf8_decode('IdentificaciÃ³n: ' . $document->infoCompRetencion->identificacionSujetoRetenido), 0, 1, 'L', 0);
        $pdf->Cell(110, 5, utf8_decode('Fecha de EmisiÃ³n: ' . $document->infoCompRetencion->fechaEmision), 0, 0, 'L', 0);

        //tabla de productos
        $pdf->SetXY(10, 86);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Helvetica', 'B', 8);
        //header de tabla
        $pdf->MultiCell(25, 8, utf8_decode('Comprobante'), 1, 'C', 1);
        $pdf->SetXY(35, 86);
        $pdf->MultiCell(30, 8, utf8_decode('NÃºmero'), 1, 'C', 1);
        $pdf->SetXY(65, 86);
        $pdf->MultiCell(25, 8, utf8_decode('Fecha EmisiÃ³n'), 1, 'C', 1);
        $pdf->SetXY(90, 86);
        $pdf->MultiCell(20, 4, utf8_decode('Ejercicio Fiscal'), 1, 'C', 1);
        $pdf->SetXY(110, 86);
        $pdf->MultiCell(25, 8, utf8_decode('Base Imponible'), 1, 'C', 1);
        $pdf->SetXY(135, 86);
        $pdf->MultiCell(20, 8, utf8_decode('Impuesto'), 1, 'C', 1);
        $pdf->SetXY(155, 86);
        $pdf->MultiCell(20, 4, utf8_decode('Porcentaje de RetenciÃ³n'), 1, 'C', 1);
        $pdf->SetXY(175, 86);
        $pdf->MultiCell(25, 8, utf8_decode('Valor Retenido'), 1, 'C', 1);
        //$pdf->Ln();

        //rellenado de campos

        $pdf->SetFont('Helvetica', '', 8);
        $total = 0;
        foreach ($document->impuestos->impuesto as $a => $b) {
            if ($b->codDocSustento = '01') {
                $pdf->Cell(25, 6, 'FACTURA', 1, 0, "L", 0);
            } else {
                $pdf->Cell(25, 6, $b->codDocSustento, 1, 0, "L", 0);
            }
            $pdf->Cell(30, 6, $b->codDocSustento, 1, 0, 'R', 0);
            $pdf->Cell(25, 6, $b->fechaEmisionDocSustento, 1, 0, 'C', 0);
            $pdf->Cell(20, 6, date("Y"), 1, 0, 'C', 0);
            $pdf->Cell(25, 6, $b->baseImponible, 1, 0, 'R', 0);
            if ($b->codigo == 1) {
                $pdf->Cell(20, 6, 'IVA', 1, 0, 'L', 0);
            } else if ($b->codigo == 2) {
                $pdf->Cell(20, 6, 'RENTA', 1, 0, 'L', 0);
            } else {
                $pdf->Cell(20, 6, $b->codigo, 1, 0, "L", 0);
            }
            $pdf->Cell(20, 6, $b->porcentajeRetener . "%", 1, 0, 'R', 0);
            $pdf->Cell(25, 6, $b->valorRetenido, 1, 0, 'R', 0);
            $pdf->Ln();
            $total += floatval($b->valorRetenido);
        }
        $infoAdicional = "";
        $correo = "";
        foreach ($document->infoAdicional->campoAdicional as $a) {
            foreach ($a->attributes() as $b) {
                if ($b == 'Email' || $b == 'email' || $b == '=correo' || $b == 'Correo') {
                    $correo = $a;
                    $infoAdicional .= $b . ': ' . $a . "\n";
                } else {
                    $infoAdicional .= $b . ': ' . $a . "\n";
                }
            }
        }
        $pdf->Ln(2);
        $pdf->SetFont('Helvetica', 'B', 8);
        $pdf->Cell(125, 6, utf8_decode('InformaciÃ³n Adicional'), 1, 0, 'L', 0);
        $pdf->Cell(40, 6, 'Total', 'LTB', 0, 'R', 0);
        $pdf->Cell(25, 6, number_format(floatval($total), 2), 'TBR', 1, 'R', 0);
        $pdf->SetFont('Helvetica', '', 8);
        $pdf->Cell(125, 6, utf8_decode('Correo: ' . $correo), 'LR', 2, 'L', 0);
        $pdf->Cell(125, 6, utf8_decode('Observaciones: ' . $infoAdicional), 'LR', 2, 'L', 0);
        $pdf->Cell(125, 6, utf8_decode('Retencion aplicada a la factura No.: ' . $b->codDocSustento), 'LBR', 2, 'L', 0);

        $pdf->Output('../server/' . $id_empresa . '/comprobantes/retencion/' . $claveAcceso . '.pdf', 'F');
        $email = new sendEmail();
        $email->enviarCorreo('Comprobante de Retencion', $document->infoCompRetencion->razonSocialSujetoRetenido, $claveAcceso, $correo, $id_empresa);
        //$pdf->Output("ejemplo.pdf", "I");
    }
    public function generarCodigoBarras($claveAcceso, $id_empresa) {
        $colorFront = new BCGColor(0, 0, 0);
        $colorBack = new BCGColor(255, 255, 255);
        $code = new BCGcode128();
        $code->setScale(4);
        $code->setThickness(30);
        $code->setForegroundColor($colorFront);
        $code->setBackgroundColor($colorBack);
        $code->parse($claveAcceso);
        $drawing = new BCGDrawing(constant("DATA_EMPRESA").$id_empresa.'/comprobantes/retencion/codigosbarras/codigo'.$claveAcceso.'.jpg', $colorBack);
        $drawing->setBarcode($code);
        $drawing->draw();
        $drawing->finish(BCGDrawing::IMG_FORMAT_JPEG);
        $this->redim(constant("DATA_EMPRESA").$id_empresa.'/comprobantes/retencion/codigosbarras/codigo'.$claveAcceso.'.jpg', constant("DATA_EMPRESA").$id_empresa.'/comprobantes/factura/codigosbarras/codigo_'.$claveAcceso.'.jpg', 1000, 200);
    }
    public function redim($ruta1, $ruta2, $ancho, $alto) {
        # se obtene la dimension y tipo de imagen 
        $datos = getimagesize($ruta1);

        $ancho_orig = $datos[0]; # Anchura de la imagen original 
        $alto_orig = $datos[1];    # Altura de la imagen original 
        $tipo = $datos[2];

        if ($tipo == 1) { # GIF 
            if (function_exists("imagecreatefromgif"))
                $img = imagecreatefromgif($ruta1);
            else
                return false;
        }
        else if ($tipo == 2) { # JPG 
            if (function_exists("imagecreatefromjpeg"))
                $img = imagecreatefromjpeg($ruta1);
            else
                return false;
        }
        else if ($tipo == 3) { # PNG 
            if (function_exists("imagecreatefrompng"))
                $img = imagecreatefrompng($ruta1);
            else
                return false;
        }

        # Se calculan las nuevas dimensiones de la imagen 
        if ($ancho_orig > $alto_orig) {
            $ancho_dest = $ancho;
            $alto_dest = ($ancho_dest / $ancho_orig) * $alto_orig;
        } else {
            $alto_dest = $alto;
            $ancho_dest = ($alto_dest / $alto_orig) * $ancho_orig;
        }

        // imagecreatetruecolor, solo estan en G.D. 2.0.1 con PHP 4.0.6+ 
        $img2 = @imagecreatetruecolor($ancho_dest, $alto_dest) or $img2 = imagecreate($ancho_dest, $alto_dest);

        // Redimensionar 
        // imagecopyresampled, solo estan en G.D. 2.0.1 con PHP 4.0.6+ 
        @imagecopyresampled($img2, $img, 0, 0, 0, 0, $ancho_dest, $alto_dest, $ancho_orig, $alto_orig) or imagecopyresized($img2, $img, 0, 0, 0, 0, $ancho_dest, $alto_dest, $ancho_orig, $alto_orig);

        // Crear fichero nuevo, segÃºn extensiÃ³n. 
        if ($tipo == 1) // GIF 
            if (function_exists("imagegif"))
                imagegif($img2, $ruta2);
            else
                return false;

        if ($tipo == 2) // JPG 
            if (function_exists("imagejpeg"))
                imagejpeg($img2, $ruta2);
            else
                return false;

        if ($tipo == 3)  // PNG 
            if (function_exists("imagepng"))
                imagepng($img2, $ruta2);
            else
                return false;

        return true;
    }
    public function PdfRetencionFacturaCompra($empresa,$factura_compra,$detalle_fact,$ruta=null)
    {
        $pdf = new FPDF('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y H:i:s");
        $pdf->AddPage();
        $pdf->AliasNbPages();

        //$pdf->Cell(20);
        $pdf->SetXY(20, 15);
        $pdf->Image(constant("DATA_EMPRESA").$empresa->id_empresa.'/imagen/'.$empresa->logo, 20, 8, 75, 30);

        //variables de empresa que emite
        $emp_dir_sucursal = '';
        $emp_contri_especial = '';

        //cuadros detalle empresa que emite
        $pdf->RoundedRect(10, 40, 98, 30, 2, '1234', 'D');
        $pdf->Ln(30);
        $pdf->SetXY(10, 41);
        $pdf->SetFont('Helvetica', 'B', 10);
        $pdf->Cell(96, 6, utf8_decode($empresa->razon_social), 0, 2, 'C', 0);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(22, 5, utf8_decode('DirecciÃ³n Matriz: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(29, 5, utf8_decode($empresa->direccion_empresa), 0, 1, 'L', 0);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(25, 5, utf8_decode('DirecciÃ³n Sucursal: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(23, 5, utf8_decode($emp_dir_sucursal), 0, 1, 'L', 0);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(36, 5, utf8_decode('Contribuyente Especial Nro.: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(29, 5, utf8_decode($emp_contri_especial), 0, 1, 'L', 0);
        $pdf->SetFont('Helvetica', 'B', 7);
        if ($empresa->obligado_contabilidad == 1) {

            $contabilidad = "Obligado a llevar contabilidad : SI";
        } else {
            $contabilidad = "Obligado a llevar contabilidad : NO";
        }
        $pdf->Cell(39, 5, utf8_decode('Obligado A Llevar Contabilidad: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(29, 5, utf8_decode($contabilidad), 0, 2, 'L', 0);

        $pdf->SetXY(111, 38);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(45, 5, utf8_decode('FECHA Y HORA DE AUTORIZACION: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(30, 5, $fecha_actual, 0, 1, 'L', 0);
        $pdf->SetXY(111, 42);
        $pdf->SetFont('Helvetica', 'B', 7);
        if ($empresa->ambiente == 2) {
            $ambiente = 'PRODUCCION';
        } else {
            $ambiente = 'PRUEBAS';
        }
        $pdf->Cell(16, 5, utf8_decode('AMBIENTE: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(58, 5, utf8_decode($ambiente), 0, 1, 'L', 0);
        $pdf->SetXY(111, 46);
        $pdf->SetFont('Helvetica', 'B', 7);
        if ($empresa->tipo_emision == 1) {
            $emision = 'NORMAL';
        } else {
            $emision = 'NORMAL';
        }
        $pdf->Cell(13, 5, utf8_decode('EMISIÃN: '), 0, 0, 'L', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(88, 5, utf8_decode($emision), 0, 1, 'L', 0);
        $pdf->SetXY(111, 50);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(88, 5, utf8_decode('CLAVE DE ACCESO'), 0, 2, 'C', 0);
        $this->generarCodigoBarras($factura_compra->observacion, $empresa->id_empresa);
        $pdf->Image(constant("DATA_EMPRESA"). $empresa->id_empresa . '/comprobantes/retencion/codigosbarras/codigo' . $factura_compra->observacion . '.jpg', null, null, 88, 11);
        $pdf->SetXY(111, 65 );
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(88, 5, $factura_compra->observacion, 0, 2, 'C', 0);
        //cuadro detalle factura
        $pdf->SetXY(111, 11);
        $pdf->SetFont('Helvetica', '', 12);
        $pdf->RoundedRect(110, 10, 90, 60, 2, '1234', 'D');
        $pdf->Cell(88, 6, utf8_decode('R.U.C: ') . $empresa->ruc_empresa, 0, 2, 'C', 0);
        $serie1=substr($factura_compra->descripcion,0,3);
        $serie2=substr($factura_compra->descripcion,3,3);
        $documento=substr($factura_compra->descripcion,6,15);
        $serie3=substr($factura_compra->observacion,24,3);
        $serie4=substr($factura_compra->observacion,27,3);
        $documento2=substr($factura_compra->observacion,30,9);
        
        $pdf->SetFont('Helvetica', 'B', 12);
        $pdf->Cell(88, 6, utf8_decode('COMPROBANTE DE RETENCIÃN'), 0, 2, 'C', 0);
        $pdf->Cell(88, 6, utf8_decode('No. ') . $serie3 ."-". $serie4 ."-". $documento2, 0, 2, 'C', 0);
        $pdf->SetFont('Helvetica', 'B', 7);
        $pdf->Cell(88, 5, utf8_decode('NUMERO DE AUTORIZACION: '), 0, 2, 'C', 0);
        $pdf->SetFont('Helvetica', '', 7);
        $pdf->Cell(88, 5, utf8_decode($factura_compra->observacion), 0, 2, 'C', 0);
        $pdf->SetFont('Helvetica', 'B', 7);

        //cuadro de datos del cliente
        $pdf->SetXY(10, 73);
        $pdf->SetFont('Helvetica', '', 8);
        $pdf->RoundedRect(10, 72, 190, 17, 2, '1234', 'D');
        $pdf->Cell(110, 5, utf8_decode('RazÃ³n Social / Nombres y Apellidos: ' . $factura_compra->nombre_proveedor), 0, 0, 'L', 0);
        $pdf->Cell(110, 5, utf8_decode('IdentificaciÃ³n:        ' ).$factura_compra->identif_proveedor, 0, 1, 'L', 0);
        $pdf->Cell(110, 5, utf8_decode('DirecciÃ³n:                                           ' . $factura_compra->direccion_prov), 0, 0, 'L', 0);
        $pdf->Cell(39, 5, utf8_decode('Correo:                  '. $factura_compra->email) , 0, 1, 'L', 0);
        $pdf->Cell(110, 5, utf8_decode('TelÃ©fono:                                            ' ).$factura_compra->telefono_prov, 0, 0, 'L', 0);
        $pdf->Cell(29, 5, utf8_decode('Fecha de EmisiÃ³n:' ).date("d/m/Y",strtotime($factura_compra->fech_emision)), 0, 1, 'L', 0);
        
        //tabla de productos
        $pdf->SetXY(10, 91);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Helvetica', 'B', 8);
        //header de tabla
        $pdf->MultiCell(25, 8, utf8_decode('Comprobante'), 1, 'C', 1);
        $pdf->SetXY(35, 91);
        $pdf->MultiCell(30, 8, utf8_decode('NÃºmero'), 1, 'C', 1);
        $pdf->SetXY(65, 91);
        $pdf->MultiCell(25, 8, utf8_decode('Fecha EmisiÃ³n'), 1, 'C', 1);
        $pdf->SetXY(90, 91);
        $pdf->MultiCell(20, 4, utf8_decode('Ejercicio Fiscal'), 1, 'C', 1);
        $pdf->SetXY(110, 91);
        $pdf->MultiCell(25, 8, utf8_decode('Base Imponible'), 1, 'C', 1);
        $pdf->SetXY(135, 91);
        $pdf->MultiCell(20, 8, utf8_decode('Impuesto'), 1, 'C', 1);
        $pdf->SetXY(155, 91);
        $pdf->MultiCell(20, 4, utf8_decode('Porcentaje de RetenciÃ³n'), 1, 'C', 1);
        $pdf->SetXY(175, 91);
        $pdf->MultiCell(25, 8, utf8_decode('Valor Retenido'), 1, 'C', 1);
        //$pdf->Ln();

        //rellenado de campos

        $pdf->SetFont('Helvetica', '', 8);
        $total = 0;
        $exist_iva=0;
        $exist_renta=0;
        foreach ($detalle_fact as $detail) {
            if($detail->porcentajeiva>0){
                $exist_iva++; 
            }
            if($detail->baserenta>0){
                $exist_renta++;
            }
        }
        
        if($exist_iva>0){
            foreach ($detalle_fact as $detail) {
                $pdf->Cell(25, 6, 'FACTURA', 1, 0, "C", 0);
                // } else {
                //     $pdf->Cell(25, 6, $b->codDocSustento, 1, 0, "L", 0);
                // }
                $poc_iva=floatval($detail->porcentajeiva);
                $pdf->Cell(30, 6, $serie1 ."-". $serie2 ."-". $documento, 1, 0, 'R', 0);
                $pdf->Cell(25, 6, date("d/m/Y",strtotime($detail->fech_emision)), 1, 0, 'C', 0);
                $pdf->Cell(20, 6, date("Y"), 1, 0, 'C', 0);
                if($detail->cantidadiva>0){
                    $pdf->Cell(25, 6, number_format(($detail->cantidadiva)/($poc_iva/100),2,".",","), 1, 0, 'R', 0);
                }else{
                    $pdf->Cell(25, 6, number_format(0,2,".",","), 1, 0, 'R', 0);
                }
                
                // if ($b->codigo == 1) {
                //     $pdf->Cell(20, 6, 'IVA', 1, 0, 'L', 0);
                // } else if ($b->codigo == 2) {
                $pdf->Cell(20, 6, 'IVA', 1, 0, 'C', 0);
                // } else {
                //     $pdf->Cell(20, 6, $b->codigo, 1, 0, "L", 0);
                // }
                $pdf->Cell(20, 6, $detail->porcentajeiva, 1, 0, 'R', 0);
                $pdf->Cell(25, 6, number_format($detail->cantidadiva,2,".",","), 1, 0, 'R', 0);
                $pdf->Ln();
            }
        }
        
        if($exist_renta>0){
            foreach ($detalle_fact as $detail) {
                //if ($b->codDocSustento = '01') {
                
                $pdf->Cell(25, 6, 'FACTURA', 1, 0, "C", 0);
                // } else {
                //     $pdf->Cell(25, 6, $b->codDocSustento, 1, 0, "L", 0);
                // }
                $pdf->Cell(30, 6, $serie1 ."-". $serie2 ."-". $documento, 1, 0, 'R', 0);
                $pdf->Cell(25, 6, date("d/m/Y",strtotime($detail->fech_emision)), 1, 0, 'C', 0);
                $pdf->Cell(20, 6, date("Y"), 1, 0, 'C', 0);
                $pdf->Cell(25, 6, $detail->baserenta, 1, 0, 'R', 0);
                // if ($b->codigo == 1) {
                //     $pdf->Cell(20, 6, 'IVA', 1, 0, 'L', 0);
                // } else if ($b->codigo == 2) {
                $pdf->Cell(20, 6, 'RENTA', 1, 0, 'C', 0);
                // } else {
                //     $pdf->Cell(20, 6, $b->codigo, 1, 0, "L", 0);
                // }
                $pdf->Cell(20, 6, $detail->porcentajerenta, 1, 0, 'R', 0);
                $pdf->Cell(25, 6, $detail->cantidadrenta, 1, 0, 'R', 0);
                $pdf->Ln();
                
                
            }
        }
        foreach ($detalle_fact as $detail) {
            $total += floatval($detail->cantidadrenta+$detail->cantidadiva);
        }
        $infoAdicional = "";
        $correo = "";
        // foreach ($document->infoAdicional->campoAdicional as $a) {
        //     foreach ($a->attributes() as $b) {
        //         if ($b == 'Email' || $b == 'email' || $b == '=correo' || $b == 'Correo') {
        //             $correo = $a;
        //             $infoAdicional .= $b . ': ' . $a . "\n";
        //         } else {
        //             $infoAdicional .= $b . ': ' . $a . "\n";
        //         }
        //     }
        // }
        if($factura_compra->telefono_prov){
            $infoAdicional .= utf8_decode('Telefono: '). $factura_compra->telefono_prov  . "\n";
            if($factura_compra->direccion_prov){
                $infoAdicional .= utf8_decode('Direccion: ') . $factura_compra->direccion_prov . "\n";
            }
        }
        $pdf->Ln(2);
        $pdf->SetFont('Helvetica', 'B', 8);
        $pdf->Cell(125, 6, "", 0, 0, 'L', 0);
        $pdf->Cell(40, 6, 'Total', 1, 0, 'C', 0);
        $pdf->Cell(25, 6, number_format(floatval($total), 2), 1, 1, 'R', 0);
        $pdf->SetFont('Helvetica', '', 8);
        // $pdf->Cell(125, 6, utf8_decode('Correo: ' . $factura_compra->email), 'LR', 2, 'L', 0);
        // $pdf->Cell(125, 6, utf8_decode('Observaciones: ' .$infoAdicional ), 'LR', 2, 'L', 0);
        $pdf->Cell(125, 6, "", 0, 2, 'L', 0);
       // "cuenta_por_cobrar_Cliente.pdf", "D"
        //$pdf->Output('../server/' . $id_empresa . '/comprobantes/retencion/' . $claveAcceso . '.pdf', 'F');
        //$pdf->Output('../server/' . $id_empresa . '/comprobantes/retencion/' . $claveAcceso . '.pdf', 'F');
        
        if($ruta==null){
            $pdf->Output("retencion_".$factura_compra->observacion.".pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."retencion_".$factura_compra->observacion.".pdf", "F");
        }
        //$pdf->Output("ejemplo.pdf", "I");
    }

    public function cuentasPorCobrar($datos,$reporte_valores_pagado, $fec_ini, $fec_fin,$empresa,$ruta=null)
    {
        //dd("FEcha inicial=".$fec_ini."Fecha fin=".$fec_fin);
        //$pdf = new FPDF('P', 'mm', 'A4');
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $pdf->AddPage();
        $pdf->AliasNbPages();

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 16);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(60, 10);
        $pdf->Cell(105, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        //$pdf->Cell(105, 8, utf8_decode('CUENTAS POR COBRAR'), 0, 2, 'C', 0);
        $pdf->Cell(105, 8, utf8_decode('CUENTAS POR COBRAR'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(105, 4, utf8_decode('Cliente'), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        /*if ($fec_ini != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else */
        //if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        /*} else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }*/
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);

        //HEADER FOR TABLE
        /*$pdf->SetY(40);
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(30, 6, 'IDENTIFICACION', 1, 0, 'C', 0);
        $pdf->Cell(95, 6, 'CLIENTE', 1, 0, 'C', 0);
        // $pdf->Cell(25, 5, 'SALDO ANTERIOR', 1, 0, 'C', 1);
        //$pdf->Cell(25, 5, '', 1, 0, 'C', 0);
        $pdf->Cell(20, 6, 'VENTAS', 1, 0, 'C', 0);
        $pdf->Cell(20, 6, 'ABONOS', 1, 0, 'C', 0);
        $pdf->Cell(25, 6, 'SALDO ACTUAL', 1, 0, 'C', 0);
        $pdf->Ln();*/
        $pdf->SetX(10);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 8);
        $margin = 10;
            $height = 40;
            $height_products = $height +2;
            $pdf->SetXY($margin, $height_products);
            $pdf->MultiCell(30, 6, 'IDENTIFICACION', 1, 'C', 0);
            $pdf->SetXY(40, $height_products);
            $pdf->MultiCell(95, 6, 'CLIENTE', 1, 'C', 0);
            $pdf->SetXY(135, $height_products);
            $pdf->MultiCell(20, 6, 'VENTAS', 1, 'C', 0);
            $pdf->SetXY(155, $height_products);
            $pdf->MultiCell(20, 6, 'ABONOS', 1, 'C', 0);
            $pdf->SetXY(175, $height_products);
            $pdf->MultiCell(25, 6, 'SALDO ACTUAL', 1, 'C', 0);
            $y = $height_products + 8;
            $pdf->SetFont('Helvetica', '', 4);
            $pdf->SetFillColor(255, 255, 255);
            $pdf->SetFillColor(255, 255, 255);
            $pdf->SetXY($margin, $height_products+6);
            $pdf->SetWidths(array(30,95,20,20,25));

        //fill cells
        $tsant = 0;
        $tdebe = 0;
        $thaber = 0;
        $tsactual = 0;
        $id_prov=0;
        $suma_total_abono=0;
        $total_saldo=0;
        //$pdf->SetY(38);
        foreach ($datos as $detail) {
            // $pdf->SetFont('Arial', '', 7);
            // $pdf->Cell(30, 6, $detail->identificacion, 1, 0, 'C', 0);
            // $pdf->Cell(95, 6, utf8_decode($detail->nombre), 1, 0, 'L', 0);
            // // $pdf->Cell(25, 4, $detail->saldo_anterior, 0, 0, 'R', 1);
            // //$pdf->Cell(25, 4, '', 0, 0, 'R', 1);
            // $pdf->Cell(20, 6, $detail->valor_cuota, 1, 0, 'C', 0);
            // $pdf->Cell(20, 6, $detail->valor_pago, 1, 0, 'C', 0);
            // $pdf->Cell(25, 6, $detail->descuento, 1, 0, 'C', 0);
            // $pdf->Ln();
            $id_prov=$detail->id_cliente;
            $valor_pago=0;
            foreach($reporte_valores_pagado as $detail2){
                if($detail2->id_cliente==$id_prov){
                    $valor_pago=$detail2->valor_pagado;
                }
            }
            $suma=0;
            $suma=$detail->valor_cuota-$valor_pago;
            $data = array(
                $detail->identificacion."Centrado",
                utf8_decode($detail->nombre),
                number_format($detail->valor_cuota,2,".",",")."Derecha",
                number_format($valor_pago,2,".",",")."Derecha",
                number_format($suma,2,".",",")."Derecha"
            );
            $tsant = $detail->valor_cuota + $tsant;
            $tdebe = $detail->valor_cuota + $tdebe;
            $thaber = $valor_pago + $thaber;
            $tsactual = $suma + $tsactual;
            $pdf->RowCtas($data, $margin);
            $suma_total_abono+=$valor_pago;
            $total_saldo +=$suma;
            $suma=0;
            $valor_pago=0;
        }

        //footer
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(125, 6, 'TOTAL:', 'T', 0, 'C', 1);
        // $pdf->Cell(25, 6, $tsant, 'T', 0, 'R', 1);
        //$pdf->Cell(25, 6, '', 'T', 0, 'R', 1);
        $pdf->Cell(20, 6, number_format(floatval($tdebe),2), 'T', 0, 'R', 1);
        $pdf->Cell(20, 6, number_format(floatval($thaber),2), 'T', 0, 'R', 1);
        $pdf->Cell(25, 6, number_format(floatval($tsactual),2), 'T', 0, 'R', 1);

        //$pdf->Output("cuentas-por-cobrar.pdf", "D");
        if($ruta==null){
            $pdf->Output("cuenta_por_cobrar_Cliente.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."cuenta_por_cobrar_Cliente.pdf", "F");
        }
    }
    public function orden_compra($datos,$fec_ini, $fec_fin){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);
        
        //$pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if ($datos[0]->logo && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        $pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('ORDEN COMPRA'), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        /*if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {*/
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        /*} else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }*/
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        //$pdf->SetXY(80,40);
        $id_prov="";
        $serie1="";
        $serie2="";
        $documento="";
        $resta=0;
        $resta_total=0;
        $fecha_emision="";
        $fecha_vencimiento="";
        $total_factura=0;
        $total_abono=0;
        $total_saldo=0;
        $suma_factura=0;
        $suma_abono=0;
        $suma_saldo=0;
        $id_fact="";
        $no_doc="";
        $fecha_pag="";
        $totales_factura=0;
        $suma_totales_factura=0;
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 7);
                    
        $pdf->Cell(33, 6, 'Identificacion', 1, 0, 'C', 0);
        $pdf->Cell(33, 6, 'Proveedor', 1, 0, 'C', 0);
        $pdf->Cell(31, 6, 'Fecha Emision', 1, 0, 'C', 0);
        //$pdf->Cell(25, 6, 'Fecha Vencimiento', 1, 0, 'C', 0);
        $pdf->Cell(31, 6, 'Fecha Validez', 1, 0, 'C', 0);
        $pdf->Cell(31, 6, 'Forma Pago', 1, 0, 'C', 0);
        //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
        $pdf->Cell(31, 6, 'ToTal Factura', 1, 0, 'C', 0);
                    //$pdf->Cell(35, 6, 'Saldos', 1, 0, 'C', 1);
        $pdf->Ln();
        foreach($datos as $detail){
            $pdf->SetX(10);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', '', 7);
            $pdf->Cell(33, 6, $detail->identif_proveedor, 1, 0, 'C', 0);
            $pdf->Cell(33, 6, $detail->nombre_proveedor, 1, 0, 'L', 0);
            $pdf->Cell(31, 6, $detail->fech_emision, 1, 0, 'C', 0);
            //$pdf->Cell(25, 6, 'Fecha Vencimiento', 1, 0, 'C', 0);
            $pdf->Cell(31, 6, $detail->fech_validez, 1, 0, 'C', 0);
            $pdf->Cell(31, 6, $detail->descripcion, 1, 0, 'C', 0);
            //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
            $pdf->Cell(31, 6, $detail->total_factura, 1, 0, 'C', 0);
            $pdf->Ln();
        }
        $pdf->Output("ORDEN_COMPRA.pdf", "D");
    }

    public function check_list_reporte($reporte, $fec_ini, $fec_fin, $vendedores,$empresa)
    {
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $pdf->SetFont('Arial', 'B', 8);
        // $logo = constant("DATA_EMPRESA") . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        // if (($datos[0]->logo!==null || $datos[0]->logo!=="") && file_exists($logo)) {
        //     $pdf->Image($logo, 12, 12, 55, 20);
        // } else {
        //     $pdf->SetTextColor(255, 0, 0);
        //     $pdf->SetFont('Arial', 'B', 020);
        //     $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        // }
        // $pdf->SetTextColor(0, 0, 0);
        // $pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        // $pdf->SetFont('Arial', 'B', 14);
        // $pdf->SetXY(70, 11);
        // //$pdf->Cell(155, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        // $pdf->MultiCell(155, 4, utf8_decode($datos[0]->nombre_empresa), 0, 'C');
        // $cab_emp=$pdf->GetY();
        // $pdf->SetXY(70, $cab_emp+1);
        // $pdf->SetFont('Arial', 'B', 12);
        // $modo == 1
        // ? $pdf->Cell(155, 8, utf8_decode('Reporte Cierre Caja'), 0, 2, 'C', 0)
        // : $pdf->Cell(155, 8, utf8_decode('Reporte de proformas'), 0, 2, 'C', 0);
        // $pdf->SetX(70);
        // if($nombre_producto!="" || $nombre_producto!=null){
        //     $pdf->MultiCell(155, 4, 'Producto: '.utf8_decode($nombre_producto), 0, 'C');
        // }else{
        //     $pdf->MultiCell(155, 4, utf8_decode($nombre_producto), 0, 'C');
        // }
        
        // //prueba
        // $pdf->SetXY(230, 11);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        // $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        // $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        // $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        // $pdf->SetXY(250, 11);
        // $pdf->SetFont('Arial', '', 8);
        // $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        // if ($fec_ini != null && $fec_fin == null) {
        //     $fec_desde = date("d/m/Y", strtotime($fec_ini));
        //     $fec_hasta = $fecha_actual;
        // } else if ($fec_ini != null && $fec_fin != null) {
        //     $fec_desde = date("d/m/Y", strtotime($fec_ini));
        //     $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        // } else {
        //     $fec_desde = $fecha_actual;
        //     $fec_hasta = $fecha_actual;
        // }
        // $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        // $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        // $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $pdf->RoundedRect(5, 10, 200, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa[0]->id_empresa . '/imagen/' . $empresa[0]->logo;
        if (strlen($empresa[0]->logo)>0 && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 7, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(25, 10);
        $pdf->Cell(155, 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('Check List'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode(''), 0, 2, 'C', 0);

        $pdf->SetXY(170, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(185, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        /*if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {*/
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        /*} else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }*/
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $pdf->Ln();
        $pdf->SetFont('Arial', 'B', 8);
        foreach($vendedores as $detail1){
            $pdf->SetFont('Arial', 'B', 8);
            $id_vd=$detail1->id_vendedor;
            $pdf->SetX(6);
            $pdf->MultiCell(200, 5, utf8_decode($detail1->nombre_vendedor), 0, 'L', 0);
            $pdf->SetX(6);
            $pdf->Cell(175, 5, "Producto", 1, 0, 'C', 0);
            $pdf->Cell(25, 5, "Cantidad", 1, 1, 'C', 0);
            $pdf->SetWidths(array(175,25));
            $cantidad_total=0;
            $pdf->SetFont('Arial', '', 7);
            foreach($reporte as $detail2){
                if($id_vd==$detail2->id_vendedor){
                    $pdf->SetX(6);
                    $cantidad_total+=$detail2->total_cantidad;
                    $data=array(
                        utf8_decode($detail2->nombre_producto),
                        $detail2->total_cantidad."Derecha"
                    );
                    $pdf->RowCheckList($data, 6);
                }
            }
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(175, 5, "TOTAL", 0, 0, 'C', 0);
            $pdf->Cell(25, 5, $cantidad_total, 0, 1, 'R', 0);
            
            $pdf->Ln(3);
        }
        

        $pdf->Output("reporte_check_list.pdf", "D");
    }

    public function cuenta_cobrar_reporte_detalle_factura($reporte_nuevo,$datos, $fec_ini, $fec_fin,$vencido,$proveedor,$referencia,$vencido_referencia,$empresa,$reporte_ctas,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        //$pdf->SetAutoPageBreak(true,5);
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);
        
        //$pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        $pdf->Cell(155, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('CUENTAS POR COBRAR'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode('Detalle Factura'), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        /*if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {*/
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        /*} else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }*/
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        //$pdf->SetXY(80,40);
        $id_prov="";
        $serie1="";
        $serie2="";
        $documento="";
        $resta=0;
        $resta_total=0;
        $fecha_emision="";
        $fecha_vencimiento="";
        $total_factura=0;
        $total_abono=0;
        $total_saldo=0;
        $suma_factura=0;
        $suma_abono=0;
        $suma_saldo=0;
        $id_fact="";
        $no_doc="";
        $fecha_pag="";
        $totales_factura=0;
        $suma_totales_factura=0;
        $pdf->Ln();
        $exist_referencia=0;
        $exist_facturas=0;
        $id_prov="";
        $id_referencia="";
        $total_referencia=0;
        $total_abono_ref=0;
        $total_saldo_ref=0;
        $totales_referencia=0;
        $suma_saldo_ref=0;
        $suma_totales_referencia=0;
        $suma_totales_cobros=0;
        $array_totales_fact=[];
        $array_totales_pro=[];
        $contador_cliente=0;
        $contador_ctas=0;
        $array_comprobante=[];
        $total_abono_nv=0;
        //dd($vencido_referencia);
        $id_ctas=count($reporte_ctas)+1;
        foreach($reporte_ctas as $detail){
            if(isset($detail->id_ctas_cobrar_pagos)){
                $id_ctas_pagos=$detail->id_ctas_cobrar_pagos;
            }else{
                $id_ctas_pagos=$detail->id_ctascobrar;
            }
            
            $id_ctas--;
            
                //$contador_cliente++;
               
            foreach($vencido_referencia as $detail2){
                if(isset($detail->id_ctas_cobrar_pagos)){
                    if($detail2->id_ctas_cobrar_pagos==$id_ctas_pagos){
                        $cta_pago=$id_ctas;
                        array_push($array_comprobante,$cta_pago.";".$detail2->id_ctas_cobrar_pagos.";");
                    }
                }
                else{
                    if($detail2->id_ctascobrar==$id_ctas_pagos){
                        $cta_pago=$id_ctas;
                        //array_push($array_comprobante,$cta_pago.";".$detail2->id_ctas_cobrar_pagos.";");
                    }
                }
                
            }
                   
                
            
        }
        $id_ctas=-1;
        $head_total_fact=40;
        //dd($array_comprobante);
        foreach($proveedor as $detail){
            $contador_cliente++;
            $id_prov=$detail->id_cliente;
                $head_id_prov=0;
            $head_total_fact=0;
            $head_resta_cab=0;
            $head_suma_cab=0;
                $pdf->SetX(10);
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 8);
                /*$pdf->Cell(15, 6, $detail->codigo, 0, 0, 'C', 0);
                $pdf->Cell(25, 6, 'IDENTIFICACION', 0, 0, 'C', 0);
                $pdf->Cell(25, 6, $detail->identificacion, 0, 0, 'R', 0);
                $pdf->Cell(75, 6, utf8_decode($detail->nombre), 0, 0, 'L', 0);*/
                $head_id_prov=$pdf->GetY();
                array_push($array_totales_fact,$head_id_prov.'Cleinte'.$detail->codigo);
                                    // if($head_id_prov>190){
                                    //     $otro_valor_prov=$pdf->GetPageHeight()-$head_id_prov;
                                    //     $pdf->SetAutoPageBreak(true,$otro_valor_prov);
                                    // }
                $pdf->MultiCell(190, 4, $detail->codigo."   CI/RUC:   ".$detail->identificacion."   CLIENTE:   ".utf8_decode($detail->nombre).utf8_decode("   TELEFONO:   ".$detail->telefono).utf8_decode("   CONTACTO:   ".$detail->contacto), 0,'L', 0);
                $pdf->Ln(2);
                
                foreach($reporte_nuevo as $detail2){
                    
                    if($detail2->id_cliente==$id_prov){
                        $contador_ctas++;
                        $suma_cuota_total=0;
                        $suma_cuota_abono_fact=0;
                        $suma_cuota_abono_nv=0;
                        $suma_cuota_abono_ref=0;
                        $suma_cuota_totales=0;
                        $suma_cuota_total=$detail2->valor_cuota;
                        $factura_id=$detail2->id_factura;
                        $nota_venta_id=$detail2->id_nota_venta;
                        $referencias=$detail2->referencias;
                        foreach($vencido_referencia as $detail3){
                            if($detail3->id_factura==$factura_id && $detail3->referencias==null && $detail3->id_nota_venta==null){
                                $suma_cuota_abono_fact+=$detail3->valor_pagado;
                            }
                            if($detail3->referencias==$referencias && $detail3->id_factura==null && $detail3->id_cliente==$id_prov && $detail3->id_nota_venta==null){
                                $suma_cuota_abono_ref+=$detail3->valor_pagado;
                            }else{
                                if($detail3->id_factura==null && $detail3->referencias==null && $detail3->id_nota_venta==$nota_venta_id){
                                    $suma_cuota_abono_nv+=$detail3->valor_pagado;
                                }
                            }
                        }
                        $suma_cuota_totales=$suma_cuota_total-$suma_cuota_abono_fact-$suma_cuota_abono_ref-$suma_cuota_abono_nv;
                        //if($suma_cuota_totales>0){
                            $head_cab=0;
                            $head_total_cli=0;
                            $array_head=[];
                            $pdf->SetX(10);
                            $pdf->SetFillColor(240, 240, 240);
                            $pdf->SetFont('Arial', 'B', 8);
                            $head_cab=$pdf->GetY();
                            array_push($array_totales_fact,$head_cab.' No. Comprobante'.$detail2->id_cliente);
                            $pdf->Cell(31, 6, 'Comprobante', 1, 0, 'C', 0);
                            //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                            $pdf->Cell(19, 6, 'Fecha', 1, 0, 'C', 0);
                            $pdf->Cell(29, 6, 'Comprobante Pago', 1, 0, 'C', 0);
                            $pdf->Cell(39, 6, 'Pago', 1, 0, 'C', 0);
                            $pdf->Cell(41, 6, 'Forma Pago', 1, 0, 'C', 0);
                            //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                            //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
                            $pdf->Cell(31, 6, 'Valor', 1, 0, 'C', 0);
                            //$pdf->Cell(35, 6, 'Saldos', 1, 0, 'C', 1);
                            $pdf->Ln();
                            
                            $pdf->SetX(10);

                            $resta_total=number_format($resta,2,".",",");
                            $pdf->SetFillColor(240, 240, 240);
                            $pdf->SetFont('Arial', '', 7);
                            
                            $fecha_emision=date("d/m/Y", strtotime($detail2->fecha_emision));
                            $fecha_vencimiento=date("d/m/Y", strtotime($detail2->fecha_pago));
                            if($detail2->vencido=='si' && $suma_cuota_totales>0){
                                $pdf->SetFillColor(250, 217, 82);
                                if($detail2->observacion){
                                    $serie1=substr($detail2->observacion,24,3);
                                    $serie2=substr($detail2->observacion,27,3);
                                    $documento=substr($detail2->observacion,30,9);
                                    $pdf->Cell(31, 6, $documento, 1, 0, 'C', 1);
                                    //$pdf->Cell(23, 6, $serie1.'-'.$serie2, 1, 0, 'C', 1);
                                    
                                }else{
                                    $serie1=substr($detail2->observacion,24,3);
                                    $serie2=substr($detail2->observacion,27,3);
                                    $documento=substr($detail2->observacion,30,9);
                                    $pdf->Cell(31, 6, $detail2->referencias, 1, 0, 'C', 1);
                                    //$pdf->Cell(23, 6, '', 1, 0, 'C', 1);
                                }
                                //$pdf->Cell(12, 6, 'Factura', 0, 0, 'C', 1);
                                //$pdf->Cell(18, 6, $detail->num_cuota, 0, 0, 'C', 1);
                                $pdf->Cell(19, 6, $fecha_vencimiento, 1, 0, 'C', 1);
                                $pdf->Cell(29, 6, '', 1, 0, 'C', 1);
                                
                                $pdf->Cell(39, 6, '', 1, 0, 'R', 1);
                                $pdf->Cell(41, 6, '', 1, 0, 'R', 1);
                                //$pdf->Cell(25, 6, '', 1, 0, 'C', 1);
                                $pdf->Cell(31, 6, $detail2->valor_cuota, 1, 0, 'C', 1);
                            }else{
                                $pdf->SetFillColor(240, 240, 240);
                                if($detail2->observacion){
                                    $serie1=substr($detail2->observacion,24,3);
                                    $serie2=substr($detail2->observacion,27,3);
                                    $documento=substr($detail2->observacion,30,9);
                                    $pdf->Cell(31, 6, $documento, 1, 0, 'C', 0);
                                    //$pdf->Cell(23, 6, $serie1.'-'.$serie2, 1, 0, 'C', 0);
                                }else{
                                    $serie1=substr($detail2->observacion,24,3);
                                    $serie2=substr($detail2->observacion,27,3);
                                    $documento=substr($detail2->observacion,30,9);
                                    $pdf->Cell(31, 6, $detail2->referencias, 1, 0, 'C', 0);
                                    //$pdf->Cell(23, 6, '', 1, 0, 'C', 0);
                                    
                                }
                                //$pdf->Cell(12, 6, 'Factura', 0, 0, 'C', 0);
                                //$pdf->Cell(18, 6, $detail->num_cuota, 0, 0, 'C', 0);
                                $pdf->Cell(19, 6, $fecha_vencimiento, 1, 0, 'C', 0);
                                //$pdf->Cell(31, 6, $fecha_vencimiento, 1, 0, 'R', 0);
                                $pdf->Cell(29, 6, '', 1, 0, 'C', 0);
                                $pdf->Cell(39, 6, '', 1, 0, 'R', 0);
                                $pdf->Cell(41, 6, '', 1, 0, 'R', 0);
                                
                                $pdf->Cell(31, 6, $detail2->valor_cuota, 1, 0, 'C', 0);
                            }
                            $total_factura=0;
                            $id_fact=$detail2->id_factura;
                            $id_nv=$detail2->id_nota_venta;
                            $id_referencia=$detail2->referencias;
                            $total_factura=$detail2->valor_cuota;
                            $doc_nro="";
                            $secuencia="";
                            if($detail2->observacion){
                                $no_doc=$documento;
                                $doc_nro=$documento;
                                $secuencia=$serie1."-".$serie2;
                            }else{
                                $no_doc=$detail2->referencias;
                                $doc_nro=$detail2->referencias;
                            }
                            
                            $pdf->Ln();
                            
                            foreach($vencido_referencia as $detail2){
                                //$index_valor=0;
                                    
                                if($detail2->id_factura==$id_fact && $detail2->referencias==null && $detail2->id_nota_venta==null){
                                    $termToSearch = ";".$detail2->id_ctas_cobrar_pagos.";";
                                    $matches = array_filter($array_comprobante, function($var) use ($termToSearch) { return stristr($var, $termToSearch); });
                                    if($matches){
                                        $index=key($matches);
                                        $valor_index=$array_comprobante[$index];
                                        $index_valor=substr($array_comprobante[$index],0,-strlen($termToSearch));
                                    }else{
                                        $index_valor="no existe";
                                    }
                                    $id_ctas++;
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(255, 255, 255);
                                    $pdf->SetFont('Arial', '', 7);
                                    /*$serie1=substr($detail2->observacion,24,3);
                                    $serie2=substr($detail2->observacion,27,3);
                                    $documento=substr($detail2->observacion,30,9);*/
                                    //$pdf->Cell(25, 6, $documento, 0, 0, 'C', 0);
                                    if($detail2->fecha_registro){
                                        $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_registro));
                                    }else{
                                        $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_pago));
                                    }
                                    
                                    
                                        $pdf->Cell(31, 6, $no_doc, 1, 0, 'C', 0);
                                        //$pdf->Cell(23, 6, $secuencia, 1, 0, 'C', 0);
                                    
                                    
                                    //$pdf->Cell(45, 6, $detail->numero_tarjeta, 1, 0, 'R', 0);
                                    $pdf->Cell(19, 6, $fecha_pag, 1, 0, 'C', 0);
                                    if($detail2->posicion==null){
                                        $pdf->Cell(29, 6, $index_valor , 1, 0, 'C', 0);
                                    }else{
                                        $pdf->Cell(29, 6, $detail2->posicion , 1, 0, 'C', 0);
                                    }
                                    
                                    $pdf->Cell(39, 6, utf8_decode($detail2->pagos_por) , 1, 0, 'C', 0);
                                    $pdf->Cell(41, 6, utf8_decode($detail2->descripcion), 1, 0, 'L', 1);
                                    //$pdf->Cell(25, 6, utf8_decode($detail2->nro_tarjeta), 1, 0, 'C', 0);
                                    if($detail2->valor_pagado>$detail2->v_pago_cobrar){
                                        $pdf->Cell(31, 6, '-'.number_format($detail2->v_pago_cobrar,2,".",","), 1, 0, 'C', 1);
                                    }else{
                                        $pdf->Cell(31, 6, '-'.number_format($detail2->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                    }
                                    
                                    $pdf->Ln();
                                    //$id_fact=0;
                                    if($detail2->valor_pagado>$detail2->v_pago_cobrar){
                                        $total_abono+=$detail2->v_pago_cobrar;
                                    }else{
                                        $total_abono+=$detail2->valor_pagado;
                                    }
                                    
                                }
                                if($detail2->id_factura==null && $detail2->referencias==null && $detail2->id_nota_venta==$id_nv){
                                    $termToSearch = ";".$detail2->id_ctas_cobrar_pagos.";";
                                    $matches = array_filter($array_comprobante, function($var) use ($termToSearch) { return stristr($var, $termToSearch); });
                                    if($matches){
                                        $index=key($matches);
                                        $valor_index=$array_comprobante[$index];
                                        $index_valor=substr($array_comprobante[$index],0,-strlen($termToSearch));
                                    }else{
                                        $index_valor="no existe";
                                    }
                                    $id_ctas++;
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(255, 255, 255);
                                    $pdf->SetFont('Arial', '', 7);
                                    /*$serie1=substr($detail2->observacion,24,3);
                                    $serie2=substr($detail2->observacion,27,3);
                                    $documento=substr($detail2->observacion,30,9);*/
                                    //$pdf->Cell(25, 6, $documento, 0, 0, 'C', 0);
                                    if($detail2->fecha_registro){
                                        $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_registro));
                                    }else{
                                        $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_pago));
                                    }
                                    
                                    
                                        $pdf->Cell(31, 6, $no_doc, 1, 0, 'C', 0);
                                        //$pdf->Cell(23, 6, $secuencia, 1, 0, 'C', 0);
                                    
                                    
                                    //$pdf->Cell(45, 6, $detail->numero_tarjeta, 1, 0, 'R', 0);
                                    $pdf->Cell(19, 6, $fecha_pag, 1, 0, 'C', 0);
                                    $pdf->Cell(29, 6, $index_valor , 1, 0, 'C', 0);
                                    $pdf->Cell(39, 6, utf8_decode($detail2->pagos_por) , 1, 0, 'C', 0);
                                    $pdf->Cell(41, 6, utf8_decode($detail2->descripcion), 1, 0, 'L', 1);
                                    //$pdf->Cell(25, 6, utf8_decode($detail2->nro_tarjeta), 1, 0, 'C', 0);
                                    if($detail2->valor_pagado>$detail2->v_pago_cobrar){
                                        $pdf->Cell(31, 6, '-'.number_format($detail2->v_pago_cobrar,2,".",","), 1, 0, 'C', 1);
                                    }else{
                                        $pdf->Cell(31, 6, '-'.number_format($detail2->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                    }
                                    
                                    $pdf->Ln();
                                    //$id_fact=0;
                                    if($detail2->valor_pagado>$detail2->v_pago_cobrar){
                                        $total_abono_nv+=$detail2->v_pago_cobrar;
                                    }else{
                                        $total_abono_nv+=$detail2->valor_pagado;
                                    }
                                    
                                }
                                if($detail2->referencias==$id_referencia && $detail2->id_factura==null && $detail2->id_cliente==$id_prov && $detail2->id_nota_venta==null){
                                        $id_ctas++;
                                        $termToSearch = ";".$detail2->id_ctas_cobrar_pagos.";";
                                        $matches = array_filter($array_comprobante, function($var) use ($termToSearch) { return stristr($var, $termToSearch); });
                                        if($matches){
                                            $index=key($matches);
                                            $valor_index=$array_comprobante[$index];
                                            $index_valor=substr($array_comprobante[$index],0,-strlen($termToSearch));
                                        }else{
                                            $index_valor="no existe";
                                        }
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', '', 7);
                                        //$pdf->Cell(25, 6, $documento, 0, 0, 'C', 0);
                                        if($detail2->fecha_registro){
                                            $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_registro));
                                        }else{
                                            $fecha_pag=date("d/m/Y", strtotime($detail2->fecha_pago));
                                        }
                                        $pdf->Cell(31, 6, $detail2->referencias, 1, 0, 'C', 0);
                                        //$pdf->Cell(23, 6, '', 1, 0, 'C', 0);
                                        //$pdf->Cell(45, 6, $detail->numero_tarjeta, 1, 0, 'R', 0);
                                        $pdf->Cell(19, 6, $fecha_pag, 1, 0, 'C', 0);
                                        $pdf->Cell(29, 6, $index_valor, 1, 0, 'C', 0);
                                        $pdf->Cell(39, 6, utf8_decode($detail2->pagos_por), 1, 0, 'C', 0);
                                        $pdf->Cell(41, 6, utf8_decode($detail2->descripcion), 1, 0, 'L', 1);
                                        //$pdf->Cell(25, 6, utf8_decode($detail2->nro_tarjeta), 1, 0, 'C', 0);
                                        if($detail2->valor_pagado>$detail2->v_pago_cobrar){
                                            $pdf->Cell(31, 6, '-'.number_format($detail2->v_pago_cobrar,2,".",","), 1, 0, 'C', 1);
                                        }else{
                                            $pdf->Cell(31, 6, '-'.number_format($detail2->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                        }
                                        
                                        $pdf->Ln();
                                        //$id_fact=0;
                                        if($detail2->valor_pagado>$detail2->v_pago_cobrar){
                                            $total_abono_ref+=$detail2->v_pago_cobrar;
                                        }else{
                                            $total_abono_ref+=$detail2->valor_pagado;
                                        }
                                        //$id_referencia=0;
                                       
                                }
                                //$total_abono+=$detail2->valor_pagado;
                                
                            }
                                    $total_saldo+=$total_factura-$total_abono-$total_abono_ref-$total_abono_nv;
                                    $total_saldo_ref=$total_factura-$total_abono-$total_abono_ref-$total_abono_nv;
                                    $totales_factura+=$total_saldo;
                                    $suma_saldo=number_format($total_saldo_ref,2,".",",");
                                    $suma_totales_factura=$totales_factura;
                                    $pdf->SetX(15);
                                    $pdf->SetFillColor(240, 240, 240);
                                    $pdf->SetFont('Arial', 'B', 8);
                                    $total_clientes='TOTAL';
                                    $pdf->Cell(159, 6, $total_clientes, 'T', 0, 'C', 0);
                                    //$pdf->Cell(25, 6, $no_doc, 1, 0, 'R', 0);
                                    //$pdf->Cell(25, 6, '', 1, 0, 'R', 0);
                                    //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
                                    //$pdf->Cell(44, 6, '', 'T', 0, 'R', 0);
                                    $pdf->Cell(22, 6, $suma_saldo, 'T', 0, 'C', 0);
                                    
                                    
                                    
                                    $total_saldo=0;
                                    $total_abono=0;
                                    $total_abono_ref=0;
                                    $total_factura=0;
                                    $total_saldo_ref=0;
                                    $suma_saldo=0;
                                    $total_abono_nv=0;
                                    $no_doc="";
                                    if(count($reporte_nuevo)==$contador_ctas){
                                        $pdf->Ln();
                                    }else{
                                        $pdf->Ln(5);
                                    }
                                    array_push($array_totales_pro,$contador_ctas. "Nro Cuentas por Cliente ".$id_prov);
                                    $head_total_cli=$pdf->GetY();
                                    array_push($array_totales_fact,$head_total_cli.'TOTAL   '.$doc_nro);
                                    $head_resta_cab+=$head_cab-$head_id_prov;
                                    $head_suma_cab+=$head_total_cli-$head_cab+$head_resta_cab;
                                    //array_push($array_totales_pro,$head_suma_cab);
                                    if($head_total_cli>251 && count($reporte_nuevo)>$contador_ctas){
                                        $otro_valor=$pdf->GetPageHeight()-$head_total_cli;
                                        $pdf->SetAutoPageBreak(true,$otro_valor);
                                    }else{
                                        if($head_total_cli>251 && count($reporte_nuevo)==$contador_ctas){
                                            $otro_valor=$pdf->GetPageHeight()-$head_total_cli;
                                            $pdf->SetAutoPageBreak(true,2);
                                        }else{
                                            $pdf->SetAutoPageBreak(true,5);
                                        }
                                        // if(count($reporte_nuevo)>$contador_ctas){
                                        //     $pdf->SetAutoPageBreak(true,2);
                                        // }else{
                                        //     $pdf->SetAutoPageBreak(true,5);
                                        // }
                                        $pdf->SetAutoPageBreak(true,5);
                                        
                                    }
                                    
                        //}
                        
                    }
                }   
                
                $pdf->SetXY(20,$head_total_cli+2);
                $suma_totales=0;
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 10);
                $pdf->Cell(159, 6, 'TOTALES FACTURAS', 0, 0, 'C', 0);
                $suma_totales=$suma_totales_factura+$suma_totales_referencia;
                $suma_totales_cobros+=$suma_totales_factura+$suma_totales_referencia;
                $pdf->Cell(10, 6, number_format($suma_totales,2,".",","), 0, 0, 'C', 0);
                if(count($proveedor)==$contador_cliente){
                    $pdf->Ln(5);
                }else{
                    $pdf->Ln(9);
                }
                
                //$pdf->Ln(9);
                $head_total_fact=$pdf->GetY();
                // array_push($array_totales_fact,$head_total_fact." TOTALES FACTURAS ".$suma_totales);
                if($head_total_fact>260 && count($reporte_nuevo)!==$contador_ctas){
                    $otro_total_2=$pdf->GetPageHeight()-$head_total_fact;
                    $pdf->SetAutoPageBreak(true,$otro_total_2);
                }else{
                    if($head_total_fact>190 && count($reporte_nuevo)==$contador_ctas){
                        $otro_total_2=$pdf->GetPageHeight()-$head_total_fact;
                        $pdf->SetAutoPageBreak(true,$otro_total_2);
                    }else{
                        $pdf->SetAutoPageBreak(true,5);
                    }
                    
                }
                $contador_ctas=0;
                $suma_totales_factura=0;
                $suma_totales_referencia=0;
                $totales_factura=0;
                $totales_referencia=0;
                $total_referencia=0;
                $suma_totales=0;
        }
        //dd($array_totales_pro);
                
                $pdf->SetXY(20,$head_total_fact);
                //$suma_totales=0;
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 10);
                $pdf->Cell(159, 6, 'TOTAL FACTURA COBROS', 0, 0, 'C', 0);
                $pdf->Cell(10, 6, number_format($suma_totales_cobros,2,".",","), 0, 1, 'C', 0);
                //$head_total_fact=0;
                // foreach($proveedor as $detail){
                //     $id_prov=$detail->id_cliente;
                //     foreach($reporte_nuevo as $detail2){
                //         if($detail2->id_cliente==$id_prov){

                //         }
                //     }    
                //     while ($row = mysql_fetch_array($result)) {

                //         // multicell content
                //         $description = $row['desciption'];
                   
                //         // get column width from a column widths array
                //         $column_width = $column_widths['description'];
                   
                //         $number_of_lines = ceil( $pdf->GetStringWidth($description) / ($column_width - 1) );
                //         // I subtracted one from column width as a kind of cell padding
                   
                //         // height of resulting cell
                //         $cell_height = 5 + 1; // I have my cells at a height of five so set to six for a padding
                //         $height_of_cell = ceil( $number_of_lines * $cell_height ); 
                   
                //         // set page constants
                //         $page_height = 279.4; // mm (portrait letter)
                //         $bottom_margin = 20; // mm
                   
                //         // mm until end of page (less bottom margin of 20mm)
                //         $space_left = $page_height - $pdf.GetY(); // space left on page
                //         $space_left -= $bottom_margin; // less the bottom margin
                   
                //         // test if height of cell is greater than space left
                //         if ( $height_of_cell >= $space_left) {
                //            $pdf->Ln();                        
                   
                //            $pdf->AddPage(); // page break.
                //            $pdf->Cell(100,5,'','B',2); // this creates a blank row for formatting reasons
                //         }
                   
                //         // ...
                //         // actual creation of pdf stuff
                //         // ...
                   
                //    }
                // }
                
        //dd($array_head);
        if($ruta==null){
            $pdf->Output("cuenta_por_cobrar_Detalle_Factura.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."cuenta_por_cobrar_Detalle_Factura.pdf", "F");
        }
    }

    public function cuenta_cobrar_reporte_resumen_factura($reporte_nuevo,$reporte_valores_pagado,$datos, $fec_ini, $fec_fin,$vencido,$proveedor,$referencia,$empresa,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        $pdf->Cell(155, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('CUENTAS POR COBRAR'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode('Resumen Factura'), 0, 2, 'C', 0);
        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        //$pdf->SetXY(80,40);
        $id_prov="";
        $serie1="";
        $serie2="";
        $documento="";
        $resta=0;
        $resta_total=0;
        $fecha_emision="";
        $fecha_vencimiento="";
        $total_factura=0;
        $total_abono=0;
        $total_saldo=0;
        $suma_factura=0;
        $suma_abono=0;
        $suma_saldo=0;
        $totales_factura=0;
        $totales_abono=0;
        $totales_saldo=0;
        $sumatot_factura=0;
        $sumatot_abono=0;
        $sumatot_saldo=0;
        $pdf->Ln();
        $resta_ref=0;
        $resta_total_ref=0;
        $total_referencia=0;
        $total_abono_ref=0;
        $total_saldo_ref=0;
        $totales_referencia=0;
        $totales_abono_ref=0;
        $totales_saldo_ref=0;
        $array_totales=[];
        $contador_prov=0;
        $cantidad_cuotas=0;
        $total_factura0=0;
        $total_abono0=0;
        $total_saldo0=0;
        $sumatot_factura0=0;
        $sumatot_abono0=0;
        $sumatot_saldo0=0;
        $array_nv=[];
        $total_deuda="";
        foreach($proveedor as $detail){
                $total_deuda=$detail->valor_deuda;
                $id_prov=$detail->id_cliente;
                //array_push($array_nv,$detail->id_cliente);
                // $head_total=0;
                // $pdf->SetX(10);
                // $pdf->SetFillColor(240, 240, 240);
                // $pdf->SetFont('Arial', 'B', 8);
                // /*$pdf->Cell(15, 6, $detail->codigo, 1, 0, 'C', 0);
                // $pdf->Cell(25, 6, 'IDENTIFICACION', 1, 0, 'C', 0);
                // $pdf->Cell(25, 6, $detail->identificacion, 1, 0, 'R', 0);
                // $pdf->Cell(65, 6, $detail->nombre, 1, 0, 'L', 0);*/
                // $pdf->MultiCell(190, 4, $detail->codigo."   CI/RUC:   ".$detail->identificacion."   CLIENTE:   ".utf8_decode($detail->nombre).utf8_decode("   TELEFONO:   ".$detail->telefono).utf8_decode("   CONTACTO:   ".$detail->contacto), 0,'L', 0);
                // $pdf->Ln(1);
                // $pdf->SetX(10);
                // $pdf->SetFillColor(240, 240, 240);
                // $pdf->SetFont('Arial', 'B', 8);
                
                // $pdf->Cell(27, 6, 'No Doc', 1, 0, 'C', 0);
                // $pdf->Cell(27, 6, 'Serie', 1, 0, 'C', 0);
                // $pdf->Cell(27, 6, 'Fecha Emision', 1, 0, 'C', 0);
                // $pdf->Cell(28, 6, 'Fecha Vencimiento', 1, 0, 'C', 0);
                // $pdf->Cell(27, 6, 'Valor Facturado', 1, 0, 'C', 0);
                // $pdf->Cell(27, 6, 'Abonos', 1, 0, 'C', 0);
                // $pdf->Cell(27, 6, 'Saldos', 1, 0, 'C', 0);
                // $pdf->Ln();
                // $contador_prov++;

                //cambios sin mostrar saldos 0
                    foreach($reporte_nuevo as $detail0){
                    
                        if($detail0->id_cliente==$id_prov){
                            $cantidad_cuotas++;
                            
                            $factura_id01=$detail0->id_factura;
                            $ref_id01=$detail0->referencias;
                            $nv_id01=$detail0->id_nota_venta;
                            $v_cuota201=$detail0->valor_cuota;
                            $saldo_factura01=0;
                            $saldo_ref01=0;
                            $saldo_nv01=0;
                            $saldo_exist01=0;
                            $exist_fact01=0;
                            $exist_ref01=0;
                            $exist_nv01=0;
                            $total_abono_fact0=0;
                            $total_abonoref0=0;
                            $total_saldo_fact0=0;
                            $total_saldoref0=0;
                            $total_abononv0=0;
                            $total_saldonv0=0;

                            //dd($reporte_nuevo);
                            //array_push($array_nv,$nv_id01);
                            foreach($reporte_valores_pagado as $detail01){
                                
                                if($detail01->id_factura==$factura_id01 && $detail01->referencias==null && $detail01->id_nota_venta==null){
                                    $exist_fact01++;
                                }else{
                                    if($detail01->referencias==$ref_id01 && $detail01->id_factura==null && $detail01->id_cliente==$id_prov && $detail01->id_nota_venta==null){
                                        $exist_ref01++;
                                    }else{
                                        
                                        if($detail01->id_factura==null && $detail01->referencias==null && $detail01->id_nota_venta==$nv_id01){
                                            $exist_nv01++;
                                            array_push($array_nv,$exist_nv01);
                                        }
                                    } 
                                }
                            }
                            //dd($array_nv);
                            if($exist_fact01>0 || $exist_ref01>0 || $exist_nv01>0){
                                foreach($reporte_valores_pagado as $detail02){
                                    if($detail02->id_factura==$factura_id01 && $detail02->referencias==null && $detail02->id_nota_venta==null){
                                        $saldo_factura01+=$v_cuota201-$detail02->valor_pagado;
                                    }else{
                                        if($detail02->referencias==$ref_id01 && $detail02->id_cliente==null && $detail02->id_cliente==$id_prov && $detail02->id_nota_venta==null){
                                            $saldo_ref01+=$v_cuota201-$detail02->valor_pagado;
                                        }else{
                                            if($detail02->id_factura==null && $detail02->referencias==null && $detail02->id_nota_venta==$nv_id01){
                                                $saldo_nv01+=$v_cuota201-$detail02->valor_pagado;
                                            }
                                        } 
                                    }
                                }
                            }else{
                                $saldo_factura01+=$v_cuota201;
                            }
                            $saldo_exist01=$saldo_ref01+$saldo_factura01+$saldo_nv01;
                            if($saldo_exist01>0){
                                        $id_factura01=$detail0->id_factura;
                                        $id_nv01=$detail0->id_nota_venta;
                                        $id_ref0=$detail0->referencias;
                                        $v_cuota0=$detail0->valor_cuota;
                                        $exist_fact_pagado0=0;
                                        $exist_refe_pagado0=0;
                                        $exist_nv_pagado0=0;
                                        foreach($reporte_valores_pagado as $detail60){
                                            if($detail60->id_factura==$id_factura01 && $detail60->referencias==null && $detail60->id_nota_venta==null){
                                                $exist_fact_pagado0++;
                                            }else{
                                                if($detail60->referencias==$id_ref0 && $detail60->id_factura==null && $detail60->id_cliente==$id_prov && $detail60->id_nota_venta==null){
                                                    $exist_refe_pagado0++;
                                                }else{
                                                    if($detail60->id_factura==null && $detail60->referencias==null && $detail60->id_nota_venta==$id_nv01){
                                                        $exist_nv_pagado0++;
                                                    }
                                                } 
                                            }
                                        }
                                        
                                        if($exist_fact_pagado0>0 || $exist_refe_pagado0>0 || $exist_nv_pagado0>0){
                                            foreach($reporte_valores_pagado as $detail03){
                                                if($detail03->id_factura==$id_factura01 && $detail03->referencias==null && $detail03->id_nota_venta==null){
        
                                                    $total_abono_fact0+=$detail03->valor_pagado;
                                                    $total_saldo_fact0+=$v_cuota201-$detail03->valor_pagado;
                                                }else{
                                                    if($detail03->referencias==$id_ref0 && $detail03->id_factura==null && $detail03->id_cliente==$id_prov && $detail03->id_nota_venta==null){
                                                        $total_abonoref0+=$detail03->valor_pagado;
                                                        $total_saldoref0+=$v_cuota201-$detail03->valor_pagado;
                                                    }else{
                                                        if($detail03->id_factura==null && $detail03->referencias==null && $detail03->id_nota_venta==$id_nv01){
                                                            $total_abononv0+=$detail03->valor_pagado;
                                                            $total_saldonv0+=$v_cuota201-$detail03->valor_pagado;
                                                        }
                                                    }
                                                }
                                            }
                                        }else{
                                                        $total_saldo_fact0+=$v_cuota201;
                                        }
                            }
                            if($saldo_exist01>0){
                                $total_factura0+=$v_cuota201;
                            }
                            if($saldo_exist01>0){
                                $total_abono0+=$total_abono_fact0+$total_abonoref0+$total_abononv0;
                            }
                            if($saldo_exist01>0){
                                $total_saldo0+=$total_saldoref0+$total_saldo_fact0+$total_saldonv0;
                            }
                            
                        }
                    }
                    //dd($array_nv);
                    $suma_factura0=number_format($total_factura0,2,".",",");
                    $suma_abono0=number_format($total_abono0,2,".",",");
                    $suma_saldo0=number_format($total_deuda,2,".",",");

                    $pdf->SetX(10);
                    $pdf->SetFillColor(240, 240, 240);
                    $pdf->SetFont('Arial', 'B', 8);

                    if($suma_saldo0>0){
                        $head_prov=0;
                        /*$pdf->Cell(25, 6, 'IDENTIFICACION', 1, 0, 'C', 0);
                        $pdf->Cell(25, 6, $detail->identificacion, 1, 0, 'R', 0);
                        $pdf->Cell(65, 6, $detail->nombre, 1, 0, 'L', 0);*/
                        $pdf->MultiCell(190, 4, $detail->codigo."   CI/RUC:   ".$detail->identificacion."   CLIENTE:   ".utf8_decode($detail->nombre).utf8_decode("   TELEFONO:   ".$detail->telefono).utf8_decode("   CONTACTO:   ".$detail->contacto), 0,'L', 0);
                        $pdf->Ln(1);
                        $pdf->SetX(10);
                        $pdf->SetFillColor(240, 240, 240);
                        $pdf->SetFont('Arial', 'B', 8);
                        
                        $pdf->Cell(27, 6, 'No Doc', 1, 0, 'C', 0);
                        $pdf->Cell(27, 6, 'Serie', 1, 0, 'C', 0);
                        $pdf->Cell(27, 6, 'Fecha Emision', 1, 0, 'C', 0);
                        $pdf->Cell(28, 6, 'Fecha Vencimiento', 1, 0, 'C', 0);
                        $pdf->Cell(27, 6, 'Valor Facturado', 1, 0, 'C', 0);
                        $pdf->Cell(27, 6, 'Abonos', 1, 0, 'C', 0);
                        $pdf->Cell(27, 6, 'Saldos', 1, 0, 'C', 0);
                        $pdf->Ln();
                        $contador_prov++;
                    }
                    $diferencia1="";
                    $diferencia2="";
                    $diferencia3="";
                    $total_factura0=0;
                    $total_abono0=0;
                    $total_saldo0=0;
                    //$total_referencia0=0;
                    $total_abono_ref0=0;
                    $total_saldo_ref0=0;
                    $suma_factura0=0;
                    $suma_abono0=0;
                    $suma_saldo0=0;
                    $cantidad_cuotas01=0;
                //
            
                foreach($reporte_nuevo as $detail2){
                    if($detail2->id_cliente==$id_prov){
                        //cambios sin mostrar saldos 0
                            $cantidad_cuotas01++;
                        //
                        $pdf->SetX(10);
                        $resta=$detail2->saldo;
                        $resta_total=number_format($resta,2,".",",");
                        $pdf->SetFillColor(240, 240, 240);
                        $pdf->SetFont('Arial', '', 7);
                        $fecha_emision=date("d/m/Y", strtotime($detail2->fecha_emision));
                        $fecha_vencimiento=date("d/m/Y", strtotime($detail2->fecha_pago));
                        
                            $serie1=substr($detail2->observacion,24,3);
                            $serie2=substr($detail2->observacion,27,3);
                            $documento=substr($detail2->observacion,30,9);
                            $total_abono_fact=0;
                            $total_abonoref=0;
                            $total_saldo_fact=0;
                            $total_saldoref=0;
                            $total_abononv=0;
                            $total_saldonv=0;
                            $factura_id=$detail2->id_factura;
                            $nota_venta_id=$detail2->id_nota_venta;
                            $ref_id=$detail2->referencias;
                            $saldo_factura=0;
                            $saldo_ref=0;
                            $saldo_nv=0;
                            $saldo_exist=0;
                            $v_cuota2=$detail2->valor_cuota;
                            $exist_fact=0;
                            $exist_refe=0;
                            $exist_nv=0;
                            foreach($reporte_valores_pagado as $detail8){
                                if($detail8->id_factura==$factura_id && $detail8->referencias==null && $detail8->id_nota_venta==null){
                                    $exist_fact++;
                                }else{
                                    if($detail8->referencias==$ref_id && $detail8->id_factura==null && $detail8->id_nota_venta==null  && $detail8->id_cliente==$id_prov){
                                        $exist_refe++;
                                    }else{
                                        if($detail8->id_factura==null && $detail8->referencias==null && $detail8->id_nota_venta==$nota_venta_id){
                                            $exist_nv++;
                                        }
                                    } 
                                }
                            }

                            if($exist_fact>0 || $exist_refe>0 || $exist_nv>0){
                                foreach($reporte_valores_pagado as $detail7){
                                    if($detail7->id_factura==$factura_id && $detail7->referencias==null && $detail7->id_nota_venta==null){
                                        $saldo_factura+=$v_cuota2-$detail7->valor_pagado;
                                    }else{
                                        if($detail7->referencias==$ref_id && $detail7->id_factura==null && $detail7->id_cliente==$id_prov && $detail7->id_nota_venta==null){
                                            $saldo_ref+=$v_cuota2-$detail7->valor_pagado;
                                        }else{
                                            if($detail7->id_factura==null && $detail7->referencias==null && $detail7->id_nota_venta==$nota_venta_id){
                                                $saldo_nv+=$v_cuota2-$detail7->valor_pagado;
                                            }
                                        } 
                                    }
                                }
                            }else{
                                $saldo_factura+=$v_cuota2;
                            }
                            $saldo_exist=number_format($saldo_ref+$saldo_factura+$saldo_nv,2,".",",");
                            if($detail2->vencido=='si' && $saldo_exist>0){
                                $pdf->SetFillColor(250, 217, 82);
                                if($detail2->observacion){
                                    $pdf->Cell(27, 6, $documento, 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, $serie1.'-'.$serie2, 1, 0, 'C', 1);
                                }else{
                                    $pdf->Cell(27, 6, $detail2->referencias, 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, '', 1, 0, 'C', 1);
                                }
                                $id_factura=$detail2->id_factura;
                                $id_nota_venta=$detail2->id_nota_venta;
                                $id_ref=$detail2->referencias;
                                $pdf->Cell(27, 6, $fecha_emision, 1, 0, 'C', 1);
                                $pdf->Cell(28, 6, $fecha_vencimiento, 1, 0, 'C', 1);
                                $pdf->Cell(27, 6, $detail2->valor_cuota, 1, 0, 'C', 1);
                                $v_cuota=$detail2->valor_cuota;
                                $exist_fact_pagado=0;
                                $exist_refe_pagado=0;
                                $exist_nv_pagado=0;
                                foreach($reporte_valores_pagado as $detail5){
                                    if($detail5->id_factura==$id_factura && $detail5->referencias==null && $detail5->id_nota_venta==null){
                                        $exist_fact_pagado++;
                                    }else{
                                        if($detail5->referencias==$id_ref && $detail5->id_factura==null && $detail5->id_cliente==$id_prov && $detail5->id_nota_venta==null){
                                            $exist_refe_pagado++;
                                        }else{
                                            if($detail5->id_factura==null && $detail5->referencias==null && $detail5->id_nota_venta==$id_nota_venta){
                                                $exist_nv_pagado++;
                                            }
                                        } 
                                    }
                                }

                                if($exist_fact_pagado>0 || $exist_refe_pagado>0 || $exist_nv_pagado>0){
                                    foreach($reporte_valores_pagado as $detail3){
                                        if($detail3->id_factura==$id_factura && $detail3->referencias==null && $detail3->id_nota_venta==null){
                                            $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                            $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                            $total_abono_fact+=$detail3->valor_pagado;
                                            $total_saldo_fact+=$v_cuota-$detail3->valor_pagado;
                                        }else{
                                            if($detail3->referencias==$id_ref && $detail3->id_factura==null && $detail3->id_cliente==$id_prov && $detail3->id_nota_venta==null){
                                                $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                $total_abonoref+=$detail3->valor_pagado;
                                                $total_saldoref+=$v_cuota-$detail3->valor_pagado;
                                            }else{
                                                if($detail3->id_factura==null && $detail3->referencias==null && $detail3->id_nota_venta==$id_nota_venta){
                                                    $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                    $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                    $total_abononv+=$detail3->valor_pagado;
                                                    $total_saldonv+=$v_cuota-$detail3->valor_pagado;
                                                }
                                            }
                                        }
                                    }
                                }else{
                                    $pdf->Cell(27, 6, '0.00', 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, number_format($v_cuota,2,".",","), 1, 0, 'C', 1);
                                    $total_saldo_fact+=$v_cuota;
                                }
                                
                                //cambios sin mostrar saldos 0
                                    $pdf->Ln();
                                //
                            }else{
                                if($detail2->vencido=='no' && $saldo_exist>0){
                                    $pdf->SetFillColor(240, 240, 240);
                                    if($detail2->observacion){
                                        $pdf->Cell(27, 6, $documento, 1, 0, 'C', 0);
                                        $pdf->Cell(27, 6, $serie1.'-'.$serie2, 1, 0, 'C', 0);
                                    }else{
                                        $pdf->Cell(27, 6, $detail2->referencias, 1, 0, 'C', 0);
                                        $pdf->Cell(27, 6, '', 1, 0, 'C', 0);
                                    }
                                    $id_factura=$detail2->id_factura;
                                    $id_ref=$detail2->referencias;
                                    $id_nota_venta=$detail2->id_nota_venta;
                                    $pdf->Cell(27, 6, $fecha_emision, 1, 0, 'C', 0);
                                    $pdf->Cell(28, 6, $fecha_vencimiento, 1, 0, 'C', 0);
                                    $pdf->Cell(27, 6, $detail2->valor_cuota, 1, 0, 'C', 0);
                                    $v_cuota=$detail2->valor_cuota;
                                    $exist_fact_pagado=0;
                                    $exist_refe_pagado=0;
                                    $exist_nv_pagado=0;
                                    foreach($reporte_valores_pagado as $detail6){
                                        if($detail6->id_factura==$id_factura && $detail6->referencias==null && $detail6->id_nota_venta==null){
                                            $exist_fact_pagado++;
                                        }else{
                                            if($detail6->referencias==$id_ref && $detail6->id_factura==null && $detail6->id_cliente==$id_prov && $detail6->id_nota_venta==null){
                                                $exist_refe_pagado++;
                                            }else{
                                                if($detail6->id_factura==null && $detail6->referencias==null && $detail6->id_nota_venta==$id_nota_venta){
                                                    $exist_nv_pagado++;
                                                }
                                            } 
                                        }
                                    }
                                    
                                    if($exist_fact_pagado>0 || $exist_refe_pagado>0 || $exist_nv_pagado>0){
                                        foreach($reporte_valores_pagado as $detail4){
                                            if($detail4->id_factura==$id_factura && $detail4->referencias==null && $detail4->id_nota_venta==null){
                                                $pdf->Cell(27, 6, number_format($detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                $pdf->Cell(27, 6, number_format($v_cuota-$detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                $total_abono_fact+=$detail4->valor_pagado;
                                                $total_saldo_fact+=$v_cuota-$detail4->valor_pagado;
                                            }else{
                                                if($detail4->referencias==$id_ref && $detail4->id_factura==null && $detail4->id_cliente==$id_prov && $detail4->id_nota_venta==null){
                                                    $pdf->Cell(27, 6, number_format($detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                    $pdf->Cell(27, 6, number_format($v_cuota-$detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                    $total_abonoref+=$detail4->valor_pagado;
                                                    $total_saldoref+=$v_cuota-$detail4->valor_pagado;
                                                }else{
                                                    if($detail4->id_factura==null && $detail4->referencias==null && $detail4->id_nota_venta==$id_nota_venta){
                                                        $pdf->Cell(27, 6, number_format($detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                        $pdf->Cell(27, 6, number_format($v_cuota-$detail4->valor_pagado,2,".",","), 1, 0, 'C', 0);
                                                        $total_abononv+=$detail4->valor_pagado;
                                                        $total_saldonv+=$v_cuota-$detail4->valor_pagado;
                                                    }
                                                }
                                            }
                                        }
                                    }else{
                                                    $pdf->Cell(27, 6, '0.00', 1, 0, 'C', 0);
                                                    $pdf->Cell(27, 6, number_format($v_cuota,2,".",","), 1, 0, 'C', 0);
                                                    $total_saldo_fact+=$v_cuota;
                                    }
                                    //cambios sin mostrar saldos 0
                                        $pdf->Ln();
                                    //
                                }
                                
                                // $pdf->Cell(27, 6, $detail2->valor_pagado, 1, 0, 'C', 0);
                                // $pdf->Cell(27, 6, $resta_total, 1, 0, 'C', 0);
                                //$pdf->Ln();
                            }
                            //cambios sin mostrar saldos 0
                                // $pdf->Ln();
                                // $total_factura+=$detail2->valor_cuota;
                                // $total_abono+=$total_abono_fact+$total_abonoref;
                                // $total_saldo+=$total_saldoref+$total_saldo_fact;
                                // $totales_factura+=$detail2->valor_cuota;
                                // $totales_abono+=$total_abono_fact+$total_abonoref;
                                // $totales_saldo+=$total_saldoref+$total_saldo_fact;
                                $exist_fact=0;
                                $exist_refe=0;
                                if($saldo_exist>0){
                                    $total_factura+=$detail2->valor_cuota;
                                }
                                if($saldo_exist>0){
                                    $total_abono+=$total_abono_fact+$total_abonoref+$total_abononv;
                                }
                                if($saldo_exist>0){
                                    $total_saldo+=$total_saldoref+$total_saldo_fact+$total_saldonv;
                                }
                                
                                // if($saldo_exist>0){
                                //     $totales_factura+=$detail2->valor_cuota;
                                // }
                                // if($saldo_exist>0){
                                //     $totales_abono+=$total_abono_fact+$total_abonoref;
                                // }
                                // if($saldo_exist>0){
                                //     $totales_saldo+=$total_saldoref+$total_saldo_fact;
                                // }
                                
                                $v_cuota2=0;
                            //
                    }         
                }
                $pdf->SetX(10);
                $suma_factura=$total_factura+$total_referencia;
                $suma_abono=$total_abono+$total_abono_ref;
                $suma_saldo=$total_saldo+$total_saldo_ref;
                $sumatot_factura+=$suma_factura;
                //$sumatot_factura=number_format($totales_factura+$totales_referencia,2,".",",");
                $sumatot_abono+=$suma_abono;
                $sumatot_saldo+=$suma_saldo;
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 8);
                $pdf->SetTextColor(0, 0, 0);
                //cambios sin mostrar saldos 0
                    $resta_valor_cuota0=0;
                    if($suma_saldo>0){
                        $pdf->Cell(109, 6, 'Total', 'T', 0, 'C', 0);
                        $pdf->Cell(27, 6, number_format($suma_factura,2,".",","), 'T', 0, 'C', 0);
                        $pdf->Cell(27, 6, number_format($suma_abono,2,".",","), 'T', 0, 'C', 0);
                        $pdf->Cell(27, 6, number_format($suma_saldo,2,".",","), 'T', 0, 'C', 0);
                        if(count($proveedor)==$contador_prov){
                            $pdf->Ln(5);
                        }else{
                            $pdf->Ln(10);
                        }
                        $head_total=$pdf->GetY();
                    
                        
                        array_push($array_totales,$head_total.' Total '.$suma_factura);
                        if($head_total>240 && count($proveedor)>$contador_prov){
                            $otro_valor=$pdf->GetPageHeight()-$head_total;
                            $pdf->SetAutoPageBreak(true,$otro_valor);
                        }else{
                            if(count($proveedor)>$contador_prov){
                                $pdf->SetAutoPageBreak(true,2); 
                            }else{
                                $pdf->SetAutoPageBreak(true,5);
                            }
                            
                        }
                        
                    }else{
                        $resta_valor_cuota0=$totales_factura+$totales_referencia;
                        $head_total=$pdf->GetY();
                        
                        
                        array_push($array_totales,$head_total.' Total '.$suma_factura);
                        if($head_total>240 && count($proveedor)>$contador_prov){
                            $otro_valor=$pdf->GetPageHeight()-$head_total;
                            $pdf->SetAutoPageBreak(true,$otro_valor);
                        }else{
                            if(count($proveedor)>$contador_prov){
                                $pdf->SetAutoPageBreak(true,2); 
                            }else{
                                $pdf->SetAutoPageBreak(true,2);
                            }
                            
                        }
                    }
                    $total_factura=0;
                    $total_abono=0;
                    $total_saldo=0;
                    $total_referencia=0;
                    $total_abono_ref=0;
                    $total_saldo_ref=0;
                    $suma_factura=0;
                    $suma_abono=0;
                    $suma_saldo=0;
                //
                //cambios sin mostrar saldos 0
                    // $pdf->Cell(109, 6, 'Total', 'T', 0, 'C', 0);
                    // $pdf->Cell(27, 6, $suma_factura, 'T', 0, 'C', 0);
                    // $pdf->Cell(27, 6, $suma_abono, 'T', 0, 'C', 0);
                    // $pdf->Cell(27, 6, $suma_saldo, 'T', 0, 'C', 0);
                    
                    // // if($head_total>180){
                    // //     $otro_valor=$pdf->GetPageHeight()-$head_total;
                    // //     $pdf->SetAutoPageBreak(true,$head_total);
                    // // }else{
                    // //     $pdf->SetAutoPageBreak(false);
                    // // }
                    // $total_factura=0;
                    // $total_abono=0;
                    // $total_saldo=0;
                    // $total_referencia=0;
                    // $total_abono_ref=0;
                    // $total_saldo_ref=0;
                    // $suma_factura=0;
                    // $suma_abono=0;
                    // $suma_saldo=0;
                
                    // if(count($proveedor)==$contador_prov){
                    //     $pdf->Ln(5);
                    // }else{
                    //     $pdf->Ln(10);
                    // }
                    // $head_total=$pdf->GetY();
                    // array_push($array_totales,$head_total.' Total '.$suma_factura);
                    // if($head_total>240 && count($proveedor)>$contador_prov){
                    //     $otro_valor=$pdf->GetPageHeight()-$head_total;
                    //     $pdf->SetAutoPageBreak(true,$otro_valor);
                    // }else{
                    //     if(count($proveedor)>$contador_prov){
                    //         $pdf->SetAutoPageBreak(true,2); 
                    //     }else{
                    //         $pdf->SetAutoPageBreak(true,5);
                    //     }
                        
                    // }
                //
                
                
                
        }
        //dd($array_totales);
            $pdf->SetX(10);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->Cell(109, 6, 'Totales', 0, 0, 'C', 0);
            $pdf->Cell(27, 6, number_format($sumatot_factura,2,".",","), 0, 0, 'C', 0);
            $pdf->Cell(27, 6, number_format($sumatot_abono,2,".",","), 0, 0, 'C', 0);
            $pdf->Cell(27, 6, number_format($sumatot_saldo,2,".",","), 0, 0, 'C', 0);
            if($ruta==null){
                $pdf->Output("cuenta_por_cobrar_Resumen_Factura.pdf", "D");
            }else{
                $pdf->Output($ruta.'/'."cuenta_por_cobrar_Resumen_Factura.pdf", "F");
            }
            return "toatal_deuda:".$total_deuda;
    }
    public function cuenta_cobrar_reporte_resumen_factura_vencido($reporte_nuevo,$reporte_valores_pagado,$datos, $fec_ini, $fec_fin,$vencido,$proveedor,$referencia,$empresa,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        $pdf->Cell(155, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('CUENTAS POR COBRAR'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode('Resumen Factura'), 0, 2, 'C', 0);
        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        //$pdf->SetXY(80,40);
        $id_prov="";
        $serie1="";
        $serie2="";
        $documento="";
        $resta=0;
        $resta_total=0;
        $fecha_emision="";
        $fecha_vencimiento="";
        $total_factura=0;
        $total_abono=0;
        $total_saldo=0;
        $suma_factura=0;
        $suma_abono=0;
        $suma_saldo=0;
        $totales_factura=0;
        $totales_abono=0;
        $totales_saldo=0;
        $sumatot_factura=0;
        $sumatot_abono=0;
        $sumatot_saldo=0;
        $pdf->Ln();
        $resta_ref=0;
        $resta_total_ref=0;
        $total_referencia=0;
        $total_abono_ref=0;
        $total_saldo_ref=0;
        $totales_referencia=0;
        $totales_abono_ref=0;
        $totales_saldo_ref=0;
        $array_totales=[];
        $contador_prov=0;
        $cantidad_cuotas=0;
        $total_factura0=0;
        $total_abono0=0;
        $total_saldo0=0;
        $sumatot_factura0=0;
        $sumatot_abono0=0;
        $sumatot_saldo0=0;
        $array_nv=[];
        $total_deuda="";
        foreach($proveedor as $detail){
                $total_deuda=$detail->valor_deuda;
                $id_prov=$detail->id_cliente;
                //array_push($array_nv,$detail->id_cliente);
                // $head_total=0;
                // $pdf->SetX(10);
                // $pdf->SetFillColor(240, 240, 240);
                // $pdf->SetFont('Arial', 'B', 8);
                // /*$pdf->Cell(15, 6, $detail->codigo, 1, 0, 'C', 0);
                // $pdf->Cell(25, 6, 'IDENTIFICACION', 1, 0, 'C', 0);
                // $pdf->Cell(25, 6, $detail->identificacion, 1, 0, 'R', 0);
                // $pdf->Cell(65, 6, $detail->nombre, 1, 0, 'L', 0);*/
                // $pdf->MultiCell(190, 4, $detail->codigo."   CI/RUC:   ".$detail->identificacion."   CLIENTE:   ".utf8_decode($detail->nombre).utf8_decode("   TELEFONO:   ".$detail->telefono).utf8_decode("   CONTACTO:   ".$detail->contacto), 0,'L', 0);
                // $pdf->Ln(1);
                // $pdf->SetX(10);
                // $pdf->SetFillColor(240, 240, 240);
                // $pdf->SetFont('Arial', 'B', 8);
                
                // $pdf->Cell(27, 6, 'No Doc', 1, 0, 'C', 0);
                // $pdf->Cell(27, 6, 'Serie', 1, 0, 'C', 0);
                // $pdf->Cell(27, 6, 'Fecha Emision', 1, 0, 'C', 0);
                // $pdf->Cell(28, 6, 'Fecha Vencimiento', 1, 0, 'C', 0);
                // $pdf->Cell(27, 6, 'Valor Facturado', 1, 0, 'C', 0);
                // $pdf->Cell(27, 6, 'Abonos', 1, 0, 'C', 0);
                // $pdf->Cell(27, 6, 'Saldos', 1, 0, 'C', 0);
                // $pdf->Ln();
                // $contador_prov++;

                //cambios sin mostrar saldos 0
                $existe_vencidos0=0;
                foreach($reporte_nuevo as $detailven){
                    if($detailven->id_proveedor==$id_prov){
                        if($detailven->vencido=='si'){
                            $existe_vencidos0++;
                        }
                    }
                }
                    foreach($reporte_nuevo as $detail0){
                        
                        if($detail0->id_cliente==$id_prov){
                            if($detail0->vencido=='si'){
                                $cantidad_cuotas++;
                            
                                $factura_id01=$detail0->id_factura;
                                $ref_id01=$detail0->referencias;
                                $nv_id01=$detail0->id_nota_venta;
                                $v_cuota201=$detail0->valor_cuota;
                                $saldo_factura01=0;
                                $saldo_ref01=0;
                                $saldo_nv01=0;
                                $saldo_exist01=0;
                                $exist_fact01=0;
                                $exist_ref01=0;
                                $exist_nv01=0;
                                $total_abono_fact0=0;
                                $total_abonoref0=0;
                                $total_saldo_fact0=0;
                                $total_saldoref0=0;
                                $total_abononv0=0;
                                $total_saldonv0=0;
                                
                                

                                
                                //array_push($array_nv,$nv_id01);
                                foreach($reporte_valores_pagado as $detail01){
                                    
                                    if($detail01->id_factura==$factura_id01 && $detail01->referencias==null && $detail01->id_nota_venta==null){
                                        $exist_fact01++;
                                    }else{
                                        if($detail01->referencias==$ref_id01 && $detail01->id_factura==null && $detail01->id_cliente==$id_prov && $detail01->id_nota_venta==null){
                                            $exist_ref01++;
                                        }else{
                                            
                                            if($detail01->id_factura==null && $detail01->referencias==null && $detail01->id_nota_venta==$nv_id01){
                                                $exist_nv01++;
                                                array_push($array_nv,$exist_nv01);
                                            }
                                        } 
                                    }
                                }
                                //dd($array_nv);
                                if($exist_fact01>0 || $exist_ref01>0 || $exist_nv01>0){
                                    foreach($reporte_valores_pagado as $detail02){
                                        if($detail02->id_factura==$factura_id01 && $detail02->referencias==null && $detail02->id_nota_venta==null){
                                            $saldo_factura01+=$v_cuota201-$detail02->valor_pagado;
                                        }else{
                                            if($detail02->referencias==$ref_id01 && $detail02->id_cliente==null && $detail02->id_cliente==$id_prov && $detail02->id_nota_venta==null){
                                                $saldo_ref01+=$v_cuota201-$detail02->valor_pagado;
                                            }else{
                                                if($detail02->id_factura==null && $detail02->referencias==null && $detail02->id_nota_venta==$nv_id01){
                                                    $saldo_nv01+=$v_cuota201-$detail02->valor_pagado;
                                                }
                                            } 
                                        }
                                    }
                                }else{
                                    $saldo_factura01+=$v_cuota201;
                                }
                                $saldo_exist01=$saldo_ref01+$saldo_factura01+$saldo_nv01;
                                if($saldo_exist01>0){
                                            $id_factura01=$detail0->id_factura;
                                            $id_nv01=$detail0->id_nota_venta;
                                            $id_ref0=$detail0->referencias;
                                            $v_cuota0=$detail0->valor_cuota;
                                            $exist_fact_pagado0=0;
                                            $exist_refe_pagado0=0;
                                            $exist_nv_pagado0=0;
                                            foreach($reporte_valores_pagado as $detail60){
                                                if($detail60->id_factura==$id_factura01 && $detail60->referencias==null && $detail60->id_nota_venta==null){
                                                    $exist_fact_pagado0++;
                                                }else{
                                                    if($detail60->referencias==$id_ref0 && $detail60->id_factura==null && $detail60->id_cliente==$id_prov && $detail60->id_nota_venta==null){
                                                        $exist_refe_pagado0++;
                                                    }else{
                                                        if($detail60->id_factura==null && $detail60->referencias==null && $detail60->id_nota_venta==$id_nv01){
                                                            $exist_nv_pagado0++;
                                                        }
                                                    } 
                                                }
                                            }
                                            
                                            if($exist_fact_pagado0>0 || $exist_refe_pagado0>0 || $exist_nv_pagado0>0){
                                                foreach($reporte_valores_pagado as $detail03){
                                                    if($detail03->id_factura==$id_factura01 && $detail03->referencias==null && $detail03->id_nota_venta==null){
            
                                                        $total_abono_fact0+=$detail03->valor_pagado;
                                                        $total_saldo_fact0+=$v_cuota201-$detail03->valor_pagado;
                                                    }else{
                                                        if($detail03->referencias==$id_ref0 && $detail03->id_factura==null && $detail03->id_cliente==$id_prov && $detail03->id_nota_venta==null){
                                                            $total_abonoref0+=$detail03->valor_pagado;
                                                            $total_saldoref0+=$v_cuota201-$detail03->valor_pagado;
                                                        }else{
                                                            if($detail03->id_factura==null && $detail03->referencias==null && $detail03->id_nota_venta==$id_nv01){
                                                                $total_abononv0+=$detail03->valor_pagado;
                                                                $total_saldonv0+=$v_cuota201-$detail03->valor_pagado;
                                                            }
                                                        }
                                                    }
                                                }
                                            }else{
                                                            $total_saldo_fact0+=$v_cuota201;
                                            }
                                }
                                if($saldo_exist01>0){
                                    $total_factura0+=$v_cuota201;
                                }
                                if($saldo_exist01>0){
                                    $total_abono0+=$total_abono_fact0+$total_abonoref0+$total_abononv0;
                                }
                                if($saldo_exist01>0){
                                    $total_saldo0+=$total_saldoref0+$total_saldo_fact0+$total_saldonv0;
                                }
                            }
                            
                        }
                    }
                    //dd($array_nv);
                    $suma_factura0=number_format($total_factura0,2,".",",");
                    $suma_abono0=number_format($total_abono0,2,".",",");
                    $suma_saldo0=number_format($total_deuda,2,".",",");
                    $suma_exist_vencido=$existe_vencidos0;

                    $pdf->SetX(10);
                    $pdf->SetFillColor(240, 240, 240);
                    $pdf->SetFont('Arial', 'B', 8);

                    if($suma_saldo0>0 && $suma_exist_vencido>0){
                        $head_prov=0;
                        /*$pdf->Cell(25, 6, 'IDENTIFICACION', 1, 0, 'C', 0);
                        $pdf->Cell(25, 6, $detail->identificacion, 1, 0, 'R', 0);
                        $pdf->Cell(65, 6, $detail->nombre, 1, 0, 'L', 0);*/
                        $pdf->MultiCell(190, 4, $detail->codigo."   CI/RUC:   ".$detail->identificacion."   CLIENTE:   ".utf8_decode($detail->nombre).utf8_decode("   TELEFONO:   ".$detail->telefono).utf8_decode("   CONTACTO:   ".$detail->contacto), 0,'L', 0);
                        $pdf->Ln(1);
                        $pdf->SetX(10);
                        $pdf->SetFillColor(240, 240, 240);
                        $pdf->SetFont('Arial', 'B', 8);
                        
                        $pdf->Cell(27, 6, 'No Doc', 1, 0, 'C', 0);
                        $pdf->Cell(27, 6, 'Serie', 1, 0, 'C', 0);
                        $pdf->Cell(27, 6, 'Fecha Emision', 1, 0, 'C', 0);
                        $pdf->Cell(28, 6, 'Fecha Vencimiento', 1, 0, 'C', 0);
                        $pdf->Cell(27, 6, 'Valor Facturado', 1, 0, 'C', 0);
                        $pdf->Cell(27, 6, 'Abonos', 1, 0, 'C', 0);
                        $pdf->Cell(27, 6, 'Saldos', 1, 0, 'C', 0);
                        $pdf->Ln();
                        $contador_prov++;
                    }
                    $diferencia1="";
                    $diferencia2="";
                    $diferencia3="";
                    $total_factura0=0;
                    $total_abono0=0;
                    $total_saldo0=0;
                    //$total_referencia0=0;
                    $total_abono_ref0=0;
                    $total_saldo_ref0=0;
                    $suma_factura0=0;
                    $suma_abono0=0;
                    $suma_saldo0=0;
                    $cantidad_cuotas01=0;
                    $suma_exist_vencido=0;
                //
            
                foreach($reporte_nuevo as $detail2){
                    if($detail2->id_cliente==$id_prov){
                        //cambios sin mostrar saldos 0
                            $cantidad_cuotas01++;
                        //
                        $pdf->SetX(10);
                        $resta=$detail2->saldo;
                        $resta_total=number_format($resta,2,".",",");
                        $pdf->SetFillColor(240, 240, 240);
                        $pdf->SetFont('Arial', '', 7);
                        $fecha_emision=date("d/m/Y", strtotime($detail2->fecha_emision));
                        $fecha_vencimiento=date("d/m/Y", strtotime($detail2->fecha_pago));
                        
                            $serie1=substr($detail2->observacion,24,3);
                            $serie2=substr($detail2->observacion,27,3);
                            $documento=substr($detail2->observacion,30,9);
                            $total_abono_fact=0;
                            $total_abonoref=0;
                            $total_saldo_fact=0;
                            $total_saldoref=0;
                            $total_abononv=0;
                            $total_saldonv=0;
                            $factura_id=$detail2->id_factura;
                            $nota_venta_id=$detail2->id_nota_venta;
                            $ref_id=$detail2->referencias;
                            $saldo_factura=0;
                            $saldo_ref=0;
                            $saldo_nv=0;
                            $saldo_exist=0;
                            $v_cuota2=$detail2->valor_cuota;
                            $exist_fact=0;
                            $exist_refe=0;
                            $exist_nv=0;
                            foreach($reporte_valores_pagado as $detail8){
                                if($detail8->id_factura==$factura_id && $detail8->referencias==null && $detail8->id_nota_venta==null){
                                    $exist_fact++;
                                }else{
                                    if($detail8->referencias==$ref_id && $detail8->id_factura==null && $detail8->id_nota_venta==null  && $detail8->id_cliente==$id_prov){
                                        $exist_refe++;
                                    }else{
                                        if($detail8->id_factura==null && $detail8->referencias==null && $detail8->id_nota_venta==$nota_venta_id){
                                            $exist_nv++;
                                        }
                                    } 
                                }
                            }

                            if($exist_fact>0 || $exist_refe>0 || $exist_nv>0){
                                foreach($reporte_valores_pagado as $detail7){
                                    if($detail7->id_factura==$factura_id && $detail7->referencias==null && $detail7->id_nota_venta==null){
                                        $saldo_factura+=$v_cuota2-$detail7->valor_pagado;
                                    }else{
                                        if($detail7->referencias==$ref_id && $detail7->id_factura==null && $detail7->id_cliente==$id_prov && $detail7->id_nota_venta==null){
                                            $saldo_ref+=$v_cuota2-$detail7->valor_pagado;
                                        }else{
                                            if($detail7->id_factura==null && $detail7->referencias==null && $detail7->id_nota_venta==$nota_venta_id){
                                                $saldo_nv+=$v_cuota2-$detail7->valor_pagado;
                                            }
                                        } 
                                    }
                                }
                            }else{
                                $saldo_factura+=$v_cuota2;
                            }
                            $saldo_exist=number_format($saldo_ref+$saldo_factura+$saldo_nv,2,".",",");
                            if($detail2->vencido=='si' && $saldo_exist>0){
                                $pdf->SetFillColor(250, 217, 82);
                                if($detail2->observacion){
                                    $pdf->Cell(27, 6, $documento, 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, $serie1.'-'.$serie2, 1, 0, 'C', 1);
                                }else{
                                    $pdf->Cell(27, 6, $detail2->referencias, 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, '', 1, 0, 'C', 1);
                                }
                                $id_factura=$detail2->id_factura;
                                $id_nota_venta=$detail2->id_nota_venta;
                                $id_ref=$detail2->referencias;
                                $pdf->Cell(27, 6, $fecha_emision, 1, 0, 'C', 1);
                                $pdf->Cell(28, 6, $fecha_vencimiento, 1, 0, 'C', 1);
                                $pdf->Cell(27, 6, $detail2->valor_cuota, 1, 0, 'C', 1);
                                $v_cuota=$detail2->valor_cuota;
                                $exist_fact_pagado=0;
                                $exist_refe_pagado=0;
                                $exist_nv_pagado=0;
                                foreach($reporte_valores_pagado as $detail5){
                                    if($detail5->id_factura==$id_factura && $detail5->referencias==null && $detail5->id_nota_venta==null){
                                        $exist_fact_pagado++;
                                    }else{
                                        if($detail5->referencias==$id_ref && $detail5->id_factura==null && $detail5->id_cliente==$id_prov && $detail5->id_nota_venta==null){
                                            $exist_refe_pagado++;
                                        }else{
                                            if($detail5->id_factura==null && $detail5->referencias==null && $detail5->id_nota_venta==$id_nota_venta){
                                                $exist_nv_pagado++;
                                            }
                                        } 
                                    }
                                }

                                if($exist_fact_pagado>0 || $exist_refe_pagado>0 || $exist_nv_pagado>0){
                                    foreach($reporte_valores_pagado as $detail3){
                                        if($detail3->id_factura==$id_factura && $detail3->referencias==null && $detail3->id_nota_venta==null){
                                            $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                            $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                            $total_abono_fact+=$detail3->valor_pagado;
                                            $total_saldo_fact+=$v_cuota-$detail3->valor_pagado;
                                        }else{
                                            if($detail3->referencias==$id_ref && $detail3->id_factura==null && $detail3->id_cliente==$id_prov && $detail3->id_nota_venta==null){
                                                $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                $total_abonoref+=$detail3->valor_pagado;
                                                $total_saldoref+=$v_cuota-$detail3->valor_pagado;
                                            }else{
                                                if($detail3->id_factura==null && $detail3->referencias==null && $detail3->id_nota_venta==$id_nota_venta){
                                                    $pdf->Cell(27, 6, number_format($detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                    $pdf->Cell(27, 6, number_format($v_cuota-$detail3->valor_pagado,2,".",","), 1, 0, 'C', 1);
                                                    $total_abononv+=$detail3->valor_pagado;
                                                    $total_saldonv+=$v_cuota-$detail3->valor_pagado;
                                                }
                                            }
                                        }
                                    }
                                }else{
                                    $pdf->Cell(27, 6, '0.00', 1, 0, 'C', 1);
                                    $pdf->Cell(27, 6, number_format($v_cuota,2,".",","), 1, 0, 'C', 1);
                                    $total_saldo_fact+=$v_cuota;
                                }
                                
                                //cambios sin mostrar saldos 0
                                    $pdf->Ln();
                                //
                            }
                            if($detail2->vencido=='si' && $saldo_exist>0){
                                $sumatot_factura+=$detail2->valor_cuota;
                                $sumatot_abono+=$total_abono_fact+$total_abonoref+$total_abononv;
                                $sumatot_saldo+=$total_saldoref+$total_saldo_fact+$total_saldonv;
                            }
                            //cambios sin mostrar saldos 0
                                // $pdf->Ln();
                                // $total_factura+=$detail2->valor_cuota;
                                // $total_abono+=$total_abono_fact+$total_abonoref;
                                // $total_saldo+=$total_saldoref+$total_saldo_fact;
                                // $totales_factura+=$detail2->valor_cuota;
                                // $totales_abono+=$total_abono_fact+$total_abonoref;
                                // $totales_saldo+=$total_saldoref+$total_saldo_fact;
                                $exist_fact=0;
                                $exist_refe=0;
                                if($saldo_exist>0 && $detail2->vencido=='si'){
                                    $total_factura+=$detail2->valor_cuota;
                                }
                                if($saldo_exist>0 && $detail2->vencido=='si'){
                                    $total_abono+=$total_abono_fact+$total_abonoref+$total_abononv;
                                }
                                if($saldo_exist>0 && $detail2->vencido=='si'){
                                    $total_saldo+=$total_saldoref+$total_saldo_fact+$total_saldonv;
                                }
                                
                                // if($saldo_exist>0){
                                //     $totales_factura+=$detail2->valor_cuota;
                                // }
                                // if($saldo_exist>0){
                                //     $totales_abono+=$total_abono_fact+$total_abonoref;
                                // }
                                // if($saldo_exist>0){
                                //     $totales_saldo+=$total_saldoref+$total_saldo_fact;
                                // }
                                
                                $v_cuota2=0;
                            //
                    }         
                }
                $pdf->SetX(10);
                $suma_factura=$total_factura+$total_referencia;
                $suma_abono=$total_abono+$total_abono_ref;
                $suma_saldo=$total_saldo+$total_saldo_ref;
                
                
                //$sumatot_factura=number_format($totales_factura+$totales_referencia,2,".",",");
                
                $pdf->SetFillColor(240, 240, 240);
                $pdf->SetFont('Arial', 'B', 8);
                $pdf->SetTextColor(0, 0, 0);
                //cambios sin mostrar saldos 0
                    $resta_valor_cuota0=0;
                    if($suma_saldo>0){
                        $pdf->Cell(109, 6, 'Total', 'T', 0, 'C', 0);
                        $pdf->Cell(27, 6, number_format($suma_factura,2,".",","), 'T', 0, 'C', 0);
                        $pdf->Cell(27, 6, number_format($suma_abono,2,".",","), 'T', 0, 'C', 0);
                        $pdf->Cell(27, 6, number_format($suma_saldo,2,".",","), 'T', 0, 'C', 0);
                        if(count($proveedor)==$contador_prov){
                            $pdf->Ln(5);
                        }else{
                            $pdf->Ln(10);
                        }
                        $head_total=$pdf->GetY();
                    
                        
                        array_push($array_totales,$head_total.' Total '.$suma_factura);
                        if($head_total>240 && count($proveedor)>$contador_prov){
                            $otro_valor=$pdf->GetPageHeight()-$head_total;
                            $pdf->SetAutoPageBreak(true,$otro_valor);
                        }else{
                            if(count($proveedor)>$contador_prov){
                                $pdf->SetAutoPageBreak(true,2); 
                            }else{
                                $pdf->SetAutoPageBreak(true,5);
                            }
                            
                        }
                        
                    }else{
                        $resta_valor_cuota0=$totales_factura+$totales_referencia;
                        $head_total=$pdf->GetY();
                        
                        
                        array_push($array_totales,$head_total.' Total '.$suma_factura);
                        if($head_total>240 && count($proveedor)>$contador_prov){
                            $otro_valor=$pdf->GetPageHeight()-$head_total;
                            $pdf->SetAutoPageBreak(true,$otro_valor);
                        }else{
                            if(count($proveedor)>$contador_prov){
                                $pdf->SetAutoPageBreak(true,2); 
                            }else{
                                $pdf->SetAutoPageBreak(true,2);
                            }
                            
                        }
                    }
                    $total_factura=0;
                    $total_abono=0;
                    $total_saldo=0;
                    $total_referencia=0;
                    $total_abono_ref=0;
                    $total_saldo_ref=0;
                    $suma_factura=0;
                    $suma_abono=0;
                    $suma_saldo=0;
                //
                //cambios sin mostrar saldos 0
                    // $pdf->Cell(109, 6, 'Total', 'T', 0, 'C', 0);
                    // $pdf->Cell(27, 6, $suma_factura, 'T', 0, 'C', 0);
                    // $pdf->Cell(27, 6, $suma_abono, 'T', 0, 'C', 0);
                    // $pdf->Cell(27, 6, $suma_saldo, 'T', 0, 'C', 0);
                    
                    // // if($head_total>180){
                    // //     $otro_valor=$pdf->GetPageHeight()-$head_total;
                    // //     $pdf->SetAutoPageBreak(true,$head_total);
                    // // }else{
                    // //     $pdf->SetAutoPageBreak(false);
                    // // }
                    // $total_factura=0;
                    // $total_abono=0;
                    // $total_saldo=0;
                    // $total_referencia=0;
                    // $total_abono_ref=0;
                    // $total_saldo_ref=0;
                    // $suma_factura=0;
                    // $suma_abono=0;
                    // $suma_saldo=0;
                
                    // if(count($proveedor)==$contador_prov){
                    //     $pdf->Ln(5);
                    // }else{
                    //     $pdf->Ln(10);
                    // }
                    // $head_total=$pdf->GetY();
                    // array_push($array_totales,$head_total.' Total '.$suma_factura);
                    // if($head_total>240 && count($proveedor)>$contador_prov){
                    //     $otro_valor=$pdf->GetPageHeight()-$head_total;
                    //     $pdf->SetAutoPageBreak(true,$otro_valor);
                    // }else{
                    //     if(count($proveedor)>$contador_prov){
                    //         $pdf->SetAutoPageBreak(true,2); 
                    //     }else{
                    //         $pdf->SetAutoPageBreak(true,5);
                    //     }
                        
                    // }
                //
                
                
                
        }
        //dd($array_totales);
            $pdf->SetX(10);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 10);
            $pdf->SetTextColor(0, 0, 0);
            $pdf->Cell(109, 6, 'Totales', 0, 0, 'C', 0);
            $pdf->Cell(27, 6, number_format($sumatot_factura,2,".",","), 0, 0, 'C', 0);
            $pdf->Cell(27, 6, number_format($sumatot_abono,2,".",","), 0, 0, 'C', 0);
            $pdf->Cell(27, 6, number_format($sumatot_saldo,2,".",","), 0, 0, 'C', 0);
            if($ruta==null){
                $pdf->Output("cuenta_por_cobrar_Resumen_Factura.pdf", "D");
            }else{
                $pdf->Output($ruta.'/'."cuenta_por_cobrar_Resumen_Factura.pdf", "F");
            }
            return "toatal_deuda:".$total_deuda;
    }
    public function cuenta_cobrar_reporte_dias_vencidos($reporte_nuevo,$datos, $fec_ini, $fec_fin,$vencido,$proveedor,$empresa,$ruta=null){
        $fecha_actual = date("d/m/Y");
        //$pdf = new FPDF('L', 'mm', 'A4');
        $pdf = new Header_Ctas_Cobrar_Dias_Venc('L', 'mm', 'A4');
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);

        $pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            $pdf->Image($logo, 12, 12, 55, 20);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(75, 10);
        $pdf->Cell(155, 10, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('CUENTAS POR COBRAR'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode('Dias Vencimiento'), 0, 2, 'C', 0);
        $pdf->SetXY(230, 11);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(20, 6, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(20, 6, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(250, 11);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(20, 6, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(20, 6, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(20, 6, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        //$pdf->SetXY(80,40);
        $id_prov="";
        $serie1="";
        $serie2="";
        $documento="";
        $resta=0;
        $resta_total=0;
        $fecha_emision="";
        $fecha_vencimiento="";
        $total_factura=0;
        $total_abono=0;
        $total_saldo=0;
        $suma_factura=0;
        $suma_abono=0;
        $suma_saldo=0;
        $totales_factura=0;
        $totales_abono=0;
        $totales_saldo=0;
        $sumatot_factura=0;
        $sumatot_abono=0;
        $sumatot_saldo=0;
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFillColor(240, 240, 240);
        $pdf->SetFont('Arial', 'B', 8);
        //$pdf->Cell(10, 6, 'No. Factura', 1, 0, 'C', 0);
        /*$pdf->Cell(20, 6, 'No. Doc', 1, 0, 'C', 0);
        //$pdf->Cell(15, 6, 'Serie', 1, 0, 'C', 0);
        $pdf->Cell(60, 6, 'Cliente', 1, 0, 'C', 0);
        $pdf->Cell(20, 6, 'Fecha', 1, 0, 'C', 0);
        $pdf->Cell(20, 6, 'Valor', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '-120', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '-90', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '-60', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '-30', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '0', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '30', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '60', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '90', 1, 0, 'C', 0);
        $pdf->Cell(15, 6, '120', 1, 0, 'C', 0);
        $pdf->Cell(20, 6, 'Total', 1, 0, 'C', 0);
        $pdf->Ln();*/
        $margin = 10;
            $height = $pdf->GetY();
            $height_products = $height +2;
            //$pdf->SetFillColor(141, 207, 140);
                    $pdf->SetXY($margin, $height_products);
                    $pdf->MultiCell(25, 6, utf8_decode('No. Doc'), 1, 'C', 0);
                    $pdf->SetXY(35, $height_products);
                    $pdf->MultiCell(70, 6, utf8_decode('Cliente'), 1, 'C', 0);
                    $pdf->SetXY(105, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('Fecha'), 1, 'C', 0);
                    $pdf->SetXY(120, $height_products);
                    $pdf->MultiCell(20, 6, utf8_decode('Valor'), 1, 'C', 0);
                    $pdf->SetXY(140, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('-120'), 1, 'C', 0);
                    $pdf->SetXY(155, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('-90'), 1, 'C', 0);
                    $pdf->SetXY(170, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('-60'), 1, 'C', 0);
                    $pdf->SetXY(185, $height_products);
                    $pdf->MultiCell(15, 6, utf8_decode('-30'), 1, 'C', 0);
                    $pdf->SetXY(200, $height_products);
                    $pdf->MultiCell(25, 6, utf8_decode('Total Vencido'), 1, 'C', 0);
                    $pdf->SetXY(225, $height_products);
                    $pdf->MultiCell(60, 6, utf8_decode('Observaciones'), 1, 'C', 0);
                    // $pdf->MultiCell(15, 6, utf8_decode('30'), 1, 'C', 0);
                    // $pdf->SetXY(220, $height_products);
                    // $pdf->MultiCell(15, 6, utf8_decode('60'), 1, 'C', 0);
                    // $pdf->SetXY(235, $height_products);
                    // $pdf->MultiCell(15, 6, utf8_decode('90'), 1, 'C', 0);
                    // $pdf->SetXY(250, $height_products);
                    // $pdf->MultiCell(15, 6, utf8_decode('120'), 1, 'C', 0);
                    // $pdf->SetXY(265, $height_products);
                    // $pdf->MultiCell(20, 6, utf8_decode('Total'), 1, 'C', 0);
                    //dd("X=".$margin."Y=".$height_products);
                    $y = $height_products + 8;
                    $pdf->SetFont('Helvetica', '', 4);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetXY($margin, $height_products+6);
                    $pdf->SetWidths(array(25, 70, 15, 20,15,15,15,15,25,60));
        $id_fact="";
        $total_0=0;
        $total_30=0;
        $total_60=0;
        $total_90=0;
        $total_120=0;
        $total_neg30=0;
        $total_neg60=0;
        $total_neg90=0;
        $total_neg120=0;
        $total_fact=0;
        $suma_total_0=0;
        $suma_total_30=0;
        $suma_total_60=0;
        $suma_total_90=0;
        $suma_total_120=0;
        $suma_total_neg30=0;
        $suma_total_neg60=0;
        $suma_total_neg90=0;
        $suma_total_neg120=0;
        $total_referencia=0;
        $total_abono_ref=0;
        $total_saldo_ref=0;
        $suma_referencia=0;
        $suma_abono_ref=0;
        $suma_saldo_ref=0;
        $totales_referencia=0;
        $totales_abono_ref=0;
        $totales_saldo_ref=0;
        $sumatot_referencia=0;
        $sumatot_abono_ref=0;
        $sumatot_saldo_ref=0;
        $total_0_ref=0;
        $total_30_ref=0;
        $total_60_ref=0;
        $total_90_ref=0;
        $total_120_ref=0;
        $total_neg30_ref=0;
        $total_neg60_ref=0;
        $total_neg90_ref=0;
        $total_neg120_ref=0;
        $total_ref=0;
        $suma_total_0_ref=0;
        $suma_total_30_ref=0;
        $suma_total_60_ref=0;
        $suma_total_90_ref=0;
        $suma_total_120_ref=0;
        $suma_total_neg30_ref=0;
        $suma_total_neg60_ref=0;
        $suma_total_neg90_ref=0;
        $suma_total_neg120_ref=0;
        foreach($reporte_nuevo as $detail){
            if($detail->observacion){
                $serie1=substr($detail->observacion,24,3);
                $serie2=substr($detail->observacion,27,3);
                $documento=substr($detail->observacion,30,9);
            }else{
                $documento=$detail->referencias;
            }
            
            $total_fact+=$detail->mencientoveinte+
                         $detail->mennoventa+
                         $detail->mensesenta+
                         $detail->mentreninta+
                         $detail->cero+
                         $detail->treninta+
                         $detail->sesenta+
                         $detail->noventa+
                         $detail->cientoveinte;
            if($empresa->nombre_empresa=='ALMACENES SU HOGAR'){
                $total_factura=number_format($detail->total_vencido,2,".",",");
            }else{
                $total_factura=number_format($total_fact,2,".",",");
            }
            
            $total_saldo+=$total_fact;
            $nto_docu=intval($documento);
            $data = array(
                utf8_decode($nto_docu."Centrado"),
                utf8_decode($detail->nombre),
                date("d/m/Y", strtotime($detail->fecha_emision))."Centrado",
                number_format($detail->saldo,2,".",",")."Derecha",
                number_format($detail->mencientoveinte,2,".",",")."Derecha",
                number_format($detail->mennoventa,2,".",",")."Derecha",
                number_format($detail->mensesenta,2,".",",")."Derecha",
                number_format($detail->mentreninta,2,".",",")."Derecha",
                $total_factura."Derecha",
                ""."Derecha"
                
                
                //utf8_decode('INMEDIATA'),
                
            );
            $total_fact=0;
            //$id_fact="";
            $total_factura=0;
            $total_abono+=$detail->saldo;
            $total_0+=$detail->cero;
            $total_30+=$detail->treninta;
            $total_60+=$detail->sesenta;
            $total_90+=$detail->noventa;
            $total_120+=$detail->cientoveinte;
            $total_neg30+=$detail->mentreninta;
            $total_neg60+=$detail->mensesenta;
            $total_neg90+=$detail->mennoventa;
            $total_neg120+=$detail->mencientoveinte;
                
                //array_unshift($data, utf8_decode('* sin imagen'));
            //dd("Imagen:".$imagen.$detail->imagen);
            $pdf->RowCtas($data, $margin);
        }
            $sumatot_abono=number_format($total_abono,2,".",",");
            $sumatot_factura=number_format($total_saldo,2,".",",");
            $suma_total_0=number_format($total_0,2,".",",");
            $suma_total_30=number_format($total_30,2,".",",");
            $suma_total_60=number_format($total_60,2,".",",");
            $suma_total_90=number_format($total_90,2,".",",");
            $suma_total_120=number_format($total_120,2,".",",");
            $suma_total_neg30=number_format($total_neg30,2,".",",");
            $suma_total_neg60=number_format($total_neg60,2,".",",");
            $suma_total_neg90=number_format($total_neg90,2,".",",");
            $suma_total_neg120=number_format($total_neg120,2,".",",");
            $pdf->SetX(10);
            $pdf->SetFillColor(240, 240, 240);
            $pdf->SetFont('Arial', 'B', 8);
            $pdf->Cell(110, 6, 'Total', 0, 0, 'C', 0);
            $pdf->Cell(20, 6, $sumatot_abono, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_neg120, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_neg90, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_neg60, 0, 0, 'R', 0);
            $pdf->Cell(15, 6, $suma_total_neg30, 0, 0, 'R', 0);
            $pdf->Cell(25, 6, $suma_total_0, 0, 0, 'R', 0);
            $pdf->Cell(60, 6, "", 0, 0, 'R', 0);
            
            //$pdf->Output("cuenta_por_pagar_Dias_Vencimiento.pdf", "D");
            if($ruta==null){
                $pdf->Output("cuenta_por_cobrar_Dias_Vencimiento.pdf", "D");
            }else{
                $pdf->Output($ruta.'/'."cuenta_por_cobrar_Dias_Vencimiento.pdf", "F");
            }

    }
    public function cuenta_cobrar_reporte_anticipo($clientes, $anticipos, $fec_ini, $fec_fin, $pagos_anticipo,$empresa,$ruta=null){
        $fecha_actual = date("d/m/Y");
        $pdf = new FPDF('P', 'mm', 'A4');
        //$pdf->SetAutoPageBreak(true,5);
        $pdf->AliasNbPages();
        $pdf->AddPage();
        $pdf->SetFont('Arial', 'B', 8);
        
        //$pdf->RoundedRect(10, 10, 275, 25, 2, '1234', 'D');
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa . '/imagen/' . $empresa->logo;
        if ($empresa->logo && file_exists($logo)) {
            //$pdf->Image($logo, 12, 12, 55, 20);
            $pdf->Image($logo, 12, 11, 45, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            
        }
        $pdf->SetTextColor(0, 0, 0);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(35, 10);
        $pdf->Cell(155, 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(155, 8, utf8_decode('CUENTAS POR COBRAR'), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 10);
        $pdf->Cell(155, 4, utf8_decode('Anticipo'), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        //dd("FEcha inicial:",$fec_ini,"FEcha final:",$fec_fin);
        /*if ($fec_ini !== null && $fec_fin === null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini !== null && $fec_fin !== null) {*/
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        /*} else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }*/
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);
        $pdf->Ln();
        $head_id_prov=0;
        foreach($clientes as $detail){
            $pdf->SetX(10);
            $pdf->SetFillColor(255, 255, 255);
            $pdf->SetFont('Arial', 'B', 8);
            /*$pdf->Cell(15, 6, $detail->codigo, 0, 0, 'C', 0);
            $pdf->Cell(25, 6, 'IDENTIFICACION', 0, 0, 'C', 0);
            $pdf->Cell(25, 6, $detail->identificacion, 0, 0, 'R', 0);
            $pdf->Cell(75, 6, utf8_decode($detail->nombre), 0, 0, 'L', 0);*/
            $head_id_prov=$pdf->GetY();
            //array_push($array_totales_fact,$head_id_prov.'Cleinte'.$detail->codigo);
                                // if($head_id_prov>190){
                                //     $otro_valor_prov=$pdf->GetPageHeight()-$head_id_prov;
                                //     $pdf->SetAutoPageBreak(true,$otro_valor_prov);
                                // }
            $pdf->MultiCell(190, 4, $detail->codigo."   CI/RUC:   ".$detail->identificacion."   CLIENTE:   ".utf8_decode($detail->nombre).utf8_decode("   TELEFONO:   ".$detail->telefono).utf8_decode("   CONTACTO:   ".$detail->contacto), 0,'L', 0);
            $pdf->Ln(2);
            $pdf->Cell(190, 5, 'ANTICIPOS', 0, 2, 'C', 0);
            $array_head=[];
                            $pdf->SetX(10);
                            $pdf->SetFillColor(2255, 2255, 2255);
                            $pdf->SetFont('Arial', 'B', 8);
                            $head_cab=$pdf->GetY();
                            
                            
                            //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                            $pdf->Cell(19, 6, 'Fecha', 1, 0, 'C', 0);
                           
                            $pdf->Cell(58, 6, 'Nro Cheque', 1, 0, 'C', 0);
                            $pdf->Cell(82, 6, 'Forma Pago', 1, 0, 'C', 0);
                            //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                            //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
                            $pdf->Cell(31, 6, 'Valor', 1, 0, 'C', 0);
                            //$pdf->Cell(35, 6, 'Saldos', 1, 0, 'C', 1);
                            $pdf->Ln();
                            
                            $pdf->SetX(10);
                            $total_anticipo=0;
                            foreach($anticipos as $detail2){
                                if($detail->id_cliente==$detail2->id_cliente){
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(255, 255, 255);
                                    $pdf->SetFont('Arial', '', 7);
            
                                    
                                    
                                    //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                                    $pdf->Cell(19, 6, date("d/m/Y", strtotime($detail2->fecha_anticipo)), 1, 0, 'C', 1);
                                
                                    $pdf->Cell(58, 6, utf8_decode($detail2->numero_transaccion), 1, 0, 'C', 1);
                                    $pdf->Cell(82, 6, utf8_decode($detail2->descripcion_fp), 1, 0, 'L', 1);
                                    //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                                    //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
                                    $pdf->Cell(31, 6, number_format($detail2->valor_cuota,2,".",","), 1, 0, 'R', 1);
                                    //$pdf->Cell(35, 6, 'Saldos', 1, 0, 'C', 1);
                                    $pdf->Ln();
                                    $total_anticipo+=$detail2->valor_cuota;
                                }
                                
                            }
                            $pdf->SetX(10);
                            $pdf->SetFillColor(2255, 2255, 2255);
                            $pdf->SetFont('Arial', 'B', 7);
                            $pdf->Cell(159, 6, 'Total', 'T', 0, 'C', 1);
                            $pdf->Cell(31, 6, number_format($total_anticipo,2,".",","), 'T', 1, 'R', 1);
                            $pdf->Ln(2);
                            $exist_pagos=0;
                            $total_pagos=0;
                            foreach($pagos_anticipo as $detail3){
                                if($detail->id_cliente==$detail3->id_cliente){
                                    $exist_pagos++;
                                    if($exist_pagos==1){
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 8);
                                        $pdf->Cell(190, 5, 'PAGOS', 0, 2, 'C', 0);
                                        $pdf->SetX(10);
                                        $pdf->SetFillColor(255, 255, 255);
                                        $pdf->SetFont('Arial', 'B', 8);
                                        $pdf->Cell(19, 6, 'Fecha', 1, 0, 'C', 0);
                           
                                        $pdf->Cell(58, 6, 'Nro Comprobante', 1, 0, 'C', 0);
                                        $pdf->Cell(82, 6, 'Forma Pago', 1, 0, 'C', 0);
                                        //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                                        //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
                                        $pdf->Cell(31, 6, 'Valor', 1, 0, 'C', 0);
                                        $pdf->Ln();
                                    }
                                    
                                    $pdf->SetX(10);
                                    $pdf->SetFillColor(2255, 2255, 2255);
                                    $pdf->SetFont('Arial', '', 7);
            
                                    $serie1=substr($detail3->clave_acceso,24,3);
                                    $serie2=substr($detail3->clave_acceso,27,3);
                                    $documento=substr($detail3->clave_acceso,30,9);
                                    //$pdf->Cell(31, 6, $documento, 1, 0, 'C', 1);
                                    
                                    //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                                    $pdf->Cell(19, 6, date("d/m/Y", strtotime($detail3->fecha_emision)), 1, 0, 'C', 1);
                                
                                    $pdf->Cell(58, 6, $serie1."-".$serie2."-".$documento, 1, 0, 'C', 1);
                                    $pdf->Cell(82, 6, 'ANTICIPO', 1, 0, 'C', 1);
                                    //$pdf->Cell(25, 6, 'Transaccion', 1, 0, 'C', 0);
                                    //$pdf->Cell(25, 6, 'Fecha', 1, 0, 'C', 0);
                                    $pdf->Cell(31, 6, number_format($detail3->total_pago_ant,2,".",","), 1, 0, 'R', 1);
                                    //$pdf->Cell(35, 6, 'Saldos', 1, 0, 'C', 1);
                                    $pdf->Ln();
                                    $total_pagos+=$detail3->total_pago_ant;
                                }
                                
                            }
                            if($exist_pagos>0){
                                $pdf->SetX(10);
                                $pdf->SetFillColor(2255, 2255, 2255);
                                $pdf->SetFont('Arial', 'B', 7);
                                $pdf->Cell(159, 6, 'Total', 'T', 0, 'C', 1);
                                $pdf->Cell(31, 6, number_format($total_pagos,2,".",","), 'T', 1, 'R', 1);
                                $pdf->Ln(2);
                            }
                                $pdf->SetX(10);
                                $pdf->SetFillColor(2255, 2255, 2255);
                                $pdf->SetFont('Arial', 'B', 8);
                                $pdf->Cell(159, 6, 'TOTAL DEUDA', 0, 0, 'C', 1);
                                $pdf->Cell(31, 6, number_format($total_anticipo-$total_pagos,2,".",","), 0, 1, 'R', 1);
                                $pdf->Ln(2);

        }
        if($ruta==null){
            $pdf->Output("cuenta_por_cobrar_Anticipo.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."cuenta_por_cobrar_Anticipo.pdf", "F");
        }
    }
    public function cuentasPorPagar($datos, $fec_ini, $fec_fin)
    {
        $pdf = new FPDF('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $pdf->AddPage();
        $pdf->AliasNbPages();

        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        //$pdf->Image('../server/' . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo, null, null, 65, 25);
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(60, 10);
        $pdf->Cell(105, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(105, 8, utf8_decode('RESUMEN CUENTAS POR PAGAR'), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else if ($fec_ini != null && $fec_fin != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = date("d/m/Y", strtotime($fec_fin));
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);

        //HEADER FOR TABLE
        $pdf->SetY(32);
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(15, 5, 'CODIGO', 'TB', 0, 'C', 1);
        $pdf->Cell(85, 5, 'PROVEEDOR', 'TB', 0, 'C', 1);
        $pdf->Cell(25, 5, 'SALDO ANTERIOR', 'TB', 0, 'C', 1);
        $pdf->Cell(20, 5, 'COMPRAS', 'TB', 0, 'C', 1);
        $pdf->Cell(20, 5, 'ABONOS', 'TB', 0, 'C', 1);
        $pdf->Cell(25, 5, 'SALDO ACTUAL', 'TB', 0, 'C', 1);
        $pdf->Ln();

        //fill cells
        $tsant = 0;
        $tdebe = 0;
        $thaber = 0;
        $tsactual = 0;
        $pdf->SetFont('Arial', '', 7);
        $pdf->SetY(38);
        foreach ($datos as $detail) {
            $pdf->Cell(15, 4, $detail->codigo, 0, 0, 'L', 1);
            $pdf->Cell(85, 4, utf8_decode($detail->nombre), 0, 0, 'L', 1);
            $pdf->Cell(25, 4, $detail->saldo_anterior, 0, 0, 'R', 1);
            $pdf->Cell(20, 4, $detail->saldo_anterior, 0, 0, 'R', 1);
            $pdf->Cell(20, 4, $detail->abono, 0, 0, 'R', 1);
            $pdf->Cell(25, 4, $detail->saldo_actual, 0, 0, 'R', 1);
            $pdf->Ln();
            $tsant = $detail->saldo_anterior + $tsant;
            $tdebe = $detail->saldo_anterior + $tdebe;
            $thaber = $detail->abono + $thaber;
            $tsactual = $detail->saldo_actual + $tsactual;
        }

        //footer
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(100, 6, 'TOTAL:', 'T', 0, 'R', 1);
        $pdf->Cell(25, 6, $tsant, 'T', 0, 'R', 1);
        $pdf->Cell(20, 6, $tdebe, 'T', 0, 'R', 1);
        $pdf->Cell(20, 6, $thaber, 'T', 0, 'R', 1);
        $pdf->Cell(25, 6, $tsactual, 'T', 0, 'R', 1);

        $pdf->Output("cuentas-por-pagar.pdf", "D");
    }
    public function empleado($datos, $fec_ini)
    {
        $pdf = new FPDF('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $logo="";
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $datos[0]->id_empresa . '/imagen/' . $datos[0]->logo;
        if ($datos[0]->logo!==null && file_exists($logo)) {
            $pdf->Image($logo, 12, 11, 55, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
        }
        $pdf->SetFont('Arial', 'B', 14);
        $pdf->SetXY(60, 10);
        $pdf->Cell(105, 10, utf8_decode($datos[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->Cell(105, 8, utf8_decode('Empleados'), 0, 2, 'C', 0);

        $pdf->SetXY(165, 10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, utf8_decode('Fecha:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Hasta:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, $fecha_actual, 0, 2, 'R', 0);
        if ($fec_ini != null) {
            $fec_desde = date("d/m/Y", strtotime($fec_ini));
            $fec_hasta = $fecha_actual;
        } else {
            $fec_desde = $fecha_actual;
            $fec_hasta = $fecha_actual;
        }
        //dd($fec_ini);
        $pdf->Cell(15, 5, $fec_desde, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $fec_hasta, 0, 2, 'R', 0);
        $pdf->Cell(15, 5, $pdf->PageNo() . ' de {nb}', 0, 2, 'R', 0);

        //HEADER FOR TABLE
        $pdf->SetY(34);
        $pdf->SetFillColor(255, 255, 255);
        $pdf->SetFont('Arial', 'B', 7);
        $pdf->Cell(75, 5, 'NOMBRE', 'TB', 0, 'C', 1);
        $pdf->Cell(30, 5, 'No IDENTIFICACION', 'TB', 0, 'C', 1);
        $pdf->Cell(35, 5, 'DEPARTAMENTO', 'TB', 0, 'C', 1);
        $pdf->Cell(20, 5, 'CARGO', 'TB', 0, 'C', 1);
        $pdf->Cell(10, 5, 'EDAD', 'TB', 0, 'C', 1);
        $pdf->Cell(15, 5, 'SUELDO', 'TB', 0, 'C', 1);
        $pdf->Ln();

        //fill cells
        $tsant = 0;
        $tdebe = 0;
        $thaber = 0;
        $tsactual = 0;
        $pdf->SetFont('Arial', '', 7);
        $pdf->SetY(40);
        foreach ($datos as $detail) {
            $pdf->Cell(75, 4, utf8_decode($detail->apellido_paterno).' '.utf8_decode($detail->apellido_materno).' '.utf8_decode($detail->primer_nombre).' '.$detail->segundo_nombre,0, 0, 'L', 1);
            $pdf->Cell(27, 4, $detail->dni, 0, 0, 'R', 1);
            $pdf->Cell(38, 4, utf8_decode($detail->dep_nombre), 0, 0, 'C', 1);
            $pdf->Cell(20, 4, utf8_decode($detail->car_nombre), 0, 0, 'C', 1);
            $pdf->Cell(10, 4, $detail->edad, 0, 0, 'R', 1);
            $pdf->Cell(15, 4, $detail->sueldo, 0, 0, 'R', 1);
            $pdf->Ln();
        }
        $pdf->Output("empleados.pdf", "D");

        
    }
    public function PDFAsientos($datos,$empresa,$nomcta,$ucrea,$ruta=null){
        setlocale(LC_TIME, "spanish");
        $pdf = new FPDF('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $width = $pdf->GetPageWidth();
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $url=constant("DATA_EMPRESA");
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa[0]->id_empresa.'/imagen/'.$empresa[0]->logo;
        if ($empresa[0]->logo!==null && file_exists($logo)) {
            $pdf->Image($logo,  12, 11, 40, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(0, 0, 0);
        }
        
        //$pdf->Image($url.'/'.$empresa[0]->id_empresa.'/imagen/'.$empresa[0]->logo, 12, 11, 40, 18);
        $pdf->SetFont('Arial', 'B', 14);
        $head_emp=0;
        if($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa))>110){
            $pdf->SetXY(48, 12);
            $pdf->MultiCell(111,4,utf8_decode($empresa[0]->nombre_empresa),0,'C');
            $head_emp=$pdf->GetY();
         }else{
             $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)) / 2), 12);
             $pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)), 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
             $head_emp=$pdf->GetY()-1;
         }
        //$pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)) / 2), 12);
        //$pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)), 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Asientos Contables')) / 2), $head_emp-2);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode('Asientos Contables')), 8,utf8_decode('Asientos Contables'), 0, 2, 'C', 0);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(ucwords(strftime("%B %Y", strtotime($datos[0]->fecha)))) / 2), 22);
        $pdf->Cell($pdf->GetStringWidth(ucwords(strftime("%B %Y", strtotime($datos[0]->fecha)))), 8, ucwords(strftime("%B %Y", strtotime($datos[0]->fecha))), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        
        $pdf->SetXY(($width / 6) * 4.5, 11.5);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "Fecha:", 0, 2, 'L', 0);
        //$pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) * 5, 11.5);
        // $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        //if ($fecha_ini != null) {
            //$fec_desde = date("d/m/Y", strtotime($datos[0]->fecha_reguistro));
            //$fec_hasta = date("d/m/Y", strtotime($datos[0]->fecha_conciliacion));
        //}
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($fecha_actual), 5, $fecha_actual, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_desde), 5, $fec_desde, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_hasta), 5, $fec_hasta, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($pdf->PageNo() . ' de {nb}'), 5, $pdf->PageNo() . ' de {nb}' , 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $existe_ident=0;

        if($datos[0]->ruc_ci){
            $existe_ident++;
        }
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        // if($existe_ident<=0){
        //     $pdf->Cell(63.3, 4, utf8_decode("NÃºmero: ").$datos[0]->codigo, 0, 0, 'C', 0);
        //     $pdf->Cell(63.3, 4, utf8_decode("Comprobante: ").strtoupper($datos[0]->tipo), 0, 0, 'C', 0);
        //     $pdf->Cell(63.3, 4, utf8_decode("Fecha: ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 0, 'C', 0);
        // }else{
        //     $pdf->Cell(38, 4, utf8_decode("NÃºmero: ").$datos[0]->codigo, 0, 0, 'L', 0);
        //     $pdf->Cell(38, 4, utf8_decode("Comprobante: ").strtoupper($datos[0]->tipo), 0, 0, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode("Fecha: ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 0, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode($datos[0]->tipo_identificacion), 0, 1, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode("IdentificaciÃ³n: ").$datos[0]->ruc_ci, 0, 1, 'C', 0);
        // }
        $pdf->Cell(95, 4, utf8_decode("NÃºmero:          ").$datos[0]->codigo, 0, 0, 'L', 0);
        $pdf->Cell(95, 4, utf8_decode("Comprobante: ").strtoupper($datos[0]->tipo), 0, 1, 'L', 0);
        
        //$pdf->Ln(5);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(95, 4, utf8_decode("Razon Social: ").utf8_decode($datos[0]->razon_social), 0, 0, 'L', 0);
        $pdf->Cell(95, 4, utf8_decode("Concepto:        ").utf8_decode($datos[0]->concepto), 0, 1, 'L', 0);
        $pdf->SetX(10);
        if($existe_ident<=0){
        $pdf->Cell(63.3, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 1, 'L', 0);
        }else{
            $pdf->Cell(95, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 0, 'L', 0);
            //$pdf->Cell(63.3, 4, utf8_decode($datos[0]->tipo_identificacion), 0, 0, 'L', 0);
            $pdf->Cell(95, 4, utf8_decode("IdentificaciÃ³n: ").$datos[0]->ruc_ci, 0, 1, 'L', 0);
        }
        $pdf->Ln(5);
        $existe_pago=0;
        foreach($datos as $detail){
            if($detail->fecha_de_pago){
                $existe_pago++;
            }
        }
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 7);
        if($existe_pago<=0){
            $pdf->Cell(67.5, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
            $pdf->Cell(87.86, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
        }else{
            $pdf->Cell(32.14, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
            $pdf->Cell(47.14, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
            $pdf->Cell(22.14, 5, utf8_decode("Fecha Pago"), 'TB', 0, 'C', 0);
            $pdf->Cell(35.14, 5, utf8_decode("Forma Pago"), 'TB', 0, 'C', 0);
            $pdf->Cell(19.14, 5, utf8_decode("No Documento"), 'TB', 0, 'C', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
        }
        
        
        $pdf->Ln();
        $suma_debe=0;
        $suma_haber=0;
        foreach($datos as $detail){
            
            $pdf->SetX(10);
            $pdf->SetFont('Arial', '', 7);
            if($existe_pago<=0){
                $pdf->Cell(67.5, 5, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
                $pdf->Cell(87.86, 5, $detail->codcta."-".utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                $pdf->Cell(17.14, 5, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                $pdf->Cell(17.14, 5, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
            }else{
                $pdf->Cell(32.14, 5, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
                $pdf->Cell(47.14, 5, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
                if($detail->fecha_de_pago){
                    $pdf->Cell(22.14, 5, date("d/m/Y",strtotime($detail->fecha_de_pago)), 0, 0, 'C', 0);
                }else{
                    $pdf->Cell(22.14, 5, "", 0, 0, 'C', 0);
                }
                $pdf->Cell(35.14, 5, utf8_decode($detail->descripcion_forma_p), 0, 0, 'L', 0);
                $pdf->Cell(19.14, 5, $detail->no_documento, 0, 0, 'R', 0);
                $pdf->Cell(17.14, 5, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                $pdf->Cell(17.14, 5, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
            }
            $pdf->Ln();
            $suma_debe+=$detail->debe;
            $suma_haber+=$detail->haber;
        }
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(155.36, 5, utf8_decode("Total"), 0, 0, 'C', 0);
        $pdf->Cell(17.14, 5, number_format($suma_debe,2,".",","), "T", 0, 'R', 0);
        $pdf->Cell(17.14, 5, number_format($suma_haber,2,".",","), "T", 0, 'R', 0);
        $pdf->Ln(30);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("ELABORADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("APROBADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("RECIBI CONFORME"), "T", 0, 'C', 0);
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode($ucrea), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        if($empresa[0]->nombre_empresa=='C.E. FUEGOS GROUP'){
            $pdf->Cell(45, 5, utf8_decode('Shirley Egas / Carlos Egas'), 0, 0, 'C', 0);
        }else{
            $pdf->Cell(45, 5, utf8_decode($empresa[0]->nomb_representante), 0, 0, 'C', 0);
        }
       
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("CI: "), 0, 0, 'L', 0);
        if($ruta==null){
            $pdf->Output("asiento_contable.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."asiento_contable.pdf", "F");
        }
    }

    public function PDFDepreciacion($datos,$empresa,$nomcta,$ucrea,$ruta=null){
        setlocale(LC_TIME, "spanish");
        $pdf = new FPDF('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $width = $pdf->GetPageWidth();
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $url=constant("DATA_EMPRESA");
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa[0]->id_empresa.'/imagen/'.$empresa[0]->logo;
        if ($empresa[0]->logo!==null && file_exists($logo)) {
            $pdf->Image($logo,  12, 11, 40, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(0, 0, 0);
        }
        
        //$pdf->Image($url.'/'.$empresa[0]->id_empresa.'/imagen/'.$empresa[0]->logo, 12, 11, 40, 18);
        $pdf->SetFont('Arial', 'B', 14);
        $head_emp=0;
        if($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa))>110){
            $pdf->SetXY(48, 12);
            $pdf->MultiCell(111,4,utf8_decode($empresa[0]->nombre_empresa),0,'C');
            $head_emp=$pdf->GetY();
         }else{
             $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)) / 2), 12);
             $pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)), 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
             $head_emp=$pdf->GetY()-1;
         }
        //$pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)) / 2), 12);
        //$pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)), 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Depreciacion')) / 2), $head_emp-2);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode('Depreciacion')), 8,utf8_decode('Depreciacion'), 0, 2, 'C', 0);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(ucwords(strftime("%B %Y", strtotime($nomcta[0]->fecha_fin)))) / 2), 22);
        $pdf->Cell($pdf->GetStringWidth(ucwords(strftime("%B %Y", strtotime($nomcta[0]->fecha_fin)))), 8, ucwords(strftime("%B %Y", strtotime($nomcta[0]->fecha_fin))), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        
        $pdf->SetXY(($width / 6) * 4.5, 11.5);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "Fecha:", 0, 2, 'L', 0);
        //$pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) * 5, 11.5);
        // $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        //if ($fecha_ini != null) {
            //$fec_desde = date("d/m/Y", strtotime($datos[0]->fecha_reguistro));
            //$fec_hasta = date("d/m/Y", strtotime($datos[0]->fecha_conciliacion));
        //}
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($fecha_actual), 5, $fecha_actual, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_desde), 5, $fec_desde, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_hasta), 5, $fec_hasta, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($pdf->PageNo() . ' de {nb}'), 5, $pdf->PageNo() . ' de {nb}' , 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $existe_ident=0;


        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        // if($existe_ident<=0){
        //     $pdf->Cell(63.3, 4, utf8_decode("NÃºmero: ").$datos[0]->codigo, 0, 0, 'C', 0);
        //     $pdf->Cell(63.3, 4, utf8_decode("Comprobante: ").strtoupper($datos[0]->tipo), 0, 0, 'C', 0);
        //     $pdf->Cell(63.3, 4, utf8_decode("Fecha: ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 0, 'C', 0);
        // }else{
        //     $pdf->Cell(38, 4, utf8_decode("NÃºmero: ").$datos[0]->codigo, 0, 0, 'L', 0);
        //     $pdf->Cell(38, 4, utf8_decode("Comprobante: ").strtoupper($datos[0]->tipo), 0, 0, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode("Fecha: ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 0, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode($datos[0]->tipo_identificacion), 0, 1, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode("IdentificaciÃ³n: ").$datos[0]->ruc_ci, 0, 1, 'C', 0);
        // }
        
        //$pdf->Ln(5);
        
        $pdf->Ln(5);
        $existe_pago=0;

        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 7);

            $pdf->Cell(49.28, 5, utf8_decode("Nombre Activo"), 'TB', 0, 'C', 0);
            $pdf->Cell(32, 5, utf8_decode("Fecha"), 'TB', 0, 'C', 0);
            $pdf->Cell(22.14, 5, utf8_decode("Dias"), 'TB', 0, 'C', 0);
            $pdf->Cell(35.14, 5, utf8_decode("Tipo Activo"), 'TB', 0, 'C', 0);
            //$pdf->Cell(19.14, 5, utf8_decode("No Documento"), 'TB', 0, 'C', 0);
            $pdf->Cell(34.28, 5, utf8_decode("Grupo Activo"), 'TB', 0, 'C', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Valor"), 'TB', 0, 'R', 0);
        
        
        
        $pdf->Ln();
        $suma_debe=0;
        $suma_haber=0;
        foreach($datos as $detail){
            
            $pdf->SetX(10);
            $pdf->SetFont('Arial', '', 7);
                $pdf->Cell(49.28, 5, utf8_decode($detail->nombre_activo_fijo), 0, 0, 'L', 0);
                $pdf->Cell(32, 5, date("d/m/Y",strtotime($detail->fecha_activo)), 0, 0, 'C', 0);
                
                $pdf->Cell(22.14, 5, $detail->dias_transcurridos, 0, 0, 'C', 0);
                
                $pdf->Cell(35.14, 5, utf8_decode($detail->grupo_activo), 0, 0, 'L', 0);
                //$pdf->Cell(19.14, 5, $detail->no_documento, 0, 0, 'R', 0);
                $pdf->Cell(34.28, 5, utf8_decode($detail->tipo_activo), 0, 0, 'L', 0);
                $pdf->Cell(17.14, 5, number_format($detail->valor_depreciacion,2,".",","), 0, 0, 'R', 0);
            
            $pdf->Ln();
            //$suma_debe+=$detail->debe;
            $suma_haber+=$detail->valor_depreciacion;
        }
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(172.5, 5, utf8_decode("Total"), 0, 0, 'C', 0);
        //$pdf->Cell(17.14, 5, number_format($suma_debe,2,".",","), "T", 0, 'R', 0);
        $pdf->Cell(17.14, 5, number_format($suma_haber,2,".",","), "T", 0, 'R', 0);
        $pdf->Ln(30);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("ELABORADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("APROBADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("RECIBI CONFORME"), "T", 0, 'C', 0);
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode($ucrea), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        if($empresa[0]->nombre_empresa=='C.E. FUEGOS GROUP'){
            $pdf->Cell(45, 5, utf8_decode('Shirley Egas / Carlos Egas'), 0, 0, 'C', 0);
        }else{
            $pdf->Cell(45, 5, utf8_decode($empresa[0]->nomb_representante), 0, 0, 'C', 0);
        }
        //$pdf->Cell(45, 5, utf8_decode($empresa[0]->nombre_contador), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("CI: "), 0, 0, 'L', 0);
        if($ruta==null){
            $pdf->Output("Depreciacion ".ucwords(strftime("%B %Y", strtotime($nomcta[0]->fecha_fin))).".pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."asiento_contable.pdf", "F");
        }
    }

    public function PDFCtaCobrar($datos,$datos_pago,$empresa,$usuario,$index,$fecha,$cta_cliente,$cta_pago,$ruta=null){
        setlocale(LC_TIME,"es_ES");
        $pdf = new FPDF('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $width = $pdf->GetPageWidth();
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $url=constant("DATA_EMPRESA");
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa.'/imagen/'.$empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            $pdf->Image($logo,  12, 11, 40, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(0, 0, 0);
        }
        
        $pdf->Image($url.'/'.$empresa->id_empresa.'/imagen/'.$empresa->logo, 12, 11, 40, 18);
        $pdf->SetFont('Arial', 'B', 14);
        $head_emp=0;
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>110){
            $pdf->SetXY(48, 12);
            $pdf->MultiCell(111,4,utf8_decode($empresa->nombre_empresa),0,'C');
            $head_emp=$pdf->GetY();
         }else{
             $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)) / 2), 12);
             $pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)), 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
             $head_emp=$pdf->GetY()-1;
         }
        //$pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)) / 2), 12);
        //$pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)), 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Comprobante Ingreso')) / 2), $head_emp-2);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode('Comprobante Ingreso')), 8,utf8_decode('Comprobante Ingreso'), 0, 2, 'C', 0);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth('') / 2), 22);
        $pdf->Cell($pdf->GetStringWidth(''), 8, '', 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        
        $pdf->SetXY(($width / 6) * 4.5, 11.5);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "Fecha:", 0, 2, 'L', 0);
        //$pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) * 5, 11.5);
        // $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        //if ($fecha_ini != null) {
            //$fec_desde = date("d/m/Y", strtotime($datos[0]->fecha_reguistro));
            //$fec_hasta = date("d/m/Y", strtotime($datos[0]->fecha_conciliacion));
        //}
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($fecha_actual), 5, $fecha_actual, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_desde), 5, $fec_desde, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_hasta), 5, $fec_hasta, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($pdf->PageNo() . ' de {nb}'), 5, $pdf->PageNo() . ' de {nb}' , 0, 2, 'L', 0);
        $pdf->Ln(7);
        $existe_ident=0;
        //dd($datos);
        if($datos_pago[0]->identificacion){
            $existe_ident++;
        }
        $fecha_cta="";
        if($datos_pago[0]->fecha_registro){
            $fecha_cta=$datos_pago[0]->fecha_registro;
        }else{
            $fecha_cta=$datos_pago[0]->fecha_pago;
        }
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        // if($existe_ident<=0){
        //     $pdf->Cell(63.3, 4, utf8_decode("NÃºmero: ").$datos[0]->codigo, 0, 0, 'C', 0);
        //     $pdf->Cell(63.3, 4, utf8_decode("Comprobante: ").strtoupper($datos[0]->tipo), 0, 0, 'C', 0);
        //     $pdf->Cell(63.3, 4, utf8_decode("Fecha: ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 0, 'C', 0);
        // }else{
        //     $pdf->Cell(38, 4, utf8_decode("NÃºmero: ").$datos[0]->codigo, 0, 0, 'L', 0);
        //     $pdf->Cell(38, 4, utf8_decode("Comprobante: ").strtoupper($datos[0]->tipo), 0, 0, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode("Fecha: ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 0, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode($datos[0]->tipo_identificacion), 0, 1, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode("IdentificaciÃ³n: ").$datos[0]->ruc_ci, 0, 1, 'C', 0);
        // }

        // $pdf->Cell(95, 4, utf8_decode("NÃºmero:          ")."CC-".$index, 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("Comprobante: ").strtoupper('ingreso'), 0, 1, 'L', 0);
        
        // //$pdf->Ln(5);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // //$pdf->Cell(95, 4, utf8_decode("Razon Social: ").utf8_decode($datos[0]->nombre), 0, 0, 'L', 0);
        // //$head_razon=$pdf->GetY();
        // $head_razon=$pdf->GetY();
        // $pdf->MultiCell(95, 3, utf8_decode("Razon Social: ").utf8_decode($datos_pago[0]->nombre), 0,'L', 0);
        // $head_razon2=$pdf->GetY();
        // $pdf->SetXY(105,$head_razon);
        // $pdf->MultiCell(95, 3, utf8_decode("Concepto:        ")."Cobro Cliente ".$fecha, 0, 'L', 0);
        // $head_concepto=$pdf->GetY();
        // $pdf->SetXY(105,$head_concepto);
        // $pdf->Cell(95, 4, utf8_decode("IdentificaciÃ³n: ").$datos_pago[0]->identificacion, 0, 1, 'L', 0);
        // $pdf->SetX(10);
        // //if($existe_ident<=0){
        // $pdf->SetXY(10,$head_razon2);
        // $pdf->Cell(63.3, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($fecha_cta)), 0, 1, 'L', 0);

        $pdf->Cell(95, 4, utf8_decode("NÃºmero:          ")."CC-".$index, 0, 0, 'L', 0);
        //$pdf->Cell(95, 4, utf8_decode("Comprobante: ").strtoupper('egreso'), 0, 1, 'L', 0);
        $pdf->Cell(63.3, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($fecha_cta)), 0, 1, 'L', 0);
        //$pdf->Ln(5);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        if($pdf->GetStringWidth(utf8_decode($datos_pago[0]->nombre))>95){
            $head_razon_x=$pdf->GetX();
            $pdf->MultiCell(95, 3, utf8_decode("Razon Social: ").utf8_decode($datos_pago[0]->nombre), 0, 'L', 0);
            $head_razon_y=$pdf->GetY();
        }else{
            $pdf->Cell(95, 4, utf8_decode("Razon Social: ").utf8_decode($datos_pago[0]->nombre), 0, 0, 'L', 0);
        }
        
        //$pdf->MultiCell(95, 3, utf8_decode("Concepto:        ")."Pago Proveedor ".$fecha, 0,'L', 0);
        //$head_concepto=$pdf->GetY();
        //$head_concepto=$pdf->GetY();
        //$pdf->SetXY(10,$head_concepto+1);
        //$pdf->SetX(10);
        //if($existe_ident<=0){
        if($existe_ident>0){
        //$pdf->Cell(63.3, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($datos[0]->fmodifica)), 0, 1, 'L', 0);
        //}else{
            //$pdf->Cell(95, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($datos[0]->fmodifica)), 0, 0, 'L', 0);
            //$pdf->Cell(63.3, 4, utf8_decode($datos[0]->tipo_identificacion), 0, 0, 'L', 0);
            if($pdf->GetStringWidth(utf8_decode($datos_pago[0]->nombre))>95){
                $pdf->SetXY(105,42);
            }
            $pdf->Cell(95, 4, utf8_decode("IdentificaciÃ³n: ").$datos_pago[0]->identificacion, 0, 1, 'L', 0);
            
        }else{
            $pdf->Cell(95, 4, '', 0, 1, 'L', 0);
            
        }
        if($pdf->GetStringWidth(utf8_decode($datos_pago[0]->nombre))>95){
            $pdf->SetXY(10,$head_razon_y);
        }else{
            $pdf->SetX(10);
        }
        
        $pdf->MultiCell(195, 4, utf8_decode("Concepto:       ")."Cobro Factura ".$fecha, 0,'L', 0);
        $pdf->Ln(5);
        // }else{
        //     $pdf->SetXY(10,$head_razon2);
        //     $pdf->Cell(95, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($datos[0]->fmodifica)), 0, 0, 'L', 0);
        //     //$pdf->Cell(63.3, 4, utf8_decode($datos[0]->tipo_identificacion), 0, 0, 'L', 0);
        //     $pdf->Cell(95, 4, utf8_decode("IdentificaciÃ³n: ").$datos[0]->identificacion, 0, 1, 'L', 0);
        // }
        $pdf->Ln(5);

        $existe_pago=0;
        foreach($datos as $detail){
            if($detail->pagos_por){
                $existe_pago++;
            }
        }
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 7);
        if($existe_pago<=0){
            $pdf->Cell(67.5, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
            $pdf->Cell(87.86, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
            $pdf->Ln();
        }else{
            $pdf->Cell(32.14, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
            $pdf->Cell(47.14, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
            $pdf->Cell(22.14, 5, utf8_decode("Fecha Pago"), 'TB', 0, 'C', 0);
            $pdf->Cell(35.14, 5, utf8_decode("Forma Pago"), 'TB', 0, 'C', 0);
            $pdf->Cell(19.14, 5, utf8_decode("No Documento"), 'TB', 0, 'C', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
            $pdf->Ln();
        }
        $pdf->SetFont('Arial', '', 7);
        $suma_debe_cliente=0;
        $suma_debe_pago=0;
        $suma_haber_cliente=0;
        $suma_haber_pago=0;
        $total_debe=0;
        $total_haber=0;
        $valor_real_cliente=0;
        $cliente_pago=0;
        //dd($cta_cliente);
        foreach($cta_cliente as $detail){
            $cliente_pago+=$detail->haber;
        }
        if($cliente_pago!==$cta_cliente[0]->haber_talves){
            $valor_real_cliente=$cta_cliente[0]->haber_talves-$cliente_pago;
        }
        
        $id_cliente=0;
        foreach($cta_cliente as $detail){
            $id_cliente++;
            $diferencia_pago=0;
            if($existe_pago<=0){
                $pdf->Cell(67.5, 4, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
                if($detail->exist_plan_cuenta_cliente=="si"){
                    $pdf->Cell(87.86, 4, utf8_decode($detail->nombre_cuenta_cliente), 0, 0, 'L', 0);
                }else{
                    $pdf->Cell(87.86, 4, utf8_decode($detail->nombre_cuenta_grupo), 0, 0, 'L', 0);
                }
                $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                //$pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
                if(count($cta_cliente)<=$id_cliente){
                    if($valor_real_cliente!==0){
                        $diferencia_pago=$detail->haber+$valor_real_cliente;
                        $pdf->Cell(17.14, 4, number_format($diferencia_pago,2,".",","), 0, 0, 'R', 0);
                    }else{
                        $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
                    }
                }else{
                    $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
                }
            }else{
                $pdf->Cell(32.14, 4, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
                if($detail->exist_plan_cuenta_cliente=="si"){
                    $pdf->Cell(47.14, 4, utf8_decode($detail->nombre_cuenta_cliente), 0, 0, 'L', 0);
                }else{
                    $pdf->Cell(47.14, 4, utf8_decode($detail->nombre_cuenta_grupo), 0, 0, 'L', 0);
                }
                $pdf->Cell(22.14, 4, "", 0, 0, 'C', 0);
                $pdf->Cell(35.14, 4, utf8_decode(""), 0, 0, 'C', 0);
                $pdf->Cell(19.14, 4, utf8_decode(""), 0, 0, 'C', 0);
                $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                //$pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
                if(count($cta_cliente)<=$id_cliente){
                    if($valor_real_cliente!==0){
                        $diferencia_pago=$detail->haber+$valor_real_cliente;
                        $pdf->Cell(17.14, 4, number_format($diferencia_pago,2,".",","), 0, 0, 'R', 0);
                    }else{
                        $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
                    }
                }else{
                    $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
                }
            }
            $suma_debe_cliente+=$detail->debe;

            //$suma_haber_cliente+=$detail->haber;
            if(count($cta_cliente)<=$id_cliente){
                if($valor_real_cliente!==0){
                    $suma_haber_cliente+=$diferencia_pago;
                }else{
                    $suma_haber_cliente+=$detail->haber;
                }
            }else{
                $suma_haber_cliente+=$detail->haber;
            }
            $pdf->Ln();
        }
        $valor_real_pago=0;
        $pagos=0;
        foreach($cta_pago as $detail){
            $pagos+=$detail->debe;
        }
        if($pagos!==$cta_pago[0]->debe_tal){
            $valor_real_pago=$cta_pago[0]->debe_tal-$pagos;
        }
        //dd()
        $id_pagos=0;
        foreach($cta_pago as $detail){
            $id_pagos++;
            $diferencia_pago=0;
            if($existe_pago<=0){
                $pdf->Cell(67.5, 4, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
                $pdf->Cell(87.86, 4, utf8_decode($detail->nombre_cuenta), 0, 0, 'L', 0);
                //$pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                if(count($cta_pago)<=$id_pagos){
                    if($valor_real_pago!==0){
                        $diferencia_pago=$detail->debe+$valor_real_pago;
                        $pdf->Cell(17.14, 4, number_format($diferencia_pago,2,".",","), 0, 0, 'R', 0);
                    }else{
                        $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                    }
                }else{
                    $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                }
                $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
            }else{
                $pdf->Cell(32.14, 4, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
                $pdf->Cell(47.14, 4, utf8_decode($detail->nombre_cuenta), 0, 0, 'L', 0);
                $pdf->Cell(22.14, 4, date("d/m/Y",strtotime($detail->fecha_pago)), 0, 0, 'C', 0);
                $pdf->Cell(35.14, 4, utf8_decode($detail->nombre_pago), 0, 0, 'C', 0);
                $pdf->Cell(19.14, 4, utf8_decode($detail->nro_tarjeta), 0, 0, 'C', 0);
                //$pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                if(count($cta_pago)<=$id_pagos){
                    if($valor_real_pago!==0){
                        $diferencia_pago=$detail->debe+$valor_real_pago;
                        $pdf->Cell(17.14, 4, number_format($diferencia_pago,2,".",","), 0, 0, 'R', 0);
                    }else{
                        $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                    }
                }else{
                    $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                }
                $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
            }
            //$suma_debe_pago+=$detail->debe;
            if(count($cta_pago)<=$id_pagos){
                if($valor_real_pago!==0){
                    $suma_debe_pago+=$diferencia_pago;
                }else{
                    $suma_debe_pago+=$detail->debe;
                }
            }else{
                $suma_debe_pago+=$detail->debe;
            }
            $suma_haber_pago+=$detail->haber;
            $pdf->Ln();
        }

        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(155.36, 6, 'TOTAL', 0, 0, 'C', 0);
        $total_debe=$suma_debe_cliente+$suma_debe_pago;
        $total_haber=$suma_haber_cliente+$suma_haber_pago;
        $pdf->Cell(17.4, 6, number_format($total_debe,2,".",","), 'T', 0, 'R', 0);
        $pdf->Cell(17.4, 6, number_format($total_haber,2,".",","), 'T', 0, 'R', 0);
        $pdf->Ln(30);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("ELABORADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("APROBADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("RECIBI CONFORME"), "T", 0, 'C', 0);
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode($usuario->nombres)." ".utf8_decode($usuario->apellidos), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        if($empresa->nombre_empresa=='C.E. FUEGOS GROUP'){
            $pdf->Cell(45, 5, utf8_decode('Shirley Egas / Carlos Egas'), 0, 0, 'C', 0);
        }else{
            $pdf->Cell(45, 5, utf8_decode($empresa->nomb_representante), 0, 0, 'C', 0);
        }
        //$pdf->Cell(45, 5, utf8_decode($empresa->nomb_representante), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("CI: "), 0, 0, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);

        // $pdf->SetX(20);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(20, 6, $datos[0]->codigo, 0, 0, 'C', 0);
        // $pdf->Cell(25, 6, 'IDENTIFICACION', 0, 0, 'C', 0);
        // $pdf->Cell(20, 6, $datos[0]->identificacion, 0, 0, 'R', 0);
        // $pdf->Cell(140, 6, $datos[0]->nombre, 0, 0, 'L', 0);
        // $pdf->Ln(10);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 7);
        // $pdf->Cell(31.7, 6, 'Nro. Comprobantes', 'TB', 0, 'C', 0);
        // $pdf->Cell(31.7, 6, 'Pagos Por', 'TB', 0, 'C', 0);
        // $pdf->Cell(21.7, 6, 'Fecha Pago', 'TB', 0, 'C', 0);
        // $pdf->Cell(61.7, 6, 'Forma Pago', 'TB', 0, 'C', 0);
        // $pdf->Cell(21.7, 6, 'Descuento', 'TB', 0, 'C', 0);
        // $pdf->Cell(21.7, 6, 'Pago', 'TB', 0, 'C', 0);
        // $pdf->Ln();
        // $pdf->SetFont('Arial', '', 7);
        // $saldo=0;
        // $total_saldo=0;
        // $descuento=0;
        // $total_descuento=0;
        // foreach($datos as $detail){
        //     $serie1="";
        //     $serie2="";
        //     $observacion="";
            
        //     if($detail->clave_acceso){
        //         $serie1=substr($detail->clave_acceso,24,3);
        //         $serie2=substr($detail->clave_acceso,27,3);
        //         $observacion=substr($detail->clave_acceso,30,9);
        //         $pdf->Cell(31.7, 4, $serie1."-".$serie2."-".$observacion, 0, 0, 'C', 0);
        //     }else{
        //         $pdf->Cell(31.7, 4, $detail->referencias, 0, 0, 'C', 0);
        //     }
        //     $pdf->Cell(31.7, 4, utf8_decode($detail->pagos_por), 0, 0, 'C', 0);
        //     $pdf->Cell(21.7, 4, date("d/m/Y",strtotime($detail->fmodifica)), 0, 0, 'C', 0);
        //     $pdf->Cell(61.7, 4, /*utf8_decode($detail->descripcion)*/'SIN UTILIZACION DEL SISTEMA FINANCIERO', 0, 0, 'L', 0);
        //     $pdf->Cell(21.7, 4, number_format($detail->descuento,2,".",","), 0, 0, 'R', 0);
        //     if($detail->valor_pagado>$detail->valor_cuota){
        //         $saldo=$detail->valor_cuota;
        //     }else{
        //         $saldo=$detail->valor_pagado; 
        //     }
        //     $total_saldo+=$saldo;
        //     $total_descuento+=$detail->descuento; 
        //     $pdf->Cell(21.7, 4, number_format($saldo,2,".",","), 0, 0, 'R', 0);
        //     $pdf->Ln();
        //     $saldo=0;
        // }
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(146.8, 6, 'TOTAL', 0, 0, 'C', 0);
        // $pdf->Cell(21.7, 6, number_format($total_descuento,2,".",","), 'T', 0, 'R', 0);
        // $pdf->Cell(21.7, 6, number_format($total_saldo,2,".",","), 'T', 0, 'R', 0);
        // $pdf->Ln(30);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("ELABORADO POR"), "T", 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("APROBADO POR"), "T", 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("RECIBI CONFORME"), "T", 0, 'C', 0);
        // $pdf->Ln();
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', '', 8);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode($usuario->nombres)." ".utf8_decode($usuario->apellidos), 0, 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode($empresa->nombre_contador), 0, 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("CI: "), 0, 0, 'L', 0);
        // $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        // $existe_ident=0;

        
        // $existe_pago=0;
        // foreach($datos as $detail){
        //     if($detail->fecha_de_pago){
        //         $existe_pago++;
        //     }
        // }
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 7);
        // if($existe_pago<=0){
        //     $pdf->Cell(67.5, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(87.86, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
        // }else{
        //     $pdf->Cell(32.14, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(47.14, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(22.14, 5, utf8_decode("Fecha Pago"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(35.14, 5, utf8_decode("Forma Pago"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(19.14, 5, utf8_decode("No Documento"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
        // }
        
        
        // $pdf->Ln();
        // $suma_debe=0;
        // $suma_haber=0;
        // foreach($datos as $detail){
            
        //     $pdf->SetX(10);
        //     $pdf->SetFont('Arial', '', 7);
        //     if($existe_pago<=0){
        //         $pdf->Cell(67.5, 5, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
        //         $pdf->Cell(87.86, 5, $detail->codcta."-".utf8_decode($detail->nomcta), 0, 0, 'L', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
        //     }else{
        //         $pdf->Cell(32.14, 5, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
        //         $pdf->Cell(47.14, 5, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
        //         if($detail->fecha_de_pago){
        //             $pdf->Cell(22.14, 5, date("d/m/Y",strtotime($detail->fecha_de_pago)), 0, 0, 'C', 0);
        //         }else{
        //             $pdf->Cell(22.14, 5, "", 0, 0, 'C', 0);
        //         }
        //         $pdf->Cell(35.14, 5, utf8_decode($detail->descripcion_forma_p), 0, 0, 'L', 0);
        //         $pdf->Cell(19.14, 5, $detail->no_documento, 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
        //     }
        //     $pdf->Ln();
        //     $suma_debe+=$detail->debe;
        //     $suma_haber+=$detail->haber;
        // }
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(155.36, 5, utf8_decode("Total"), 0, 0, 'C', 0);
        // $pdf->Cell(17.14, 5, number_format($suma_debe,2,".",","), "T", 0, 'R', 0);
        // $pdf->Cell(17.14, 5, number_format($suma_haber,2,".",","), "T", 0, 'R', 0);
        // $pdf->Ln(30);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("ELABORADO POR"), "T", 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("APROBADO POR"), "T", 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("RECIBI CONFORME"), "T", 0, 'C', 0);
        // $pdf->Ln();
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', '', 8);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode($ucrea), 0, 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode($empresa[0]->nombre_contador), 0, 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("CI: "), 0, 0, 'L', 0);
        if($ruta==null){
            $pdf->Output("cobro_cliente.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."cobro_cliente.pdf", "F");
        }
    }
    public function PDFCtaPagar($cta_cobrar_pagos,$datos_pago,$datos,$empresa,$usuario,$index,$fecha,$cta_cliente,$cta_pago,$ruta=null){
        setlocale(LC_TIME,"es_ES");
        $pdf = new FPDF('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $width = $pdf->GetPageWidth();
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $url=constant("DATA_EMPRESA");
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa.'/imagen/'.$empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            $pdf->Image($logo,  12, 11, 40, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(0, 0, 0);
        }
        
        $pdf->Image($url.'/'.$empresa->id_empresa.'/imagen/'.$empresa->logo, 12, 11, 40, 18);
        $pdf->SetFont('Arial', 'B', 14);
        $head_emp=0;
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>110){
            $pdf->SetXY(48, 12);
            $pdf->MultiCell(111,4,utf8_decode($empresa->nombre_empresa),0,'C');
            $head_emp=$pdf->GetY();
         }else{
             $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)) / 2), 12);
             $pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)), 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
             $head_emp=$pdf->GetY()-1;
         }
        //$pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)) / 2), 12);
        //$pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa[0]->nombre_empresa)), 8, utf8_decode($empresa[0]->nombre_empresa), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Comprobante Egreso')) / 2), $head_emp-2);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode('Comprobante Egreso')), 8,utf8_decode('Comprobante Egreso'), 0, 2, 'C', 0);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth('') / 2), 22);
        $pdf->Cell($pdf->GetStringWidth(''), 8, '', 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        
        $pdf->SetXY(($width / 6) * 4.5, 11.5);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "Fecha:", 0, 2, 'L', 0);
        //$pdf->Cell(15, 5, utf8_decode('Desde:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) * 5, 11.5);
        // $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        //if ($fecha_ini != null) {
            //$fec_desde = date("d/m/Y", strtotime($datos[0]->fecha_reguistro));
            //$fec_hasta = date("d/m/Y", strtotime($datos[0]->fecha_conciliacion));
        //}
        $pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($fecha_actual), 5, $fecha_actual, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_desde), 5, $fec_desde, 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_hasta), 5, $fec_hasta, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($pdf->PageNo() . ' de {nb}'), 5, $pdf->PageNo() . ' de {nb}' , 0, 2, 'L', 0);
        $pdf->Ln(7);
        $existe_ident=0;
        //dd($datos[0]);
        if(isset($datos_pago[0]->identificacion)){
            $existe_ident++;
        }
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        // if($existe_ident<=0){
        //     $pdf->Cell(63.3, 4, utf8_decode("NÃºmero: ").$datos[0]->codigo, 0, 0, 'C', 0);
        //     $pdf->Cell(63.3, 4, utf8_decode("Comprobante: ").strtoupper($datos[0]->tipo), 0, 0, 'C', 0);
        //     $pdf->Cell(63.3, 4, utf8_decode("Fecha: ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 0, 'C', 0);
        // }else{
        //     $pdf->Cell(38, 4, utf8_decode("NÃºmero: ").$datos[0]->codigo, 0, 0, 'L', 0);
        //     $pdf->Cell(38, 4, utf8_decode("Comprobante: ").strtoupper($datos[0]->tipo), 0, 0, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode("Fecha: ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 0, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode($datos[0]->tipo_identificacion), 0, 1, 'C', 0);
        //     $pdf->Cell(38, 4, utf8_decode("IdentificaciÃ³n: ").$datos[0]->ruc_ci, 0, 1, 'C', 0);
        // }
        if($index>0){
            $pdf->Cell(95, 4, utf8_decode("NÃºmero:          ")."PP-".$index, 0, 0, 'L', 0);
        }else{
            $pdf->Cell(95, 4, utf8_decode("NÃºmero:          "), 0, 0, 'L', 0);
        }
        
        $fecha_cta="";
        if($cta_cobrar_pagos[0]->fecha_registro){
            $fecha_cta=$cta_cobrar_pagos[0]->fecha_registro;
        }else{
            $fecha_cta=$cta_cobrar_pagos[0]->fecha_pago;
        }
        //$pdf->Cell(95, 4, utf8_decode("Comprobante: ").strtoupper('egreso'), 0, 1, 'L', 0);
        $pdf->Cell(63.3, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($fecha_cta)), 0, 1, 'L', 0);
        //$pdf->Ln(5);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        if($pdf->GetStringWidth(utf8_decode($datos_pago[0]->nombre))>95){
            $head_razon_x=$pdf->GetX();
            $pdf->MultiCell(95, 3, utf8_decode("Razon Social: ").utf8_decode($datos_pago[0]->nombre), 0, 'L', 0);
            $head_razon_y=$pdf->GetY();
        }else{
            $pdf->Cell(95, 4, utf8_decode("Razon Social: ").utf8_decode($datos_pago[0]->nombre), 0, 0, 'L', 0);
        }
        
        //$pdf->MultiCell(95, 3, utf8_decode("Concepto:        ")."Pago Proveedor ".$fecha, 0,'L', 0);
        //$head_concepto=$pdf->GetY();
        //$head_concepto=$pdf->GetY();
        //$pdf->SetXY(10,$head_concepto+1);
        //$pdf->SetX(10);
        //if($existe_ident<=0){
        if($existe_ident>0){
        //$pdf->Cell(63.3, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($datos[0]->fmodifica)), 0, 1, 'L', 0);
        //}else{
            //$pdf->Cell(95, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($datos[0]->fmodifica)), 0, 0, 'L', 0);
            //$pdf->Cell(63.3, 4, utf8_decode($datos[0]->tipo_identificacion), 0, 0, 'L', 0);
            if($pdf->GetStringWidth(utf8_decode($datos_pago[0]->nombre))>95){
                $pdf->SetXY(105,42);
            }
            $pdf->Cell(95, 4, utf8_decode("IdentificaciÃ³n: ").$datos_pago[0]->identificacion, 0, 1, 'L', 0);
            
        }else{
            $pdf->Cell(95, 4, '', 0, 1, 'L', 0);
            
        }
        if($pdf->GetStringWidth(utf8_decode($datos_pago[0]->nombre))>95){
            $pdf->SetXY(10,$head_razon_y);
        }else{
            $pdf->SetX(10);
        }

        //$referencia = $cta_cliente[0]->referencia;
        
        $pdf->MultiCell(195, 4, utf8_decode("Concepto:       ")."Pago Factura ".$fecha, 0,'L', 0);
        $pdf->Ln(5);

        $existe_pago=0;
        foreach($datos as $detail){
            if($detail->pagos_por){
                $existe_pago++;
            }
        }
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 7);
        if($existe_pago<=0){
            $pdf->Cell(67.5, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
            $pdf->Cell(87.86, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
            $pdf->Ln();
        }else{
            $pdf->Cell(32.14, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
            $pdf->Cell(47.14, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
            $pdf->Cell(22.14, 5, utf8_decode("Fecha Pago"), 'TB', 0, 'C', 0);
            $pdf->Cell(35.14, 5, utf8_decode("Forma Pago"), 'TB', 0, 'C', 0);
            $pdf->Cell(19.14, 5, utf8_decode("No Documento"), 'TB', 0, 'C', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
            $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
            $pdf->Ln();
        }
        $pdf->SetFont('Arial', '', 7);
        $suma_debe_cliente=0;
        $suma_debe_pago=0;
        $suma_haber_cliente=0;
        $suma_haber_pago=0;
        $total_debe=0;
        $total_haber=0;
        $exist_mas_proyectos=0;
        $valor_real_cliente=0;
        $cliente_pago=0;
        foreach($cta_cliente as $detail){
            $cliente_pago+=$detail->debe;
        }
        if($cliente_pago!==$cta_cliente[0]->debe_talves){
            $valor_real_cliente=$cta_cliente[0]->debe_talves-$cliente_pago;
        }
        //dd()
        $id_cliente=0;
        foreach($cta_cliente as $detail){
            $pdf->SetFillColor(255,255,255);
            $id_cliente++;
            $diferencia_pago=0;
            if($existe_pago<=0){
                $pdf->Cell(67.5, 4, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
                if($detail->exist_plan_cuenta_cliente=="si"){
                    $pdf->Cell(87.86, 4, utf8_decode($detail->nombre_cuenta_cliente), 0, 0, 'L', 1);
                }else{
                    $pdf->Cell(87.86, 4, utf8_decode($detail->nombre_cuenta_grupo), 0, 0, 'L', 1);
                }
                // if($detail->proyectos==1){
                //     $pdf->Cell(17.14, 4, number_format($detail->debe_talves,2,".",","), 0, 0, 'R', 0);
                // }else{
                    //$pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                //}
                if(count($cta_cliente)<=$id_cliente){
                    if($valor_real_cliente!==0){
                        $diferencia_pago=$detail->debe+$valor_real_cliente;
                        $pdf->Cell(17.14, 4, number_format($diferencia_pago,2,".",","), 0, 0, 'R', 1);
                    }else{
                        $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 1);
                    }
                }else{
                    $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 1);
                }
                $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 1);
            }else{
                $pdf->Cell(32.14, 4, utf8_decode($detail->descripcion), 0, 0, 'L', 1);
                if($detail->exist_plan_cuenta_cliente=="si"){
                    $pdf->Cell(47.14, 4, utf8_decode($detail->nombre_cuenta_cliente), 0, 0, 'L', 1);
                }else{
                    $pdf->Cell(47.14, 4, utf8_decode($detail->nombre_cuenta_grupo), 0, 0, 'L', 1);
                }
                $pdf->Cell(22.14, 4, "", 0, 0, 'C', 1);
                $pdf->Cell(35.14, 4, utf8_decode(""), 0, 0, 'C', 1);
                $pdf->Cell(19.14, 4, utf8_decode(""), 0, 0, 'C', 1);
                // if($detail->proyectos==1){
                //     $pdf->Cell(17.14, 4, number_format($detail->debe_talves,2,".",","), 0, 0, 'R', 0);
                // }else{
                    //$pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
                //}
                if(count($cta_cliente)<=$id_cliente){
                    if($valor_real_cliente!==0){
                        $diferencia_pago=$detail->debe+$valor_real_cliente;
                        $pdf->Cell(17.14, 4, number_format($diferencia_pago,2,".",","), 0, 0, 'R', 1);
                    }else{
                        $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 1);
                    }
                }else{
                    $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 1);
                }
                $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 1);
            }
            // if($detail->proyectos==1){
            //     $suma_debe_cliente+=$detail->debe_talves;
            // }else{
                //$suma_debe_cliente+=$detail->debe;
            //}
            if(count($cta_cliente)<=$id_cliente){
                if($valor_real_cliente!==0){
                    $suma_debe_cliente+=$diferencia_pago;
                }else{
                    $suma_debe_cliente+=$detail->debe;
                }
            }else{
                $suma_debe_cliente+=$detail->debe;
            }

            $suma_haber_cliente+=$detail->haber;

            $pdf->Ln();
        }
        $valor_real_pago=0;
        $pagos=0;
        foreach($cta_pago as $detail){
            $pagos+=$detail->haber;
        }
        if($pagos!==$cta_pago[0]->haber_tal){
            $valor_real_pago=$cta_pago[0]->haber_tal-$pagos;
        }
        //dd()
        $id_pagos=0;
        foreach($cta_pago as $detail){
            $id_pagos++;
            $diferencia_pago=0;
            if($existe_pago<=0){
                $pdf->Cell(67.5, 4, utf8_decode($detail->descripcion), 0, 0, 'L', 1);
                $pdf->Cell(87.86, 4, utf8_decode($detail->nombre_cuenta), 0, 0, 'L', 1);
                $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 1);
                // if($detail->proyectos==1){
                //     $pdf->Cell(17.14, 4, number_format($detail->haber_tal,2,".",","), 0, 0, 'R', 0);
                // }else{
                    if(count($cta_pago)<=$id_pagos){
                        if($valor_real_pago!==0){
                            $diferencia_pago=$detail->haber+$valor_real_pago;
                            $pdf->Cell(17.14, 4, number_format($diferencia_pago,2,".",","), 0, 0, 'R', 1);
                        }else{
                            $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 1);
                        }
                    }else{
                        $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 1);
                    }
                //}
                //$pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
            }else{
                $pdf->Cell(32.14, 4, utf8_decode($detail->descripcion), 0, 0, 'L', 1);
                $pdf->Cell(47.14, 4, utf8_decode($detail->nombre_cuenta), 0, 0, 'L', 1);
                $pdf->Cell(22.14, 4, date("d/m/Y",strtotime($detail->fecha_pago)), 0, 0, 'C', 1);
                $pdf->Cell(35.14, 4, utf8_decode($detail->nombre_pago), 0, 0, 'L', 1);
                $pdf->Cell(19.14, 4, utf8_decode($detail->nro_tarjeta), 0, 0, 'C', 1);
                $pdf->Cell(17.14, 4, number_format($detail->debe,2,".",","), 0, 0, 'R', 1);
                // if($detail->proyectos==1){
                //     $pdf->Cell(17.14, 4, number_format($detail->haber_tal,2,".",","), 0, 0, 'R', 0);
                // }else{
                    if(count($cta_pago)<=$id_pagos){
                        if($valor_real_pago!==0){
                            $diferencia_pago=$detail->haber+$valor_real_pago;
                            $pdf->Cell(17.14, 4, number_format($diferencia_pago,2,".",","), 0, 0, 'R', 1);
                        }else{
                            $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 1);
                        }
                    }else{
                        $pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 1);
                    }
                    //$pdf->Cell(17.14, 4, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
                //}
                
            }
            $suma_debe_pago+=$detail->debe;
            // if($detail->proyectos==1){
            //     $suma_haber_pago+=$detail->haber_tal;
            // }else{
                //$suma_haber_pago+=$detail->haber;
            //}
            if(count($cta_pago)<=$id_pagos){
                if($valor_real_pago!==0){
                    $suma_haber_pago+=$diferencia_pago;
                }else{
                    $suma_haber_pago+=$detail->haber;
                }
            }else{
                $suma_haber_pago+=$detail->haber;
            }
            
            $pdf->Ln();
        }

        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(155.36, 6, 'TOTAL', 0, 0, 'C', 0);
        $total_debe=$suma_debe_cliente+$suma_debe_pago;
        $total_haber=$suma_haber_cliente+$suma_haber_pago;
        $pdf->Cell(17.4, 6, number_format($total_debe,2,".",","), 'T', 0, 'R', 0);
        $pdf->Cell(17.4, 6, number_format($total_haber,2,".",","), 'T', 0, 'R', 0);
        $pdf->Ln(30);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("ELABORADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("APROBADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("RECIBI CONFORME"), "T", 0, 'C', 0);
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode($usuario->nombres)." ".utf8_decode($usuario->apellidos), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        if($empresa->nombre_empresa=='C.E. FUEGOS GROUP'){
            $pdf->Cell(45, 5, utf8_decode('Shirley Egas / Carlos Egas'), 0, 0, 'C', 0);
        }else{
            $pdf->Cell(45, 5, utf8_decode($empresa->nomb_representante), 0, 0, 'C', 0);
        }
        //$pdf->Cell(45, 5, utf8_decode($empresa->nomb_representante), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("CI: "), 0, 0, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);

        // $pdf->SetX(20);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(20, 6, $datos[0]->codigo, 0, 0, 'C', 0);
        // $pdf->Cell(25, 6, 'IDENTIFICACION', 0, 0, 'C', 0);
        // $pdf->Cell(20, 6, $datos[0]->identificacion, 0, 0, 'R', 0);
        // $pdf->Cell(140, 6, $datos[0]->nombre, 0, 0, 'L', 0);
        // $pdf->Ln(10);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 7);
        // $pdf->Cell(31.7, 6, 'Nro. Comprobantes', 'TB', 0, 'C', 0);
        // $pdf->Cell(31.7, 6, 'Pagos Por', 'TB', 0, 'C', 0);
        // $pdf->Cell(21.7, 6, 'Fecha Pago', 'TB', 0, 'C', 0);
        // $pdf->Cell(61.7, 6, 'Forma Pago', 'TB', 0, 'C', 0);
        // $pdf->Cell(21.7, 6, 'Descuento', 'TB', 0, 'C', 0);
        // $pdf->Cell(21.7, 6, 'Pago', 'TB', 0, 'C', 0);
        // $pdf->Ln();
        // $pdf->SetFont('Arial', '', 7);
        // $saldo=0;
        // $total_saldo=0;
        // $descuento=0;
        // $total_descuento=0;
        // foreach($datos as $detail){
        //     $serie1="";
        //     $serie2="";
        //     $observacion="";
            
        //     if($detail->clave_acceso){
        //         $serie1=substr($detail->clave_acceso,24,3);
        //         $serie2=substr($detail->clave_acceso,27,3);
        //         $observacion=substr($detail->clave_acceso,30,9);
        //         $pdf->Cell(31.7, 4, $serie1."-".$serie2."-".$observacion, 0, 0, 'C', 0);
        //     }else{
        //         $pdf->Cell(31.7, 4, $detail->referencias, 0, 0, 'C', 0);
        //     }
        //     $pdf->Cell(31.7, 4, utf8_decode($detail->pagos_por), 0, 0, 'C', 0);
        //     $pdf->Cell(21.7, 4, date("d/m/Y",strtotime($detail->fmodifica)), 0, 0, 'C', 0);
        //     $pdf->Cell(61.7, 4, /*utf8_decode($detail->descripcion)*/'SIN UTILIZACION DEL SISTEMA FINANCIERO', 0, 0, 'L', 0);
        //     $pdf->Cell(21.7, 4, number_format($detail->descuento,2,".",","), 0, 0, 'R', 0);
        //     if($detail->valor_pagado>$detail->valor_cuota){
        //         $saldo=$detail->valor_cuota;
        //     }else{
        //         $saldo=$detail->valor_pagado; 
        //     }
        //     $total_saldo+=$saldo;
        //     $total_descuento+=$detail->descuento; 
        //     $pdf->Cell(21.7, 4, number_format($saldo,2,".",","), 0, 0, 'R', 0);
        //     $pdf->Ln();
        //     $saldo=0;
        // }
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(146.8, 6, 'TOTAL', 0, 0, 'C', 0);
        // $pdf->Cell(21.7, 6, number_format($total_descuento,2,".",","), 'T', 0, 'R', 0);
        // $pdf->Cell(21.7, 6, number_format($total_saldo,2,".",","), 'T', 0, 'R', 0);
        // $pdf->Ln(30);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("ELABORADO POR"), "T", 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("APROBADO POR"), "T", 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("RECIBI CONFORME"), "T", 0, 'C', 0);
        // $pdf->Ln();
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', '', 8);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode($usuario->nombres)." ".utf8_decode($usuario->apellidos), 0, 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode($empresa->nombre_contador), 0, 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("CI: "), 0, 0, 'L', 0);
        // $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        // $existe_ident=0;

        
        // $existe_pago=0;
        // foreach($datos as $detail){
        //     if($detail->fecha_de_pago){
        //         $existe_pago++;
        //     }
        // }
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 7);
        // if($existe_pago<=0){
        //     $pdf->Cell(67.5, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(87.86, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
        // }else{
        //     $pdf->Cell(32.14, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(47.14, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(22.14, 5, utf8_decode("Fecha Pago"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(35.14, 5, utf8_decode("Forma Pago"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(19.14, 5, utf8_decode("No Documento"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
        // }
        
        
        // $pdf->Ln();
        // $suma_debe=0;
        // $suma_haber=0;
        // foreach($datos as $detail){
            
        //     $pdf->SetX(10);
        //     $pdf->SetFont('Arial', '', 7);
        //     if($existe_pago<=0){
        //         $pdf->Cell(67.5, 5, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
        //         $pdf->Cell(87.86, 5, $detail->codcta."-".utf8_decode($detail->nomcta), 0, 0, 'L', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
        //     }else{
        //         $pdf->Cell(32.14, 5, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
        //         $pdf->Cell(47.14, 5, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
        //         if($detail->fecha_de_pago){
        //             $pdf->Cell(22.14, 5, date("d/m/Y",strtotime($detail->fecha_de_pago)), 0, 0, 'C', 0);
        //         }else{
        //             $pdf->Cell(22.14, 5, "", 0, 0, 'C', 0);
        //         }
        //         $pdf->Cell(35.14, 5, utf8_decode($detail->descripcion_forma_p), 0, 0, 'L', 0);
        //         $pdf->Cell(19.14, 5, $detail->no_documento, 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
        //     }
        //     $pdf->Ln();
        //     $suma_debe+=$detail->debe;
        //     $suma_haber+=$detail->haber;
        // }
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(155.36, 5, utf8_decode("Total"), 0, 0, 'C', 0);
        // $pdf->Cell(17.14, 5, number_format($suma_debe,2,".",","), "T", 0, 'R', 0);
        // $pdf->Cell(17.14, 5, number_format($suma_haber,2,".",","), "T", 0, 'R', 0);
        // $pdf->Ln(30);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("ELABORADO POR"), "T", 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("APROBADO POR"), "T", 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("RECIBI CONFORME"), "T", 0, 'C', 0);
        // $pdf->Ln();
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', '', 8);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode($ucrea), 0, 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode($empresa[0]->nombre_contador), 0, 0, 'C', 0);
        // $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        // $pdf->Cell(45, 5, utf8_decode("CI: "), 0, 0, 'L', 0);
        if($ruta==null){
            $pdf->Output("pago_proveedor.pdf", "D");
        }else{
            $pdf->Output($ruta.'/'."pago_proveedor.pdf", "F");
        }
    }

    public function PDFBodegaIng($datos,$detalle,$empresa,$ruta=null){
        setlocale(LC_TIME, "spanish");
        //$pdf = new FPDF('P', 'mm', 'A4');
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $width = $pdf->GetPageWidth();
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $url=constant("DATA_EMPRESA");
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa.'/imagen/'.$empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            $pdf->Image($logo,  12, 11, 40, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(0, 0, 0);
        }
        //dd($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))/ 2);
        //$pdf->Image($url.'/'.$empresa->id_empresa.'/imagen/'.$empresa->logo, 12, 11, 40, 18);
        $pdf->SetFont('Arial', 'B', 14);
        $head_emp=0;
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>110){
            $pdf->SetXY(48, 12);
            $pdf->MultiCell(111,4,utf8_decode($empresa->nombre_empresa),0,'C');
            $head_emp=$pdf->GetY();
         }else{
             $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)) / 2), 12);
             $pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)), 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
             $head_emp=$pdf->GetY()-1;
         }
        //$pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nomb_empresa_ej)) / 2), 12);
        //$pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nomb_empresa_ej)), 8, utf8_decode($empresa->nomb_empresa_ej), 0, 2, 'C', 0);
        
        
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Ingreso Bodega')) / 2), $head_emp-2);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode('Ingreso Bodega')), 8,utf8_decode('Ingreso Bodega'), 0, 2, 'C', 0);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($datos[0]->nombre)) / 2), 22);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode($datos[0]->nombre)), 8, utf8_decode($datos[0]->nombre), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        
        $pdf->SetXY(($width / 6) * 4.5, 11.5);
        $pdf->SetFont('Arial', 'B', 8);
        //$pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "Fecha:", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Fecha Ingreso:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) * 5.1, 11.5);
        // $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        //if ($fecha_ini != null) {
            //$fec_desde = date("d/m/Y", strtotime($datos[0]->fecha_reguistro));
            //$fec_hasta = date("d/m/Y", strtotime($datos[0]->fecha_conciliacion));
        //}
        //$pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($fecha_actual), 5, $fecha_actual, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth(date("d/m/Y", strtotime($datos[0]->fecha_ingreso))), 5, date("d/m/Y", strtotime($datos[0]->fecha_ingreso)), 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_hasta), 5, $fec_hasta, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($pdf->PageNo() . ' de {nb}'), 5, $pdf->PageNo() . ' de {nb}' , 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $existe_ident=0;

        $pdf->Ln();
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("NÃºmero:                              ").$datos[0]->num_ingreso, 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("Tipo Ingreso:        ").utf8_decode($datos[0]->tipo_ingreso), 0, 1, 'L', 0);
        
        // //$pdf->Ln(5);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("Proyecto:                            ").utf8_decode($datos[0]->descripcion), 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("Observaciones:    ").utf8_decode($datos[0]->observ_ingreso), 0, 1, 'L', 0);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("Responsable de Bodega: ").utf8_decode($datos[0]->responsable), 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("TelÃ©fono:               ").utf8_decode($datos[0]->telefono), 0, 1, 'L', 0);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("UbicaciÃ³n:                          ").utf8_decode($datos[0]->ubicacion), 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("DirecciÃ³n:             ").utf8_decode($datos[0]->direccion), 0, 1, 'L', 0);
        // $pdf->SetX(10);
        
        $pdf->Ln(5);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(110, 4, utf8_decode("UbicaciÃ³n:                          ").utf8_decode($datos[0]->ubicacion), 0, 0, 'L', 0);
        $pdf->Cell(80, 4, utf8_decode("NÃºmero:         ").utf8_decode($datos[0]->num_ingreso), 0, 1, 'L', 0);
        
        //$pdf->Ln(5);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(110, 4, utf8_decode("DirecciÃ³n:                           ").utf8_decode($datos[0]->direccion), 0, 0, 'L', 0);
        $pdf->Cell(80, 4,utf8_decode("TelÃ©fono:        ").utf8_decode($datos[0]->telefono), 0, 1, 'L', 0);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(110, 4, utf8_decode("Responsable de Bodega: ").utf8_decode($datos[0]->responsable), 0, 0, 'L', 0);
        $pdf->Cell(80, 4, utf8_decode("Tipo Ingreso:  ").utf8_decode($datos[0]->tipo_ingreso), 0, 1, 'L', 0);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        if($datos[0]->nombre_proveedor){
            $pdf->Cell(110, 4, utf8_decode("Proveedor: ").utf8_decode($datos[0]->nombre_proveedor), 0, 0, 'L', 0);
        }
        
        //$pdf->Cell(95, 4, utf8_decode("DirecciÃ³n:             ").utf8_decode($datos[0]->direccion), 0, 1, 'L', 0);
        $pdf->Ln(5);
        //dd($pdf->GetPageWidth());
        // $pdf->Cell(15, 5, utf8_decode("Cod"), 'TB', 0, 'C', 0);
        // $pdf->Cell(104, 5, utf8_decode("Nombre"), 'TB', 0, 'C', 0);
        // $pdf->Cell(20, 5, utf8_decode("Cantidad"), 'TB', 0, 'C', 0);
        // $pdf->Cell(25, 5, utf8_decode("Costo Unitario"), 'TB', 0, 'R', 0);
        // $pdf->Cell(25, 5, utf8_decode("Costo Total"), 'TB', 0, 'R', 0);
        //$pdf->Ln();
        $margin = 10;
            $height = $pdf->GetY();
            $height_products = $height +2;
            //$pdf->SetFillColor(141, 207, 140);
                    $pdf->SetXY($margin, $height_products);
                    $pdf->MultiCell(15, 5, utf8_decode('Cod'), 'TB', 'C', 0);
                    $pdf->SetXY(25, $height_products);
                    $pdf->MultiCell(79, 5, utf8_decode('Nombre'), 'TB', 'C', 0);
                    $pdf->SetXY(104, $height_products);
                    $pdf->MultiCell(25, 5, utf8_decode('Proyecto'), 'TB', 'C', 0);
                    $pdf->SetXY(129, $height_products);
                    $pdf->MultiCell(20, 5, utf8_decode('Cantidad'), 'TB', 'C', 0);
                    $pdf->SetXY(149, $height_products);
                    $pdf->MultiCell(25, 5, utf8_decode('Costo Unitario'), 'TB', 'R', 0);
                    $pdf->SetXY(174, $height_products);
                    $pdf->MultiCell(25, 5, utf8_decode('Costo Total'), 'TB', 'R', 0);
                    
                    //dd("X=".$margin."Y=".$height_products);
                    $y = $height_products + 8;
                    $pdf->SetFont('Helvetica', '', 7);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetXY($margin, $height_products+6);
                    $pdf->SetWidths(array(15, 79, 25, 20,25,25));
        $total=0;
        foreach($detalle as $detail){
            $data = array(
                $detail->cod_principal."Centrado",
                utf8_decode($detail->nombre)."Centrado",
                utf8_decode($detail->descripcion_proy)."Centrado",
                $detail->cantidad."Centrado",
                number_format($detail->costo_unitario,2,'.',',')."Derecha",
                number_format($detail->costo_total,2,'.',',')."Derecha",
                
                //utf8_decode('INMEDIATA'),
                
            );
            $total+=$detail->costo_total;
            $pdf->RowWithoutImageBodega($data, 10);
        }
        // foreach($detalle as $detail){
        //     $pdf->SetX(10);
        //     $pdf->SetFont('Arial', '', 7);
        //     $pdf->Cell(15, 3, $detail->cod_principal, 0, 0, 'C', 0);
        //     $pdf->Cell(104, 3, utf8_decode($detail->nombre), 0, 0, 'L', 0);
        //     $pdf->Cell(20, 3, $detail->cantidad, 0, 0, 'C', 0);
        //     $pdf->Cell(25, 3, number_format($detail->costo_unitario,2,'.',','), 0, 0, 'R', 0);
        //     $pdf->Cell(25, 3, number_format($detail->costo_total,2,'.',','), 0, 0, 'R', 0);
        //     $pdf->Ln();
        //     $total+=$detail->costo_total;
        // }
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(165, 5, utf8_decode("Total"), 0, 0, 'C', 0);
        $pdf->Cell(25, 5, number_format($total,2,".",","), "T", 0, 'R', 0);
        $pdf->Ln(10);
        $pdf->SetX(15);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(95, 4, utf8_decode("Observaciones:    ").utf8_decode($datos[0]->observ_ingreso), 0, 1, 'L', 0);
        $pdf->Ln(5);

        $pdf->Ln(30);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("ELABORADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("APROBADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("RECIBI CONFORME"), "T", 0, 'C', 0);
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode($empresa->usuario), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        if($empresa->nombre_empresa=='C.E. FUEGOS GROUP'){
            $pdf->Cell(45, 5, utf8_decode('Shirley Egas / Carlos Egas'), 0, 0, 'C', 0);
        }else{
            $pdf->Cell(45, 5, utf8_decode($empresa->nomb_representante), 0, 0, 'C', 0);
        }
        //$pdf->Cell(45, 5, utf8_decode($empresa->nombre_contador), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("CI: "), 0, 0, 'L', 0);
        //if($ruta==null){
            $pdf->Output("ingreso_bodega ".utf8_decode($datos[0]->nombre)." ".$datos[0]->fecha_ingreso.".pdf", "D");
        //}else{
        //    $pdf->Output($ruta.'/'."asiento_contable.pdf", "F");
        //}
    }
    public function PDFBodegaEg($datos,$detalle,$empresa,$ruta=null){
        setlocale(LC_TIME, "spanish");
        //$pdf = new FPDF('P', 'mm', 'A4');
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $width = $pdf->GetPageWidth();
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $url=constant("DATA_EMPRESA");
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa.'/imagen/'.$empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            $pdf->Image($logo,  12, 11, 40, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(0, 0, 0);
        }
        //dd($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))/ 2);
        //$pdf->Image($url.'/'.$empresa->id_empresa.'/imagen/'.$empresa->logo, 12, 11, 40, 18);
        $pdf->SetFont('Arial', 'B', 14);
        $head_emp=0;
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>110){
            $pdf->SetXY(48, 12);
            $pdf->MultiCell(111,4,utf8_decode($empresa->nombre_empresa),0,'C');
            $head_emp=$pdf->GetY();
         }else{
             $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)) / 2), 12);
             $pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)), 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
             $head_emp=$pdf->GetY()-1;
         }
        //$pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nomb_empresa_ej)) / 2), 12);
        //$pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nomb_empresa_ej)), 8, utf8_decode($empresa->nomb_empresa_ej), 0, 2, 'C', 0);
        
        
        $pdf->SetFont('Arial', 'B', 12);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Egreso Bodega')) / 2), $head_emp-2);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode('Egreso Bodega')), 8,utf8_decode('Egreso Bodega'), 0, 2, 'C', 0);
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($datos[0]->nombre)) / 2), 22);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode($datos[0]->nombre)), 8, utf8_decode($datos[0]->nombre), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        
        $pdf->SetXY(($width / 6) * 4.5, 11.5);
        $pdf->SetFont('Arial', 'B', 8);
        //$pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "Fecha:", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Fecha Egreso:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) * 5.1, 11.5);
        // $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        //if ($fecha_ini != null) {
            //$fec_desde = date("d/m/Y", strtotime($datos[0]->fecha_reguistro));
            //$fec_hasta = date("d/m/Y", strtotime($datos[0]->fecha_conciliacion));
        //}
        //$pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($fecha_actual), 5, $fecha_actual, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth(date("d/m/Y", strtotime($datos[0]->fecha_egreso))), 5, date("d/m/Y", strtotime($datos[0]->fecha_egreso)), 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_hasta), 5, $fec_hasta, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($pdf->PageNo() . ' de {nb}'), 5, $pdf->PageNo() . ' de {nb}' , 0, 2, 'L', 0);
        $pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $existe_ident=0;

        $pdf->Ln();
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("NÃºmero:                              ").$datos[0]->num_ingreso, 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("Tipo Ingreso:        ").utf8_decode($datos[0]->tipo_ingreso), 0, 1, 'L', 0);
        
        // //$pdf->Ln(5);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("Proyecto:                            ").utf8_decode($datos[0]->descripcion), 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("Observaciones:    ").utf8_decode($datos[0]->observ_ingreso), 0, 1, 'L', 0);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("Responsable de Bodega: ").utf8_decode($datos[0]->responsable), 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("TelÃ©fono:               ").utf8_decode($datos[0]->telefono), 0, 1, 'L', 0);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("UbicaciÃ³n:                          ").utf8_decode($datos[0]->ubicacion), 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("DirecciÃ³n:             ").utf8_decode($datos[0]->direccion), 0, 1, 'L', 0);
        // $pdf->SetX(10);
        
        $pdf->Ln(5);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(110, 4, utf8_decode("UbicaciÃ³n:                          ").utf8_decode($datos[0]->ubicacion), 0, 0, 'L', 0);
        $pdf->Cell(80, 4, utf8_decode("NÃºmero:         ").utf8_decode($datos[0]->num_egreso), 0, 1, 'L', 0);
        
        //$pdf->Ln(5);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(110, 4, utf8_decode("DirecciÃ³n:                           ").utf8_decode($datos[0]->direccion), 0, 0, 'L', 0);
        $pdf->Cell(80, 4,utf8_decode("TelÃ©fono:        ").utf8_decode($datos[0]->telefono), 0, 1, 'L', 0);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(110, 4, utf8_decode("Responsable de Bodega: ").utf8_decode($datos[0]->responsable), 0, 0, 'L', 0);
        $pdf->Cell(80, 4, utf8_decode("Tipo Egreso:  ").utf8_decode($datos[0]->tipo_egreso), 0, 1, 'L', 0);
        
        //$pdf->Cell(95, 4, utf8_decode("DirecciÃ³n:             ").utf8_decode($datos[0]->direccion), 0, 1, 'L', 0);
        $pdf->Ln(5);
        //dd($pdf->GetPageWidth());
        $margin = 10;
            $height = $pdf->GetY();
            $height_products = $height +2;
            //$pdf->SetFillColor(141, 207, 140);
                    $pdf->SetXY($margin, $height_products);
                    $pdf->MultiCell(15, 5, utf8_decode('Cod'), 'TB', 'C', 0);
                    $pdf->SetXY(25, $height_products);
                    $pdf->MultiCell(79, 5, utf8_decode('Nombre'), 'TB', 'C', 0);
                    $pdf->SetXY(104, $height_products);
                    $pdf->MultiCell(25, 5, utf8_decode('Proyecto'), 'TB', 'C', 0);
                    $pdf->SetXY(129, $height_products);
                    $pdf->MultiCell(20, 5, utf8_decode('Cantidad'), 'TB', 'C', 0);
                    $pdf->SetXY(149, $height_products);
                    $pdf->MultiCell(25, 5, utf8_decode('Costo Unitario'), 'TB', 'R', 0);
                    $pdf->SetXY(174, $height_products);
                    $pdf->MultiCell(25, 5, utf8_decode('Costo Total'), 'TB', 'R', 0);
                    
                    //dd("X=".$margin."Y=".$height_products);
                    $y = $height_products + 8;
                    $pdf->SetFont('Helvetica', '', 7);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetXY($margin, $height_products+6);
                    $pdf->SetWidths(array(15, 79, 25, 20,25,25));
        // $pdf->Cell(15, 5, utf8_decode("Cod"), 'TB', 0, 'C', 0);
        // $pdf->Cell(104, 5, utf8_decode("Nombre"), 'TB', 0, 'C', 0);
        // $pdf->Cell(20, 5, utf8_decode("Cantidad"), 'TB', 0, 'C', 0);
        // $pdf->Cell(25, 5, utf8_decode("Costo Unitario"), 'TB', 0, 'R', 0);
        // $pdf->Cell(25, 5, utf8_decode("Costo Total"), 'TB', 0, 'R', 0);
        // $pdf->Ln();
        $total=0;
        foreach($detalle as $detail){
            $data = array(
                $detail->cod_principal."Centrado",
                utf8_decode($detail->nombre)."Centrado",
                utf8_decode($detail->descripcion_proy)."Centrado",
                $detail->cantidad."Centrado",
                number_format($detail->costo_unitario,2,'.',',')."Derecha",
                number_format($detail->costo_total,2,'.',',')."Derecha",
                
                //utf8_decode('INMEDIATA'),
                
            );
            $total+=$detail->costo_total;
            $pdf->RowWithoutImageBodega($data, 10);
        }
        // foreach($detalle as $detail){
        //     $pdf->SetX(10);
        //     $pdf->SetFont('Arial', '', 7);
        //     $pdf->Cell(15, 3, $detail->cod_principal, 0, 0, 'C', 0);
        //     $pdf->Cell(104, 3, utf8_decode($detail->nombre), 0, 0, 'L', 0);
        //     $pdf->Cell(20, 3, $detail->cantidad, 0, 0, 'C', 0);
        //     $pdf->Cell(25, 3, number_format($detail->costo_unitario,2,'.',','), 0, 0, 'R', 0);
        //     $pdf->Cell(25, 3, number_format($detail->costo_total,2,'.',','), 0, 0, 'R', 0);
        //     $pdf->Ln();
        //     $total+=$detail->costo_total;
        // }
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(165, 5, utf8_decode("Total"), 0, 0, 'C', 0);
        $pdf->Cell(25, 5, number_format($total,2,".",","), "T", 0, 'R', 0);
        $pdf->Ln(10);
        $pdf->SetX(15);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(95, 4, utf8_decode("Observaciones:    ").utf8_decode($datos[0]->observ_egreso), 0, 1, 'L', 0);
        $pdf->Ln(5);
        // if($datos[0]->ruc_ci){
        //     $existe_ident++;
        // }
        // $pdf->Ln();
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("NÃºmero:          ").$datos[0]->codigo, 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("Comprobante: ").strtoupper($datos[0]->tipo), 0, 1, 'L', 0);
        
        // //$pdf->Ln(5);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("Razon Social: ").utf8_decode($datos[0]->razon_social), 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("Concepto:        ").utf8_decode($datos[0]->concepto), 0, 1, 'L', 0);
        // $pdf->SetX(10);
        // if($existe_ident<=0){
        // $pdf->Cell(63.3, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 1, 'L', 0);
        // }else{
        //     $pdf->Cell(95, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 0, 'L', 0);
        //     //$pdf->Cell(63.3, 4, utf8_decode($datos[0]->tipo_identificacion), 0, 0, 'L', 0);
        //     $pdf->Cell(95, 4, utf8_decode("IdentificaciÃ³n: ").$datos[0]->ruc_ci, 0, 1, 'L', 0);
        // }
        // $pdf->Ln(5);
        // $existe_pago=0;
        // foreach($datos as $detail){
        //     if($detail->fecha_de_pago){
        //         $existe_pago++;
        //     }
        // }
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 7);
        // if($existe_pago<=0){
        //     $pdf->Cell(67.5, 5, utf8_decode("Proyecto"), 0, 0, 'C', 0);
        //     $pdf->Cell(87.86, 5, utf8_decode("Cuenta Contable"), 0, 0, 'C', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Debe"), 0, 0, 'R', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Haber"), 0, 0, 'R', 0);
        // }else{
        //     $pdf->Cell(32.14, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(47.14, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(22.14, 5, utf8_decode("Fecha Pago"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(35.14, 5, utf8_decode("Forma Pago"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(19.14, 5, utf8_decode("No Documento"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
        // }
        
        
        // $pdf->Ln();
        // $suma_debe=0;
        // $suma_haber=0;
        // foreach($datos as $detail){
            
        //     $pdf->SetX(10);
        //     $pdf->SetFont('Arial', '', 7);
        //     if($existe_pago<=0){
        //         $pdf->Cell(67.5, 5, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
        //         $pdf->Cell(87.86, 5, $detail->codcta."-".utf8_decode($detail->nomcta), 0, 0, 'L', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
        //     }else{
        //         $pdf->Cell(32.14, 5, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
        //         $pdf->Cell(47.14, 5, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
        //         if($detail->fecha_de_pago){
        //             $pdf->Cell(22.14, 5, date("d/m/Y",strtotime($detail->fecha_de_pago)), 0, 0, 'C', 0);
        //         }else{
        //             $pdf->Cell(22.14, 5, "", 0, 0, 'C', 0);
        //         }
        //         $pdf->Cell(35.14, 5, utf8_decode($detail->descripcion_forma_p), 0, 0, 'L', 0);
        //         $pdf->Cell(19.14, 5, $detail->no_documento, 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
        //     }
        //     $pdf->Ln();
        //     $suma_debe+=$detail->debe;
        //     $suma_haber+=$detail->haber;
        // }
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(155.36, 5, utf8_decode("Total"), 0, 0, 'C', 0);
        // $pdf->Cell(17.14, 5, number_format($suma_debe,2,".",","), "T", 0, 'R', 0);
        // $pdf->Cell(17.14, 5, number_format($suma_haber,2,".",","), "T", 0, 'R', 0);
        $pdf->Ln(30);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("ELABORADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("APROBADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("RECIBI CONFORME"), "T", 0, 'C', 0);
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode($empresa->usuario), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        if($empresa->nombre_empresa=='C.E. FUEGOS GROUP'){
            $pdf->Cell(45, 5, utf8_decode('Shirley Egas / Carlos Egas'), 0, 0, 'C', 0);
        }else{
            $pdf->Cell(45, 5, utf8_decode($empresa->nomb_representante), 0, 0, 'C', 0);
        }
        //$pdf->Cell(45, 5, utf8_decode($empresa->nombre_contador), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("CI: "), 0, 0, 'L', 0);
        //if($ruta==null){
            $pdf->Output("egreso_bodega ".utf8_decode($datos[0]->nombre)." ".$datos[0]->fecha_egreso.".pdf", "D");
        //}else{
        //    $pdf->Output($ruta.'/'."asiento_contable.pdf", "F");
        //}
    }
    public function PDFBodegaTransf($datos,$tipo,$detalle,$empresa,$ruta=null){
        setlocale(LC_TIME, "spanish");
        //$pdf = new FPDF('P', 'mm', 'A4');
        $pdf = new PDF_MC_Table('P', 'mm', 'A4');
        $fecha_actual = date("d/m/Y");
        $width = $pdf->GetPageWidth();
        $pdf->AddPage();
        $pdf->AliasNbPages();
        $url=constant("DATA_EMPRESA");
        $pdf->RoundedRect(10, 10, 190, 20, 2, '1234', 'D');
        $logo = constant("DATA_EMPRESA")  . $empresa->id_empresa.'/imagen/'.$empresa->logo;
        if ($empresa->logo!==null && file_exists($logo)) {
            $pdf->Image($logo,  12, 11, 40, 18);
        } else {
            $pdf->SetTextColor(255, 0, 0);
            $pdf->SetFont('Arial', 'B', 020);
            $pdf->Cell(50, 20, utf8_decode('NO TIENE LOGO'), 0, 2, 'C', 0);
            $pdf->SetTextColor(0, 0, 0);
        }
        //dd($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))/ 2);
        //$pdf->Image($url.'/'.$empresa->id_empresa.'/imagen/'.$empresa->logo, 12, 11, 40, 18);
        $pdf->SetFont('Arial', 'B', 14);
        $head_emp=0;
        if($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa))>110){
            $pdf->SetXY(48, 12);
            $pdf->MultiCell(111,4,utf8_decode($empresa->nombre_empresa),0,'C');
            $head_emp=$pdf->GetY();
         }else{
             $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)) / 2), 12);
             $pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nombre_empresa)), 8, utf8_decode($empresa->nombre_empresa), 0, 2, 'C', 0);
             $head_emp=$pdf->GetY()-1;
         }
        //$pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($empresa->nomb_empresa_ej)) / 2), 12);
        //$pdf->Cell($pdf->GetStringWidth(utf8_decode($empresa->nomb_empresa_ej)), 8, utf8_decode($empresa->nomb_empresa_ej), 0, 2, 'C', 0);
        
        
        $pdf->SetFont('Arial', 'B', 12);
        if($tipo=="emisor"){
            $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Transferencia Bodega Envio')) / 2), $head_emp-2);
            $pdf->Cell($pdf->GetStringWidth(utf8_decode('Transferencia Bodega Envio')), 8,utf8_decode('Transferencia Bodega Envio'), 0, 2, 'C', 0);
        }else{
            $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode('Transferencia Bodega Recepcion')) / 2), $head_emp-2);
            $pdf->Cell($pdf->GetStringWidth(utf8_decode('Transferencia Bodega Recepcion')), 8,utf8_decode('Transferencia Bodega Recepcion'), 0, 2, 'C', 0);
        }
        
        $pdf->SetXY(($width / 2) - ($pdf->GetStringWidth(utf8_decode($datos[0]->nombre)) / 2), 22);
        $pdf->Cell($pdf->GetStringWidth(utf8_decode($datos[0]->nombre)), 8, utf8_decode($datos[0]->nombre), 0, 2, 'C', 0);
        $pdf->SetFont('Arial', 'B', 12);
        
        $pdf->SetXY(($width / 6) * 4.5, 11.5);
        $pdf->SetFont('Arial', 'B', 8);
        //$pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        $pdf->Cell(15, 4, "Fecha:", 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Fecha Inicio:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('Fecha Fin:'), 0, 2, 'L', 0);
        $pdf->Cell(15, 5, utf8_decode('PÃ¡gina:'), 0, 2, 'L', 0);
        //$pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $pdf->SetXY(($width / 6) * 5.1, 11.5);
        // $pdf->SetXY(180, 10);
        $pdf->SetFont('Arial', '', 8);
        //if ($fecha_ini != null) {
            //$fec_desde = date("d/m/Y", strtotime($datos[0]->fecha_reguistro));
            //$fec_hasta = date("d/m/Y", strtotime($datos[0]->fecha_conciliacion));
        //}
        //$pdf->Cell(15, 4, "", 0, 2, 'L', 0);
        //dd($datos[0]);
        $pdf->Cell($pdf->GetStringWidth($fecha_actual), 4, $fecha_actual, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth(date("d/m/Y", strtotime($datos[0]->f_iniciacion))), 5, date("d/m/Y", strtotime($datos[0]->f_iniciacion)), 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth(date("d/m/Y", strtotime($datos[0]->f_finalizacion))), 5, date("d/m/Y", strtotime($datos[0]->f_finalizacion)), 0, 2, 'L', 0);
        //$pdf->Cell($pdf->GetStringWidth($fec_hasta), 5, $fec_hasta, 0, 2, 'L', 0);
        $pdf->Cell($pdf->GetStringWidth($pdf->PageNo() . ' de {nb}'), 5, $pdf->PageNo() . ' de {nb}' , 0, 2, 'L', 0);
        //$pdf->Cell(15, 5, "", 0, 2, 'L', 0);
        $existe_ident=0;

        $pdf->Ln();
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("NÃºmero:                              ").$datos[0]->num_ingreso, 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("Tipo Ingreso:        ").utf8_decode($datos[0]->tipo_ingreso), 0, 1, 'L', 0);
        
        // //$pdf->Ln(5);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("Proyecto:                            ").utf8_decode($datos[0]->descripcion), 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("Observaciones:    ").utf8_decode($datos[0]->observ_ingreso), 0, 1, 'L', 0);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("Responsable de Bodega: ").utf8_decode($datos[0]->responsable), 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("TelÃ©fono:               ").utf8_decode($datos[0]->telefono), 0, 1, 'L', 0);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("UbicaciÃ³n:                          ").utf8_decode($datos[0]->ubicacion), 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("DirecciÃ³n:             ").utf8_decode($datos[0]->direccion), 0, 1, 'L', 0);
        // $pdf->SetX(10);
        
        $pdf->Ln(5);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(110, 4, utf8_decode("UbicaciÃ³n:                          ").utf8_decode($datos[0]->ubicacion), 0, 0, 'L', 0);
        $pdf->Cell(80, 4, utf8_decode("NÃºmero:         ").utf8_decode($datos[0]->num_trans), 0, 1, 'L', 0);
        
        //$pdf->Ln(5);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(110, 4, utf8_decode("DirecciÃ³n:                           ").utf8_decode($datos[0]->direccion), 0, 0, 'L', 0);
        $pdf->Cell(80, 4,utf8_decode("TelÃ©fono:        ").utf8_decode($datos[0]->telefono), 0, 1, 'L', 0);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(110, 4, utf8_decode("Responsable de Bodega: ").utf8_decode($datos[0]->responsable), 0, 0, 'L', 0);
        $pdf->Cell(80, 4,  utf8_decode("Motivo:            ").utf8_decode($datos[0]->motivo_trans), 0, 1, 'L', 0);
        
        //$pdf->Cell(95, 4, utf8_decode("DirecciÃ³n:             ").utf8_decode($datos[0]->direccion), 0, 1, 'L', 0);
        $pdf->Ln(5);
        //dd($pdf->GetPageWidth());
        $margin = 10;
            $height = $pdf->GetY();
            $height_products = $height +2;
            //$pdf->SetFillColor(141, 207, 140);
                    $pdf->SetXY($margin, $height_products);
                    $pdf->MultiCell(15, 5, utf8_decode('Cod'), 'TB', 'C', 0);
                    $pdf->SetXY(25, $height_products);
                    $pdf->MultiCell(79, 5, utf8_decode('Nombre'), 'TB', 'C', 0);
                    $pdf->SetXY(104, $height_products);
                    $pdf->MultiCell(25, 5, utf8_decode('Proyecto'), 'TB', 'C', 0);
                    $pdf->SetXY(129, $height_products);
                    $pdf->MultiCell(20, 5, utf8_decode('Cantidad'), 'TB', 'C', 0);
                    $pdf->SetXY(149, $height_products);
                    $pdf->MultiCell(25, 5, utf8_decode('Costo Unitario'), 'TB', 'R', 0);
                    $pdf->SetXY(174, $height_products);
                    $pdf->MultiCell(25, 5, utf8_decode('Costo Total'), 'TB', 'R', 0);
                    
                    //dd("X=".$margin."Y=".$height_products);
                    $y = $height_products + 8;
                    $pdf->SetFont('Helvetica', '', 7);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetFillColor(255, 255, 255);
                    $pdf->SetXY($margin, $height_products+6);
                    $pdf->SetWidths(array(15, 79, 25, 20,25,25));
        // $pdf->Cell(15, 5, utf8_decode("Cod"), 'TB', 0, 'C', 0);
        // $pdf->Cell(104, 5, utf8_decode("Nombre"), 'TB', 0, 'C', 0);
        // $pdf->Cell(20, 5, utf8_decode("Cantidad"), 'TB', 0, 'C', 0);
        // $pdf->Cell(25, 5, utf8_decode("Costo Unitario"), 'TB', 0, 'R', 0);
        // $pdf->Cell(25, 5, utf8_decode("Costo Total"), 'TB', 0, 'R', 0);
        // $pdf->Ln();
        $total=0;
        foreach($detalle as $detail){
            $data = array(
                $detail->cod_principal."Centrado",
                utf8_decode($detail->nombre)."Centrado",
                utf8_decode($detail->descripcion_proy)."Centrado",
                $detail->cant_env."Centrado",
                number_format($detail->costo_unitario,2,'.',',')."Derecha",
                number_format($detail->costo_total,2,'.',',')."Derecha",
                
                //utf8_decode('INMEDIATA'),
                
            );
            $total+=$detail->costo_total;
            $pdf->RowWithoutImageBodega($data, 10);
        }
        // foreach($detalle as $detail){
        //     $pdf->SetX(10);
        //     $pdf->SetFont('Arial', '', 7);
        //     $pdf->Cell(15, 3, $detail->cod_principal, 0, 0, 'C', 0);
        //     $pdf->Cell(104, 3, utf8_decode($detail->nombre), 0, 0, 'L', 0);
        //     $pdf->Cell(20, 3, $detail->cantidad, 0, 0, 'C', 0);
        //     $pdf->Cell(25, 3, number_format($detail->costo_unitario,2,'.',','), 0, 0, 'R', 0);
        //     $pdf->Cell(25, 3, number_format($detail->costo_total,2,'.',','), 0, 0, 'R', 0);
        //     $pdf->Ln();
        //     $total+=$detail->costo_total;
        // }
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(165, 5, utf8_decode("Total"), 0, 0, 'C', 0);
        $pdf->Cell(25, 5, number_format($total,2,".",","), "T", 0, 'R', 0);
        $pdf->Ln(10);
        $pdf->SetX(15);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(95, 4, utf8_decode("Observaciones:    ").utf8_decode($datos[0]->observ_trans), 0, 1, 'L', 0);
        $pdf->Ln(5);
        // if($datos[0]->ruc_ci){
        //     $existe_ident++;
        // }
        // $pdf->Ln();
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("NÃºmero:          ").$datos[0]->codigo, 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("Comprobante: ").strtoupper($datos[0]->tipo), 0, 1, 'L', 0);
        
        // //$pdf->Ln(5);
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(95, 4, utf8_decode("Razon Social: ").utf8_decode($datos[0]->razon_social), 0, 0, 'L', 0);
        // $pdf->Cell(95, 4, utf8_decode("Concepto:        ").utf8_decode($datos[0]->concepto), 0, 1, 'L', 0);
        // $pdf->SetX(10);
        // if($existe_ident<=0){
        // $pdf->Cell(63.3, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 1, 'L', 0);
        // }else{
        //     $pdf->Cell(95, 4, utf8_decode("Fecha:             ").date("d/m/Y",strtotime($datos[0]->fecha)), 0, 0, 'L', 0);
        //     //$pdf->Cell(63.3, 4, utf8_decode($datos[0]->tipo_identificacion), 0, 0, 'L', 0);
        //     $pdf->Cell(95, 4, utf8_decode("IdentificaciÃ³n: ").$datos[0]->ruc_ci, 0, 1, 'L', 0);
        // }
        // $pdf->Ln(5);
        // $existe_pago=0;
        // foreach($datos as $detail){
        //     if($detail->fecha_de_pago){
        //         $existe_pago++;
        //     }
        // }
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 7);
        // if($existe_pago<=0){
        //     $pdf->Cell(67.5, 5, utf8_decode("Proyecto"), 0, 0, 'C', 0);
        //     $pdf->Cell(87.86, 5, utf8_decode("Cuenta Contable"), 0, 0, 'C', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Debe"), 0, 0, 'R', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Haber"), 0, 0, 'R', 0);
        // }else{
        //     $pdf->Cell(32.14, 5, utf8_decode("Proyecto"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(47.14, 5, utf8_decode("Cuenta Contable"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(22.14, 5, utf8_decode("Fecha Pago"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(35.14, 5, utf8_decode("Forma Pago"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(19.14, 5, utf8_decode("No Documento"), 'TB', 0, 'C', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Debe"), 'TB', 0, 'R', 0);
        //     $pdf->Cell(17.14, 5, utf8_decode("Haber"), 'TB', 0, 'R', 0);
        // }
        
        
        // $pdf->Ln();
        // $suma_debe=0;
        // $suma_haber=0;
        // foreach($datos as $detail){
            
        //     $pdf->SetX(10);
        //     $pdf->SetFont('Arial', '', 7);
        //     if($existe_pago<=0){
        //         $pdf->Cell(67.5, 5, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
        //         $pdf->Cell(87.86, 5, $detail->codcta."-".utf8_decode($detail->nomcta), 0, 0, 'L', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
        //     }else{
        //         $pdf->Cell(32.14, 5, utf8_decode($detail->descripcion), 0, 0, 'L', 0);
        //         $pdf->Cell(47.14, 5, utf8_decode($detail->nomcta), 0, 0, 'L', 0);
        //         if($detail->fecha_de_pago){
        //             $pdf->Cell(22.14, 5, date("d/m/Y",strtotime($detail->fecha_de_pago)), 0, 0, 'C', 0);
        //         }else{
        //             $pdf->Cell(22.14, 5, "", 0, 0, 'C', 0);
        //         }
        //         $pdf->Cell(35.14, 5, utf8_decode($detail->descripcion_forma_p), 0, 0, 'L', 0);
        //         $pdf->Cell(19.14, 5, $detail->no_documento, 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->debe,2,".",","), 0, 0, 'R', 0);
        //         $pdf->Cell(17.14, 5, number_format($detail->haber,2,".",","), 0, 0, 'R', 0);
        //     }
        //     $pdf->Ln();
        //     $suma_debe+=$detail->debe;
        //     $suma_haber+=$detail->haber;
        // }
        // $pdf->SetX(10);
        // $pdf->SetFont('Arial', 'B', 8);
        // $pdf->Cell(155.36, 5, utf8_decode("Total"), 0, 0, 'C', 0);
        // $pdf->Cell(17.14, 5, number_format($suma_debe,2,".",","), "T", 0, 'R', 0);
        // $pdf->Cell(17.14, 5, number_format($suma_haber,2,".",","), "T", 0, 'R', 0);
        $pdf->Ln(30);
        $pdf->SetX(10);
        $pdf->SetFont('Arial', 'B', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("ELABORADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("APROBADO POR"), "T", 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("RECIBI CONFORME"), "T", 0, 'C', 0);
        $pdf->Ln();
        $pdf->SetX(10);
        $pdf->SetFont('Arial', '', 8);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode($empresa->usuario), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        if($empresa->nombre_empresa=='C.E. FUEGOS GROUP'){
            $pdf->Cell(45, 5, utf8_decode('Shirley Egas / Carlos Egas'), 0, 0, 'C', 0);
        }else{
            $pdf->Cell(45, 5, utf8_decode($empresa->nomb_representante), 0, 0, 'C', 0);
        }
        //$pdf->Cell(45, 5, utf8_decode($empresa->nombre_contador), 0, 0, 'C', 0);
        $pdf->Cell(15, 5, "", 0, 0, 'C', 0);
        $pdf->Cell(45, 5, utf8_decode("CI: "), 0, 0, 'L', 0);
        //if($ruta==null){
            $pdf->Output("transferencia_bodega ".utf8_decode($datos[0]->nombre)." ".$datos[0]->f_iniciacion.".pdf", "D");
        //}else{
        //    $pdf->Output($ruta.'/'."asiento_contable.pdf", "F");
        //}
    }

    public function PDFKardex($kardex){

        $html = "";

        foreach ($kardex as $kardexs){

        $html .= '<table BORDER="1">';
    
            $html .= '<tr>';
                $html .= '<td bgcolor="#ffa959" width="1100" ALIGN="CENTER" size="12">';
                    $html .= '<b>KARDEX</b>';
                $html .= '</td>';
            $html .= '</tr>';
            $html .= '<tr>';
                $html .= '<td bgcolor="#ffc590" width="550" ALIGN="CENTER" size="7"><b>PRODUCTO: ' . strtoupper($kardexs->cod_principal) . ' - ' . strtoupper($kardexs->nombre_producto) . '</b></td>';
                $html .= '<td bgcolor="#ffc590" width="550" ALIGN="CENTER" size="7"><b>BODEGA: ' . strtoupper($kardexs->nombre_bodega) . '</b></td>';
            $html .= '</tr>';
            $html .= '<tr>';
                $html .= '<td width="550" ALIGN="CENTER" size="7"><b>EXISTENCIA MÃNIMA: ' . $kardexs->existencia_minima . '</b></td>';
                $html .= '<td width="550" ALIGN="CENTER" size="7"><b>EXISTENCIA MÃXIMA: ' . $kardexs->existencia_maxima . '</b></td>';
            $html .= '</tr>';
            $html .= '<tr>';
                $html .= '<td bgcolor="#ffca99" width="366.66" ALIGN="CENTER" size="7"><b>CANTIDAD: ' . number_format($kardexs->cantidad, 6, ".", ",") . '</b></td>';
                $html .= '<td bgcolor="#ffca99" width="366.66" ALIGN="CENTER" size="7"><b>COSTO UNITARIO: ' . number_format($kardexs->costo_unitario, 6, ".", ",") . '</b></td>';
                $html .= '<td bgcolor="#ffca99" width="366.66" ALIGN="CENTER" size="7"><b>COSTO TOTAL: ' . number_format($kardexs->costo_total, 6, ".", ",") . '</b></td>';
            $html .= '</tr>';
            $html .= '<br>';
            $html .= '<tr>';
                $html .= '<td bgcolor="#ffa959" width="440" ALIGN="CENTER" size="7"><b>INFORMACIÃN</b></td>';
                $html .= '<td bgcolor="#ffa959" width="220" ALIGN="CENTER" size="7"><b>INGRESOS</b></td>';
                $html .= '<td bgcolor="#ffa959" width="220" ALIGN="CENTER" size="7"><b>EGRESOS</b></td>';
                $html .= '<td bgcolor="#ffa959" width="220" ALIGN="CENTER" size="7"><b>SALDOS</b></td>';
            $html .= '</tr>';
            $html .= '<tr>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="28.35">No.</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="73.35">Fecha</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="195">Transaccion</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="143.35">Proveedor o Cliente</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="73.33">Cantidad</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="73.33" style="font-size: 45%;">Costo Unitario</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="73.33">Costo Total</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="73.33">Cantidad</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="73.33" style="font-size: 45%;">Costo Unitario</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="73.33">Costo Total</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="73.33">Cantidad</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="73.33" style="font-size: 45%;">Costo Unitario</td>';
                $html .= '<td ALIGN="CENTER" bgcolor="#ffc590" width="73.33">Costo Total</td>';
            $html .= '</tr>';
            $i=0;
            foreach ($kardexs->transacciones as $trans){

                if (($i % 2) == 0) {
                    $color = "#ffffff";
                }
                else{
                    $color = "#d8d8d8";
                }

                $html .= '<tr>';
                    $html .= '<td width="28.35" height="50" ALIGN="CENTER" bgcolor="' . $color .'">' . $trans->numero_transaccion . '</td>';
                    $html .= '<td width="73.35" height="50" ALIGN="CENTER" bgcolor="' . $color .'">' . explode(" ", $trans->fecha_transaccion)[0] . '</td>';
                    $html .= '<td width="195" height="50" ALIGN="CENTER" bgcolor="' . $color .'">' . $trans->documento . '</td>';
                    if ($trans->agente !=null){
                        $html .= '<td width="143.35" height="50" ALIGN="CENTER" bgcolor="' . $color .'">' . $trans->agente . '</td>';
                    }
                    else{
                        $html .= '<td width="143.35" height="50" ALIGN="CENTER" bgcolor="' . $color .'">' . $trans->tipo_transaccion . '</td>';
                    }
                    if($trans->cantidad_ingreso !=null){
                        $html .= '<td width="73.33" height="50" ALIGN="RIGHT" bgcolor="' . $color .'">' . number_format($trans->cantidad_ingreso, 6, ".", ",") . '</td>';
                    }
                    else{
                        $html .= '<td width="73.33" height="50" ALIGN="CENTER" bgcolor="' . $color .'">&nbsp;</td>';
                    }
                    if ($trans->costo_unitario_ingreso !=null){
                        $html .= '<td width="73.33" height="50" ALIGN="RIGHT" bgcolor="' . $color .'">' . number_format($trans->costo_unitario_ingreso, 6, ".", ",") . '</td>';
                    }
                    else{
                        $html .= '<td width="73.33" height="50" ALIGN="CENTER" bgcolor="' . $color .'">&nbsp;</td>';
                    }
                    if($trans->costo_total_ingreso !=null){
                        $html .= '<td width="73.33" height="50" ALIGN="RIGHT" bgcolor="' . $color .'">' . number_format($trans->costo_total_ingreso, 6, ".", ",") . '</td>';
                    }
                    else{
                        $html .= '<td width="73.33" height="50" ALIGN="CENTER" bgcolor="' . $color .'">&nbsp;</td>';
                    }
                    if($trans->cantidad_egreso !=null){
                        $html .= '<td width="73.33" height="50" ALIGN="RIGHT" bgcolor="' . $color .'">' . number_format($trans->cantidad_egreso, 6, ".", ",") . '</td>';
                    }
                    else{
                        $html .= '<td width="73.33" height="50" ALIGN="CENTER" bgcolor="' . $color .'">&nbsp;</td>';
                    }
                    if ($trans->costo_unitario_egreso !=null){
                        $html .= '<td width="73.33" height="50" ALIGN="RIGHT" bgcolor="' . $color .'">' . number_format($trans->costo_unitario_egreso, 6, ".", ",") . '</td>';
                    }
                    else{
                        $html .= '<td width="73.33" height="50" ALIGN="CENTER" bgcolor="' . $color .'">&nbsp;</td>';
                    }
                    if($trans->costo_total_egreso !=null){
                        $html .= '<td width="73.33" height="50" ALIGN="RIGHT" bgcolor="' . $color .'">' . number_format($trans->costo_total_egreso, 6, ".", ",") . '</td>';
                    }
                    else{
                        $html .= '<td width="73.33" height="50" ALIGN="CENTER" bgcolor="' . $color .'">&nbsp;</td>';
                    }
                    $html .= '<td width="73.33" height="50" ALIGN="RIGHT" bgcolor="' . $color .'">' . number_format($trans->cantidad_saldo, 6, ".", ",") . '</td>';
                    if ($trans->costo_unitario_saldo !==null){
                        $html .= '<td width="73.33" height="50" ALIGN="RIGHT" bgcolor="' . $color .'">' . number_format($trans->costo_unitario_saldo, 6, ".", ",") . '</td>';
                    }
                    else{
                        $html .= '<td width="73.33" height="50" ALIGN="CENTER" bgcolor="' . $color .'">&nbsp;</td>';
                    }
                    $html .= '<td width="73.33" height="50" ALIGN="RIGHT" bgcolor="' . $color .'">' . number_format($trans->costo_total_saldo, 6, ".", ",") . '</td>';
                $html .= '</tr>';
                $i++;
            }
            $html .= '</table><br><br>';
        }

        $pdf=new PDF('L');
        $pdf->SetFont('Arial','',6);
        $pdf->AddPage();
        $pdf->WriteHTML($html);
        $pdf->Output();
        exit;

    }

}
